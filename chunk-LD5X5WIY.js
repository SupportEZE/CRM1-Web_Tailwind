import{a as re}from"./chunk-PU6S26UW.js";import{a as ne}from"./chunk-OTFCGVEU.js";import{a as L}from"./chunk-CNF4GSI7.js";import{a as U}from"./chunk-DC4QM32I.js";import{C as oe,F as ae,g as X,j as Z,k as ee,r as te,w as ie}from"./chunk-VHE3PQ3O.js";import{A as g,B as E,C as R,D as x,H as q,M,Oa as H,P as O,Pa as W,Ta as Q,Ua as Y,V as j,X as G,Ya as $,Z as B,hb as K,o as I,oa as z,w as N,wa as J}from"./chunk-GYDYF5F3.js";import{f as A,g as P,n as D,t as w}from"./chunk-PD5VTTIY.js";import{Aa as p,Ba as c,Hb as b,Mc as h,Ob as C,Pc as T,_b as n,ed as k,fd as V,kc as l,lc as d,mc as f,qc as v,rb as s,sb as u,wc as _,yc as m}from"./chunk-2NSPOFEK.js";import{a as S,b as F}from"./chunk-66YHNWRR.js";function le(a,o){if(a&1){let e=v();l(0,"div",6)(1,"label",13),h(2,"Product Images"),l(3,"span",14),h(4,"*"),d()(),l(5,"file-pond",15),_("onremovefile",function(t){p(e);let r=m(2);return c(r.onFileRemove(t,"image"))})("onprocessfile",function(t){p(e);let r=m(2);return c(r.onFileProcessed(t,"image"))}),d()()}if(a&2){let e=m(2);s(5),n("options",e.pondOptions)("files",e.pondFiles)}}function de(a,o){if(a&1){let e=v();l(0,"div",1)(1,"app-modal-header",2),k(2,"titlecase"),_("close",function(){p(e);let t=m();return c(t.close())}),d(),l(3,"form",3),_("ngSubmit",function(){p(e);let t=m();return c(t.onSubmitSparePart())}),l(4,"mat-dialog-content",4)(5,"div",5)(6,"div",6),f(7,"spk-input",7),d(),l(8,"div",6),f(9,"spk-input",8),d(),l(10,"div",6),f(11,"spk-input",9),d(),C(12,le,6,2,"div",10),d()(),l(13,"mat-dialog-actions",11),f(14,"app-button",12),d()()()}if(a&2){let e=m();s(),n("title",V(2,16,e.pageType)+" Spare Part")("closeBtn",!0),s(2),n("formGroup",e.addForm),s(4),n("label","Product Name")("fieldReq",!0),s(2),n("label","MRP")("fieldReq",!0),s(2),n("label","Description")("fieldReq",!0),s(),n("ngIf",e.modalData.formType==="add"),s(2),n("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",e.api.disabled)("formType",e.modalData.formType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}function me(a,o){if(a&1){let e=v();l(0,"div",16)(1,"spk-ng-select",26),_("selectedChange",function(t){p(e);let r=m(2);return c(r.findName(t,"assign_to_type"))}),d()()}if(a&2){let e=m(2);s(),n("fieldReq",!0)("options",e.assign_to_type)}}function pe(a,o){if(a&1){let e=v();l(0,"div",16)(1,"spk-ng-select",27),_("selectedChange",function(t){p(e);let r=m(2);return c(r.findName(t,"assign_from"))}),d()()}if(a&2){let e=m(2);s(),n("fieldReq",!0)("options",e.assign_from)}}function ce(a,o){if(a&1){let e=v();l(0,"div",16)(1,"spk-ng-select",28),_("selectedChange",function(t){p(e);let r=m(2);return c(r.findName(t,"customer_name"))})("searchChanged",function(t){p(e);let r=m(2);return c(r.onSearch(t,"customer"))}),d()()}if(a&2){let e=m(2);s(),n("label",e.stockForm.value.assign_to_type)("fieldReq",!0)("options",e.stockForm.value.assign_to_type==="Team"?e.CommonApiService.userData:e.CommonApiService.customerData)("search",!0)}}function _e(a,o){if(a&1){let e=v();l(0,"div",16)(1,"spk-ng-select",29),_("selectedChange",function(t){p(e);let r=m(2);return c(r.findName(t,"customer_name"))}),d()()}if(a&2){let e=m(2);s(),n("formControlName",e.stockForm.value.assign_from==="Customer"?"assign_from_user_id":"assigned_to_user_id")("fieldReq",!0)("options",e.stockForm.value.assign_from==="Customer"?e.CommonApiService.customerData:e.CommonApiService.userData)}}function ue(a,o){if(a&1){let e=v();l(0,"div",16)(1,"spk-ng-select",30),_("selectedChange",function(t){p(e);let r=m(2);return c(r.findName(t,r.stockForm.value.assign_from==="Customer"?"service_user":"customer"))}),d()()}if(a&2){let e=m(2);s(),n("label",e.stockForm.value.assign_from==="Customer"?"Assign To (Customer)":"Assign To (Service User)")("fieldReq",!0)("options",e.stockForm.value.assign_from==="Customer"?e.CommonApiService.userData:e.CommonApiService.customerData)}}function ge(a,o){a&1&&(l(0,"div",16),f(1,"spk-input",31),d()),a&2&&(s(),n("label","Vendor")("fieldReq",!0))}function fe(a,o){if(a&1&&(l(0,"mat-option",32),h(1),d()),a&2){let e=o.$implicit;n("value",e._id),s(),T("",e.product_name," (",e.product_code,")")}}function ve(a,o){a&1&&(l(0,"div",33),h(1," Product is required. "),d())}function he(a,o){if(a&1){let e=v();l(0,"div",1)(1,"app-modal-header",2),_("close",function(){p(e);let t=m();return c(t.close())}),d(),l(2,"form",3),_("ngSubmit",function(){p(e);let t=m();return c(t.onSubmitManageStock())}),l(3,"mat-dialog-content",4)(4,"div",5)(5,"div",16)(6,"spk-ng-select",17),_("selectedChange",function(){p(e);let t=m();return c(t.getAssignToTypeOptions())}),d()(),C(7,me,2,2,"div",18)(8,pe,2,2,"div",18)(9,ce,2,4,"div",18)(10,_e,2,3,"div",18)(11,ue,2,3,"div",18)(12,ge,2,2,"div",18),l(13,"div",19)(14,"label",13),h(15,"Product"),l(16,"span",14),h(17,"*"),d()(),l(18,"mat-form-field",20)(19,"mat-select",21),_("ngModelChange",function(t){p(e);let r=m();return c(r.findName(t,"product_name"))}),C(20,fe,2,3,"mat-option",22),d()(),C(21,ve,2,0,"div",23),d(),l(22,"div",16),f(23,"spk-input",24),d(),l(24,"div",16),f(25,"spk-input",25),d()()(),l(26,"mat-dialog-actions",11),f(27,"app-button",12),d()()()}if(a&2){let e,i,t=m();s(),n("title","Manage Transaction")("closeBtn",!0),s(),n("formGroup",t.stockForm),s(4),n("fieldReq",!0)("options",t.transaction_type),s(),n("ngIf",t.stockForm.value.transaction_type!=="External"),s(),n("ngIf",((e=t.stockForm.get("transaction_type"))==null?null:e.value)==="External"),s(),n("ngIf",t.stockForm.value.assign_to_type&&t.stockForm.value.assign_to_type!=="Vendor"),s(),n("ngIf",t.stockForm.value.transaction_type==="External"),s(),n("ngIf",t.stockForm.value.transaction_type==="External"&&(t.stockForm.value.assign_from==="Customer"||t.stockForm.value.assign_from==="Team")),s(),n("ngIf",t.stockForm.value.assign_to_type==="Vendor"),s(8),n("ngForOf",t.listing),s(),n("ngIf",((i=t.stockForm.get("product_id"))==null?null:i.invalid)&&((i=t.stockForm.get("product_id"))==null?null:i.touched)),s(2),n("label","Qty")("fieldReq",!0),s(2),n("label","Description")("fieldReq",!0),s(2),n("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",t.api.disabled)("formType",t.modalData.formType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}var se=class a{constructor(o,e,i,t,r,y,Ce,ye,Se){this.modalData=o;this.dialogRef=e;this.api=i;this.toastr=t;this.CommonApiService=r;this.fb=y;this.uploadService=Ce;this.logService=ye;this.moduleService=Se}data={};pageType="add";skLoading=!1;addForm=new x({});stockForm=new x({});modules={};assign_to_type=[];assign_from=[];listing=[];submodule;originalData={};ngOnInit(){let o=this.moduleService.getSubModuleByName("WCMS","Spare Part");o&&(this.modules=o,console.log(this.modules)),this.modalData.formType==="manage-transaction"&&this.getList(),this.addForm=this.fb.group({product_name:["",g.required],mrp:["",g.required],description:["",g.required],_id:[""]}),this.stockForm=this.fb.group({transaction_type:["",g.required],assign_to_type:[""],assign_from:[""],assigned_to_id:[""],assigned_to_user_id:[""],assigned_to_name:[""],assigned_from_name:[""],assigned_to_login_id:[""],product_id:["",g.required],product_name:["",g.required],delivery_note:["",g.required],transaction_qty:["",g.required]}),this.stockForm.get("transaction_type")?.valueChanges.subscribe(e=>{e==="Fresh Purchase"?(this.stockForm.get("assign_to_type")?.clearValidators(),this.stockForm.get("assigned_to_id")?.clearValidators(),this.stockForm.get("assigned_to_login_id")?.clearValidators(),this.stockForm.get("assign_to_type")?.updateValueAndValidity(),this.stockForm.get("assigned_to_id")?.updateValueAndValidity(),this.stockForm.get("assigned_to_login_id")?.updateValueAndValidity()):e==="External"?(this.stockForm.get("assign_from")?.clearValidators(),this.stockForm.get("assign_from")?.updateValueAndValidity()):(this.stockForm.get("assigned_to_login_id")?.setValidators([g.required]),this.stockForm.get("assigned_to_login_id")?.updateValueAndValidity())}),this.modalData.formType==="edit"&&(this.pageType=this.modalData.formType,this.addForm.patchValue(F(S({},this.modalData.formData),{_id:this.modalData.formData._id})),this.originalData=JSON.parse(JSON.stringify(this.modalData.formData)))}onSearch(o,e){e==="customer"&&this.CommonApiService.getCustomerData(this.stockForm.value.customer_type_id,"",o),e==="user"&&this.CommonApiService.getUserData(o)}findName(o,e){if(e==="assign_to_type"||e==="assign_from"){let i=this.stockForm.value.assign_to_type,t=this.stockForm.value.assign_from;if((i==="Team"||t==="Team")&&this.CommonApiService.getUserData([I.SERVICE_FIELD_USER],""),i==="Customer"||t==="Customer"){this.CommonApiService.getCustomerData();let r=this.CommonApiService.customerData.find(y=>y.value===o);r&&(this.stockForm.patchValue({assigned_to_name:r.label}),this.stockForm.patchValue({assigned_to_login_id:r.login_type_id}))}}if(e==="customer_name"){let i=this.stockForm.value.assign_to_type;if(i==="Team"){let t=this.CommonApiService.userData.find(r=>r.value===o);t&&(this.stockForm.patchValue({assigned_to_name:t.label}),this.stockForm.patchValue({assigned_to_login_id:t.login_type_id}))}if(i==="Customer"){let t=this.CommonApiService.customerData.find(r=>r.value===o);t&&this.stockForm.patchValue({assigned_to_name:t.label||"",assigned_to_login_id:t.login_type_id||""})}}if(e==="customer"){let i=this.CommonApiService.customerData.find(t=>t.value===o);i&&this.stockForm.patchValue({assigned_to_name:i.label||"",assigned_to_login_id:i.login_type_id||""})}if(e==="service_user"){let i=this.CommonApiService.userData.find(t=>t.value===o);i&&this.stockForm.patchValue({assigned_to_name:i.label||"",assigned_to_login_id:i.login_type_id||""})}if(e==="product_name"){let i=this.listing.find(t=>t._id===o);i&&this.stockForm.patchValue({product_name:i.product_name})}}getList(){this.api.post({page:1},"spare-part/read").subscribe(o=>{o.statusCode==200&&(this.listing=o.data.result)})}pondFiles=[];pondOptions=this.getPondOptions("image");getPondOptions(o){let e={allowFileTypeValidation:!0,labelIdle:"Click or drag files here to upload...",maxFiles:5,server:{process:(i,t,r,y)=>{setTimeout(()=>{y(Date.now().toString())},1e3)},revert:(i,t)=>{t()}}};if(o==="image")return F(S({},e),{allowMultiple:!1,acceptedFileTypes:["image/jpeg","image/png","image/jpg"],maxFileSize:"2MB",allowImageValidateSize:!0,labelFileTypeNotAllowed:"Only PNG and JPEG files are allowed",fileValidateTypeLabelExpectedTypes:"Allowed: PNG, JPEG",labelImageValidateSizeTooSmall:"Image is too small. Min: {minWidth}\xD7{minHeight}",labelImageValidateSizeTooBig:"Image is too large. Max: {maxWidth}\xD7{maxHeight}"})}onFileProcessed(o,e){let i=o.file.file;Object.assign(i,{image_type:e}),e==="image"&&(this.pondFiles=[...this.pondFiles||[],i])}onFileRemove(o,e){let i=o.file.file;if(e==="image"){let t=this.pondFiles.findIndex(r=>r.name===i.name&&r.size===i.size);t>-1&&this.pondFiles.splice(t,1)}}onSubmitSparePart(){if(this.addForm.invalid){this.addForm.markAllAsTouched();return}if(this.pondFiles.length===0&&this.modalData.formType==="add"){this.toastr.error("Please upload at least one file.","","toast-top-right");return}this.api.disabled=!0;let o=this.pageType==="edit";if(o&&this.logService.logActivityOnUpdate(o,this.originalData,this.addForm.value,this.modules.module_id,this.modules.title,"update",this.originalData._id||null,()=>{},this.modules.module_type)&&this.pondFiles.length===0){this.api.disabled=!1,this.toastr.warning("No changes detected","","toast-top-right");return}let e=o?"patch":"post",i=o?"spare-part/update-spare-part":"spare-part/create-spare-part";this.api[e](this.addForm.value,i).subscribe(t=>{t.statusCode===200&&(this.pondFiles.length>0?(this.api.disabled=!0,this.uploadService.uploadFile(t.data.inserted_id,"spare-part",this.pondFiles,"Spare Part Images",this.modules,void 0,()=>this.dialogRef.close(!0))):(this.api.disabled=!1,this.toastr.success(t.message,"","toast-top-right"),this.dialogRef.close(!0)))})}onSubmitManageStock(){if(this.stockForm.invalid){this.toastr.error("Form Is Invalid","","toast-top-right"),this.stockForm.markAllAsTouched();let o=Object.keys(this.stockForm.controls).filter(e=>this.stockForm.get(e)?.invalid);console.warn("Invalid fields:",o);return}this.stockForm.value.transaction_type==="Fresh Purchase"&&(delete this.stockForm.value.assigned_to_id,delete this.stockForm.value.assigned_to_login_id),this.api.disabled=!0,this.api.post(this.stockForm.value,"spare-part/create-manage-stock").subscribe(o=>{o.statusCode===200&&(this.api.disabled=!1,this.toastr.success(o.message,"","toast-top-right"),this.dialogRef.close(!0))})}getAssignToTypeOptions(){return this.assign_to_type=[],this.assign_from=[],this.stockForm.value.transaction_type==="Fresh Purchase"&&this.assign_to_type.push({label:"Vendor",value:"Vendor"}),this.stockForm.value.transaction_type==="External"?this.assign_from.push({label:"Team",value:"Team"},{label:"Customer",value:"Customer"}):this.assign_to_type.push({label:"Team",value:"Team"},{label:"Customer",value:"Customer"}),this.assign_to_type}close(){this.dialogRef.close()}transaction_type=[{label:"Fresh Purchase",value:"Fresh Purchase"},{label:"Assign",value:"Assign"},{label:"Return",value:"Return"},{label:"External",value:"External"}];static \u0275fac=function(e){return new(e||a)(u(W),u(H),u(B),u(N),u(L),u(j),u(re),u(ne),u(U))};static \u0275cmp=b({type:a,selectors:[["app-spare-part-add"]],decls:2,vars:2,consts:[["class","mat-dialoge",4,"ngIf"],[1,"mat-dialoge"],[3,"close","title","closeBtn"],[3,"ngSubmit","formGroup"],[1,"mat-typography","py-1"],[1,"grid","grid-cols-12","sm:gap-x-6"],[1,"xl:col-span-12","col-span-12"],["formControlName","product_name",1,"remove-default-class",3,"label","fieldReq"],["formControlName","mrp","type","number",1,"remove-default-class",3,"label","fieldReq"],["formControlName","description","type","textarea",1,"remove-default-class",3,"label","fieldReq"],["class","xl:col-span-12 col-span-12",4,"ngIf"],["align","end",1,"gap-2"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],[1,"form-label","mb-0"],[1,"text-red-500"],[1,"filepond","basic-filepond",3,"onremovefile","onprocessfile","options","files"],[1,"xl:col-span-4","col-span-12"],["formControlName","transaction_type","label","Transaction Type",3,"selectedChange","fieldReq","options"],["class","xl:col-span-4 col-span-12",4,"ngIf"],[1,"xl:col-span-4","col-span-12","mb-3"],[1,"mat-custom-field"],["placeholder","Select an option","formControlName","product_id",3,"ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["class","error",4,"ngIf"],["formControlName","transaction_qty","type","number",1,"remove-default-class",3,"label","fieldReq"],["formControlName","delivery_note","type","textarea",1,"remove-default-class",3,"label","fieldReq"],["formControlName","assign_to_type","label","User Type",3,"selectedChange","fieldReq","options"],["formControlName","assign_from","label","Assign From Type",3,"selectedChange","fieldReq","options"],["formControlName","assigned_to_id",3,"selectedChange","searchChanged","label","fieldReq","options","search"],["label","Assign From",3,"selectedChange","formControlName","fieldReq","options"],["formControlName","assigned_to_id",3,"selectedChange","label","fieldReq","options"],["formControlName","assigned_to_name",1,"remove-default-class",3,"label","fieldReq"],[3,"value"],[1,"error"]],template:function(e,i){e&1&&C(0,de,15,18,"div",0)(1,he,28,23,"div",0),e&2&&(n("ngIf",i.modalData.formType==="add"||i.modalData.formType==="edit"),s(),n("ngIf",i.modalData.formType==="manage-transaction"))},dependencies:[w,A,P,D,ae,q,E,R,M,O,ie,X,oe,te,K,z,Y,Q,J,$,G,ee,Z],encapsulation:2})};export{se as a};
