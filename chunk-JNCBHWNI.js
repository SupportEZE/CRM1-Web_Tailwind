import{a as le,b as ne,c as me}from"./chunk-HMNG3Q5Y.js";import{a as re}from"./chunk-OTFCGVEU.js";import{a as B}from"./chunk-CNF4GSI7.js";import{a as L}from"./chunk-DC4QM32I.js";import{C as oe,F as ae,g as ee,r as te,w as ie}from"./chunk-VHE3PQ3O.js";import{A as s,B as I,C as k,D as V,Ga as J,H as N,Ha as H,Ia as Y,Ja as z,M as q,Oa as K,P as E,Pa as Q,Ta as W,Ua as X,V as R,W as U,X as j,Z as G,hb as Z,jb as $,o as x,va as O,w as M,wa as P,z as A}from"./chunk-GYDYF5F3.js";import{g as F,t as D}from"./chunk-PD5VTTIY.js";import{Aa as _,Ba as v,Hb as T,Lc as S,Mc as f,Ob as y,_b as r,kc as a,lc as l,mc as c,qc as w,rb as n,sb as d,wc as h,yc as u}from"./chunk-2NSPOFEK.js";import{a as C,b}from"./chunk-66YHNWRR.js";function de(p,t){p&1&&(a(0,"div",24),f(1," Date is required. "),l())}function se(p,t){p&1&&(a(0,"div",24),f(1," Time is required. "),l())}function ce(p,t){if(p&1&&(a(0,"div",8),c(1,"spk-ng-select",25),l()),p&2){let e=u(2);n(),r("label",e.addForm.value.category_type)("fieldReq",!0)("options",e.categoryTypeValue)}}function ue(p,t){if(p&1){let e=w();a(0,"div",3)(1,"app-modal-header",4),h("close",function(){_(e);let i=u();return v(i.closeModal())}),l(),a(2,"form",5),h("ngSubmit",function(){_(e);let i=u();return v(i.onSubmit())}),a(3,"mat-dialog-content",6)(4,"div",7)(5,"div",8)(6,"label",9),f(7,"Date"),a(8,"span",10),f(9,"*"),l()(),a(10,"mat-form-field",11),c(11,"input",12)(12,"mat-datepicker-toggle",13)(13,"mat-datepicker",null,0),l(),y(15,de,2,0,"div",14),l(),a(16,"div",15)(17,"label",9),f(18,"Time"),a(19,"span",10),f(20,"*"),l()(),a(21,"mat-form-field",11),c(22,"input",16),l(),c(23,"ngx-material-timepicker",null,1),y(25,se,2,0,"div",14),l(),a(26,"div",8),c(27,"spk-ng-select",17),l(),a(28,"div",8)(29,"spk-ng-select",18),h("selectedChange",function(){_(e);let i=u();return v(i.getCategoryTypeValue())}),l()(),y(30,ce,2,3,"div",19),a(31,"div",8)(32,"spk-ng-select",20),h("searchChanged",function(i){_(e);let g=u();return v(g.onSearch(i))})("selectedChange",function(i){_(e);let g=u();return v(g.findName(i,"user_name"))}),l()(),a(33,"div",8),c(34,"spk-input",21),l()()(),a(35,"mat-dialog-actions",22),c(36,"app-button",23),l()()()}if(p&2){let e,o,i=S(14),g=S(24),m=u();n(),r("title","Followup")("closeBtn",!0),n(),r("formGroup",m.addForm),n(9),r("matDatepicker",i)("min",m.today),n(),r("for",i),n(3),r("ngIf",((e=m.addForm.get("followup_date"))==null?null:e.invalid)&&((e=m.addForm.get("followup_date"))==null?null:e.touched)),n(7),r("ngxTimepicker",g),n(3),r("ngIf",((o=m.addForm.get("followup_time"))==null?null:o.invalid)&&((o=m.addForm.get("followup_time"))==null?null:o.touched)),n(2),r("label","Meeting Type")("fieldReq",!0)("options",m.followup_type),n(2),r("label","Followup Type")("fieldReq",!0)("options",m.category_type),n(),r("ngIf",m.addForm.value.category_type),n(2),r("label","User")("fieldReq",!0)("options",m.CommonApiService.userData)("search",!0),n(2),r("label","Remark")("fieldReq",!0),n(2),r("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",m.api.disabled)("formType",m.pageType.formType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}var pe=class p{constructor(t,e,o,i,g,m,fe,ge,_e){this.modalData=t;this.dialogRef=e;this.api=o;this.toastr=i;this.CommonApiService=g;this.fb=m;this.dateService=fe;this.logService=ge;this.moduleService=_e}addForm=new V({});data={};filter={};userList=[];categoryTypeValue=[];today=new Date;pageType={};originalData={};submodule;ngOnInit(){let t=this.moduleService.getSubModuleByName("SFA","Follow Up");t&&(this.submodule=t),this.CommonApiService.getUserData(),this.addForm=this.fb.group({followup_date:["",s.required],followup_time:["",s.required],followup_type:["",s.required],category_type:["",s.required],category_id:["",s.required],assigned_to_user_id:["",s.required],assigned_to_user_name:["",s.required],remark:["",s.required],_id:[""]}),this.modalData.formType==="edit"&&(this.pageType.formType=this.modalData.formType,this.addForm.patchValue(b(C({},this.modalData.formData),{_id:this.modalData.formData._id})),this.originalData=JSON.parse(JSON.stringify(this.modalData.formData)),this.getCategoryTypeValue()),this.modalData.enquiryType==="add"&&(this.addForm.patchValue(C({},this.modalData.formData)),this.pageType.enquiryType=this.modalData.enquiryType,this.getCategoryTypeValue())}findName(t,e){if(e==="user_name"){let o=this.CommonApiService.userData.find(i=>i.value===t);o&&this.addForm.patchValue({assigned_to_user_name:o.label})}}getCategoryTypeValue(){this.api.post({category_type:this.addForm.value.category_type},"followup/categories").subscribe(t=>{t.statusCode==200&&(this.categoryTypeValue=t.data)})}lastSearchTerm="";onSearch(t){let e=t?.trim()||"";e!==this.lastSearchTerm&&(this.lastSearchTerm=e,this.CommonApiService.getUserData([x.FIELD_USER],t))}onSubmit(){if(this.addForm.invalid){this.addForm.markAllAsTouched();return}this.api.disabled=!0;let t=this.pageType.formType==="edit";if(t&&this.logService.logActivityOnUpdate(t,this.originalData,this.addForm.value,this.submodule.module_id,this.submodule.title,"update",this.originalData._id||null,()=>{},this.submodule.module_type)){this.api.disabled=!1,this.toastr.warning("No changes detected","","toast-top-right");return}let e=t?"followup/update":"followup/create",o=t?"patch":"post";this.api[o](this.addForm.value,e).subscribe(i=>{i.statusCode===200&&(this.api.disabled=!1,this.dialogRef.close(!0),this.toastr.success(i.message,"","toast-top-right"))})}closeModal(){this.dialogRef.close()}followup_type=[{label:"Call",value:"Call"},{label:"Visit",value:"Visit"}];category_type=[{label:"Site",value:"Site"},{label:"Enquiry",value:"Enquiry"},{label:"Customer",value:"Customer"}];static \u0275fac=function(e){return new(e||p)(d(Q),d(K),d(G),d(M),d(B),d(R),d($),d(re),d(L))};static \u0275cmp=T({type:p,selectors:[["app-follow-up-add"]],decls:1,vars:1,consts:[["pickerStart",""],["followup_time",""],["class","mat-dialoge",4,"ngIf"],[1,"mat-dialoge"],[3,"close","title","closeBtn"],[3,"ngSubmit","formGroup"],[1,"mat-typography","py-1"],[1,"grid","grid-cols-12","sm:gap-x-6"],[1,"xl:col-span-4","col-span-12"],[1,"form-label","mb-0"],[1,"text-red-500"],[1,"mat-custom-field","remove-space"],["matInput","","placeholder","Select an date","formControlName","followup_date",3,"matDatepicker","min"],["matIconSuffix","",3,"for"],["class","error",4,"ngIf"],[1,"xl:col-span-4","col-span-12","mb-3"],["matInput","","formControlName","followup_time","placeholder","Select Time","readonly","",3,"ngxTimepicker"],["formControlName","followup_type",3,"label","fieldReq","options"],["formControlName","category_type",3,"selectedChange","label","fieldReq","options"],["class","xl:col-span-4 col-span-12",4,"ngIf"],["formControlName","assigned_to_user_id",3,"searchChanged","selectedChange","label","fieldReq","options","search"],["formControlName","remark","type","textarea",1,"remove-default-class","textarea",3,"label","fieldReq"],["align","end",1,"gap-2"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],[1,"error"],["formControlName","category_id",3,"label","fieldReq","options"]],template:function(e,o){e&1&&y(0,ue,37,28,"div",2),e&2&&r("ngIf",o.modalData.lastPage==="folloup-list")},dependencies:[U,N,A,I,k,D,F,ae,q,E,ie,ee,oe,Z,H,Y,z,X,W,J,P,O,j,te,me,le,ne],encapsulation:2})};export{pe as a};
