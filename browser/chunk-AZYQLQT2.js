import{a as ve}from"./chunk-J4NDCUAB.js";import{a as Ce}from"./chunk-GXF7AAOQ.js";import{a as H}from"./chunk-ZON5AR26.js";import"./chunk-LGZVJJDX.js";import"./chunk-54KZ5YIV.js";import{a as be}from"./chunk-SQZ3YN6N.js";import{c as he}from"./chunk-CIBZCVJQ.js";import{a as ge}from"./chunk-OTFCGVEU.js";import{a as k}from"./chunk-HPLI5COI.js";import"./chunk-DUVWFXSE.js";import{a as ne}from"./chunk-CNF4GSI7.js";import{a as ce}from"./chunk-OEHD5D2Y.js";import{a as ye}from"./chunk-GLWQGYBC.js";import{a as P}from"./chunk-DC4QM32I.js";import{C as fe,F as V,c as M,r as _e,s as ue,v as D}from"./chunk-VHE3PQ3O.js";import{B as J,C as Y,G as Z,H as ee,M as te,Oa as ae,Pa as se,Qa as le,V as T,W as ie,X as oe,Y as w,Z as L,Za as me,hb as de,jb as pe,l as I,na as re,w as X,y as q}from"./chunk-GYDYF5F3.js";import{f as F,g as S,t as E}from"./chunk-PD5VTTIY.js";import{Aa as _,Ba as u,Fc as G,Gc as U,Hb as x,Hc as $,Mc as O,Nc as N,Ob as c,Uc as z,Vc as Q,Wc as K,Xc as W,Yc as C,_b as r,bc as B,cc as j,kc as m,lc as l,mc as y,nc as b,oc as v,qc as h,rb as a,sb as p,wc as g,yc as d}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as A}from"./chunk-66YHNWRR.js";var Ae=()=>[];function Oe(o,t){o&1&&(m(0,"div",12),y(1,"app-skeleton"),l())}function Ne(o,t){o&1&&(m(0,"div",8)(1,"div",9)(2,"div",10),c(3,Oe,2,0,"div",11),l()()()),o&2&&(a(3),r("ngForOf",C(1,Ae).constructor(10)))}function He(o,t){if(o&1){let e=h();m(0,"app-form-field",24,0),g("valueChange",function(n){_(e);let s=d(2).$implicit,f=d(5);return u(f.onFieldChange(n,s))}),l()}if(o&2){let e=d(2).$implicit,i=d(5);r("field",e)("form",i.myForm)}}function Be(o,t){if(o&1&&(m(0,"div"),c(1,He,2,2,"app-form-field",23),l()),o&2){let e=d().$implicit;j("mb-4 ",e.class_name,""),a(),r("ngIf",e.is_show==!0)}}function je(o,t){if(o&1&&(b(0),c(1,Be,2,4,"div",22),v()),o&2){let e=t.$implicit;a(),r("ngIf",e.is_show==!0)}}function Ge(o,t){if(o&1&&(m(0,"div",20),c(1,je,2,1,"ng-container",21),l()),o&2){let e=d(4);a(),r("ngForOf",e.formFields)}}function Ue(o,t){if(o&1){let e=h();m(0,"form",15),g("ngSubmit",function(){_(e);let n=d(3);return u(n.onSubmit())}),m(1,"div",16)(2,"div",9),c(3,Ge,2,1,"div",17),l(),m(4,"div",18),y(5,"app-button",19),l()()()}if(o&2){let e=d(3);r("formGroup",e.myForm),a(3),r("ngIf",e.myForm&&e.myForm.controls),a(2),r("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",e.api.disabled)("formType",e.pageType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}function $e(o,t){if(o&1&&(m(0,"div",13),c(1,Ue,6,8,"form",14),l()),o&2){let e=d(2);a(),r("ngIf",e.formIniatialized)}}function ze(o,t){if(o&1){let e=h();m(0,"div",2)(1,"app-modal-header",3),g("close",function(){_(e);let n=d();return u(n.close())}),l(),y(2,"div",4),m(3,"div",5),c(4,Ne,4,2,"div",6)(5,$e,2,1,"div",7),l()()}if(o&2){let e=d();a(),r("title",e.originalData.name+" Expense Policy")("closeBtn",!0),a(3),r("ngIf",e.skLoading),a(),r("ngIf",!e.skLoading)}}var R=class o{constructor(t,e,i,n,s,f,Se,Ee,nt,rt){this.modalData=t;this.fb=e;this.toastr=i;this.api=n;this.dialogRef=s;this.dateService=f;this.formValidation=Se;this.util=Ee;this.moduleService=nt;this.logService=rt}states=[];today=new Date;formIniatialized=!1;skLoading=!1;myForm;formFields=[];moduleFormId=0;moduleId=0;submoduleId={};moduleName="";module_type="";primaryForm;FORMID=k;fieldTypes=I;formDropdown=[];formDropdownOption=[];userList=[];originalData={};pageType="add";ngOnInit(){this.pageType=this.modalData.formType;let t=this.moduleService.getSubModuleByName("Masters","Expense Policy"),e=this.moduleService.getFormById("Masters","Expense Policy",this.FORMID.ID.ExpensePolicyForm);t&&(this.moduleId=t.module_id,this.submoduleId=t.sub_module_id,this.moduleName=t.title,this.module_type=t.module_type),e&&(this.moduleFormId=e.form_id,this.getFormData())}initializeForm(){this.myForm=this.fb.group({}),this.formFields.forEach(t=>{t.control=this.fb.control("",this.formValidation.getValidators(t)),this.myForm.addControl(t.name,t.control)}),this.formIniatialized=!0}onFieldChange(t,e){if(e.type==this.fieldTypes.SINGLE_SELECT||e.type==this.fieldTypes.MULTI_SELECT||e.type==this.fieldTypes.RADIO_SELECT||e.type==this.fieldTypes.CHECKBOX_SELECT||e.type==this.fieldTypes.DATE||e.type==this.fieldTypes.TIME||e.type==this.fieldTypes.UPLOAD){if(e.key_name_required===!0){let i=e.options.findIndex(s=>s.value===t),n;i!==-1&&(n=e.options[i].label,this.formFields.forEach(s=>{s.name===s.key_name&&this.myForm.controls[s.name].setValue(n)}))}e.type==this.fieldTypes.SINGLE_SELECT&&e.key_source=="custom"||e.type==this.fieldTypes.MULTI_SELECT&&e.key_source=="custom"?(e.control.setValue(t),e.value=t.label):e.control.setValue(t)}e.type===this.fieldTypes.DATE&&this.myForm.controls[e.name].setValue(e.control.value),this.myForm.controls.flight.setValue(!0)}getFormData(){this.skLoading=!0,this.api.post({form_id:this.moduleFormId,platform:"web"},"form-builder/read").subscribe(t=>{t.statusCode==200&&(this.formFields=t.data.form_data,this.skLoading=!1,this.formFields.forEach(e=>{this.util.createValidation(e)}),this.initializeForm(),this.pageType==="edit"&&(this.originalData=A(A({},this.modalData.formData),this.modalData.formData.form_data),delete this.originalData.form_data,console.log(this.originalData,"originalData"),this.myForm.patchValue(this.originalData)),this.getUserList())})}getUserList(){this.api.post({},"user/read-dropdown").subscribe(t=>{if(t.statusCode==200){this.userList=t.data;for(let e=0;e<this.formFields.length;e++)this.formFields[e].name==="user_id"&&(this.formFields[e].options=t.data)}})}onSubmit(){if(this.formFields.forEach(t=>{(t.is_child_show===!1||t.is_show===!1)&&(this.myForm.get(t.name)?.clearValidators(),this.myForm.get(t.name)?.updateValueAndValidity())}),this.myForm.valid){this.api.disabled=!0;let t={primaryFields:{form_data:{}}};this.formFields.forEach(i=>{i.name&&this.myForm.value.hasOwnProperty(i.name)&&(i.read_only===!1&&i.key_source!=="custom"&&(t.primaryFields[i.name]=this.myForm.value[i.name]),i.key_source==="custom"&&(t.primaryFields.form_data[i.name]=this.myForm.value[i.name]))});let e=this.pageType==="edit";if(e&&this.logService.logActivityOnUpdate(e,this.originalData,this.myForm.value,this.submoduleId,this.moduleName,"update",this.originalData.user_id||null,()=>{},this.module_type)){this.api.disabled=!1,this.toastr.warning("No changes detected","","toast-top-right");return}this.api.post(t.primaryFields,"expense/save-allowance-master").subscribe(i=>{i.statusCode==200&&(this.api.disabled=!1,this.dialogRef.close(!0),this.toastr.success(i.message,"","toast-top-right"))})}else{this.toastr.error("Form Is Invalid","","toast-top-right"),this.formValidation.markFormGroupTouched(this.myForm);let t=Object.keys(this.myForm.controls).filter(e=>this.myForm.get(e)?.invalid);console.warn("Invalid fields:",t)}}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||o)(p(se),p(T),p(X),p(L),p(ae),p(pe),p(D),p(w),p(P),p(ge))};static \u0275cmp=x({type:o,selectors:[["app-expense-policy-add-modal"]],inputs:{formFields:"formFields"},features:[W([re()])],decls:1,vars:1,consts:[["dynamicForm",""],["class","mat-dialoge",4,"ngIf"],[1,"mat-dialoge"],[3,"close","title","closeBtn"],[1,"dropdown-divider"],[1,"xxl:col-span-8","xl:col-span-12","lg:col-span-12","md:col-span-6","col-span-12"],["class","box",4,"ngIf"],["class","xl:col-span-12 col-span-12",4,"ngIf"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","gap-x-6"],["class","xl:col-span-3 col-span-12 mb-4",4,"ngFor","ngForOf"],[1,"xl:col-span-3","col-span-12","mb-4"],[1,"xl:col-span-12","col-span-12"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"box","m-0","shadow-none"],["class","grid grid-cols-12 gap-x-4",4,"ngIf"],[1,"box-footer","border-t","border-block-start-dashed","sm:flex","justify-end"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],[1,"grid","grid-cols-12","gap-x-4"],[4,"ngFor","ngForOf"],[3,"class",4,"ngIf"],[3,"field","form","valueChange",4,"ngIf"],[3,"valueChange","field","form"]],template:function(e,i){e&1&&c(0,ze,6,4,"div",1),e&2&&r("ngIf",i.modalData.lastPage==="expense-policy-add")},dependencies:[E,F,S,V,ee,Y,te,Ce,M,fe,oe,de,_e],encapsulation:2})};var Qe=["reusableTable"],Ke=()=>["Expense Policy"],Fe=()=>[];function We(o,t){if(o&1&&(m(0,"span"),O(1),l()),o&2){let e,i=d().$implicit,n=d().$implicit;a(),N((e=(e=n[(i==null?null:i.actual_name)||(i==null?null:i.name)])!==null&&e!==void 0?e:n.form_data==null?null:n.form_data[i==null?null:i.name])!==null&&e!==void 0?e:"--")}}function Xe(o,t){if(o&1){let e=h();m(0,"span")(1,"input",17),K("ngModelChange",function(n){_(e);let s=d().$implicit,f=d().$implicit;return Q(f.form_data[s.name],n)||(f.form_data[s.name]=n),u(n)}),l()()}if(o&2){let e=d().$implicit,i=d(),n=i.$implicit,s=i.index;a(),z("ngModel",n.form_data[e.name]),r("id",e.name+s)("disabled",!0)}}function qe(o,t){if(o&1&&(b(0),m(1,"td"),c(2,We,2,1,"span",9)(3,Xe,2,3,"span",9),l(),v()),o&2){let e=t.$implicit;a(2),r("ngIf",e.type!=="CHECKBOX_SELECT"),a(),r("ngIf",e.type==="CHECKBOX_SELECT")}}function Je(o,t){if(o&1){let e=h();m(0,"app-icon-button",18),g("clickEvent",function(){_(e);let n=d().$implicit,s=d(2);return u(s.updateExpensePolicy(n))}),l()}o&2&&r("icon","ri-edit-line")("buttonClass","ti-btn btn-wave  ti-btn-sm ti-btn-soft-success waves-effect waves-light")}function Ye(o,t){if(o&1){let e=h();m(0,"tr",11)(1,"td",12),O(2),l(),c(3,qe,4,2,"ng-container",13),m(4,"td",12)(5,"div",14)(6,"app-icon-button",15),g("clickEvent",function(){let n=_(e).$implicit,s=d(2);return u(s.openMainLogModal(n._id))}),l(),c(7,Je,1,2,"app-icon-button",16),l()()()}if(o&2){let e=t.index,i=d(2);a(2),N(e+1),a(),r("ngForOf",i.visibleHeaders),a(3),r("icon","ri-file-list-line")("buttonClass","ti-btn btn-wave  ti-btn-sm ti-btn-soft-primary waves-effect waves-light"),a(),r("ngIf",i.accessRight==null?null:i.accessRight.modifyRight)}}function Ze(o,t){if(o&1&&(b(0),c(1,Ye,8,5,"tr",10),v()),o&2){let e=d();a(),r("ngForOf",e.listing)}}function et(o,t){o&1&&(m(0,"td",22),y(1,"app-skeleton"),l()),o&2&&(a(),B("h20 bg-skeleton"))}function tt(o,t){o&1&&(m(0,"tr",20),c(1,et,2,2,"td",21),l()),o&2&&(a(),r("ngForOf",C(1,Fe).constructor(8)))}function it(o,t){o&1&&(b(0),c(1,tt,2,2,"tr",19),v()),o&2&&(a(),r("ngForOf",C(1,Fe).constructor(16)))}function ot(o,t){o&1&&(b(0),y(1,"app-data-not-found"),v())}var xe=class o{constructor(t,e,i,n,s,f,Se,Ee){this.moduleService=t;this.api=e;this.dialog=i;this.formValidation=n;this.fb=s;this.util=f;this.comanFuncation=Se;this.CommonApiService=Ee}reusableTable;FORMID=k;filter={};sorting={};skLoading=!1;moduleFormId=0;moduleTableId=0;subModule={};originalFormFields=[];formFields=[];fieldTypes=I;formIniatialized=!1;myForm;accessRight={};ngOnInit(){let t=this.moduleService.getAccessMap("Masters","Expense Policy");t&&(this.accessRight=t);let e=this.moduleService.getSubModuleByName("Masters","Expense Policy"),i=this.moduleService.getFormById("Masters","Expense Policy",this.FORMID.ID.ExpensePolicyForm),n=this.moduleService.getTableById("Masters","Expense Policy",this.FORMID.ID.ExpensePolicyTable);e&&(this.subModule=e),i&&(this.moduleFormId=i.form_id,this.getFormData()),n&&(this.moduleTableId=n.table_id),this.getHeaderConfigListing()}onRefresh(){this.filter={},this.reusableTable.clearSearchInputs(),this.getHeaderConfigListing()}tableConfigData={};visibleHeaders=[];getHeaderConfigListing(){this.CommonApiService.getHeaderConfigListing(this.moduleTableId,this.moduleFormId).subscribe(t=>{this.tableConfigData=t.data.table_data;let e=this.tableConfigData.tableHead;this.visibleHeaders=e.filter(i=>i.list_view_checked),this.getList()})}expensePolicyData=[];listing=[];getList(){this.skLoading=!0,this.api.post({filters:this.filter,form_id:this.moduleFormId},"expense/read-allowance-master").subscribe(t=>{t.statusCode=="200"&&(this.skLoading=!1,this.listing=t.data)})}handleSelectionChange(t){let{category_name:e,selections:i}=t;this.filter[e]=i,this.getList()}updateSearchFilter(t){this.filter[t.name]=t.searchText,this.getList()}handleDateRangeChange(t){this.filter=t,this.getList()}handleDateChange(t){this.filter=t,this.getList()}getFormData(){this.skLoading=!0,this.api.post({form_id:this.moduleFormId,platform:"web"},"form-builder/read").subscribe(t=>{t.statusCode==200&&(t?.data?.form_data&&(this.originalFormFields=JSON.parse(JSON.stringify(t.data.form_data))),this.formFields=t.data.form_data,this.skLoading=!1,this.formFields.forEach(e=>{this.util.createValidation(e)}),this.initializeForm())})}initializeForm(){this.myForm=this.fb.group({}),this.formFields.forEach(t=>{t.control=this.fb.control("",this.formValidation.getValidators(t)),this.myForm.addControl(t.name,t.control)}),this.formIniatialized=!0}openModal(t){this.dialog.open(H,{data:{lastPage:"expense-policy-add",form_Fields:this.originalFormFields,moduleFormId:this.moduleFormId,moduleId:this.subModule.sub_module_id,moduleName:this.subModule.title,module_type:this.subModule.module_type}}).afterClosed().subscribe(i=>{i===!0&&this.getHeaderConfigListing()})}openHeaderSettingModal(){this.dialog.open(H,{width:"450px",panelClass:"mat-right-modal",position:{right:"0px"},data:{lastPage:"header-config",moduleFormId:this.moduleFormId,moduleTableId:this.moduleTableId,moduleName:this.subModule.title,tableConfigData:this.tableConfigData}}).afterClosed().subscribe(e=>{e===!0&&this.getHeaderConfigListing()})}updateExpensePolicy(t){this.dialog.open(R,{width:"768px",data:{lastPage:"expense-policy-add",formType:t?"edit":"create",formData:t||{}}}).afterClosed().subscribe(i=>{i===!0&&this.getHeaderConfigListing()})}openMainLogModal(t){this.comanFuncation.listLogsModal(this.subModule.sub_module_id,t,this.subModule.module_type).subscribe(e=>{})}static \u0275fac=function(e){return new(e||o)(p(P),p(L),p(le),p(D),p(T),p(w),p(he),p(ne))};static \u0275cmp=x({type:o,selectors:[["app-expense-policy-list"]],viewQuery:function(e,i){if(e&1&&G(Qe,5),e&2){let n;U(n=$())&&(i.reusableTable=n.first)}},inputs:{formFields:"formFields"},decls:12,vars:29,consts:[["reusableTable",""],[3,"buttonClick","buttonClick1","title","title1","activeitem","buttonText","icon","btnShow","buttonValue","buttonText1","icon1","btnShow1","buttonValue1"],[1,"row"],[1,"col-xl-12"],[1,"box"],[3,"logBtn","onRefresh","pageTitle","listLength","refreshLabel","logsLabel","btnShow","btnShow1"],[1,"box-body"],[1,"table-responsive","overflow-auto","table-bordered-default"],["tableClass","ti-custom-table ti-custom-table-head ti-custom-table-hover ti-head-primary whitespace-nowrap",3,"selectionChange","textSearchChange","dateChange","tableHead","showCheckbox","showS_No","showSorting","showFilterRow","showAction","columns"],[4,"ngIf"],["class","product-list border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[1,"product-list","border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"!text-center"],[4,"ngFor","ngForOf"],[1,"flex","flex-row","items-center","!gap-2","text-[0.9375rem]"],["matTooltip","View Logs",3,"clickEvent","icon","buttonClass"],[3,"icon","buttonClass","clickEvent",4,"ngIf"],["type","checkbox",1,"form-check-input",3,"ngModelChange","ngModel","id","disabled"],[3,"clickEvent","icon","buttonClass"],["class","border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[1,"border-b","!border-defaultborder","dark:!border-defaultborder/10"],["class","w120",4,"ngFor","ngForOf"],[1,"w120"]],template:function(e,i){if(e&1){let n=h();m(0,"app-page-header",1),g("buttonClick",function(){return _(n),u(i.openHeaderSettingModal())})("buttonClick1",function(f){return _(n),u(i.openModal(f))}),l(),m(1,"div",2)(2,"div",3)(3,"div",4)(4,"app-page-sub-header",5),g("logBtn",function(){return _(n),u(i.openMainLogModal(""))})("onRefresh",function(){return _(n),u(i.onRefresh())}),l(),m(5,"div",6)(6,"div",7)(7,"spk-reusable-tables",8,0),g("selectionChange",function(f){return _(n),u(i.handleSelectionChange(f))})("textSearchChange",function(f){return _(n),u(i.updateSearchFilter(f))})("dateChange",function(f){return _(n),u(i.handleDateChange(f))}),c(9,Ze,2,1,"ng-container",9),l(),c(10,it,2,2,"ng-container",9)(11,ot,2,0,"ng-container",9),l()()()()()}e&2&&(r("title","Master Modules")("title1",C(28,Ke))("activeitem","Expense Policy")("buttonText","Header Config")("icon","settings")("btnShow",!1)("buttonValue","")("buttonText1","Form Config")("icon1","settings")("btnShow",i.accessRight==null?null:i.accessRight.modifyRight)("btnShow1",i.accessRight==null?null:i.accessRight.modifyRight)("buttonValue1",""),a(4),r("pageTitle","Expense Policy List")("listLength",i.listing.length)("refreshLabel","Refresh")("logsLabel","Logs")("btnShow",!0)("btnShow1",!0),a(3),r("tableHead","border-b")("showCheckbox",!1)("showS_No",!0)("showSorting",!1)("showFilterRow",!0)("showAction",!0)("columns",i.visibleHeaders),a(2),r("ngIf",!i.skLoading),a(),r("ngIf",i.skLoading),a(),r("ngIf",!i.listing.length&&!i.skLoading))},dependencies:[V,F,S,q,J,Z,ye,M,ue,ve,be,me,E,ce,ie],encapsulation:2})};export{xe as ExpensePolicyListComponent};
