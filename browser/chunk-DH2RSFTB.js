import{a as ce}from"./chunk-ZON5AR26.js";import"./chunk-LGZVJJDX.js";import"./chunk-54KZ5YIV.js";import"./chunk-SQZ3YN6N.js";import"./chunk-CIBZCVJQ.js";import{a as le}from"./chunk-OTFCGVEU.js";import{a as re}from"./chunk-HPLI5COI.js";import{b as se}from"./chunk-DUVWFXSE.js";import{a as te}from"./chunk-OEHD5D2Y.js";import{a as ae}from"./chunk-GLWQGYBC.js";import{a as G}from"./chunk-DC4QM32I.js";import{F as oe,c as z,s as ie,t as ne}from"./chunk-VHE3PQ3O.js";import{$ as J,B as H,G as $,Qa as Y,R as B,W as U,Ya as Z,Z as q,hb as ee,oa as K,sa as Q,v as W,w as N,wa as X,z as j}from"./chunk-GYDYF5F3.js";import{Q as O,f as I,g as D,t as F}from"./chunk-PD5VTTIY.js";import{Aa as _,Ba as u,Hb as P,Mc as m,Nc as v,Ob as b,Uc as R,Vc as w,Wc as A,Yc as L,_b as s,bc as V,kc as o,lc as l,mc as C,nc as f,oc as h,qc as x,qd as T,rb as r,sb as S,wc as g,yc as p}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as y}from"./chunk-66YHNWRR.js";var pe=()=>["Role & Permission"],me=()=>[];function _e(n,i){if(n&1){let e=x();o(0,"button",10),g("click",function(c){_(e);let a=p();return u(a.addRoleModal(c))}),C(1,"i",32),m(2," Add Role "),l()}}function ue(n,i){if(n&1&&(o(0,"mat-option",33),m(1),l()),n&2){let e=i.$implicit;s("value",e._id),r(),v(e.user_role_name)}}function ge(n,i){n&1&&(f(0),o(1,"i",38),m(2,"indeterminate_check_box"),l(),h())}function fe(n,i){if(n&1){let e=x();f(0),o(1,"input",39),g("change",function(c){_(e);let a=p().$implicit,d=p(2);return u(d.updatePermission(a,"add",c))}),l(),h()}if(n&2){let e=p().$implicit;r(),s("checked",e.permission_access.add)}}function he(n,i){n&1&&(f(0),o(1,"i",38),m(2,"indeterminate_check_box"),l(),h())}function be(n,i){if(n&1){let e=x();f(0),o(1,"input",39),g("change",function(c){_(e);let a=p().$implicit,d=p(2);return u(d.updatePermission(a,"approve",c))}),l(),h()}if(n&2){let e=p().$implicit;r(),s("checked",e.permission_access.approve)}}function Ce(n,i){n&1&&(f(0),o(1,"i",38),m(2,"indeterminate_check_box"),l(),h())}function xe(n,i){if(n&1){let e=x();f(0),o(1,"input",39),g("change",function(c){_(e);let a=p().$implicit,d=p(2);return u(d.updatePermission(a,"delete",c))}),l(),h()}if(n&2){let e=p().$implicit;r(),s("checked",e.permission_access.delete)}}function Se(n,i){n&1&&(f(0),o(1,"i",38),m(2,"indeterminate_check_box"),l(),h())}function ye(n,i){if(n&1){let e=x();f(0),o(1,"input",39),g("change",function(c){_(e);let a=p().$implicit,d=p(2);return u(d.updatePermission(a,"export",c))}),l(),h()}if(n&2){let e=p().$implicit;r(),s("checked",e.permission_access.export)}}function ve(n,i){n&1&&(f(0),o(1,"i",38),m(2,"indeterminate_check_box"),l(),h())}function Le(n,i){if(n&1){let e=x();f(0),o(1,"input",39),g("change",function(c){_(e);let a=p().$implicit,d=p(2);return u(d.updatePermission(a,"import",c))}),l(),h()}if(n&2){let e=p().$implicit;r(),s("checked",e.permission_access.import)}}function Re(n,i){n&1&&(f(0),o(1,"i",38),m(2,"indeterminate_check_box"),l(),h())}function we(n,i){if(n&1){let e=x();f(0),o(1,"input",39),g("change",function(c){_(e);let a=p().$implicit,d=p(2);return u(d.updatePermission(a,"modify",c))}),l(),h()}if(n&2){let e=p().$implicit;r(),s("checked",e.permission_access.modify)}}function Ae(n,i){n&1&&(f(0),o(1,"i",38),m(2,"indeterminate_check_box"),l(),h())}function ke(n,i){if(n&1){let e=x();f(0),o(1,"input",39),g("change",function(c){_(e);let a=p().$implicit,d=p(2);return u(d.updatePermission(a,"view",c))}),l(),h()}if(n&2){let e=p().$implicit;r(),s("checked",e.permission_access.view)}}function Me(n,i){if(n&1&&(o(0,"tr",22)(1,"td",23),m(2),l(),o(3,"td")(4,"div",35)(5,"p",36),m(6),l(),o(7,"p",37),m(8),l()()(),o(9,"td",23),b(10,ge,3,0,"ng-container",29)(11,fe,2,1,"ng-container",29),l(),o(12,"td",23),b(13,he,3,0,"ng-container",29)(14,be,2,1,"ng-container",29),l(),o(15,"td",23),b(16,Ce,3,0,"ng-container",29)(17,xe,2,1,"ng-container",29),l(),o(18,"td",23),b(19,Se,3,0,"ng-container",29)(20,ye,2,1,"ng-container",29),l(),o(21,"td",23),b(22,ve,3,0,"ng-container",29)(23,Le,2,1,"ng-container",29),l(),o(24,"td",23),b(25,Re,3,0,"ng-container",29)(26,we,2,1,"ng-container",29),l(),o(27,"td",23),b(28,Ae,3,0,"ng-container",29)(29,ke,2,1,"ng-container",29),l()()),n&2){let e=i.$implicit,t=i.index;r(2),v(t+1),r(4),v(e.module_name||"--"),r(2),v(e.parent_module_name?"("+e.parent_module_name+")":""),r(2),s("ngIf",(e.default_access==null?null:e.default_access.add)==="disable"),r(),s("ngIf",(e.default_access==null?null:e.default_access.add)!=="disable"),r(2),s("ngIf",(e.default_access==null?null:e.default_access.approve)==="disable"),r(),s("ngIf",(e.default_access==null?null:e.default_access.approve)!=="disable"),r(2),s("ngIf",(e.default_access==null?null:e.default_access.delete)==="disable"),r(),s("ngIf",(e.default_access==null?null:e.default_access.delete)!=="disable"),r(2),s("ngIf",(e.default_access==null?null:e.default_access.export)==="disable"),r(),s("ngIf",(e.default_access==null?null:e.default_access.export)!=="disable"),r(2),s("ngIf",(e.default_access==null?null:e.default_access.import)==="disable"),r(),s("ngIf",(e.default_access==null?null:e.default_access.import)!=="disable"),r(2),s("ngIf",(e.default_access==null?null:e.default_access.modify)==="disable"),r(),s("ngIf",(e.default_access==null?null:e.default_access.modify)!=="disable"),r(2),s("ngIf",(e.default_access==null?null:e.default_access.view)==="disable"),r(),s("ngIf",(e.default_access==null?null:e.default_access.view)!=="disable")}}function Ee(n,i){if(n&1&&(f(0),b(1,Me,30,17,"tr",34),h()),n&2){let e=p();r(),s("ngForOf",e.moduleListing)}}function Pe(n,i){n&1&&(o(0,"td"),C(1,"app-skeleton"),l()),n&2&&(r(),V("h20 bg-skeleton"))}function Ve(n,i){n&1&&(o(0,"tr",22),b(1,Pe,2,2,"td",40),l()),n&2&&(r(),s("ngForOf",L(1,me).constructor(9)))}function Te(n,i){n&1&&(f(0),b(1,Ve,2,2,"tr",34),h()),n&2&&(r(),s("ngForOf",L(1,me).constructor(8)))}function Ie(n,i){n&1&&(f(0),C(1,"app-data-not-found"),h())}var de=class n{constructor(i,e,t,c,a,d,k){this.toastr=i;this.api=e;this.dialog=t;this.cd=c;this.alert=a;this.moduleService=d;this.logService=k}disabled=!1;sorting={};selectedField="";isModalOpen=!1;range;skLoading=!1;FORMID=re;selectedChoices=[];allModulesData=[];mastersModule={};productModule=[];module_table={};module_form={};roleListArray=[];filter={};data={};selectedRole=null;assign_module_data=[];search_key="";moduleListing=[];currentUserPermissions=[];logList=[];subModule={};moduleType;accessRight={};ngOnInit(){let i=this.moduleService.getAccessMap("Masters","Roles & Permission");i&&(this.accessRight=i);let e=this.moduleService.getSubModuleByName("Masters","Roles & Permission");e&&(this.subModule=e),this.getRoleList()}readMore=[];toggleReadMore(i){this.readMore[i]=!this.readMore[i]}isContentOverflowed(i){let e=parseFloat(window.getComputedStyle(i).lineHeight);return i.scrollHeight>e*2}onRefresh(){this.search_key="",this.getModuleListRoleWise()}isAccessDisabled(i,e){return i.default_access[e]==="disable"}getDefaultAccessValue(i,e){return i.permission_access[e]===!0}modifiedIndexes=new Set;updatePermission(i,e,t){let c=t.target;i.permission_access[e]=c.checked;let a=this.moduleListing.findIndex(d=>d.id===i.id);a!==-1&&this.modifiedIndexes.add(a)}toggleSelectAll(i){let e=this.moduleListing.filter(t=>t?.default_access?.[i]!=="disable"&&t?.permission_access).every(t=>t.permission_access[i]===!0);this.moduleListing.forEach(t=>{t?.default_access?.[i]!=="disable"&&t?.permission_access&&(t.permission_access[i]=!e)})}allSelected(i){let e=this.moduleListing.filter(t=>t?.default_access?.[i]!=="disable"&&t?.permission_access);return e.length>0&&e.every(t=>t.permission_access[i]===!0)}listColumns=[{label:"S.No"},{label:"Module"},{label:"Add",table_class:"text-center"},{label:"Approve",table_class:"text-center"},{label:"Delete",table_class:"text-center"},{label:"Export",table_class:"text-center"},{label:"Import",table_class:"text-center"},{label:"Modify",table_class:"text-center"},{label:"View",table_class:"text-center"}];getRoleList(){this.api.post({},"rbac/read").subscribe(i=>{i.statusCode==200&&(this.roleListArray=i.data,this.roleListArray.length>0&&(this.data.selectedRole=this.roleListArray[0]._id,this.getModuleListRoleWise()))})}getModuleListRoleWise(){this.skLoading=!0,this.api.post({search_key:this.search_key,user_role_id:this.data.selectedRole},"rbac/read-modules").subscribe(i=>{i.statusCode==200&&(this.skLoading=!1,this.moduleListing=i.data,this.originalData=JSON.parse(JSON.stringify(this.moduleListing)),this.logService.getLogs(this.subModule.sub_module_id,e=>{this.logList=e},"",this.subModule.module_type),this.cd.detectChanges())})}getChangedData(){let i={};for(let e=0;e<this.moduleListing.length;e++){let t=this.moduleListing[e],c=this.originalData[e],a=t.permission_access||{},d=c.permission_access||{},k=new Set([...Object.keys(a),...Object.keys(d)]),M=!1;for(let E of k)if(a[E]!==d[E]){M=!0;break}M&&(i[t.module_name]={old:{permission_access:y({},d)},new:{permission_access:y({},a)}})}return i}originalData=[];updateRoleWiseModule(){this.alert.confirm("Are you sure?").then(i=>{if(i.isConfirmed){let e=this.getChangedData(),t=Object.entries(e).map(([a,d])=>y({module_name:a},d.old)),c=Object.entries(e).map(([a,d])=>y({module_name:a},d.new));if(Object.keys(e).length===0){this.api.disabled=!1,this.toastr.warning("No changes detected","","toast-top-right");return}this.logService.logActivityOnUpdate(!0,t,c,this.subModule.sub_module_id,this.subModule.title,"updateMany","",()=>{},this.subModule.module_type),this.api.disabled=!0,this.api.post({permission:this.moduleListing,user_role_id:this.data.selectedRole},"rbac/add-permissions").subscribe(a=>{a.statusCode===200&&(this.api.disabled=!1,this.toastr.success(a.message,"","toast-top-right"),this.getModuleListRoleWise())})}})}addRoleModal(i){this.dialog.open(ce,{width:"500px",data:{lastPage:"role-and-permission-add"}}).afterClosed().subscribe(t=>{this.getRoleList()})}static \u0275fac=function(e){return new(e||n)(S(N),S(q),S(Y),S(T),S(J),S(G),S(le))};static \u0275cmp=P({type:n,selectors:[["app-role-and-permission-list"]],decls:65,vars:26,consts:[["selectedRole","ngModel"],[3,"title","title1","activeitem"],[1,"row"],[1,"col-xl-12"],[1,"box"],[1,"box-header","flex","items-center","justify-between","flex-wrap","gap-4","pt-1","pb-2"],[1,"box-title"],[1,"flex","gap-2","items-center","flex-wrap"],["type","button",1,"ti-btn-sm","!py-1","btn","ti-btn","ti-btn-soft-success",3,"click"],[1,"ri-save-3-line","font-medium","align-middle"],["type","button",1,"ti-btn-sm","!py-1","btn","ti-btn","ti-btn-soft-primary",3,"click"],[1,"ri-refresh-line","font-medium","align-middle"],["type","button","class","ti-btn-sm !py-1 btn ti-btn ti-btn-soft-primary",3,"click",4,"ngIf"],[1,""],["appearance","outline",1,"mat-custom-field","remove-space"],["placeholder","Select an option","name","selectedRole","required","",3,"ngModelChange","selectionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"box-body","pt-0"],[1,"grid","grid-cols-12","gap-x-6"],[1,"xxl:col-span-8","xl:col-span-8","lg:col-span-8","md:col-span-7","col-span-12"],[1,"table-responsive","overflow-auto","table-bordered-default"],["tableClass","ti-custom-table ti-custom-table-hover ti-head-primary",3,"tableHead","tableHeadColumn","tableHeight","showCheckbox","columns"],[1,"border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"!text-center"],["type","text","id","input-text","placeholder","Search...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","checkbox","id","selectAllCol4",1,"form-check-input",3,"change","checked"],["type","checkbox","id","selectAllCol2",1,"form-check-input",3,"change","checked"],["type","checkbox","id","selectAllCol3",1,"form-check-input",3,"change","checked"],["type","checkbox","id","selectAllCol1",1,"form-check-input",3,"change","checked"],[4,"ngIf"],[1,"xxl:col-span-4","xl:col-span-4","lg:col-span-4","md:col-span-5","col-span-12"],[3,"logList","scrollHeight","closeBtn"],[1,"ri-apps-2-add-line","font-medium","align-middle"],[3,"value"],["class","border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[1,"flex","items-center"],[1,"mr-1"],[1,"text-[11px]","text-textmuted","dark:text-textmuted/50","mb-0"],[1,"material-icons","text-textmuted/50",2,"font-size","20px !important"],["type","checkbox",1,"form-check-input",3,"change","checked"],[4,"ngFor","ngForOf"]],template:function(e,t){if(e&1){let c=x();C(0,"app-page-header",1),o(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),m(6," Role & Permission "),l(),o(7,"div",7)(8,"button",8),g("click",function(){return _(c),u(t.updateRoleWiseModule())}),C(9,"i",9),m(10," Update "),l(),o(11,"button",10),g("click",function(){return _(c),u(t.onRefresh())}),C(12,"i",11),m(13," Refresh "),l(),b(14,_e,3,0,"button",12),o(15,"div",13)(16,"mat-form-field",14)(17,"mat-label"),m(18,"Select Role"),l(),o(19,"mat-select",15,0),A("ngModelChange",function(d){return _(c),w(t.data.selectedRole,d)||(t.data.selectedRole=d),u(d)}),g("selectionChange",function(){return _(c),u(t.getModuleListRoleWise())}),b(21,ue,2,2,"mat-option",16),l()()()()(),o(22,"div",17)(23,"div",18)(24,"div",19)(25,"div",20)(26,"spk-reusable-tables",21)(27,"tr",22)(28,"td",23),m(29,"\xA0"),l(),o(30,"td",23)(31,"input",24),A("ngModelChange",function(d){return _(c),w(t.search_key,d)||(t.search_key=d),u(d)}),g("keyup.enter",function(){return _(c),u(t.getModuleListRoleWise())}),l()(),o(32,"td",23),m(33," Select All "),C(34,"br"),o(35,"input",25),g("change",function(){return _(c),u(t.toggleSelectAll("add"))}),l()(),o(36,"td",23),m(37," Select All "),C(38,"br"),o(39,"input",25),g("change",function(){return _(c),u(t.toggleSelectAll("approve"))}),l()(),o(40,"td",23),m(41," Select All "),C(42,"br"),o(43,"input",26),g("change",function(){return _(c),u(t.toggleSelectAll("delete"))}),l()(),o(44,"td",23),m(45," Select All "),C(46,"br"),o(47,"input",25),g("change",function(){return _(c),u(t.toggleSelectAll("export"))}),l()(),o(48,"td",23),m(49," Select All "),C(50,"br"),o(51,"input",27),g("change",function(){return _(c),u(t.toggleSelectAll("import"))}),l()(),o(52,"td",23),m(53," Select All "),C(54,"br"),o(55,"input",26),g("change",function(){return _(c),u(t.toggleSelectAll("modify"))}),l()(),o(56,"td",23),m(57," Select All "),C(58,"br"),o(59,"input",28),g("change",function(){return _(c),u(t.toggleSelectAll("view"))}),l()()(),b(60,Ee,2,1,"ng-container",29)(61,Te,2,2,"ng-container",29),l(),b(62,Ie,2,0,"ng-container",29),l()(),o(63,"div",30),C(64,"app-logs",31),l()()()()()()}e&2&&(s("title","Master Modules")("title1",L(25,pe))("activeitem","Role & Permission List"),r(14),s("ngIf",t.accessRight==null?null:t.accessRight.addRight),r(5),R("ngModel",t.data.selectedRole),r(2),s("ngForOf",t.roleListArray),r(5),s("tableHead","border-b")("tableHeadColumn","!text-center")("tableHeight","630px")("showCheckbox",!1)("columns",t.listColumns),r(5),R("ngModel",t.search_key),r(4),s("checked",t.allSelected("add")),r(4),s("checked",t.allSelected("approve")),r(4),s("checked",t.allSelected("delete")),r(4),s("checked",t.allSelected("export")),r(4),s("checked",t.allSelected("import")),r(4),s("checked",t.allSelected("modify")),r(4),s("checked",t.allSelected("view")),r(),s("ngIf",t.moduleListing.length),r(),s("ngIf",t.skLoading),r(),s("ngIf",!t.moduleListing.length&&!t.skLoading),r(2),s("logList",t.logList)("scrollHeight","520")("closeBtn",!1))},dependencies:[oe,I,D,j,H,B,$,ae,z,ie,ne,F,O,te,U,se,W,ee,K,X,Q,Z],encapsulation:2})};export{de as RoleAndPermissionListComponent};
