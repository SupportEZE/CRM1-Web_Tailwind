import{a as it}from"./chunk-G64KJ3QF.js";import{a as et}from"./chunk-5QFGLOXN.js";import{a as X}from"./chunk-PJTW4QXW.js";import{a as tt}from"./chunk-SQZ3YN6N.js";import"./chunk-CIBZCVJQ.js";import{a as W}from"./chunk-OTFCGVEU.js";import{a as Z}from"./chunk-GLWQGYBC.js";import{a as O}from"./chunk-DC4QM32I.js";import{A as K,B as $,F as J,c as U,s as G}from"./chunk-VHE3PQ3O.js";import{Qa as Q,W as j,Z as P,Za as Y,aa as H,hb as q,jb as z}from"./chunk-GYDYF5F3.js";import{K as V,e as F,f as R,g as A,o as B,t as N}from"./chunk-PD5VTTIY.js";import{$c as M,Aa as b,Ba as x,Fc as S,Gc as T,Hb as h,Hc as I,Mc as o,Nc as m,Ob as d,Oc as E,Yc as _,Zc as D,_b as c,bc as C,ed as w,gd as L,kc as e,lc as i,mc as u,nc as v,oc as f,qc as y,rb as a,sb as s,wc as k,yc as g}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import"./chunk-66YHNWRR.js";var lt=["commentList"],ot=()=>["Ticket Detail"],nt=n=>({active:n}),rt=(n,r,t)=>({"bg-success/10 text-success":n,"bg-warning/10 text-warning":r,"bg-danger/10 text-danger":t}),ct=()=>[];function mt(n,r){if(n&1&&(e(0,"app-showcode-card",10)(1,"ul",11)(2,"li",12)(3,"div")(4,"span",13),o(5,"Name :"),i(),e(6,"span",14),o(7),i()()(),e(8,"li",12)(9,"div")(10,"span",13),o(11,"User Code :"),i(),e(12,"span",14),o(13),i()()()()()),n&2){let t=g();c("title","User Detail")("classbody","p-0")("titleView",!0)("view",!1),a(7),m((t.ticketDetail==null||t.ticketDetail.assign_to_user_detail==null?null:t.ticketDetail.assign_to_user_detail.name)||"-"),a(6),m((t.ticketDetail==null||t.ticketDetail.assign_to_user_detail==null?null:t.ticketDetail.assign_to_user_detail.user_code)||"-")}}function st(n,r){if(n&1){let t=y();e(0,"app-icon-button",33),k("click",function(){b(t);let p=g(2);return x(p.openModal(p.ticketDetail))}),i()}n&2&&c("icon","ri-pencil-line")("buttonClass","btn-wave ti-btn ti-btn-sm ti-btn-soft-primary waves-effect waves-light")}function dt(n,r){if(n&1&&(e(0,"div",23)(1,"div")(2,"span",24),o(3),i(),e(4,"span",26),o(5),i()()()),n&2){let t=g(2);a(3),E("",t.ticketDetail.status," Remark"),a(2),m((t.ticketDetail==null?null:t.ticketDetail.status_remark)||"--")}}function pt(n,r){if(n&1&&(e(0,"div")(1,"div",22)(2,"div",23)(3,"div")(4,"span",24),o(5,"Ticket No."),i(),e(6,"span",25),o(7),i()()(),e(8,"div",23)(9,"div")(10,"span",24),o(11,"Created At"),i(),e(12,"span",26),o(13),w(14,"date"),i()()(),e(15,"div",23)(16,"div")(17,"span",24),o(18,"Created by"),i(),e(19,"span",26),o(20),i()()(),e(21,"div",23)(22,"div")(23,"span",27),o(24,"Category"),i(),e(25,"span",28),o(26),i()()(),e(27,"div",23)(28,"div")(29,"span",27),o(30,"Priority"),i(),e(31,"span",28),o(32),i()()(),e(33,"div",29)(34,"div")(35,"span",27),o(36,"Status"),i(),e(37,"span",30),o(38),i()(),d(39,st,1,2,"app-icon-button",31),i(),d(40,dt,6,2,"div",32),e(41,"div",23)(42,"div")(43,"span",24),o(44,"Remark"),i(),e(45,"span",26),o(46),i()()()()()),n&2){let t=g();a(7),m((t.ticketDetail==null?null:t.ticketDetail.ticket_no)||"--"),a(6),m(L(14,12,t.ticketDetail==null?null:t.ticketDetail.created_at,"dd MMM yyyy hh:mm a")),a(7),m((t.ticketDetail==null?null:t.ticketDetail.created_name)||"--"),a(5),c("ngClass",t.ticketDetail.ticket_category==="Marketing"?"bg-warning/10 text-warning":t.ticketDetail.ticket_category==="Billing"?"bg-danger/10 text-danger":t.ticketDetail.ticket_category==="Quality"?"bg-success/10 text-success":"bg-primary/10 text-primary"),a(),m((t.ticketDetail==null?null:t.ticketDetail.ticket_category)||"--"),a(5),c("ngClass",t.ticketDetail.ticket_priority==="High"?"bg-primarytint1color/10  text-primarytint1color":t.ticketDetail.ticket_priority==="Critical"?"bg-danger/10 text-danger":t.ticketDetail.ticket_priority==="Medium"?"bg-warning/10 text-warning":"bg-primary/10 text-primary"),a(),m((t.ticketDetail==null?null:t.ticketDetail.ticket_priority)||"--"),a(5),c("ngClass",M(15,rt,t.ticketDetail.status==="Complete",t.ticketDetail.status==="Pending",t.ticketDetail.status==="Cancel")),a(),m((t.ticketDetail==null?null:t.ticketDetail.status)||"--"),a(),c("ngIf",t.ticketDetail.status!=="Complete"&&(t.accessRight==null?null:t.accessRight.approveRight)),a(),c("ngIf",t.ticketDetail.status!=="Pending"),a(6),m((t.ticketDetail==null?null:t.ticketDetail.ticket_description)||"--")}}function ut(n,r){n&1&&(e(0,"div",23),u(1,"app-skeleton"),i()),n&2&&(a(),C("w180"))}function gt(n,r){n&1&&(e(0,"div")(1,"div",34),d(2,ut,2,2,"div",35),i()()),n&2&&(a(2),c("ngForOf",_(1,ct).constructor(10)))}function vt(n,r){if(n&1&&(v(0),u(1,"app-comments",36),f()),n&2){let t=g();a(),c("detailId",t.ticketId)("module","ticket")("showAvatar",!0)}}function ft(n,r){if(n&1&&(e(0,"div",39),u(1,"spk-product-card",40),i()),n&2){let t=r.$implicit;a(),c("apiPath","ticket/get-doc")("imageData",t)("editBtn",!1)("heading",!1)("subHeading",!1)("delBtn",!1)}}function kt(n,r){n&1&&(v(0),u(1,"app-data-not-found"),f())}function _t(n,r){if(n&1&&(v(0),e(1,"div",37),d(2,ft,2,6,"div",38),i(),d(3,kt,2,0,"ng-container",17),f()),n&2){let t=g();a(2),c("ngForOf",t.ticketDetailImages),a(),c("ngIf",!(t.ticketDetailImages!=null&&t.ticketDetailImages.length))}}var at=class n{constructor(r,t,l,p,Dt,bt,xt,ht){this.dialog=r;this.nameUtils=t;this.route=l;this.api=p;this.logService=Dt;this.dateService=bt;this.moduleService=xt;this.authService=ht;this.orgData=this.authService.getUser()}commentList;comment="";ticketId;ticketDetail;formattedKeysFormData={};ticketDetailFormData;ticketDetailImages=[];commentsData=[];skLoading=!1;skCommentsLoading=!1;subModule={};logList=[];orgData={};activeTab="comments";accessRight={};ngOnInit(){let r=this.moduleService.getAccessMap("Ticket");r&&(this.accessRight=r);let t=this.moduleService.getModuleByName("Ticket");t&&(this.subModule=t),this.route.paramMap.subscribe(l=>{this.ticketId=l.get("id"),this.ticketId&&this.getDetail()})}getDetail(){this.skLoading=!0,this.ticketDetailImages=[],this.api.post({_id:this.ticketId,module_id:this.subModule.module_id},"ticket/detail").subscribe(r=>{if(r.statusCode===200){this.skLoading=!1,this.ticketDetail=r.data,this.ticketDetailImages=this.ticketDetail?.files;let t=document.getElementById("task-comments-tab-pane");setTimeout(()=>{t?.click()},200)}})}openModal(r){this.dialog.open(it,{width:"450px",data:r}).afterClosed().subscribe(l=>{l===!0&&this.getDetail()})}getComments(){this.getCommentsDetail(),setTimeout(()=>this.scrollToBottom(),200)}getCommentsDetail(){this.skCommentsLoading=!0;let r={module_name:this.subModule.module_name?this.subModule.module_name:"",module_id:this.subModule.module_id?this.subModule.module_id:"",row_id:this.ticketId};this.api.post(r,"comment/read-comments").subscribe(t=>{t.statusCode===200&&(this.skCommentsLoading=!1,this.commentsData=t.data,this.commentsData=this.dateService.formatToDDMMYYYYHHMM(this.commentsData),setTimeout(()=>this.scrollToBottom(),100))})}postComment(){if(this.comment){if(this.api.disabled=!0,this.comment.trim()==="")return;let r={module_name:this.subModule.module_name?this.subModule.module_name:"",module_id:this.subModule.module_id?this.subModule.module_id:"",comment:this.comment};this.api.post(r,"comment/save-comment").subscribe(t=>{t.statusCode===200&&(this.comment="",this.api.disabled=!1,this.getCommentsDetail(),setTimeout(()=>this.scrollToBottom(),100))})}}scrollToBottom(){this.commentList&&setTimeout(()=>{this.commentList.nativeElement.scrollTop=this.commentList.nativeElement.scrollHeight},100)}static \u0275fac=function(t){return new(t||n)(s(Q),s(et),s(V),s(P),s(W),s(z),s(O),s(H))};static \u0275cmp=h({type:n,selectors:[["app-ticket-detail"]],viewQuery:function(t,l){if(t&1&&S(lt,5),t&2){let p;T(p=I())&&(l.commentList=p.first)}},decls:43,vars:25,consts:[[3,"title","title1","activeitem"],[1,"grid","grid-cols-12","gap-x-6"],[1,"xl:col-span-12","col-span-12"],[1,"box","profile-card"],[1,"profile-banner-img"],["src","./assets/images/media/media-3.jpg","alt","...",1,"card-img-top"],[1,"box-body","pb-0","relative"],[1,"grid","grid-cols-12","sm:gap-x-6","profile-content"],[1,"xl:col-span-3","col-span-12"],[3,"title","classbody","titleView","view",4,"ngIf"],[3,"title","classbody","titleView","view"],[1,"ti-list-group","list-group-flush","!border-0"],[1,"ti-list-group-item","border-0"],[1,"font-medium","me-2"],[1,"text-textmuted","dark:text-textmuted/50"],[1,"xl:col-span-9","col-span-12"],[3,"title","titleView","view"],[4,"ngIf"],[1,"box"],["aria-label","Tabs","role","tablist","aria-orientation","horizontal",1,"nav","nav-tabs","tab-style-6","flex","bg-white","dark:bg-bodybg"],["type","button",1,"nav-link","text-start","rounded-md","active",3,"click","ngClass"],[1,"box-body","tab-content"],[1,"flex","gap-5","mb-1","flex-wrap"],[1,"flex","items-center"],[1,"text-xs","text-textmuted","dark:text-textmuted/50"],[1,"block","text-primary","font-medium"],[1,"block","font-medium"],[1,"text-xs","block","text-textmuted","dark:text-textmuted/50"],[1,"badge",3,"ngClass"],[1,"flex","gap-3","items-center"],[1,"block","font-medium",3,"ngClass"],["matTooltip","Change Status","matTooltip","Change Status",3,"icon","buttonClass","click",4,"ngIf"],["class","flex items-center",4,"ngIf"],["matTooltip","Change Status","matTooltip","Change Status",3,"click","icon","buttonClass"],[1,"flex","gap-2","mb-1","flex-wrap"],["class","flex items-center",4,"ngFor","ngForOf"],[3,"detailId","module","showAvatar"],[1,"grid","grid-cols-12","gap-x-4"],["class","xxl:col-span-2 lg:col-span-3 xl:col-span-4 sm:col-span-6 col-span-12",4,"ngFor","ngForOf"],[1,"xxl:col-span-2","lg:col-span-3","xl:col-span-4","sm:col-span-6","col-span-12"],[3,"apiPath","imageData","editBtn","heading","subHeading","delBtn"]],template:function(t,l){t&1&&(u(0,"app-page-header",0),e(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),u(5,"img",5),i(),e(6,"div",6)(7,"div",7)(8,"div",8),d(9,mt,14,6,"app-showcode-card",9),e(10,"app-showcode-card",10)(11,"ul",11)(12,"li",12)(13,"div")(14,"span",13),o(15,"Name :"),i(),e(16,"span",14),o(17),i()()(),e(18,"li",12)(19,"div")(20,"span",13),o(21,"Type :"),i(),e(22,"span",14),o(23),i()()(),e(24,"li",12)(25,"div")(26,"span",13),o(27,"Mobile No. :"),i(),e(28,"span",14),o(29),i()()()()()(),e(30,"div",15)(31,"app-showcode-card",16),d(32,pt,47,19,"div",17)(33,gt,3,2,"div",17),i(),e(34,"div",18)(35,"nav",19)(36,"button",20),k("click",function(){return l.activeTab="comments",l.getComments()}),o(37," Comments "),i(),e(38,"button",20),k("click",function(){return l.activeTab="attachment"}),o(39," Attachment "),i()(),e(40,"div",21),d(41,vt,2,3,"ng-container",17)(42,_t,4,2,"ng-container",17),i()()()()()()()()),t&2&&(c("title","Ticket")("title1",_(20,ot))("activeitem","Ticket Detail"),a(9),c("ngIf",l.orgData==null||l.orgData.org==null?null:l.orgData.org.sfa),a(),c("title","Customer Detail")("classbody","p-0")("titleView",!0)("view",!1),a(7),m((l.ticketDetail==null||l.ticketDetail.customer_detail==null?null:l.ticketDetail.customer_detail.customer_name)||"-"),a(6),m((l.ticketDetail==null||l.ticketDetail.customer_detail==null?null:l.ticketDetail.customer_detail.customer_type_name)||"-"),a(6),m((l.ticketDetail==null||l.ticketDetail.customer_detail==null?null:l.ticketDetail.customer_detail.mobile)||"-"),a(2),c("title","Basic Detail")("titleView",!0)("view",!1),a(),c("ngIf",!l.skLoading),a(),c("ngIf",l.skLoading),a(3),c("ngClass",D(21,nt,l.activeTab==="comments")),a(2),c("ngClass",D(23,nt,l.activeTab==="attachment")),a(3),c("ngIf",l.activeTab==="comments"),a(),c("ngIf",l.activeTab==="attachment"))},dependencies:[X,J,F,R,A,Z,U,G,tt,K,Y,B,q,N,$,j],encapsulation:2})};export{at as TicketDetailComponent};
