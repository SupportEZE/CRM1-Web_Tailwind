import{a as ie}from"./chunk-J4NDCUAB.js";import{a as te}from"./chunk-ZON5AR26.js";import"./chunk-LGZVJJDX.js";import"./chunk-54KZ5YIV.js";import{a as ee}from"./chunk-SQZ3YN6N.js";import{a as X,c as Y}from"./chunk-CIBZCVJQ.js";import"./chunk-OTFCGVEU.js";import{a as Q}from"./chunk-HPLI5COI.js";import"./chunk-DUVWFXSE.js";import{a as j}from"./chunk-CNF4GSI7.js";import{a as q}from"./chunk-OEHD5D2Y.js";import{a as Z}from"./chunk-GLWQGYBC.js";import{a as W}from"./chunk-DC4QM32I.js";import{F as J,c as K,q as G,s as z}from"./chunk-VHE3PQ3O.js";import{$ as N,Qa as U,V as A,W as B,Y as O,Z as $,l as R}from"./chunk-GYDYF5F3.js";import{M as D,e as M,f as P,g as E,o as H,t as V}from"./chunk-PD5VTTIY.js";import{Aa as _,Ba as b,Hb as w,Mc as m,Nc as h,Ob as d,Oc as v,Yc as S,Zc as L,_b as c,bc as T,dc as I,ed as k,gd as F,kc as r,lc as a,mc as f,nc as y,oc as x,qc as C,rb as o,sb as g,wc as u,yc as p}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import"./chunk-66YHNWRR.js";var re=()=>["Complaint List"],ae=n=>({active:n}),oe=()=>[];function le(n,e){if(n&1){let t=C();r(0,"button",26),u("click",function(){_(t);let l=p();return b(l.goToAddPage())}),f(1,"i",27),m(2,"Add New "),a()}}function se(n,e){if(n&1&&(r(0,"span"),m(1),a()),n&2){let t=p().$implicit;I("badge bg-",t.countClass,"/10 text-",t.countClass," rounded-full"),o(),v(" ",t.count," ")}}function ce(n,e){if(n&1){let t=C();r(0,"li",28),u("click",function(){let l=_(t).$implicit,s=p();return s.filter.status="",s.filter.priority=null,s.setActiveTab(l.label),b(s.getList())}),r(1,"a")(2,"div",29)(3,"span",30),f(4,"i"),a(),r(5,"span",31),m(6),a(),d(7,se,2,5,"span",32),a()()()}if(n&2){let t=e.$implicit,i=p();c("ngClass",L(5,ae,i.activeTab===t.value)),o(4),T(t.icon+" align-middle text-[14px] text-primary"),o(2),v(" ",t.label," "),o(),c("ngIf",t.count!==null)}}function pe(n,e){if(n&1){let t=C();r(0,"li")(1,"div",33)(2,"a",34),u("click",function(){let l=_(t).$implicit,s=p();return b(s.updateFilter(l.service_engineer_name))}),r(3,"div")(4,"span",30),f(5,"i",35),a()(),r(6,"div",31)(7,"span",36),m(8),a()()(),r(9,"span",37),m(10),a()()()}if(n&2){let t=e.$implicit;o(8),h(t.service_engineer_name),o(2),h(t.assigned_count)}}function me(n,e){n&1&&(r(0,"div")(1,"label",38),m(2," No data available! "),a()())}function de(n,e){if(n&1){let t=C();r(0,"li",28),u("click",function(){let l=_(t).$implicit,s=p();return s.filter.status="",s.activeTab="All",s.filter.ticket_category=null,s.filter.priority=l,b(s.getList())}),r(1,"div",33)(2,"a",34),u("click",function(){let l=_(t).$implicit,s=p();return b(s.updatePriorityFilter(l.priorityKeys))}),r(3,"div",31)(4,"span",36),m(5),a()()(),r(6,"span",39),m(7),a()()()}if(n&2){let t=e.$implicit,i=p();c("ngClass",L(3,ae,i.filter.priority===t)),o(5),h(t),o(2),h(i.priorityCount[t])}}function ue(n,e){n&1&&(r(0,"div",40)(1,"label",38),m(2," No data available! "),a()())}function ge(n,e){if(n&1&&(r(0,"span"),m(1),k(2,"date"),a()),n&2){let t=p().$implicit,i=p().$implicit;o(),v(" ",F(2,1,(i==null?null:i[t.name])||(i==null||i.form_data==null?null:i.form_data[t.name]),"d MMM yyyy, hh:mm a")," ")}}function _e(n,e){if(n&1){let t=C();r(0,"span")(1,"a",46),u("click",function(){_(t);let l=p(2).$implicit,s=p(2);return b(s.goToDetailPage(l._id))}),m(2),a()()}if(n&2){let t=p().$implicit,i=p().$implicit;o(2),v(" ",(i==null?null:i[t.name])||(i==null||i.form_data==null?null:i.form_data[t.name])||"--"," ")}}function be(n,e){if(n&1&&(r(0,"span"),m(1),a()),n&2){let t=p().$implicit,i=p().$implicit;o(),v(" ",(i==null?null:i[t.name])||(i==null||i.form_data==null?null:i.form_data[t.name])||"--"," ")}}function fe(n,e){if(n&1&&(y(0),r(1,"td"),d(2,ge,3,4,"span",45)(3,_e,3,1,"span",18)(4,be,2,1,"span",18),a(),x()),n&2){let t=e.$implicit;o(2),c("ngIf",t.name.includes("date")||t.name.endsWith("_at")),o(),c("ngIf",t.name==="complaint_no"),o(),c("ngIf",!(t.name.includes("date")||t.name.endsWith("_at")||t.name==="complaint_no"))}}function Ce(n,e){if(n&1){let t=C();r(0,"tr",42)(1,"td",43),m(2),a(),d(3,fe,5,3,"ng-container",17),r(4,"td",43)(5,"app-icon-button",44),u("clickEvent",function(){let l=_(t).$implicit,s=p(2);return b(s.goToDetailPage(l._id))}),a()()()}if(n&2){let t=e.index,i=p(2);o(2),h(t+1),o(),c("ngForOf",i.tableHeader),o(2),c("icon","ri-eye-line")("buttonClass","ti-btn btn-wave  ti-btn-sm ti-btn-soft-primary waves-effect waves-light")}}function he(n,e){if(n&1&&(y(0),d(1,Ce,6,4,"tr",41),x()),n&2){let t=p();o(),c("ngForOf",t.listing)}}function ve(n,e){n&1&&(r(0,"td"),f(1,"app-skeleton"),a()),n&2&&(o(),T("h20 bg-skeleton"))}function ye(n,e){n&1&&(r(0,"tr",48),d(1,ve,2,2,"td",17),a()),n&2&&(o(),c("ngForOf",S(1,oe).constructor(11)))}function xe(n,e){n&1&&(y(0),d(1,ye,2,2,"tr",47),x()),n&2&&(o(),c("ngForOf",S(1,oe).constructor(8)))}function Se(n,e){n&1&&(y(0),f(1,"app-data-not-found"),x())}var ne=class n{constructor(e,t,i,l,s,Te,Le,we,Ie){this.moduleService=e;this.CommonApiService=t;this.api=i;this.dialog=l;this.fb=s;this.util=Te;this.router=Le;this.alert=we;this.commonFunction=Ie}filter={};FORMID=Q;skLoading=!1;tableData={};tableHeader=[];listing=[];listingData=[];listTabs={};listPagination={};subModule={};moduleName="";moduleId=0;moduleFormId=0;moduleTableId=0;fieldTypes=R;page=1;activeTab="All";activeSubTab="";mainTabs=[];inProcessTabs=[];closeTabs=[];accessRight={};priorityKeys=[];tabCount={};priorityCount={};userViceCounts={};categoryKeys=[];tabs=[{label:"All",value:"",icon:"ri-inbox-line",countClass:"warning",count:0},{label:"Pending",value:"Pending",icon:"ri-time-line",countClass:"warning",count:0},{label:"Close",value:"Close",icon:"ri-checkbox-line",countClass:"success",count:0},{label:"Cancel",value:"Cancel",icon:"ri-close-circle-line",countClass:"danger",count:0}];ngOnInit(){let e=this.moduleService.getAccessMap("WCMS","Complaint");console.log(e),e&&(this.accessRight=e);let t=this.moduleService.getSubModuleByName("WCMS","Complaint"),i=this.moduleService.getFormById("WCMS","Complaint",this.FORMID.ID.ComplaintForm),l=this.moduleService.getTableById("WCMS","Complaint",this.FORMID.ID.ComplaintTable);t&&(this.subModule=t,this.moduleId=t.module_id,this.moduleName=t.title,console.log(this.subModule)),i&&(this.moduleFormId=i.form_id),l&&(this.moduleTableId=l.table_id),this.getHeaderConfigListing()}setActiveTab(e){this.activeTab=e,this.filter={}}onRefresh(){this.filter={},this.getHeaderConfigListing()}goToAddPage(){this.router.navigate(["/apps/service/complaint/complaint-add"])}goToDetailPage(e){this.router.navigate(["/apps/service/complaint/complaint-detail",e])}onTabChange(e,t){this.activeTab=e,this.activeSubTab=t,this.getList()}onSubTabChange(e){this.activeSubTab=e,this.getList()}getHeaderConfigListing(){this.CommonApiService.getHeaderConfigListing(this.moduleTableId,this.moduleFormId).subscribe(e=>{this.tableData=e.data,this.tableHeader=e.data.table_data.tableHead,this.tableHeader=this.tableHeader.filter(t=>t.list_view_checked&&t.key_name_required!==!0&&t.type!=this.fieldTypes.UPLOAD),this.getState(),this.getList()})}updateFilter(e){this.filter.service_engineer_name=e,this.getList()}updatePriorityFilter(e){this.filter.priority=e,this.getList()}getList(){this.skLoading=!0,this.activeTab!="All"&&(this.filter.status=this.activeTab),this.filter=this.commonFunction.removeBlankKeys(this.filter),this.api.post({filters:this.filter,form_id:this.moduleFormId,activeTab:this.activeTab,page:this.listPagination.cur_page??1},"complaint/read").subscribe(e=>{e.statusCode=="200"&&(this.skLoading=!1,this.listingData=e.data,this.listing=e.data.result,this.tabCount=e.data.category_counts?e.data.category_counts:{},this.priorityCount=e.data.priority_counts?e.data.priority_counts:{},this.priorityKeys=Object.keys(e.data.priority_counts?e.data.priority_counts:""),this.userViceCounts=Object.keys(e.data.userViceCounts?e.data.userViceCounts:""),this.tabs=[{label:"All",value:"All",icon:"ri-inbox-line",countClass:"primary",count:e.data.status_counts.All||0},{label:"Pending",value:"Pending",icon:"ri-time-line",countClass:"warning",count:e.data.status_counts?.Pending||0},{label:"Close",value:"Close",icon:"ri-checkbox-circle-line",countClass:"success",count:e.data.status_counts?.Close||0},{label:"Cancel",value:"Cancel",icon:"ri-close-circle-line",countClass:"danger",count:e.data.status_counts?.Cancel||0}],this.listPagination=e.pagination)})}getState(){this.api.post({},"postal-code/states").subscribe(e=>{if(e.statusCode===200)for(let t=0;t<this.tableHeader.length;t++)this.tableHeader[t].name==="state"&&(this.tableHeader[t].options=e.data)})}getDistrict(e){this.api.post({state:e},"postal-code/districts").subscribe(t=>{if(t.statusCode===200)for(let i=0;i<this.tableHeader.length;i++)this.tableHeader[i].name==="district"&&(this.tableHeader[i].options=t.data)})}getTabCount(e){return this.listTabs&&this.listTabs[e]!==void 0?this.listTabs[e].toString():"0"}changeToPagination(e){e=="Previous"?this.listPagination.prev&&this.page>1&&(this.page--,this.getList()):this.listPagination.next&&(this.page++,this.getList())}changeToPage(e){this.page=e,this.listPagination.cur_page=e,this.getList()}updateSearchFilter(e){this.filter[e.name]=e.searchText,this.getList()}handleSelectChange(e){let{category_name:t,selections:i}=e;this.filter[t]=i,this.getList()}openHeaderSettingModal(){this.getHeaderConfigListing(),this.dialog.open(te,{width:"450px",panelClass:"mat-right-modal",position:{right:"0px"},data:{lastPage:"header-config",moduleFormId:this.moduleFormId,moduleTableId:this.moduleTableId,PageTableData:this.tableData,allPageHeaders:this.tableHeader,PageHeaders:this.tableHeader}}).afterClosed().subscribe(t=>{t===!0&&(this.tableHeader=t.headers,this.getHeaderConfigListing())})}openMainLogModal(){this.dialog.open(X,{width:"350px",panelClass:"mat-right-modal",position:{right:"0px"},data:{moduleId:this.subModule.module_id,module_type:this.subModule.module_type}}).afterClosed().subscribe(t=>{})}static \u0275fac=function(t){return new(t||n)(g(W),g(j),g($),g(U),g(A),g(O),g(D),g(N),g(Y))};static \u0275cmp=w({type:n,selectors:[["app-complaint-list"]],decls:40,vars:39,consts:[[3,"buttonClick","title","title1","activeitem","buttonText","icon","btnShow","buttonValue","buttonValue1"],[1,"grid","grid-cols-12","gap-x-6"],[1,"xl:col-span-3","col-span-12"],[1,"box"],[1,"box-header","gap-2","items-center","pb-3","border-b","border-dashed","border-defaultborder","dark:border-defaultborder/10"],[1,"avatar","avatar-md","bg-primary","avatar-rounded"],[1,"ri-file-list-3-line","text-[1rem]"],[1,"box-title"],["class","ti-btn ti-btn-sm ti-btn-soft-primary1 ms-auto !rounded-full",3,"click",4,"ngIf"],[1,"box-body","p-0"],[1,"p-4","task-navigation","border-b","border-dashed","border-defaultborder","dark:border-defaultborder/10"],[1,"list-none","task-main-nav","mb-0"],[1,"px-0","pt-0"],[1,"text-[11px]","text-textmuted","dark:text-textmuted/50","opacity-70","font-medium"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"px-0","pt-2","flex","justify-between","gap-2","items-center"],[1,"scroll-y-250","mb-0"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","px-3",4,"ngIf"],[1,"xl:col-span-9","col-span-12"],[3,"onRefresh","logBtn","pageTitle","listLength","btnShow","refreshLabel","btnShow1","logsLabel"],[1,"box-body"],[1,"table-responsive","overflow-auto","table-bordered-default"],["tableClass","ti-custom-table ti-custom-table-head ti-custom-table-hover ti-head-primary whitespace-nowrap",3,"textSearchChange","selectionChange","tableHead","showCheckbox","showS_No","showSorting","showFilterRow","showAction","columns","subModule"],[3,"preButtonClick","nextButtonClick","pageChange","currentPage","totalPage","pageLimit","listLength","preBtn","nextBtn"],[1,"ti-btn","ti-btn-sm","ti-btn-soft-primary1","ms-auto","!rounded-full",3,"click"],[1,"ri-add-line"],[3,"click","ngClass"],[1,"flex","items-center"],[1,"me-2","leading-none"],[1,"flex-auto","text-nowrap"],[3,"class",4,"ngIf"],[1,"flex","items-center","justify-between","flex-wrap","gap-2"],[1,"flex",3,"click"],[1,"ri-account-circle-fill","text-primarytint1color","align-middle","text-[14px]"],[1,"font-medium"],[1,"badge","bg-primarytint1color/10","text-primarytint1color","rounded-full"],[1,"form-check-label","!ps-0","text11px","font-normal"],[1,"badge","bg-primary/10","rounded-full","text-primary"],[1,"px-3"],["class","product-list border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[1,"product-list","border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"!text-center"],[3,"clickEvent","icon","buttonClass"],[4,"ngIfElseNonDate","ngIf"],[1,"text-primary","font-semibold","underline",3,"click"],["class","border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[1,"border-b","!border-defaultborder","dark:!border-defaultborder/10"]],template:function(t,i){t&1&&(r(0,"app-page-header",0),u("buttonClick",function(){return i.openHeaderSettingModal()}),a(),r(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"span",5),f(6,"i",6),a(),r(7,"div",7),m(8," Complaint "),a(),d(9,le,3,0,"button",8),a(),r(10,"div",9)(11,"div",10)(12,"ul",11)(13,"li",12)(14,"span",13),m(15,"Status"),a()(),d(16,ce,8,7,"li",14),a(),r(17,"ul",11)(18,"li",15)(19,"span",13),m(20,"Team"),a()(),r(21,"ul",16),d(22,pe,11,2,"li",17)(23,me,3,0,"div",18),a()(),r(24,"ul",11)(25,"li",15)(26,"span",13),m(27,"Priority"),a()(),d(28,de,8,5,"li",14)(29,ue,3,0,"div",19),a()()()()(),r(30,"div",20)(31,"div",3)(32,"app-page-sub-header",21),u("onRefresh",function(){return i.onRefresh()})("logBtn",function(){return i.openMainLogModal()}),a(),r(33,"div",22)(34,"div",23)(35,"spk-reusable-tables",24),u("textSearchChange",function(s){return i.updateSearchFilter(s)})("selectionChange",function(s){return i.handleSelectChange(s)}),d(36,he,2,1,"ng-container",18)(37,xe,2,2,"ng-container",18),a(),d(38,Se,2,0,"ng-container",18),a()(),r(39,"app-pagination-footer",25),u("preButtonClick",function(){return i.changeToPagination("Previous")})("nextButtonClick",function(){return i.changeToPagination("Next")})("pageChange",function(s){return i.changeToPage(s)}),a()()()()),t&2&&(c("title","WCMS")("title1",S(38,re))("activeitem","Complaint List")("buttonText","Header Config")("icon","settings")("btnShow",!1)("buttonValue","")("btnShow",i.accessRight==null?null:i.accessRight.modifyRight)("buttonValue1",""),o(9),c("ngIf",i.accessRight==null?null:i.accessRight.addRight),o(7),c("ngForOf",i.tabs),o(6),c("ngForOf",i.listingData.userViceCounts),o(),c("ngIf",!(i.listingData.userViceCounts!=null&&i.listingData.userViceCounts.length)),o(5),c("ngForOf",i.priorityKeys),o(),c("ngIf",!(i.priorityKeys!=null&&i.priorityKeys.length)),o(3),c("pageTitle","Complaint List")("listLength",i.listing.length)("btnShow",!0)("refreshLabel","Refresh")("btnShow1",!0)("logsLabel","Logs"),o(3),c("tableHead","border-b")("showCheckbox",!1)("showS_No",!0)("showSorting",!1)("showFilterRow",!0)("showAction",!0)("columns",i.tableHeader)("subModule",i.subModule),o(),c("ngIf",!i.skLoading),o(),c("ngIf",i.skLoading),o(),c("ngIf",!i.listing.length&&!i.skLoading),o(),c("currentPage",i.listPagination.cur_page)("totalPage",i.listPagination.total_pages)("pageLimit",i.listPagination.limit)("listLength",i.listing.length)("preBtn",!i.listPagination.prev)("nextBtn",!i.listPagination.next))},dependencies:[J,M,P,E,Z,K,z,G,ie,ee,H,V,q,B],encapsulation:2})};export{ne as ComplaintListComponent};
