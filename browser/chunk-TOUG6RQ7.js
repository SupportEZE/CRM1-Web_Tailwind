import{a as Ue}from"./chunk-5QFGLOXN.js";import{a as Ge}from"./chunk-J4NDCUAB.js";import{a as je}from"./chunk-PU6S26UW.js";import"./chunk-OTFCGVEU.js";import{a as ue}from"./chunk-CNF4GSI7.js";import{a as Me}from"./chunk-OEHD5D2Y.js";import{a as Ye}from"./chunk-GLWQGYBC.js";import{a as D}from"./chunk-DC4QM32I.js";import{C as We,F as B,c as ge,g as Fe,h as Re,j as Ee,k as Ie,q as Ae,r as De,s as Ne,u as Be,v as qe,w as Oe}from"./chunk-VHE3PQ3O.js";import{$ as _e,A as h,Aa as ye,B as I,C as ae,D as H,Ea as he,G as re,Ga as be,H as le,Ha as ve,Ia as xe,Ja as Se,M as se,Oa as we,P as me,Pa as Pe,Qa as Te,Ta as ke,Ua as Ve,V as ce,W as de,X as pe,Z as A,hb as N,jb as Le,o as T,p as ie,va as fe,w as E,wa as Ce,y as ne,z as oe}from"./chunk-GYDYF5F3.js";import{M as te,e as Z,f as $,g as F,o as ee,t as R}from"./chunk-PD5VTTIY.js";import{$c as Q,Aa as d,Ba as p,Hb as M,Lc as Y,Mc as u,Nc as b,Ob as g,Pc as J,Uc as v,Vc as x,Wc as S,Yc as V,Zc as K,_b as c,ad as X,bc as j,ed as G,fc as k,gd as U,kc as l,lc as a,mc as C,nc as w,oc as P,qc as y,rb as r,sb as f,wc as _,yc as m}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as O,b as W}from"./chunk-66YHNWRR.js";function it(o,n){if(o&1){let t=y();l(0,"div",6)(1,"spk-ng-select",17),_("selectedChange",function(e){d(t);let s=m(2);return p(s.findName(e,"payment_to_name"))}),a()()}if(o&2){let t=m(2);r(),c("fieldReq",!0)("options",t.CommonApiService.customerMapping)}}function nt(o,n){if(o&1){let t=y();w(0),l(1,"div",6),C(2,"spk-input",18),a(),l(3,"div",19)(4,"label",20),u(5,"Screenshot Attachment"),l(6,"span",21),u(7,"*"),a()(),l(8,"file-pond",22),_("onremovefile",function(e){d(t);let s=m(2);return p(s.onFileRemove(e,"image"))})("onprocessfile",function(e){d(t);let s=m(2);return p(s.onFileProcessed(e,"image"))}),a()(),P()}if(o&2){let t=m(2);r(2),c("label",t.addForm.value.payment_mode==="Online"?"Transaction Id":"Cheque No.")("fieldReq",!0),r(6),c("options",t.pondOptions)("files",t.pondFiles)}}function ot(o,n){if(o&1){let t=y();l(0,"div",1)(1,"app-modal-header",2),_("close",function(){d(t);let e=m();return p(e.close())}),a(),l(2,"form",3),_("ngSubmit",function(){d(t);let e=m();return p(e.onSubmit())}),l(3,"mat-dialog-content",4)(4,"div",5)(5,"div",6)(6,"spk-ng-select",7),_("selectedChange",function(e){d(t);let s=m();return p(s.findName(e,"customer_category"))}),a()(),l(7,"div",6)(8,"spk-ng-select",8),_("searchChanged",function(e){d(t);let s=m();return p(s.onSearch(e,"customer"))})("selectedChange",function(e){d(t);let s=m();return p(s.findName(e,"customer_name"))}),a()(),g(9,it,2,2,"div",9),l(10,"div",6),C(11,"spk-input",10),a(),l(12,"div",6),C(13,"spk-flatpickr",11),a(),l(14,"div",6),C(15,"spk-ng-select",12),a(),g(16,nt,9,4,"ng-container",13),a()(),l(17,"mat-dialog-actions",14)(18,"div",15),C(19,"app-button",16),a()()()()}if(o&2){let t,i,e=m();r(),c("title","Add Payment")("closeBtn",!0),r(),c("formGroup",e.addForm),r(4),c("fieldReq",!0)("options",e.CommonApiService.customerCategorySubType),r(2),c("fieldReq",!0)("options",e.CommonApiService.customerData)("search",!0),r(),c("ngIf",((t=e.addForm.get("collected_from_login_type_id"))==null?null:t.value)===e.LOGIN_TYPES.SECONDARY),r(2),c("fieldReq",!0),r(2),c("fieldReq",!0)("max",e.today),r(2),c("fieldReq",!0)("options",e.modeList),r(),c("ngIf",((i=e.addForm.get("payment_mode"))==null?null:i.value)!=="Cash"),r(3),c("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",e.api.disabled)("iconClass",e.api.disabled?"ri-loader-2-fill animate-spin":"ri-save-line")("loadingIconClass","ri-loader-2-fill")}}function at(o,n){if(o&1){let t=y();l(0,"div",1)(1,"app-modal-header",2),_("close",function(){d(t);let e=m();return p(e.close())}),a(),l(2,"form",3),_("ngSubmit",function(){d(t);let e=m();return p(e.statusChange())}),l(3,"mat-dialog-content",4)(4,"div",5)(5,"div",23),C(6,"spk-ng-select",24),a(),l(7,"div",23),C(8,"spk-input",25),a()()(),l(9,"mat-dialog-actions",26),C(10,"app-button",27),a()()()}if(o&2){let t,i=m();r(),c("title","Change Status")("closeBtn",!0),r(),c("formGroup",i.statusForm),r(4),c("fieldReq",!0)("options",i.statusList),r(2),c("label",((t=i.statusForm.get("status"))==null?null:t.value)==="Verified"?"Remark":"Reason")("fieldReq",!0),r(2),c("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",i.api.disabled)("formType",i.modalData.formType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}var L=class o{constructor(n,t,i,e,s,q,ze,kt,Vt,Lt){this.modalData=n;this.dialogRef=t;this.nameUtils=i;this.CommonApiService=e;this.toastr=s;this.api=q;this.fb=ze;this.formValidation=kt;this.moduleService=Vt;this.uploadService=Lt}addForm=new H({});statusForm=new H({});submodule;LOGIN_TYPES=T;today=new Date;pondFiles=[];ngOnInit(){this.modalData.formType==="add"&&this.CommonApiService.getCustomerCategorySubType([T.PRIMARY,T.SUB_PRIMARY,T.SECONDARY]),this.addForm=this.fb.group({customer_type_id:["",h.required],customer_type_name:["",h.required],collected_from_login_type_id:["",h.required],collected_from_id:["",h.required],collected_from_name:["",h.required],amount:["",h.required],payment_mode:["Cheque",h.required],transaction_id:[""],payment_date:["",h.required],payment_to_name:[""],payment_to_id:[""],payment_to_login_type_id:[""]}),this.addForm.get("payment_mode")?.valueChanges.subscribe(n=>{n==="Cash"?this.addForm.get("transaction_id")?.clearValidators():this.addForm.get("transaction_id")?.setValidators([h.required])}),this.addForm.get("collected_from_login_type_id")?.valueChanges.subscribe(n=>{n===T.PRIMARY||n===T.SUB_PRIMARY?(this.addForm.get("payment_to_name")?.clearValidators(),this.addForm.get("payment_to_id")?.clearValidators(),this.addForm.get("payment_to_login_type_id")?.clearValidators()):(this.addForm.get("payment_to_name")?.setValidators([h.required]),this.addForm.get("payment_to_id")?.setValidators([h.required]),this.addForm.get("payment_to_login_type_id")?.setValidators([h.required]))}),this.statusForm=this.fb.group({status:["",h.required],reason:["",h.required]})}lastSearchTerm="";onSearch(n,t){let i=n?.trim()||"";i!==this.lastSearchTerm&&(this.lastSearchTerm=i,t==="customer"&&this.CommonApiService.getCustomerData(this.addForm.value.customer_type_id,"",n))}pondOptions=this.getPondOptions("image");getPondOptions(n){let t={allowFileTypeValidation:!0,labelIdle:"Click or drag files here to upload...",maxFiles:5,server:{process:(i,e,s,q)=>{setTimeout(()=>{q(Date.now().toString())},1e3)},revert:(i,e)=>{e()}}};if(n==="image")return W(O({},t),{allowMultiple:!1,acceptedFileTypes:["image/jpeg","image/png","image/jpg"],maxFileSize:"2MB",allowImageValidateSize:!0,labelFileTypeNotAllowed:"Only PNG and JPEG files are allowed",fileValidateTypeLabelExpectedTypes:"Allowed: PNG, JPEG",labelImageValidateSizeTooSmall:"Image is too small. Min: {minWidth}\xD7{minHeight}",labelImageValidateSizeTooBig:"Image is too large. Max: {maxWidth}\xD7{maxHeight}"})}onFileProcessed(n,t){let i=n.file.file;Object.assign(i,{image_type:t}),t==="image"&&(this.pondFiles=[...this.pondFiles||[],i])}onFileRemove(n,t){let i=n.file.file;if(t==="image"){let e=this.pondFiles.findIndex(s=>s.name===i.name&&s.size===i.size);e>-1&&this.pondFiles.splice(e,1)}}findName(n,t){if(t==="customer_category"){let i=this.CommonApiService.customerCategorySubType.find(e=>e.value===n);i&&(this.addForm.patchValue({customer_type_name:i.label}),this.addForm.patchValue({collected_from_login_type_id:i.login_type_id})),this.CommonApiService.getCustomerData(this.addForm.value.customer_type_id)}if(t==="customer_name"){let i=this.CommonApiService.customerData.find(e=>e.value===n);i&&(this.addForm.patchValue({collected_from_name:i.label}),this.addForm.get("collected_from_login_type_id")?.value===T.SECONDARY&&this.CommonApiService.getCustomerMapping(this.addForm.value.collected_from_id))}if(t==="payment_to_name"){let i=this.CommonApiService.customerMapping.find(e=>e.value===n);i&&(this.addForm.patchValue({payment_to_name:i.label}),this.addForm.patchValue({payment_to_login_type_id:i.login_type_id}))}}onSubmit(){if(this.addForm.invalid){this.toastr.error("Form Is Invalid","","toast-top-right"),this.addForm.markAllAsTouched();let n=Object.keys(this.addForm.controls).filter(t=>this.addForm.get(t)?.invalid);console.warn("Invalid fields:",n);return}if(this.addForm.value.payment_mode!=="Cash"&&this.pondFiles.length===0){this.toastr.error("Please upload at least one file.","","toast-top-right");return}this.api.disabled=!0,this.api.post(this.addForm.value,"payment/create").subscribe(n=>{n.statusCode===200&&(this.pondFiles.length>0?(this.api.disabled=!0,this.uploadService.uploadFile(n.data.inserted_id,"payment",this.pondFiles,"Payment Collection Images",this.submodule,void 0,()=>this.dialogRef.close(!0))):(this.api.disabled=!1,this.toastr.success(n.message,"","toast-top-right"),this.dialogRef.close(!0)))})}statusChange(){if(this.statusForm.invalid){this.statusForm.markAllAsTouched();return}let n=W(O({},this.statusForm.value),{customers:this.modalData.selectedRows});this.api.disabled=!0,this.api.patch(n,"payment/update-status").subscribe(t=>{t.statusCode===200&&(this.api.disabled=!1,this.toastr.success(t.message,"","toast-top-right"),this.dialogRef.close(!0))})}close(){this.dialogRef.close()}modeList=[{label:"Cash",value:"Cash"},{label:"Cheque",value:"Cheque"},{label:"Online",value:"Online"}];statusList=[{label:"Verified",value:"Verified"},{label:"Reject",value:"Reject"}];static \u0275fac=function(t){return new(t||o)(f(Pe),f(we),f(Ue),f(ue),f(E),f(A),f(ce),f(qe),f(D),f(je))};static \u0275cmp=M({type:o,selectors:[["app-payment-collection-add"]],decls:2,vars:2,consts:[["class","mat-dialoge",4,"ngIf"],[1,"mat-dialoge"],[3,"close","title","closeBtn"],[3,"ngSubmit","formGroup"],[1,"mat-typography","py-1"],[1,"grid","grid-cols-12","sm:gap-x-6"],[1,"xl:col-span-4","col-span-12"],["formControlName","customer_type_id","label","Customer Category",3,"selectedChange","fieldReq","options"],["formControlName","collected_from_id","label","Customer",3,"searchChanged","selectedChange","fieldReq","options","search"],["class","xl:col-span-4 col-span-12",4,"ngIf"],["label","Amount","formControlName","amount","type","number",1,"remove-default-class",3,"fieldReq"],["placeholder","Payment Date","label","Payment Date","formControlName","payment_date",1,"form-control","custom-datepickr",3,"fieldReq","max"],["formControlName","payment_mode","label","Mode",3,"fieldReq","options"],[4,"ngIf"],["align","end"],[1,"flex","items-center","gap-2"],[3,"buttonType","buttonClass","disabled","iconClass","loadingIconClass"],["formControlName","payment_to_id","label","Payment To",3,"selectedChange","fieldReq","options"],["formControlName","transaction_id",1,"remove-default-class",3,"label","fieldReq"],[1,"xl:col-span-8","col-span-12"],[1,"form-label","mb-0"],[1,"text-red-500"],[1,"filepond","basic-filepond",3,"onremovefile","onprocessfile","options","files"],[1,"xl:col-span-12","col-span-12"],["formControlName","status","label","Status",3,"fieldReq","options"],["formControlName","reason","type","textarea",1,"remove-default-class",3,"label","fieldReq"],["align","end",1,"gap-2"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"]],template:function(t,i){t&1&&g(0,ot,20,20,"div",0)(1,at,11,13,"div",0),t&2&&(c("ngIf",i.modalData.formType==="add"),r(),c("ngIf",i.modalData.formType==="change-status"))},dependencies:[R,F,B,le,I,ae,se,me,Oe,Fe,We,De,N,Ve,ke,Ie,Ee,Re,pe],encapsulation:2})};var rt=()=>["Payment Collection"],lt=(o,n,t,i)=>({name:o,label:n,icon:t,count:i}),st=o=>[o],z=()=>[],mt=(o,n,t)=>({"text-primary":o,"text-secondary":n,"text-primarytint2color":t});function ct(o,n){if(o&1){let t=y();l(0,"app-listing-tab",15),_("tabChange",function(e){d(t);let s=m(2);return p(s.onTabChange(e.tab))}),a()}if(o&2){let t=n.$implicit,i=m(2);c("tabs",K(7,st,X(2,lt,t.name,t.label,t.icon,t.count)))("activeTab",i.activeTab)}}function dt(o,n){if(o&1&&(w(0),l(1,"nav",13),g(2,ct,1,9,"app-listing-tab",14),a(),P()),o&2){let t=m();r(2),c("ngForOf",t.mainTabs)}}function pt(o,n){o&1&&C(0,"app-skeleton"),o&2&&j("w100 h30 bg-skeleton")}function _t(o,n){o&1&&(w(0),l(1,"div",16),g(2,pt,1,2,"app-skeleton",17),a(),P()),o&2&&(r(2),c("ngForOf",V(1,z).constructor(4)))}function ut(o,n){if(o&1){let t=y();w(0),l(1,"input",27),S("ngModelChange",function(e){d(t);let s=m(2);return x(s.allTasksChecked,e)||(s.allTasksChecked=e),p(e)}),_("change",function(){d(t);let e=m(2);return p(e.handleToggleSelectAll(e.allTasksChecked))}),a(),P()}if(o&2){let t=m(2);r(),v("ngModel",t.allTasksChecked)}}function gt(o,n){if(o&1){let t=y();l(0,"button",28),_("click",function(){d(t);let e=m(2);return e.filter.created_name="",p(e.getList())}),l(1,"mat-icon"),u(2,"close"),a()()}}function ft(o,n){if(o&1){let t=y();l(0,"button",28),_("click",function(){d(t);let e=m(2);return e.filter.payment_no="",p(e.getList())}),l(1,"mat-icon"),u(2,"close"),a()()}}function Ct(o,n){if(o&1){let t=y();l(0,"button",28),_("click",function(){d(t);let e=m(2);return e.filter.customer_type_name="",p(e.getList())}),l(1,"mat-icon"),u(2,"close"),a()()}}function yt(o,n){if(o&1){let t=y();l(0,"button",28),_("click",function(){d(t);let e=m(2);return e.filter.collected_from_name="",p(e.getList())}),l(1,"mat-icon"),u(2,"close"),a()()}}function ht(o,n){if(o&1){let t=y();l(0,"button",28),_("click",function(){d(t);let e=m(2);return e.filter.payment_mode="",p(e.getList())}),l(1,"mat-icon"),u(2,"close"),a()()}}function bt(o,n){if(o&1){let t=y();l(0,"input",27),S("ngModelChange",function(e){d(t);let s=m().$implicit;return x(s.checked,e)||(s.checked=e),p(e)}),_("change",function(){d(t);let e=m().$implicit,s=m(2);return p(s.toggleRowChecked(e))}),a()}if(o&2){let t=m().$implicit;v("ngModel",t.checked)}}function vt(o,n){if(o&1){let t=y();l(0,"tr",29)(1,"td",30),g(2,bt,1,1,"input",31),a(),l(3,"td"),u(4),a(),l(5,"td"),u(6),G(7,"date"),a(),l(8,"td"),u(9),a(),l(10,"td"),u(11),G(12,"date"),a(),l(13,"td")(14,"a",32),_("click",function(){let e=d(t).$implicit,s=m(2);return p(s.goToDetailPage(e._id))}),u(15),a()(),l(16,"td"),u(17),a(),l(18,"td"),u(19),a(),l(20,"td",33),u(21),a(),l(22,"td",34)(23,"span",35),u(24),a()(),l(25,"td"),u(26),a()()}if(o&2){let t=n.$implicit,i=n.index,e=m(2);r(2),c("ngIf",t.status==="Pending"&&(e.accessRight==null?null:e.accessRight.approveRight)),r(2),b((e.pagination.cur_page-1)*e.pagination.limit+i+1),r(2),b(t.created_at?U(7,13,t.created_at,"d MMM yyyy, hh:mm a"):"--"),r(3),b(t.created_name||"--"),r(2),b(t.payment_date?U(12,16,t.payment_date,"d MMM yyyy"):"--"),r(4),b(t.payment_no||"--"),r(2),b(t.customer_type_name||"--"),r(2),b(t.collected_from_name||"--"),r(2),J("",e.CURRENCY_SYMBOLS.RUPEE," ",t.amount||"--",""),r(2),c("ngClass",Q(19,mt,t.payment_mode==="Online",t.payment_mode==="Cash",t.payment_mode==="Cheque")),r(),b(t.payment_mode||"--"),r(2),b(t.transaction_id||"--")}}function xt(o,n){if(o&1){let t=y();w(0),l(1,"tr",18)(2,"td"),g(3,ut,2,1,"ng-container",4),a(),l(4,"td"),u(5,"\xA0"),a(),l(6,"td")(7,"div",19)(8,"mat-form-field",20)(9,"input",21),S("ngModelChange",function(e){d(t);let s=m();return x(s.filter.created_at,e)||(s.filter.created_at=e),p(e)}),_("ngModelChange",function(){d(t);let e=m();return p(e.getList())}),a(),C(10,"mat-datepicker-toggle",22)(11,"mat-datepicker",null,0),a()()(),l(13,"td")(14,"div",19)(15,"mat-form-field",20)(16,"input",23),S("ngModelChange",function(e){d(t);let s=m();return x(s.filter.created_name,e)||(s.filter.created_name=e),p(e)}),_("keyup.enter",function(){d(t);let e=m();return p(e.getList())}),a(),g(17,gt,3,0,"button",24),a()()(),l(18,"td")(19,"div",19)(20,"mat-form-field",20)(21,"input",25),S("ngModelChange",function(e){d(t);let s=m();return x(s.filter.payment_date,e)||(s.filter.payment_date=e),p(e)}),_("ngModelChange",function(){d(t);let e=m();return p(e.getList())}),a(),C(22,"mat-datepicker-toggle",22)(23,"mat-datepicker",null,1),a()()(),l(25,"td")(26,"div",19)(27,"mat-form-field",20)(28,"input",23),S("ngModelChange",function(e){d(t);let s=m();return x(s.filter.payment_no,e)||(s.filter.payment_no=e),p(e)}),_("keyup.enter",function(){d(t);let e=m();return p(e.getList())}),a(),g(29,ft,3,0,"button",24),a()()(),l(30,"td")(31,"div",19)(32,"mat-form-field",20)(33,"input",23),S("ngModelChange",function(e){d(t);let s=m();return x(s.filter.customer_type_name,e)||(s.filter.customer_type_name=e),p(e)}),_("keyup.enter",function(){d(t);let e=m();return p(e.getList())}),a(),g(34,Ct,3,0,"button",24),a()()(),l(35,"td")(36,"div",19)(37,"mat-form-field",20)(38,"input",23),S("ngModelChange",function(e){d(t);let s=m();return x(s.filter.collected_from_name,e)||(s.filter.collected_from_name=e),p(e)}),_("keyup.enter",function(){d(t);let e=m();return p(e.getList())}),a(),g(39,yt,3,0,"button",24),a()()(),l(40,"td"),u(41,"\xA0"),a(),l(42,"td")(43,"div",19)(44,"mat-form-field",20)(45,"input",23),S("ngModelChange",function(e){d(t);let s=m();return x(s.filter.payment_mode,e)||(s.filter.payment_mode=e),p(e)}),_("keyup.enter",function(){d(t);let e=m();return p(e.getList())}),a(),g(46,ht,3,0,"button",24),a()()(),l(47,"td"),u(48,"\xA0"),a()(),g(49,vt,27,23,"tr",26),P()}if(o&2){let t=Y(12),i=Y(24),e=m();r(3),c("ngIf",e.hasPendingRows&&(e.accessRight==null?null:e.accessRight.approveRight)),r(6),c("matDatepicker",t),v("ngModel",e.filter.created_at),r(),c("for",t),r(6),v("ngModel",e.filter.created_name),r(),k(e.filter.created_name?17:-1),r(4),c("matDatepicker",i),v("ngModel",e.filter.payment_date),r(),c("for",i),r(6),v("ngModel",e.filter.payment_no),r(),k(e.filter.payment_no?29:-1),r(4),v("ngModel",e.filter.customer_type_name),r(),k(e.filter.customer_type_name?34:-1),r(4),v("ngModel",e.filter.collected_from_name),r(),k(e.filter.collected_from_name?39:-1),r(6),v("ngModel",e.filter.payment_mode),r(),k(e.filter.payment_mode?46:-1),r(3),c("ngForOf",e.listing)}}function St(o,n){o&1&&(l(0,"td"),C(1,"app-skeleton"),a()),o&2&&(r(),j("h20 bg-skeleton"))}function wt(o,n){o&1&&(l(0,"tr",18),g(1,St,2,2,"td",37),a()),o&2&&(r(),c("ngForOf",V(1,z).constructor(11)))}function Pt(o,n){o&1&&(w(0),g(1,wt,2,2,"tr",36),P()),o&2&&(r(),c("ngForOf",V(1,z).constructor(8)))}function Tt(o,n){o&1&&(w(0),C(1,"app-data-not-found"),P())}var He=class o{constructor(n,t,i,e,s,q,ze){this.dialog=n;this.api=t;this.alert=i;this.router=e;this.toastr=s;this.moduleService=q;this.dateService=ze}CURRENCY_SYMBOLS=ie;skLoading=!1;activeTab="Pending";pagination={};filter={};mainTabs=[];submodule={};listingCount={};listing=[];showChangeStatusBtn=!1;accessRight={};ngOnInit(){let n=this.moduleService.getAccessMap("SFA","Payment Collection");n&&(this.accessRight=n),this.getList()}allTasksChecked=!1;handleToggleSelectAll(n){this.listing.forEach(t=>{t.status==="Pending"?t.checked=n:t.checked=!1}),this.allTasksChecked=n,this.showChangeStatusBtn=this.listing.some(t=>t.checked)}toggleRowChecked(n){let t=this.listing.filter(i=>i.status==="Pending");this.allTasksChecked=t.every(i=>i.checked),this.showChangeStatusBtn=t.some(i=>i.checked)}get hasPendingRows(){return this.listing?.some(n=>n.status==="Pending")}goToDetailPage(n){this.router.navigate(["/apps/sfa/payment-collection/payment-collection-detail",n])}onRefresh(){this.filter={},this.listing.forEach(n=>n.checked=!1),this.allTasksChecked=!1,this.showChangeStatusBtn=!1,this.getList()}onTabChange(n){this.activeTab=n,this.getList()}changeToPage(n){this.pagination.cur_page=n,this.getList()}changeToPagination(n){n==="Next"&&this.pagination.cur_page<this.pagination.total_pages?this.pagination.cur_page++:n==="Previous"&&this.pagination.cur_page>1&&this.pagination.cur_page--,this.getList()}getList(){this.skLoading=!0,this.filter.created_at&&(this.filter.created_at=this.dateService.formatToYYYYMMDD(this.filter.created_at)),this.filter.payment_date&&(this.filter.payment_date=this.dateService.formatToYYYYMMDD(this.filter.payment_date)),this.api.post({filters:this.filter,activeTab:this.activeTab,page:this.pagination.cur_page??1},"payment/read").subscribe(n=>{n.statusCode==200&&(this.skLoading=!1,this.listing=n.data.result,this.listingCount=n.data.status_counts,this.pagination=n.pagination,this.mainTabs=[{name:"All",label:"All",icon:"ri-list-check",count:this.listingCount.All},{name:"Pending",label:"Pending",icon:"ri-time-line",count:this.listingCount.Pending},{name:"Verified",label:"Verified",icon:"ri-checkbox-circle-line",count:this.listingCount.Verified},{name:"Reject",label:"Reject",icon:"ri-close-circle-line",count:this.listingCount.Reject}])})}openModal(n){this.dialog.open(L,{width:"800px",data:{formType:n}}).afterClosed().subscribe(i=>{i===!0&&this.getList()})}onChangeStatusAll(n){let t=this.listing.filter(e=>e.checked).map(e=>({_id:e._id,status:e.status}));if(t.length===0){this.toastr.error("Please select at least one row.","","toast-top-right");return}this.dialog.open(L,{width:"400px",data:{formType:n,selectedRows:t}}).afterClosed().subscribe(e=>{e===!0&&this.getList()})}PageHeaders=[{label:""},{label:"S.No"},{label:"Created At"},{label:"Created By"},{label:"Payment At"},{label:"Payment No."},{label:"Customer Category"},{label:"Customer Name"},{label:"Amount",table_class:"text-right"},{label:"Payment Mode",table_class:"text-center"},{label:"Transaction Detail"}];static \u0275fac=function(t){return new(t||o)(f(Te),f(A),f(_e),f(te),f(E),f(D),f(Le))};static \u0275cmp=M({type:o,selectors:[["app-stock-audit-list"]],decls:15,vars:25,consts:[["picker",""],["picker1",""],[3,"title","title1","activeitem"],[1,"box","py-3","px-4"],[4,"ngIf"],[1,"row"],[1,"col-xl-12"],[1,"box"],[3,"onRefresh","logBtn","button1","pageTitle","listLength","btnShow","refreshLabel","btnShow1","logsLabel","btnShow2","addBtnLabel"],[1,"box-body"],[1,"table-responsive","overflow-auto","table-bordered-default"],["tableClass","ti-custom-table ti-custom-table-head ti-custom-table-hover ti-head-primary whitespace-nowrap",3,"tableHead","columns"],[3,"preButtonClick","nextButtonClick","pageChange","currentPage","totalPage","pageLimit","listLength","preBtn","nextBtn"],["aria-label","Tabs","role","tablist",1,"sm:flex","sm:space-x-2","sm:rtl:space-x-reverse","gap-1"],[3,"tabs","activeTab","tabChange",4,"ngFor","ngForOf"],[3,"tabChange","tabs","activeTab"],[1,"flex","items-center","gap-3"],[3,"class",4,"ngFor","ngForOf"],[1,"border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"table-search-filters"],[1,"table-input"],["matInput","","placeholder","Created At",3,"ngModelChange","matDatepicker","ngModel"],["matIconSuffix","",3,"for"],["matInput","","type","text","placeholder","Search...",3,"ngModelChange","keyup.enter","ngModel"],["matSuffix","","mat-icon-button","","aria-label","Clear"],["matInput","","placeholder","Payment Date",3,"ngModelChange","matDatepicker","ngModel"],["class","product-list border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],["type","checkbox",1,"form-check-input",3,"ngModelChange","change","ngModel"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"click"],[1,"product-list","border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"task-checkbox"],["class","form-check-input","type","checkbox",3,"ngModel","ngModelChange","change",4,"ngIf"],[1,"text-primary","font-semibold","underline",3,"click"],[1,"text-right"],[1,"text-center"],[1,"font-semibold",3,"ngClass"],["class","border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"]],template:function(t,i){t&1&&(C(0,"app-page-header",2),l(1,"div",3),g(2,dt,3,1,"ng-container",4)(3,_t,3,2,"ng-container",4),a(),l(4,"div",5)(5,"div",6)(6,"div",7)(7,"app-page-sub-header",8),_("onRefresh",function(){return i.onRefresh()})("logBtn",function(){return i.onChangeStatusAll("change-status")})("button1",function(){return i.openModal("add")}),a(),l(8,"div",9)(9,"div",10)(10,"spk-reusable-tables",11),g(11,xt,50,18,"ng-container",4)(12,Pt,2,2,"ng-container",4),a(),g(13,Tt,2,0,"ng-container",4),a()(),l(14,"app-pagination-footer",12),_("preButtonClick",function(){return i.changeToPagination("Previous")})("nextButtonClick",function(){return i.changeToPagination("Next")})("pageChange",function(s){return i.changeToPage(s)}),a()()()()),t&2&&(c("title","Payment Collection")("title1",V(24,rt))("activeitem","Payment Collection List"),r(2),c("ngIf",!i.skLoading),r(),c("ngIf",i.skLoading),r(4),c("pageTitle","Payment Collection List")("listLength",i.listing.length)("btnShow",!0)("refreshLabel","Refresh")("btnShow1",i.showChangeStatusBtn)("logsLabel","Change Status")("btnShow2",i.accessRight==null?null:i.accessRight.approveRight)("addBtnLabel","Add Payment Collection"),r(3),c("tableHead","border-b")("columns",i.PageHeaders),r(),c("ngIf",!i.skLoading),r(),c("ngIf",i.skLoading),r(),c("ngIf",!i.listing.length&&!i.skLoading),r(),c("currentPage",i.pagination.cur_page)("totalPage",i.pagination.total_pages)("pageLimit",i.pagination.limit)("listLength",i.listing.length)("preBtn",!i.pagination.prev)("nextBtn",!i.pagination.next))},dependencies:[B,Z,$,F,oe,ne,I,re,Ye,ge,Ne,Ae,Ge,Be,ee,R,Me,N,ye,ve,xe,Se,he,be,Ce,fe,de],encapsulation:2})};export{He as PaymentCollectionListComponent};
