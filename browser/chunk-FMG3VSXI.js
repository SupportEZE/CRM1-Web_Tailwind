import{a as _e}from"./chunk-PU6S26UW.js";import"./chunk-OTFCGVEU.js";import{b as he}from"./chunk-DUVWFXSE.js";import{a as Q}from"./chunk-CNF4GSI7.js";import{a as ve}from"./chunk-GLWQGYBC.js";import{a as ee}from"./chunk-DC4QM32I.js";import{C as ue,F as ge,c as $,g as re,j as le,k as ae,l as de,m as se,n as me,p as pe,v as ce,w as fe}from"./chunk-VHE3PQ3O.js";import{A as _,B as z,C as L,D as B,F as T,H as U,M as H,P as W,V as Z,W as Y,X as J,Z as X,aa as K,cb as te,db as ie,hb as oe,jb as ne,o as G,w as O}from"./chunk-GYDYF5F3.js";import{K as D,M as P,Q as j,f as M,g as k,t as q}from"./chunk-PD5VTTIY.js";import{Aa as v,Ba as h,Hb as R,La as w,Mc as f,Ob as u,Yc as A,_b as l,kc as r,lc as d,mc as g,nc as b,oc as F,qc as I,rb as a,sb as p,wc as C,yc as c}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as E,b as N}from"./chunk-66YHNWRR.js";var Ce=()=>["Gift"],xe=()=>[];function Se(o,i){o&1&&(r(0,"div",7),g(1,"app-skeleton"),d())}function be(o,i){o&1&&(r(0,"div",3)(1,"div",4)(2,"div",5),u(3,Se,2,0,"div",6),d()()()),o&2&&(a(3),l("ngForOf",A(1,xe).constructor(10)))}function Fe(o,i){o&1&&(r(0,"div",31),f(1," Gift type is required. "),d())}function Ie(o,i){if(o&1){let e=I();r(0,"div",17)(1,"spk-ng-select",32),C("selectedChange",function(n){v(e);let s=c(2);return h(s.findName(n,"customer_type"))}),d()()}if(o&2){let e=c(2);a(),l("fieldReq",!0)("options",e.commonApi.customerCategorySubType)("multiple",!0)}}function Ge(o,i){o&1&&(b(0),g(1,"spk-input",33),F()),o&2&&(a(),l("fieldReq",!0))}function Te(o,i){if(o&1){let e=I();b(0),r(1,"spk-ng-select",34),C("selectedChange",function(n){v(e);let s=c(2);return h(s.findName(n,"voucher"))}),d(),F()}if(o&2){let e=c(2);a(),l("fieldReq",!0)("options",e.voucher)("multiple",!1)}}function Ve(o,i){if(o&1&&(b(0),r(1,"div",17),g(2,"spk-input",35),d(),F()),o&2){let e,t=c(2);a(2),l("label",((e=t.giftForm.get("gift_type"))==null?null:e.value)==="Gift"?"Gift Point Value":"Eligible Point Value")("fieldReq",!0)}}function Ae(o,i){o&1&&(b(0),r(1,"div",17),g(2,"spk-input",36),d(),r(3,"div",17),g(4,"spk-input",37),d(),r(5,"div",17),g(6,"spk-input",38),d(),F()),o&2&&(a(2),l("fieldReq",!0),a(2),l("fieldReq",!0),a(2),l("fieldReq",!0))}function Ee(o,i){o&1&&(r(0,"div",24),f(1," Gift Image is required. "),d())}function Ne(o,i){if(o&1){let e=I();r(0,"div",22)(1,"label",23),f(2,"Upload Gift Image"),r(3,"span",24),f(4,"*"),d()(),r(5,"file-pond",39),C("onremovefile",function(n){v(e);let s=c(2);return h(s.onFileRemove(n))})("onprocessfile",function(n){v(e);let s=c(2);return h(s.onFileProcessed(n))}),d(),u(6,Ee,2,0,"div",40),r(7,"p",41),f(8,"Image dimensions must be exactly 1400X700 px and file size must not exceed 2 MB."),d()()}if(o&2){let e,t=c(2);a(5),l("options",t.pondOptions)("files",t.pondFiles),a(),l("ngIf",((e=t.giftForm.get("uploadedFile"))==null?null:e.invalid)&&((e=t.giftForm.get("uploadedFile"))==null?null:e.touched))}}function we(o,i){o&1&&(r(0,"div",42),f(1," Decription is required. "),d())}function Re(o,i){if(o&1){let e=I();r(0,"div",8)(1,"form",9),C("ngSubmit",function(){v(e);let n=c();return h(n.onSubmit())}),r(2,"div",3)(3,"div",4)(4,"div",10)(5,"mat-radio-group",11),C("change",function(n){v(e);let s=c();return h(s.onGiftTypeChange(n))}),r(6,"mat-radio-button",12),f(7,"Gift"),d(),r(8,"mat-radio-button",13),f(9,"Bank Transfer"),d(),r(10,"mat-radio-button",14),f(11,"Voucher"),d()(),u(12,Fe,2,0,"div",15),d(),r(13,"div",16)(14,"div",17)(15,"spk-ng-select",18),C("selectedChange",function(n){v(e);let s=c();return s.commonApi.getCustomerCategorySubType(n),h(s.findName(n,"login_type"))}),d()(),u(16,Ie,2,3,"div",19),r(17,"div",17),u(18,Ge,2,1,"ng-container",20)(19,Te,2,3,"ng-container",20),d(),u(20,Ve,3,2,"ng-container",20)(21,Ae,7,3,"ng-container",20),d(),r(22,"div",16),u(23,Ne,9,3,"div",21),r(24,"div",22)(25,"label",23),f(26,"Description"),r(27,"span",24),f(28,"*"),d()(),r(29,"div",25),g(30,"ngx-editor-menu",26)(31,"ngx-editor",27),d(),u(32,we,2,0,"div",28),d()(),r(33,"div",29),g(34,"app-button",30),d()()()()()}if(o&2){let e,t,n,s,y,V,x,S,m=c();a(),l("formGroup",m.giftForm),a(11),l("ngIf",((e=m.giftForm.get("gift_type"))==null?null:e.invalid)&&((e=m.giftForm.get("gift_type"))==null?null:e.touched)),a(3),l("fieldReq",!0)("options",m.commonApi.loginType)("multiple",!1),a(),l("ngIf",(t=m.giftForm.get("login_type_id"))==null?null:t.value),a(2),l("ngIf",((n=m.giftForm.get("gift_type"))==null?null:n.value)!="Voucher"),a(),l("ngIf",((s=m.giftForm.get("gift_type"))==null?null:s.value)=="Voucher"),a(),l("ngIf",((y=m.giftForm.get("gift_type"))==null?null:y.value)==="Gift"||((y=m.giftForm.get("gift_type"))==null?null:y.value)==="Voucher"),a(),l("ngIf",((V=m.giftForm.get("gift_type"))==null?null:V.value)==="Cash"),a(2),l("ngIf",((x=m.giftForm.get("gift_type"))==null?null:x.value)==="Gift"||((x=m.giftForm.get("gift_type"))==null?null:x.value)==="Voucher"),a(7),l("editor",m.editor)("toolbar",m.toolbar),a(),l("editor",m.editor),a(),l("ngIf",((S=m.giftForm.get("description"))==null?null:S.invalid)&&((S=m.giftForm.get("description"))==null?null:S.touched)),a(2),l("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("iconClass",m.api.disabled?"ri-loader-2-fill animate-spin":"ri-save-line")("loadingIconClass","ri-loader-2-fill")("disabled",m.api.disabled)}}var ye=class o{constructor(i,e,t,n,s,y,V,x,S,m,Me,ke){this.toastr=i;this.ngZone=e;this.api=t;this.formValidation=n;this.fb=s;this.dateService=y;this.router=V;this.route=x;this.commonApi=S;this.uploadService=m;this.moduleService=Me;this.authService=ke;this.orgData=this.authService.getOrg()}skLoading=!1;giftForm=new B({});myForm;today=new Date;formIniatialized=!1;formFields=[];documentData={};editor;giftMasterList=[];giftId="";toolbar=[["bold","italic"],["underline","strike"],["code","blockquote"],["ordered_list","bullet_list"],[{heading:["h1","h2","h3","h4","h5","h6"]}],["text_color","background_color"],["align_left","align_center","align_right","align_justify"]];submodule={};orgData={};ngOnInit(){let i=this.moduleService.getSubModuleByName("IRP","Gift Gallery");i&&(this.submodule=i),this.editor=new pe,this.giftForm=this.fb.group({gift_type:["Gift",_.required],customer_type_id:["",_.required],customer_type_name:[""],login_type_id:["",_.required],login_type_name:[""],title:["",_.required],point_value:["",_.required],range_start:[""],range_end:[""],voucher_type_id:[""],description:["",_.required]});let e=new Set;this.orgData.irp&&this.orgData.dms&&(e.add(G.SECONDARY),e.add(G.INFLUENCER)),this.orgData.dms&&e.add(G.SECONDARY),this.orgData.irp&&e.add(G.INFLUENCER);let t=Array.from(e);this.commonApi.getLoginType(t),this.giftForm.get("gift_type")?.valueChanges.subscribe(n=>{n==="Gift"?(this.giftForm.get("range_start")?.clearValidators(),this.giftForm.get("range_end")?.clearValidators()):n==="Cash"&&(this.giftForm.get("range_start")?.setValidators([_.required]),this.giftForm.get("range_end")?.setValidators([_.required]))})}onGiftTypeChange(i){i.value==="Voucher"?this.getTitle():this.voucher=[]}voucher=[];getTitle(){this.api.post({},"gift-gallery/voucher-types").subscribe(i=>{i.statusCode===200&&(this.voucher=i.data)})}pondFiles=[];pondOptions=this.getPondOptions("image");getPondOptions(i){let e={allowMultiple:!1,allowFileTypeValidation:!0,labelIdle:"Click or drag files here to upload...",maxFiles:5,server:{process:(t,n,s,y)=>{setTimeout(()=>{y(Date.now().toString())},1e3)},revert:(t,n)=>{n()}}};if(i==="image")return N(E({},e),{acceptedFileTypes:["image/jpeg","image/png","image/jpg"],maxFileSize:"2MB",allowImageValidateSize:!0,imageValidateSizeMinWidth:1400,imageValidateSizeMinHeight:700,imageValidateSizeMaxWidth:1400,imageValidateSizeMaxHeight:700,labelFileTypeNotAllowed:"Only PNG and JPEG files are allowed",fileValidateTypeLabelExpectedTypes:"Allowed: PNG, JPEG",labelImageValidateSizeTooSmall:"Image is too small. Min: {minWidth}\xD7{minHeight}",labelImageValidateSizeTooBig:"Image is too large. Max: {maxWidth}\xD7{maxHeight}"})}onFileProcessed(i){let e=i.file.file;this.pondFiles=[...this.pondFiles||[],e]}onFileRemove(i){let e=i.file.file,t=this.pondFiles.findIndex(n=>n.name===e.name&&n.size===e.size);t>-1&&this.pondFiles.splice(t,1)}findName(i,e){if(e==="login_type"){let t=this.commonApi.loginType.findIndex(n=>n.value===i);t!=-1&&this.giftForm.setControl("login_type_name",new T(this.commonApi.loginType[t].label))}if(e==="voucher"){let t=this.voucher.findIndex(n=>n.value===i);t!=-1&&(this.giftForm.setControl("title",new T(this.voucher[t].label)),this.giftForm.setControl("voucher_type_id",new T(this.voucher[t].value)))}if(e==="customer_type"){let t=i;if(Array.isArray(t)&&t.length>0){let n=this.commonApi.customerCategorySubType.filter(s=>t.includes(s.value)).map(s=>s.label);this.giftForm.patchValue({customer_type_name:n})}}}onSubmit(){if(this.giftForm.valid)if(this.giftForm.value.gift_type!=="Cash"&&this.pondFiles.length===0){this.toastr.error("Please upload image.","","toast-top-right");return}else{if(this.giftForm.get("gift_type")?.value==="Cash"&&this.giftForm.value.range_end<this.giftForm.value.range_start){this.toastr.error("Range end cannot be less than range start.","","toast-top-right");return}this.api.disabled=!0,this.formValidation.removeEmptyControls(this.giftForm),this.api.post(this.giftForm.value,"gift-gallery/create").subscribe({next:e=>{this.api.disabled=!1,e.statusCode==200&&(this.pondFiles.length>0?this.uploadService.uploadFile(e.data.inserted_id,"gift-gallery",this.pondFiles,"Gift Images",this.submodule,"apps/loyalty/gift-list"):(this.api.disabled=!1,this.toastr.success(e.message,"","toast-top-right"),this.router.navigate(["/apps/loyalty/gift-list"])))}})}else this.formValidation.markFormGroupTouched(this.giftForm)}giftDetails(i){this.skLoading=!0,this.api.post({id:i},"gift-gallery/read").subscribe(e=>{if(e.statusCode===200){let t=e.data;this.giftForm.patchValue(t)}this.skLoading=!1})}static \u0275fac=function(e){return new(e||o)(p(O),p(w),p(X),p(ce),p(Z),p(ne),p(P),p(D),p(Q),p(_e),p(ee),p(K))};static \u0275cmp=R({type:o,selectors:[["app-gift-add"]],inputs:{formFields:"formFields"},decls:3,vars:7,consts:[[3,"title","title1","activeitem","btnShow1"],["class","box",4,"ngIf"],["class","xl:col-span-12 col-span-12",4,"ngIf"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","gap-x-6"],["class","xl:col-span-3 col-span-12 mb-4",4,"ngFor","ngForOf"],[1,"xl:col-span-3","col-span-12","mb-4"],[1,"xl:col-span-12","col-span-12"],[3,"ngSubmit","formGroup"],[1,"mt-2","mb-4"],["formControlName","gift_type","aria-label","Select Gift Type",3,"change"],["value","Gift"],["value","Cash",1,"ml-4"],["value","Voucher",1,"ml-4"],["class","error",4,"ngIf"],[1,"grid","grid-cols-12","sm:gap-x-6","gap-y-5"],[1,"xxl:col-span-3","xl:col-span-3","lg:col-span-3","md:col-span-4","col-span-12"],["formControlName","login_type_id","label","Customer Type",3,"selectedChange","fieldReq","options","multiple"],["class","xxl:col-span-3 xl:col-span-3 lg:col-span-3 md:col-span-4 col-span-12",4,"ngIf"],[4,"ngIf"],["class","xxl:col-span-6 xl:col-span-6 lg:col-span-6 md:col-span-6 col-span-12",4,"ngIf"],[1,"xxl:col-span-6","xl:col-span-6","lg:col-span-6","md:col-span-6","col-span-12"],[1,"form-label"],[1,"text-red-500"],["id","product-features",1,"ngx-editor-custom"],[3,"editor","toolbar"],["formControlName","description",1,"overflow-auto",3,"editor"],["class","text-red-500 text-right",4,"ngIf"],[1,"flex","items-center","justify-end","mt-10","gap-2"],[3,"buttonType","buttonClass","iconClass","loadingIconClass","disabled"],[1,"error"],["formControlName","customer_type_id","label","Customer Category",3,"selectedChange","fieldReq","options","multiple"],["label","Title","formControlName","title","type","text",1,"remove-default-class",3,"fieldReq"],["formControlName","title","label","Title",3,"selectedChange","fieldReq","options","multiple"],["formControlName","point_value","type","text",1,"remove-default-class",3,"label","fieldReq"],["label","Range Start","formControlName","range_start","type","number",1,"remove-default-class",3,"fieldReq"],["label","Range End","formControlName","range_end","type","number",1,"remove-default-class",3,"fieldReq"],["label","Per Point Value","formControlName","point_value","type","number",1,"remove-default-class",3,"fieldReq"],[1,"filepond","basic-filepond",3,"onremovefile","onprocessfile","options","files"],["class","text-red-500",4,"ngIf"],[1,"text-[.625rem]","font-semibold","text-right","text-red-500"],[1,"text-red-500","text-right"]],template:function(e,t){e&1&&(g(0,"app-page-header",0),u(1,be,4,2,"div",1)(2,Re,35,20,"div",2)),e&2&&(l("title","Gift Gallery")("title1",A(6,Ce))("activeitem","Gift Add")("btnShow1",!1),a(),l("ngIf",t.skLoading),a(),l("ngIf",!t.skLoading))},dependencies:[ge,M,k,U,z,L,H,W,fe,re,ve,$,ue,oe,te,ie,q,Y,he,j,J,me,de,se,ae,le],encapsulation:2})};export{ye as GiftAddComponent};
