import{a as He}from"./chunk-5QFGLOXN.js";import{a as je}from"./chunk-J4NDCUAB.js";import{a as Oe}from"./chunk-REKAXM5L.js";import{a as Be}from"./chunk-SQZ3YN6N.js";import{b as Ve,c as De}from"./chunk-CIBZCVJQ.js";import{a as q}from"./chunk-OTFCGVEU.js";import{a as W}from"./chunk-HPLI5COI.js";import{a as de}from"./chunk-CNF4GSI7.js";import{a as Re}from"./chunk-OEHD5D2Y.js";import{a as Ne}from"./chunk-GLWQGYBC.js";import{a as B}from"./chunk-DC4QM32I.js";import{B as Ee,C as Ae,F as H,c as ge,g as Le,k as Pe,q as Ie,r as Te,s as Me,v as ke,w as Fe}from"./chunk-VHE3PQ3O.js";import{$ as pe,A,Aa as fe,B as V,C as ie,D as re,Ea as he,G as ne,Ga as be,H as oe,M as ae,Oa as ve,P as le,Pa as Ce,Qa as j,Ta as ye,Ua as Se,V as se,W as D,X as me,Z as N,Za as xe,aa as ce,hb as O,jb as we,o as Y,va as ue,w as ee,wa as _e,z as te}from"./chunk-GYDYF5F3.js";import{M as Z,f as k,g as F,n as Q,o as X,t as E}from"./chunk-PD5VTTIY.js";import{Aa as g,Ba as u,Bc as K,Hb as y,Mc as c,Nc as b,Ob as f,Oc as C,Uc as L,Vc as P,Wc as I,Yc as T,_b as s,ac as $,bc as S,ed as M,fc as x,fd as z,gd as J,kc as o,lc as n,mc as v,nc as w,oc as R,qc as h,rb as l,sb as d,wc as _,yc as m}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import"./chunk-66YHNWRR.js";function tt(a,i){if(a&1){let e=h();o(0,"div",1)(1,"app-modal-header",2),M(2,"titlecase"),_("close",function(){g(e);let t=m();return u(t.closeModal())}),n(),o(3,"form",3),_("ngSubmit",function(){g(e);let t=m();return u(t.onSubmit())}),o(4,"mat-dialog-content",4)(5,"div",5)(6,"div",6),v(7,"spk-ng-select",7),n(),o(8,"div",6)(9,"spk-ng-select",8),_("selectedChange",function(t){g(e);let p=m();return u(p.findName(t))}),n()(),o(10,"div",6),v(11,"spk-input",9),n()()(),o(12,"mat-dialog-actions",10)(13,"div",11),v(14,"app-button",12),n()()()()}if(a&2){let e=m();l(),s("title",z(2,16,e.modalData.formType)+" Referral Program")("closeBtn",!0),l(2),s("formGroup",e.referralForm),l(4),s("fieldReq",!0)("options",e.bonusType)("multiple",!1),l(2),s("fieldReq",!0)("options",e.CommonApiService.customerCategorySubType)("multiple",!0),l(2),s("fieldReq",!0),l(3),s("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",e.api.disabled)("formType",e.modalData.formType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}function it(a,i){if(a&1&&(o(0,"li",16)(1,"div",17)(2,"div",18)(3,"span",19),c(4),n(),o(5,"div",20),c(6),n()(),o(7,"span",21),c(8,"512"),n()()()),a&2){let e=i.$implicit,r=m(2);l(4),C(" ",r.nameUtils.getInitials(e.customer_name)," "),l(2),C(" ",e.customer_name||"--"," ")}}function rt(a,i){if(a&1){let e=h();o(0,"div",1)(1,"app-modal-header",2),_("close",function(){g(e);let t=m();return u(t.closeModal())}),n(),o(2,"app-showcode-card",13)(3,"ul",14),f(4,it,9,2,"li",15),n()()()}if(a&2){let e=m();l(),s("title","Beneficiary")("closeBtn",!0),l(),S("box-title font-medium text-[15px] block text-primarytint1color"),s("title","")("titleView",!1)("actionIcons",!1)("iconClass","ti-btn btn-wave ti-btn-sm ti-btn-soft-primary waves-effect waves-light")("classbody","pt-0")("iconName","ri-add-line"),l(2),s("ngForOf",e.userPoints)}}var G=class a{constructor(i,e,r,t,p,U,Ge,Ue,Ke,bt,vt,Ct){this.dialog=i;this.formValidation=e;this.api=r;this.toastr=t;this.CommonApiService=p;this.modalData=U;this.dialogRef=Ge;this.authService=Ue;this.moduleService=Ke;this.logService=bt;this.nameUtils=vt;this.fb=Ct;this.orgData=this.authService.getOrg()}data={};skLoading=!1;submodule={};originalData={};FORMID=W;customerCategoryList=[];selectedCustomerCategory={};userPoints=[];referralForm=new re({});orgData={};ngOnInit(){this.referralForm=this.fb.group({bonus_type:["",A.required],customer_type_id:["",A.required],customer_type_name:[""],bonus_point:["",A.required]});let i=this.moduleService.getSubModuleByName("IRP","Referral Program");i&&(this.submodule=i),this.modalData.formType==="edit"?(this.referralForm.patchValue(this.modalData.formData),this.originalData=this.modalData.formData):this.modalData.formType==="view"?this.getUserPoints():this.data.status="Active",this.CommonApiService.getLoginType([Y.PRIMARY]),this.CommonApiService.getCustomerCategorySubType([Y.INFLUENCER])}closeModal(){this.dialogRef.close()}onSubmit(){if(this.referralForm.valid){this.api.disabled=!0;let i=this.modalData.formType==="edit";if(i&&(this.referralForm.value._id=this.modalData.formData._id,this.logService.logActivityOnUpdate(i,this.originalData,this.referralForm.value,this.submodule.module_id,this.submodule.title,"update",this.referralForm.value._id||null,()=>{},this.submodule.module_type))){this.api.disabled=!1,this.toastr.warning("No changes detected","","toast-top-right");return}let e=i?"referral-bonus/update":"referral-bonus/create",r=i?"patch":"post";this.api[r](this.referralForm.value,e).subscribe(t=>{t.statusCode===200&&(this.api.disabled=!1,this.toastr.success(t.message,"","toast-top-right"),this.dialogRef.close(!0))})}else this.formValidation.markFormGroupTouched(this.referralForm)}findName(i){let e=i;if(Array.isArray(e)&&e.length>0){let r=this.CommonApiService.customerCategorySubType.filter(t=>e.includes(t.value)).map(t=>t.label);this.referralForm.patchValue({customer_type_name:r})}}onLoginTypeChange(i){let e=this.CommonApiService.loginType.find(r=>r.value===i);e&&(this.data.login_type_name=e.label)}getUserPoints(){this.skLoading=!0,this.api.post({},"referral-bonus/userpoints").subscribe(i=>{i.statusCode===200&&(this.skLoading=!1,this.userPoints=i.data)})}bonusType=[{label:"Welcome",value:"Welcome"},{label:"Birthday",value:"Birthday"},{label:"Anniversary",value:"Anniversary"},{label:"Invite Friends",value:"Invite Friends"},...this.orgData?.irp?[{label:"Refer Enquiry",value:"Refer Enquiry"},{label:"Refer Site | Project",value:"Refer Site | Project"}]:[]];static \u0275fac=function(e){return new(e||a)(d(j),d(ke),d(N),d(ee),d(de),d(Ce),d(ve),d(ce),d(B),d(q),d(He),d(se))};static \u0275cmp=y({type:a,selectors:[["app-referral-program-add"]],decls:2,vars:2,consts:[["class","mat-dialoge",4,"ngIf"],[1,"mat-dialoge"],[3,"close","title","closeBtn"],[3,"ngSubmit","formGroup"],[1,"mat-typography","py-1"],[1,"grid","grid-cols-12","sm:gap-x-6"],[1,"xl:col-span-4","col-span-12","mb-3"],["formControlName","bonus_type","label","Bonus Type",3,"fieldReq","options","multiple"],["formControlName","customer_type_id","label","Customer Category",3,"selectedChange","fieldReq","options","multiple"],["label","Bonus Point","formControlName","bonus_point","type","number",1,"remove-default-class",3,"fieldReq"],["align","end"],[1,"flex","items-center","gap-2"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],[3,"title","titleView","actionIcons","iconClass","classbody","iconName"],[1,"ti-list-group","list-group-flush","border-0","scroll-y-300"],["class","border-b-2 pb-2 pt-2",4,"ngFor","ngForOf"],[1,"border-b-2","pb-2","pt-2"],[1,"flex","items-center","justify-between"],[1,"flex","items-center"],[1,"avatar","avatar-sm","bg-primarytint1color"],[1,"ms-2","font-medium"],[1,"badge","bg-light","bg-primary/10","text-primary","float-end","ms-auto"]],template:function(e,r){e&1&&f(0,tt,15,18,"div",0)(1,rt,5,11,"div",0),e&2&&(s("ngIf",r.modalData.formType==="add"||r.modalData.formType==="edit"),l(),s("ngIf",r.modalData.formType==="view"))},dependencies:[D,oe,V,ie,E,k,F,Q,Te,H,ae,le,Fe,Le,Ae,O,Se,ye,Pe,Ee,me],encapsulation:2})};var nt=()=>["Referral Program"],qe=()=>[];function ot(a,i){if(a&1){let e=h();o(0,"button",17),_("click",function(){g(e);let t=m(2);return t.filter.bonus_type="",u(t.getList())}),o(1,"mat-icon"),c(2,"close"),n()()}}function at(a,i){if(a&1){let e=h();o(0,"button",17),_("click",function(){g(e);let t=m(2);return t.filter.customer_type_name="",u(t.getList())}),o(1,"mat-icon"),c(2,"close"),n()()}}function lt(a,i){if(a&1){let e=h();o(0,"button",17),_("click",function(){g(e);let t=m(2);return t.filter.status="",u(t.getList())}),o(1,"mat-icon"),c(2,"close"),n()()}}function st(a,i){if(a&1){let e=h();o(0,"a",29),_("click",function(){g(e);let t=m(3);return u(t.openModal("view",""))}),o(1,"i",30),c(2,"screen_share"),n(),c(3),n()}if(a&2){let e=m().$implicit;l(3),b(e.transfer_points||"--")}}function mt(a,i){if(a&1&&(o(0,"a",31),c(1),n()),a&2){let e=m().$implicit;l(),C(" ",e.transfer_points||"--","")}}function pt(a,i){if(a&1){let e=h();o(0,"app-icon-button",27),_("clickEvent",function(){g(e);let t=m().$implicit,p=m(2);return u(p.openModal("edit",t))}),n()}a&2&&s("icon","ri-edit-line")("buttonClass","ti-btn btn-wave  ti-btn-sm ti-btn-soft-success waves-effect waves-light")}function ct(a,i){if(a&1){let e=h();o(0,"app-icon-button",27),_("clickEvent",function(){g(e);let t=m().$implicit,p=m(2);return u(p.delete(t._id,"referral-bonus/delete",t.bonus_type))}),n()}a&2&&s("icon","ri-delete-bin-line")("buttonClass","ti-btn btn-wave product-btn ti-btn-sm ti-btn-soft-danger waves-effect waves-light")}function dt(a,i){if(a&1){let e=h();o(0,"tr",18)(1,"td",11),c(2),n(),o(3,"td"),c(4),M(5,"date"),n(),o(6,"td"),c(7),n(),o(8,"td"),c(9),n(),o(10,"td"),c(11),n(),o(12,"td",19),c(13),n(),o(14,"td")(15,"span",20),c(16),n()(),o(17,"td",19)(18,"span",21),f(19,st,4,1,"a",22)(20,mt,2,1,"a",23),n()(),o(21,"td")(22,"span",20),c(23),n()(),o(24,"td")(25,"app-toggle",24),_("checkedChange",function(t){let p=g(e).$implicit,U=m(2);return u(U.onToggleChange(t,p._id,p.status))}),n()(),o(26,"td",25)(27,"div",26)(28,"app-icon-button",27),_("clickEvent",function(){let t=g(e).$implicit,p=m(2);return u(p.openMainLogModal(t._id))}),n(),f(29,pt,1,2,"app-icon-button",28)(30,ct,1,2,"app-icon-button",28),n()()()}if(a&2){let e=i.$implicit,r=i.index,t=m(2);$("bg-gray-400",t.isHighlighted(e._id)),l(2),b((t.pagination.cur_page-1)*t.pagination.limit+r+1),l(2),b(e.created_at?J(5,19,e.created_at,"d MMM yyyy, hh:mm a"):"--"),l(3),b(e.created_name||"--"),l(2),b(e.bonus_type||"--"),l(2),b(e.customer_type_name||"--"),l(2),b(e.bonus_point||"--"),l(2),K("matTooltip",e.admin_working_flow),l(),b(e.admin_working_flow||"--"),l(3),s("ngIf",e.transfer_points>0),l(),s("ngIf",e.transfer_points<=0),l(2),K("matTooltip",e.user_working_flow),l(),b(e.user_working_flow||"--"),l(2),s("checked",e.isChecked),l(3),s("icon","ri-file-list-line")("buttonClass","ti-btn btn-wave  ti-btn-sm ti-btn-soft-primary waves-effect waves-light"),l(),s("ngIf",t.accessRight==null?null:t.accessRight.modifyRight),l(),s("ngIf",t.accessRight==null?null:t.accessRight.deleteRight)}}function gt(a,i){if(a&1){let e=h();w(0),o(1,"tr",10)(2,"td"),c(3,"\xA0"),n(),o(4,"td"),c(5,"\xA0"),n(),o(6,"td"),c(7,"\xA0"),n(),o(8,"td",11)(9,"div",12)(10,"mat-form-field",13)(11,"input",14),I("ngModelChange",function(t){g(e);let p=m();return P(p.filter.bonus_type,t)||(p.filter.bonus_type=t),u(t)}),_("keyup.enter",function(){g(e);let t=m();return u(t.getList())}),n(),f(12,ot,3,0,"button",15),n()()(),o(13,"td",11)(14,"div",12)(15,"mat-form-field",13)(16,"input",14),I("ngModelChange",function(t){g(e);let p=m();return P(p.filter.customer_type_name,t)||(p.filter.customer_type_name=t),u(t)}),_("keyup.enter",function(){g(e);let t=m();return u(t.getList())}),n(),f(17,at,3,0,"button",15),n()()(),o(18,"td"),c(19,"\xA0"),n(),o(20,"td"),c(21,"\xA0"),n(),o(22,"td"),c(23,"\xA0"),n(),o(24,"td"),c(25,"\xA0"),n(),o(26,"td")(27,"div",12)(28,"mat-form-field",13)(29,"input",14),I("ngModelChange",function(t){g(e);let p=m();return P(p.filter.status,t)||(p.filter.status=t),u(t)}),_("keyup.enter",function(){g(e);let t=m();return u(t.getList())}),n(),f(30,lt,3,0,"button",15),n()()(),o(31,"td"),c(32,"\xA0"),n()(),f(33,dt,31,22,"tr",16),R()}if(a&2){let e=m();l(11),L("ngModel",e.filter.bonus_type),l(),x(e.filter.bonus_type?12:-1),l(4),L("ngModel",e.filter.customer_type_name),l(),x(e.filter.customer_type_name?17:-1),l(12),L("ngModel",e.filter.status),l(),x(e.filter.status?30:-1),l(3),s("ngForOf",e.listing)}}function ut(a,i){a&1&&(o(0,"td"),v(1,"app-skeleton"),n()),a&2&&(l(),S("h20 bg-skeleton"))}function _t(a,i){a&1&&(o(0,"tr",10),f(1,ut,2,2,"td",33),n()),a&2&&(l(),s("ngForOf",T(1,qe).constructor(11)))}function ft(a,i){a&1&&(w(0),f(1,_t,2,2,"tr",32),R()),a&2&&(l(),s("ngForOf",T(1,qe).constructor(8)))}function ht(a,i){a&1&&(w(0),v(1,"app-data-not-found"),R())}var We=class a{constructor(i,e,r,t,p,U,Ge,Ue,Ke){this.dialog=i;this.api=e;this.comanFuncation=r;this.moduleService=t;this.alert=p;this.dateService=U;this.router=Ge;this.logService=Ue;this.highlightService=Ke}FORMID=W;skLoading=!1;pagination={};listing=[];filter={};submodule={};pageKey="spin-win-list";highlightedId;accessRight={};ngOnInit(){let i=this.moduleService.getAccessMap("IRP","Referral Program");i&&(this.accessRight=i);let e=this.moduleService.getSubModuleByName("IRP","Referral Program");e&&(this.submodule=e),this.getList()}onRefresh(){this.filter={},this.getList()}goToAddPage(){this.router.navigate(["/apps/referral-program"])}changeToPage(i){this.pagination.cur_page=i,this.getList()}changeToPagination(i){i==="Next"&&this.pagination.cur_page<this.pagination.total_pages?this.pagination.cur_page++:i==="Previous"&&this.pagination.cur_page>1&&this.pagination.cur_page--,this.getList()}isHighlighted(i){return this.highlightedId===i}setHighLight(i){this.comanFuncation.setHighLight(this.pageKey,i,"none",this.filter,this.pagination.cur_page?this.pagination.cur_page:1)}getList(){this.skLoading=!0;let i=this.pagination.cur_page;this.api.post({filters:this.filter,page:i},"referral-bonus/read").subscribe(e=>{if(e.statusCode==200){this.skLoading=!1,this.listing=e.data;for(let r=0;r<this.listing.length;r++){let t=this.listing[r];t.isChecked=t.status==="Active"}this.pagination=e.pagination}})}onToggleChange(i,e,r){this.comanFuncation.statusChange(i,e,r,this.submodule,"toggle","referral-bonus/update-status").subscribe(t=>{t?this.getList():this.getList()})}delete(i,e,r){this.comanFuncation.delete(i,this.submodule,r,e,"single_action",i).subscribe(t=>{t===!0&&this.getList()})}openModal(i,e){i==="edit"&&this.setHighLight(e._id),this.dialog.open(G,{width:i==="view"?"450px":"700px",data:{formType:i,formData:e||{}}}).afterClosed().subscribe(t=>{if(t===!0){let p=this.highlightService.getHighlight(this.pageKey);p!=null&&(this.highlightedId=p.rowId,this.pagination.cur_page=p.pageIndex,this.filter=p.filters,this.highlightService.clearHighlight(this.pageKey)),this.getList()}})}openMainLogModal(i){this.comanFuncation.listLogsModal(this.submodule.module_id,i,this.submodule.module_type).subscribe(e=>{e===!0&&this.getList()})}PageHeaders=[{label:"Created At"},{label:"Created By"},{label:"Bonus Type"},{label:"Customer Category"},{label:"Bonus Point",table_class:"text-center"},{label:"Backend Working Flow"},{label:"Transfer Points"},{label:"User Working Flow"},{label:"Status"},{label:"Action",table_class:"text-center"}];static \u0275fac=function(e){return new(e||a)(d(j),d(N),d(De),d(B),d(pe),d(we),d(Z),d(q),d(Ve))};static \u0275cmp=y({type:a,selectors:[["app-referral-program"]],decls:12,vars:26,consts:[[3,"title","title1","activeitem"],[1,"row"],[1,"col-xl-12"],[1,"box"],[3,"onRefresh","logBtn","button1","pageTitle","listLength","btnShow","refreshLabel","btnShow1","logsLabel","btnShow2","addBtnLabel"],[1,"box-body"],[1,"table-responsive","overflow-auto","table-bordered-default"],["tableClass","ti-custom-table ti-custom-table-hover ti-head-primary whitespace-nowrap",3,"tableHead","showCheckbox","showS_No","showAction","columns"],[4,"ngIf"],[3,"preButtonClick","nextButtonClick","pageChange","currentPage","totalPage","pageLimit","listLength","preBtn","nextBtn"],[1,"border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"!text-center"],[1,"table-search-filters"],[1,"table-input"],["matInput","","type","text","placeholder","Search...",3,"ngModelChange","keyup.enter","ngModel"],["matSuffix","","mat-icon-button","","aria-label","Clear"],["class","product-list border-b !border-defaultborder dark:!border-defaultborder/10",3,"bg-gray-400",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"click"],[1,"product-list","border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"text-center"],[1,"ellipsis",3,"matTooltip"],[1,"badge","bg-primary/10"],["class","text-info font-medium text-primary",3,"click",4,"ngIf"],["class","text-info font-medium  text-primary",4,"ngIf"],[3,"checkedChange","checked"],[1,"w140","relative"],[1,"flex","flex-row","items-center","!gap-2","text-[0.9375rem]"],[3,"clickEvent","icon","buttonClass"],[3,"icon","buttonClass","clickEvent",4,"ngIf"],[1,"text-info","font-medium","text-primary",3,"click"],[1,"material-icons","ms-1","text-primary"],[1,"text-info","font-medium","text-primary"],["class","border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"]],template:function(e,r){e&1&&(v(0,"app-page-header",0),o(1,"div",1)(2,"div",2)(3,"div",3)(4,"app-page-sub-header",4),_("onRefresh",function(){return r.onRefresh()})("logBtn",function(){return r.openMainLogModal("")})("button1",function(){return r.openModal("add","")}),n(),o(5,"div",5)(6,"div",6)(7,"spk-reusable-tables",7),f(8,gt,34,7,"ng-container",8)(9,ft,2,2,"ng-container",8),n(),f(10,ht,2,0,"ng-container",8),n()(),o(11,"app-pagination-footer",9),_("preButtonClick",function(){return r.changeToPagination("Previous")})("nextButtonClick",function(){return r.changeToPagination("Next")})("pageChange",function(p){return r.changeToPage(p)}),n()()()()),e&2&&(s("title","Loyalty")("title1",T(25,nt))("activeitem","Referral Program List"),l(4),s("pageTitle","Referral Program List")("listLength",r.listing.length)("btnShow",!0)("refreshLabel","Refresh")("btnShow1",!0)("logsLabel","Logs")("btnShow2",r.accessRight==null?null:r.accessRight.addRight)("addBtnLabel","Add Referral Program"),l(3),s("tableHead","border-b")("showCheckbox",!1)("showS_No",!0)("showAction",!1)("columns",r.PageHeaders),l(),s("ngIf",!r.skLoading),l(),s("ngIf",r.skLoading),l(),s("ngIf",r.listing.length===0&&!r.skLoading),l(),s("currentPage",r.pagination.cur_page)("totalPage",r.pagination.total_pages)("pageLimit",r.pagination.limit)("listLength",r.listing.length)("preBtn",!r.pagination.prev)("nextBtn",!r.pagination.next))},dependencies:[H,k,F,te,V,ne,Ne,ge,Me,Ie,je,Be,Oe,xe,X,E,Re,O,fe,he,be,_e,ue,D],encapsulation:2})};export{We as ReferralProgramListComponent};
