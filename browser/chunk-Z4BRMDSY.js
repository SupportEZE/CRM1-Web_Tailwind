import{a as de}from"./chunk-J4NDCUAB.js";import{a as ce}from"./chunk-ZON5AR26.js";import"./chunk-LGZVJJDX.js";import"./chunk-54KZ5YIV.js";import{a as le}from"./chunk-SQZ3YN6N.js";import"./chunk-CIBZCVJQ.js";import{a as re}from"./chunk-OTFCGVEU.js";import{a as oe}from"./chunk-HPLI5COI.js";import{b as pe}from"./chunk-DUVWFXSE.js";import{a as Y}from"./chunk-CNF4GSI7.js";import{a as te}from"./chunk-OEHD5D2Y.js";import{a as se}from"./chunk-GLWQGYBC.js";import{a as J}from"./chunk-DC4QM32I.js";import{F as ae,c as z,s as ne,u as ie}from"./chunk-VHE3PQ3O.js";import{$ as q,Qa as K,V as G,W as Q,Z,_ as ge,aa as U,hb as X,jb as ee,o as I,w as W}from"./chunk-GYDYF5F3.js";import{M as $,Q as B,f as H,g as P,o as j,t as N}from"./chunk-PD5VTTIY.js";import{Aa as d,Ba as m,Fc as F,Gc as M,Hb as D,Hc as R,Mc as x,Nc as A,Ob as u,Oc as v,Yc as S,Zc as O,_b as r,ad as V,bc as y,ed as L,gd as E,kc as l,lc as p,mc as T,nc as b,oc as h,qc as C,rb as o,sb as _,wc as f,yc as s}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as w,g as ue}from"./chunk-66YHNWRR.js";var _e=ue(ge());var fe=["reusableTable"],be=()=>["Expense"],k=()=>[],he=(i,n,e,t)=>({name:i,label:n,icon:e,count:t}),xe=i=>[i];function Ce(i,n){i&1&&T(0,"app-skeleton"),i&2&&y("w100 h30 bg-skeleton")}function ve(i,n){i&1&&(b(0),l(1,"div",9),u(2,Ce,1,2,"app-skeleton",10),p(),h()),i&2&&(o(2),r("ngForOf",S(1,k).constructor(5)))}function Se(i,n){if(i&1){let e=C();l(0,"app-listing-tab",13),f("tabChange",function(a){d(e);let c=s(2);return m(c.onTabChange(a.tab))}),p()}if(i&2){let e=n.$implicit,t=s(2);r("tabs",O(7,xe,V(2,he,e.name,e.label,e.icon,e.count)))("activeTab",t.activeTab)}}function ye(i,n){if(i&1&&(b(0),l(1,"nav",11),u(2,Se,1,9,"app-listing-tab",12),p(),h()),i&2){let e=s();o(2),r("ngForOf",e.mainTabs)}}function Te(i,n){if(i&1&&(l(0,"span"),x(1),L(2,"date"),p()),i&2){let e=s().$implicit,t=s().$implicit;o(),v(" ",E(2,1,(t==null?null:t[e.name])||(t==null||t.form_data==null?null:t.form_data[e.name]),"d MMM yyyy, hh:mm a")," ")}}function we(i,n){if(i&1&&(l(0,"span"),x(1),L(2,"date"),p()),i&2){let e=s().$implicit,t=s().$implicit;o(),v(" ",E(2,1,(t==null?null:t[e.name])||(t==null||t.form_data==null?null:t.form_data[e.name]),"d MMM yyyy")," ")}}function Le(i,n){if(i&1){let e=C();l(0,"span")(1,"a",21),f("click",function(){d(e);let a=s(2).$implicit,c=s(2);return m(c.goToDetailPage(a._id))}),x(2),p()()}if(i&2){let e=s().$implicit,t=s().$implicit;o(2),v(" ",(t==null?null:t[e.name])||(t==null||t.form_data==null?null:t.form_data[e.name])||"--"," ")}}function Ee(i,n){if(i&1){let e=C();l(0,"span")(1,"a",21),f("click",function(){d(e);let a=s(2).$implicit,c=s(2);return m(c.goToDetailPage(a._id))}),x(2),p()()}if(i&2){let e=s().$implicit,t=s().$implicit;o(2),v(" ",(t==null?null:t[e.name])||(t==null||t.form_data==null?null:t.form_data[e.name])||"--"," ")}}function Ie(i,n){if(i&1&&(l(0,"span"),x(1),p()),i&2){let e,t=s().$implicit,a=s().$implicit;o(),v(" ",(e=(e=a[(t==null?null:t.actual_name)||(t==null?null:t.name)])!==null&&e!==void 0?e:a.form_data==null?null:a.form_data[t==null?null:t.name])!==null&&e!==void 0?e:"--"," ")}}function ke(i,n){if(i&1&&(b(0),l(1,"td"),u(2,Te,3,4,"span",5)(3,we,3,4,"span",5)(4,Le,3,1,"span",5)(5,Ee,3,1,"span",5)(6,Ie,2,1,"span",5),p(),h()),i&2){let e=n.$implicit;o(2),r("ngIf",e.name.endsWith("_at")),o(),r("ngIf",!e.name.endsWith("_at")&&e.name.includes("date")),o(),r("ngIf",e.name==="expense_id"),o(),r("ngIf",e.name==="is_expesne_senior_status"),o(),r("ngIf",!(e.name.includes("date")||e.name.endsWith("_at")||e.name==="expense_id"||e.name==="is_expesne_senior_status"))}}function De(i,n){if(i&1){let e=C();l(0,"app-icon-button",22),f("clickEvent",function(){d(e);let a=s().$implicit,c=s(2);return m(c.onDeleteLeave(a._id))}),p()}i&2&&r("icon","ri-delete-bin-line")("buttonClass","ti-btn btn-wave expense-btn ti-btn-sm ti-btn-soft-danger waves-effect waves-light")}function Fe(i,n){if(i&1&&(l(0,"tr",15)(1,"td",16),x(2),p(),u(3,ke,7,5,"ng-container",17),l(4,"td",18)(5,"div",19),u(6,De,1,2,"app-icon-button",20),p()()()),i&2){let e=n.index,t=s(2);o(2),A(e+1),o(),r("ngForOf",t.visibleHeaders),o(3),r("ngIf",t.accessRight==null?null:t.accessRight.deleteRight)}}function Me(i,n){if(i&1&&(b(0),u(1,Fe,7,3,"tr",14),h()),i&2){let e=s();o(),r("ngForOf",e.expenseListing)}}function Re(i,n){i&1&&(l(0,"td"),T(1,"app-skeleton"),p()),i&2&&(o(),y("h20 bg-skeleton"))}function Ae(i,n){i&1&&(l(0,"tr",24),u(1,Re,2,2,"td",17),p()),i&2&&(o(),r("ngForOf",S(1,k).constructor(10)))}function Oe(i,n){i&1&&(b(0),u(1,Ae,2,2,"tr",23),h()),i&2&&(o(),r("ngForOf",S(1,k).constructor(10)))}function Ve(i,n){i&1&&(b(0),T(1,"app-data-not-found"),h())}var me=class i{constructor(n,e,t,a,c,g,He,Pe,je,Ne,$e){this.toastr=n;this.api=e;this.alert=t;this.fb=a;this.router=c;this.logService=g;this.dialog=He;this.moduleService=Pe;this.dateService=je;this.CommonApiService=Ne;this.authService=$e}reusableTable;activeTab;module_table={};module_form={};skLoading=!1;subModule={};moduleFormId=0;moduleTableId=0;FORMID=oe;expensePageTableData={};allexpensePageHeaders=[];expensePageHeaders=[];expensePageDropdowns={};expenseData=[];expenseListing=[];dropdownOptions=[];expenseListPagination={};page=1;filter={};sorting={};listPageData={};expensePageDropdownOption=[];view;expenseTabs={};mainTabs=[];accessRight={};OrgLoginData;orgData;loginTypeId;ngOnInit(){let n=this.moduleService.getAccessMap("SFA","Expense");n&&(this.accessRight=n);let e=this.moduleService.getSubModuleByName("SFA","Expense"),t=this.moduleService.getFormById("SFA","Expense",this.FORMID.ID.ExpenseFormData),a=this.moduleService.getTableById("SFA","Expense",this.FORMID.ID.ExpenseTable);e&&(this.subModule=e),t&&(this.moduleFormId=t.form_id),a&&(this.moduleTableId=a.table_id),this.OrgLoginData=this.authService.getUser(),this.orgData=this.authService.getOrg(),console.log(this.orgData?.is_expesne_senior_status,"this.orgData"),this.getHeaderConfigListing(),this.loginTypeId=this.OrgLoginData?.login_type_id,this.loginTypeId===I.ORGANIZATION_ADMIN?this.activeTab="Submitted":this.activeTab="Draft"}onRefresh(){this.filter={},this.reusableTable.clearSearchInputs(),this.getHeaderConfigListing()}updateExpenseWiseExpense(n){this.router.navigate(["/apps/sfa/expense-list/expense-add"])}tableConfigData={};visibleHeaders=[];getHeaderConfigListing(){this.CommonApiService.getHeaderConfigListing(this.moduleTableId,this.moduleFormId).subscribe(n=>{this.tableConfigData=n?.data?.table_data;let e=this.tableConfigData?.tableHead;this.visibleHeaders=e.filter(t=>t.name==="senior_status"||t.name==="senior_status_remark"?this.orgData?.is_expesne_senior_status&&t.list_view_checked:t.list_view_checked),console.log(this.visibleHeaders,"visibleHeaders"),this.getList()})}onTabChange(n){this.activeTab=n,this.getList()}goToDetailPage(n){this.router.navigate(["/apps/sfa/expense-list/expense-detail",n])}onCheckboxChange(n,e,t){let a=t.target;e==="view"?n.list_view_checked=a.checked:e==="filter"&&(n.filter_checked=a.checked)}getList(){this.skLoading=!0,this.api.post({filters:this.filter,activeTab:this.activeTab,sorting:this.sorting,page:this.page},"expense/read").subscribe(n=>{n.statusCode===200&&(this.skLoading=!1,this.expenseListing=n.data.result,this.expenseTabs=n.data.expense_status_tabs,this.mainTabs=[...this.loginTypeId!==I.ORGANIZATION_ADMIN?[{name:"Draft",label:"Draft",icon:"ri-sticky-note-fill",count:this.expenseTabs.find(e=>e.darftCount!==void 0)?.darftCount}]:[],{name:"Submitted",label:"Submitted",icon:"ri-calendar-check-fill",count:this.expenseTabs.find(e=>e.submittedCount!==void 0)?.submittedCount||0},{name:"Approved",label:"Approved",icon:"ri-upload-2-fill",count:this.expenseTabs.find(e=>e.approvedCount!==void 0)?.approvedCount||0},{name:"Reject",label:"Reject",icon:"ri-close-circle-fill",count:this.expenseTabs.find(e=>e.rejectCount!==void 0)?.rejectCount||0},{name:"Paid",label:"Paid",icon:"ri-wallet-3-fill",count:this.expenseTabs.find(e=>e.paidCount!==void 0)?.paidCount||0}],this.activeTab=this.mainTabs[0]?.name||"",this.expenseListPagination=n.pagination)})}onSortChanged(n){this.sorting={},this.sorting[n.field]=n.order,this.getList()}handleSelectionChange(n){let{category_name:e,selections:t}=n;this.filter[e]=t,this.getList()}updateSearchFilter(n){this.filter[n.name]=n.searchText,this.getList()}handleDateChange(n){this.filter=w(w({},this.filter),n),this.getList()}handleDateRangeChange(n){this.filter=n,this.getList()}onDeleteLeave(n){this.alert.confirm("Are you sure?").then(e=>{e.isConfirmed&&this.api.patch({_id:n,is_delete:1},"expense/delete").subscribe(t=>{t.statusCode===200&&(_e.default.fire("Deleted!",t.message,"success"),this.getList())})})}openHeaderSettingModal(){this.getHeaderConfigListing(),this.dialog.open(ce,{width:"450px",panelClass:"mat-right-modal",position:{right:"0px"},data:{lastPage:"header-config",moduleFormId:this.moduleFormId,moduleTableId:this.moduleTableId,moduleName:this.subModule.title,tableConfigData:this.tableConfigData}}).afterClosed().subscribe(e=>{e===!0&&this.getHeaderConfigListing()})}static \u0275fac=function(e){return new(e||i)(_(W),_(Z),_(q),_(G),_($),_(re),_(K),_(J),_(ee),_(Y),_(U))};static \u0275cmp=D({type:i,selectors:[["app-expense-list"]],viewQuery:function(e,t){if(e&1&&F(fe,5),e&2){let a;M(a=R())&&(t.reusableTable=a.first)}},decls:13,vars:28,consts:[["reusableTable",""],[3,"buttonClick1","title","title1","activeitem","btnShow1","buttonText1","icon1","dataHsOverlay"],[1,"box","py-3","px-4"],[1,"col-xl-12"],[1,"row"],[4,"ngIf"],[3,"onRefresh","button1","pageTitle","refreshLabel","addBtnLabel","btnShow","btnShow2"],[1,"table-responsive","overflow-auto","table-bordered-default"],["tableClass","ti-custom-table ti-custom-table-head ti-custom-table-hover ti-head-primary whitespace-nowrap",3,"sortChanged","selectionChange","textSearchChange","dateChange","dateRangeChange","tableHead","showCheckbox","showS_No","showSorting","showFilterRow","showAction","columns","subModule"],[1,"flex","items-center","gap-3"],[3,"class",4,"ngFor","ngForOf"],["aria-label","Tabs","role","tablist",1,"sm:flex","sm:space-x-2","sm:rtl:space-x-reverse","gap-1"],[3,"tabs","activeTab","tabChange",4,"ngFor","ngForOf"],[3,"tabChange","tabs","activeTab"],["class","expense-list border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[1,"expense-list","border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"!text-center"],[4,"ngFor","ngForOf"],[1,"!text-center","relative","w100"],[1,"flex","flex-row","items-center","!gap-2","text-[0.9375rem]"],[3,"icon","buttonClass","clickEvent",4,"ngIf"],[1,"text-primary","font-semibold","underline",3,"click"],[3,"clickEvent","icon","buttonClass"],["class","border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[1,"border-b","!border-defaultborder","dark:!border-defaultborder/10"]],template:function(e,t){if(e&1){let a=C();l(0,"app-page-header",1),f("buttonClick1",function(){return d(a),m(t.openHeaderSettingModal())}),p(),l(1,"div",2)(2,"div",3)(3,"div",4),u(4,ve,3,2,"ng-container",5)(5,ye,3,1,"ng-container",5),l(6,"app-page-sub-header",6),f("onRefresh",function(){return d(a),m(t.onRefresh())})("button1",function(){return d(a),m(t.updateExpenseWiseExpense(""))}),p(),l(7,"div",7)(8,"spk-reusable-tables",8,0),f("sortChanged",function(g){return d(a),m(t.onSortChanged(g))})("selectionChange",function(g){return d(a),m(t.handleSelectionChange(g))})("textSearchChange",function(g){return d(a),m(t.updateSearchFilter(g))})("dateChange",function(g){return d(a),m(t.handleDateChange(g))})("dateRangeChange",function(g){return d(a),m(t.handleDateRangeChange(g))}),u(10,Me,2,1,"ng-container",5)(11,Oe,2,2,"ng-container",5),p(),u(12,Ve,2,0,"ng-container",5),p()()()()}e&2&&(r("title","SFA")("title1",S(27,be))("activeitem","Expense List")("btnShow1",t.accessRight==null?null:t.accessRight.modifyRight)("buttonText1","Header Config")("icon1","settings")("dataHsOverlay","#expense-header-config"),o(4),r("ngIf",t.skLoading),o(),r("ngIf",!t.skLoading),o(),y("p-0 pt-2"),r("pageTitle","Expense List")("refreshLabel","Refresh")("addBtnLabel","Add Expense")("btnShow",!0)("btnShow2",t.accessRight==null?null:t.accessRight.addRight),o(2),r("tableHead","border-b")("showCheckbox",!1)("showS_No",!0)("showSorting",!1)("showFilterRow",!0)("showAction",!0)("columns",t.visibleHeaders)("subModule",t.subModule),o(2),r("ngIf",!t.skLoading),o(),r("ngIf",t.skLoading),o(),r("ngIf",!t.expenseListing.length&&!t.skLoading))},dependencies:[ae,H,P,se,z,ne,de,le,ie,j,X,N,B,te,Q,pe],encapsulation:2})};export{me as ExpenseListComponent};
