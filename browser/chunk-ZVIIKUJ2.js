import{a as Te}from"./chunk-GXF7AAOQ.js";import{a as be}from"./chunk-PU6S26UW.js";import{a as Ie}from"./chunk-54KZ5YIV.js";import{c as Se}from"./chunk-CIBZCVJQ.js";import{a as xe}from"./chunk-OTFCGVEU.js";import{a as Ce}from"./chunk-HPLI5COI.js";import{a as oe}from"./chunk-CNF4GSI7.js";import{a as re}from"./chunk-DC4QM32I.js";import{C as ye,F as Fe,c as ae,k as he,r as ge,v as ve}from"./chunk-VHE3PQ3O.js";import{B as Y,C as $,E as K,G as X,Ga as le,H as Q,M as Z,Oa as me,Pa as pe,R as ee,Ta as ce,Ua as _e,V as ie,Y as te,Ya as fe,Z as ne,hb as ue,l as W,o as D,oa as se,w as H,wa as de,z as J}from"./chunk-GYDYF5F3.js";import{M as z,f as G,g as P,t as q}from"./chunk-PD5VTTIY.js";import{Aa as u,Ba as h,Hb as N,Lc as F,Mc as C,Nc as j,Ob as _,Oc as k,Uc as L,Vc as O,Wc as R,Yc as A,_b as s,cc as V,kc as d,lc as l,mc as S,nc as T,oc as M,qc as g,rb as r,sb as f,wc as v,yc as m}from"./chunk-2NSPOFEK.js";import{a as w,i as U}from"./chunk-66YHNWRR.js";var Ee=()=>[];function Be(n,i){n&1&&(d(0,"div",13),S(1,"app-skeleton"),l())}function we(n,i){n&1&&(d(0,"div",9)(1,"div",10)(2,"div",11),_(3,Be,2,0,"div",12),l()()()),n&2&&(r(3),s("ngForOf",A(1,Ee).constructor(10)))}function Ve(n,i){if(n&1){let e=g();d(0,"div")(1,"app-form-field",22,0),v("valueChange",function(t){u(e);let a=m().$implicit,c=m(5);return h(c.onFieldChange(t,a))}),l()()}if(n&2){let e=m().$implicit,o=m(5);V("mb-4 ",e.class_name,""),r(),s("field",e)("form",o.myForm)}}function Le(n,i){if(n&1&&(T(0),_(1,Ve,3,5,"div",21),M()),n&2){let e=i.$implicit;r(),s("ngIf",e.is_show===!0&&(e.is_parent_dependency===!1||e.is_child_show===!0))}}function Oe(n,i){if(n&1&&(d(0,"div",11),_(1,Le,2,1,"ng-container",20),l()),n&2){let e=m(4);r(),s("ngForOf",e.formFields)}}function Re(n,i){if(n&1){let e=g();d(0,"form",16),v("ngSubmit",function(){u(e);let t=m(3);return h(t.onSubmit())}),d(1,"div",9)(2,"div",10),_(3,Oe,2,1,"div",17),l(),d(4,"div",18),S(5,"app-button",19),l()()()}if(n&2){let e=m(3);s("formGroup",e.myForm),r(3),s("ngIf",e.myForm&&e.myForm.controls),r(2),s("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",e.api.disabled)("formType",e.pageType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}function Ae(n,i){if(n&1&&(d(0,"div",14),_(1,Re,6,8,"form",15),l()),n&2){let e=m(2);r(),s("ngIf",e.formIniatialized)}}function Ue(n,i){if(n&1){let e=g();d(0,"div",5)(1,"app-modal-header",6),v("close",function(){u(e);let t=m();return h(t.close())}),l(),_(2,we,4,2,"div",7)(3,Ae,2,1,"div",8),l()}if(n&2){let e=m();r(),s("title","Add Audit Request")("closeBtn",!0),r(),s("ngIf",e.skLoading),r(),s("ngIf",!e.skLoading)}}function Ne(n,i){n&1&&(d(0,"div",13),S(1,"app-skeleton"),l())}function je(n,i){n&1&&(d(0,"div",9)(1,"div",10)(2,"div",11),_(3,Ne,2,0,"div",12),l()()()),n&2&&(r(3),s("ngForOf",A(1,Ee).constructor(10)))}function ke(n,i){if(n&1){let e=g();d(0,"div")(1,"app-form-field",22,0),v("valueChange",function(t){u(e);let a=m().$implicit,c=m(5);return h(c.onFieldChange(t,a))}),l()()}if(n&2){let e=m().$implicit,o=m(5);V("mb-4 ",e.class_name,""),r(),s("field",e)("form",o.myForm)}}function Ge(n,i){if(n&1&&(T(0),_(1,ke,3,5,"div",21),M()),n&2){let e=i.$implicit;r(),s("ngIf",e.is_show===!0&&(e.is_parent_dependency===!1||e.is_child_show===!0))}}function Pe(n,i){if(n&1&&(d(0,"div",11),_(1,Ge,2,1,"ng-container",20),l()),n&2){let e=m(4);r(),s("ngForOf",e.formFields)}}function qe(n,i){if(n&1){let e=g();d(0,"form",16),v("ngSubmit",function(){u(e);let t=m(3);return h(t.onSubmit())}),d(1,"div",9)(2,"div",10),_(3,Pe,2,1,"div",17),l(),d(4,"div",18),S(5,"app-button",19),l()()()}if(n&2){let e=m(3);s("formGroup",e.myForm),r(3),s("ngIf",e.myForm&&e.myForm.controls),r(2),s("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",e.api.disabled)("formType",e.pageType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}function ze(n,i){if(n&1&&(d(0,"div",14),_(1,qe,6,8,"form",15),l()),n&2){let e=m(2);r(),s("ngIf",e.formIniatialized)}}function We(n,i){if(n&1){let e=g();d(0,"div",5)(1,"app-modal-header",6),v("close",function(){u(e);let t=m();return h(t.close())}),l(),_(2,je,4,2,"div",7)(3,ze,2,1,"div",8),l()}if(n&2){let e=m();r(),s("title","Add Branding Request")("closeBtn",!0),r(),s("ngIf",e.skLoading),r(),s("ngIf",!e.skLoading)}}function He(n,i){if(n&1&&(d(0,"mat-option",34),C(1),l()),n&2){let e=i.$implicit;s("value",e.name),r(),j(e.name)}}function Je(n,i){n&1&&(T(0),C(1,"This field is required"),M())}function Ye(n,i){if(n&1&&(d(0,"div",35),_(1,Je,2,0,"ng-container",36),l()),n&2){m();let e=F(12);r(),s("ngIf",e.errors==null?null:e.errors.required)}}function $e(n,i){n&1&&(T(0),C(1,"This field is required"),M())}function Ke(n,i){if(n&1&&(d(0,"div",35),_(1,$e,2,0,"ng-container",36),l()),n&2){m();let e=F(7);r(),s("ngIf",e.errors==null?null:e.errors.required)}}function Xe(n,i){if(n&1){let e=g();d(0,"div",37)(1,"label",26),C(2,"Reason"),d(3,"span",27),C(4,"*"),l()(),d(5,"mat-form-field",38)(6,"textarea",39,3),R("ngModelChange",function(t){u(e);let a=m(2);return O(a.data.reason,t)||(a.data.reason=t),h(t)}),l()(),_(8,Ke,2,1,"div",31),l()}if(n&2){let e=F(7);m();let o=F(3),t=m();r(6),L("ngModel",t.data.reason),r(2),s("ngIf",e.touched||o.submitted)}}function Qe(n,i){if(n&1){let e=g();d(0,"div",5)(1,"app-modal-header",6),v("close",function(){u(e);let t=m();return h(t.closeModal())}),l(),d(2,"form",23,1),v("ngSubmit",function(){u(e);let t=F(3),a=m();return h(t.valid&&a.brandStatusChange())}),d(4,"mat-dialog-content",24)(5,"div",25)(6,"label",26),C(7),d(8,"span",27),C(9,"*"),l()(),d(10,"mat-form-field",28)(11,"mat-select",29,2),R("ngModelChange",function(t){u(e);let a=m();return O(a.data.status,t)||(a.data.status=t),h(t)}),_(13,He,2,2,"mat-option",30),l()(),_(14,Ye,2,1,"div",31),l(),_(15,Xe,9,2,"div",32),l(),d(16,"mat-dialog-actions",33),S(17,"app-button",19),l()()()}if(n&2){let e=F(3),o=F(12),t=m();r(),s("title","Change Status")("closeBtn",!0),r(6),k("Status ",t.data.status,""),r(4),L("ngModel",t.data.status),r(2),s("ngForOf",t.modalData.options),r(),s("ngIf",o.touched||e.submitted),r(),s("ngIf",t.data.status=="Reject"),r(2),s("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",t.api.disabled)("formType",t.modalData.formType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}var Me=class n{constructor(i,e,o,t,a,c,p,y,E,B,b,De,x,I){this.modalData=i;this.dialogRef=e;this.CommonApiService=o;this.toastr=t;this.moduleService=a;this.api=c;this.util=p;this.formValidation=y;this.fb=E;this.uploadService=B;this.spaceRemove=b;this.logService=De;this.router=x;this.comanFuncation=I}skLoading=!1;data={};FORMID=Ce;subModule;moduleFormId=0;originalFormFields=[];formFields=[];myForm;primaryForm;formIniatialized=!1;DetailId;fieldTypes=W;originalData={};pageType="add";ngOnInit(){let i=this.moduleService.getSubModuleByName("SFA","Branding"),e=this.moduleService.getFormById("SFA","Branding",this.FORMID.ID.BrandingForm);i&&(this.subModule=i),e&&(this.moduleFormId=e.form_id,(this.modalData.formType==="add-branding-request"||this.modalData.formType==="add-branding-request")&&this.getFormData()),this.modalData.lastPage==="branding-list"&&(this.data.status=this.modalData.status)}getFormData(){this.skLoading=!0,this.api.post({form_id:this.moduleFormId,platform:"web"},"form-builder/read").subscribe(i=>{i.statusCode==200&&(i?.data?.form_data&&(this.originalFormFields=JSON.parse(JSON.stringify(i.data.form_data))),this.formFields=i.data.form_data,this.skLoading=!1,this.formFields.forEach(e=>{this.util.createValidation(e)}),this.initializeForm())})}initializeForm(){this.getUserList(),this.getLoginType(),this.myForm=this.fb.group({}),this.formFields.forEach(i=>{i.api_path&&this.getOptions(i.label,i.name,i.api_path),i.control=this.fb.control("",this.formValidation.getValidators(i)),this.myForm.addControl(i.name,i.control)}),this.formIniatialized=!0,this.DetailId&&this.getDetail()}getOptions(i,e,o){return U(this,null,function*(){try{let t=yield this.api.post({dropdown_name:i,module_id:this.subModule.sub_module_id||this.subModule.module_id},o).toPromise();t?.statusCode===200&&(this.formFields.forEach(a=>{a.name===e&&(a.options=t.data)}),this.originalFormFields.forEach(a=>{a.name===e&&(a.options=t.data)}))}catch(t){console.error("Error fetching options:",t)}})}onFieldChange(i,e){if(e.type==this.fieldTypes.SINGLE_SELECT||e.type==this.fieldTypes.MULTI_SELECT||e.type==this.fieldTypes.RADIO_SELECT||e.type==this.fieldTypes.CHECKBOX_SELECT||e.type==this.fieldTypes.DATE||e.type==this.fieldTypes.TIME||e.type==this.fieldTypes.UPLOAD){if(e.key_name_required===!0){let o=e.options.findIndex(a=>a.value===i),t;o!==-1&&(t=e.options[o].label,this.formFields.forEach(a=>{a.name===e.key_name&&this.myForm.controls[a.name].setValue(t)}))}e.type==this.fieldTypes.SINGLE_SELECT&&e.key_source=="custom"||e.type==this.fieldTypes.MULTI_SELECT&&e.key_source=="custom"?(e.control.setValue(i),e.value=i.label):e.control.setValue(i)}if(e.type===this.fieldTypes.DATE_RANGE){let o={from:i.from,to:i.to};this.myForm.controls[e.name].setValue(o)}if(e.type===this.fieldTypes.UPLOAD){for(let o=0;o<this.UploadFiles.length;o++)this.UploadFiles[o].label===e.label&&this.UploadFiles.splice(o,1);this.UploadFiles.push({label:e.label,file:i})}if(e.is_child_dependency===!0){let o=e.options.findIndex(t=>t.value===i);o!==-1&&(e.type===this.fieldTypes.SINGLE_SELECT&&e.key_source==="default"?(e.value=e.options[o].value,this.getDependencyUpdate(e)):(e.value=e.options[o].label,this.getDependencyUpdate(e)))}if(e.is_child_dependency){let o=this.formFields.findIndex(t=>t.name==e.name);this.onResetDependentFields(o);for(let t=o;t<=this.formFields.length-1;t++){let c=this.formFields[t].options?.find(p=>this.spaceRemove.formatString(p.value)===this.spaceRemove.formatString(this.formFields[t].value))?.label||"";for(let p=0;p<=this.formFields[t].child_dependency.length-1;p++){let y=!1,E=this.formFields[t].child_dependency[p];if(E.visibilty==="Direct"&&(E.parent_field_value===c||E.child_field_option.length===0&&this.formFields[t].is_child_show)&&(y=!0),this.formFields[t].child_dependency[p].visibilty==="Option"){let b=this.formFields.findIndex(x=>x.name==this.formFields[t].child_dependency[p].child_field_name);if(b!==-1&&this.formFields[b].type===this.fieldTypes.SHORT_TEXT&&this.formFields[t].value&&(y=!0,this.formFields[b].is_child_show=y),this.formFields[t].child_dependency[p].child_field_option.findIndex(x=>x.parent_field_value==c&&x.parent_field_name==this.formFields[t].name)!==-1){y=!0;let x=this.formFields.findIndex(I=>I.name==this.formFields[t].child_dependency[p].child_field_name);this.formFields[x].options=this.formFields[t].child_dependency[p].child_field_option.filter(I=>I.parent_field_name==this.formFields[t].name&&I.parent_field_value==c)}}let B=this.formFields.findIndex(b=>b.name==this.formFields[t].child_dependency[p].child_field_name);B!==-1&&(this.formFields[B].is_child_show=y)}}}e.name==="customer_type_id"&&this.getCustomerByLoginType(i)}onResetDependentFields(i){this.formFields[i].child_dependency.length!=0&&this.formFields[i].child_dependency.map(e=>{let o=this.formFields.findIndex(t=>t.name===e.child_field_name);o!==-1&&(this.myForm.controls[e.child_field_name].reset(),this.formFields[o].value=""),this.onResetDependentFields(o)})}getDetail(){this.api.post({_id:this.DetailId},"branding/detail").subscribe(i=>{if(i.statusCode===200){let e;e=i.data,this.originalData=w(w({},e),e.form_data),delete this.originalData.form_data;let o=Object.keys(this.originalData),t=this.formFields.filter(a=>o.includes(a.name)&&(a.type===this.fieldTypes.SINGLE_SELECT||a.type===this.fieldTypes.MULTI_SELECT));if(this.myForm.patchValue(this.originalData),t.length>0)for(let a=0;a<t.length;a++){let c=t[a].name;this.myForm.controls[c]&&this.myForm.controls[c].setValue(this.originalData[c]);for(let p=0;p<this.formFields.length;p++)this.formFields[p].name===c&&this.originalData[c]&&(this.formFields[p].is_child_show=!0,this.formFields[p].value=this.originalData[c],this.getDependencyUpdate(this.formFields[p]))}}})}getUserList(){this.api.post({page:1},"user/read-dropdown").subscribe(i=>{if(i.statusCode==200)for(let e=0;e<this.formFields.length;e++)this.formFields[e].name==="assigned_to_user_id"&&(this.formFields[e].options=i.data)})}getLoginType(){let i=[D.PRIMARY,D.SUB_PRIMARY,D.SECONDARY];this.api.post({form_id:this.moduleFormId,login_type_ids:i},"customer-type/read-dropdown").subscribe(e=>{if(e.statusCode==200)for(let o=0;o<this.formFields.length;o++)this.formFields[o].name==="customer_type_id"&&(this.formFields[o].options=e.data)})}getCustomerByLoginType(i){this.api.post({customer_type_id:i},"customer/read-dropdown").subscribe(e=>{if(e.statusCode==200)for(let o=0;o<this.formFields.length;o++)this.formFields[o].name==="customer_id"&&(this.formFields[o].options=e.data)})}getDependencyUpdate(i){if(i.is_child_dependency){let e,o,t;if(i.key_source==="default"){let a=i.options.find(c=>c.value===i.value);e=a?a.label:null}i.child_dependency.forEach(a=>{let c=this.formFields.find(p=>p.name===a.child_field_name);if(c){o=c.name;let p=a.child_field_option.find(y=>y.parent_field_value===e);t=p?p.label:null}}),o&&this.api.post({child_field_name:o,parent_field_value:e},"form-builder/read-dependency").subscribe(a=>{if(a?.statusCode===200&&a?.data){let c=this.formFields.find(p=>p.name===o);c&&(c.options=a.data)}})}}onCustomerCategoryChange(i){let e=this.CommonApiService.customerCategorySubType.find(o=>o.value===i);e&&(this.data.customer_type_name=e.label),this.CommonApiService.getCustomerData(this.data.customer_type_id)}pondFiles=[];UploadFiles=[];pondOptions={allowMultiple:!0,labelIdle:"Click or drag images here to upload...",acceptedFileTypes:["image/jpeg","image/png","image/jpg"],maxFileSize:"2KB",maxFiles:5};onFileAdd(i){let e=i.file.file;if(!["image/jpeg","image/png","image/jpg"].includes(e.type)){this.toastr.error("Invalid file type. Only JPG, JPEG, and PNG are allowed.","","toast-top-right");return}if(e.size>2*1e6){this.toastr.error("File size should not exceed 2MB.","","toast-top-right");return}this.pondFiles.push(e),this.UploadFiles=this.pondFiles}close(){this.dialogRef.close()}onSubmit(){if(this.formFields.forEach(i=>{(i.is_child_show===!1||i.is_show===!1)&&(this.myForm.get(i.name)?.clearValidators(),this.myForm.get(i.name)?.updateValueAndValidity())}),this.myForm.valid){this.api.disabled=!0;let i={primaryFields:{form_data:{}}};this.formFields.forEach(a=>{a.name&&this.myForm.value.hasOwnProperty(a.name)&&(a.read_only===!1&&a.key_source!=="custom"&&(i.primaryFields[a.name]=this.myForm.value[a.name]),a.key_source==="custom"&&(i.primaryFields.form_data[a.name]=this.myForm.value[a.name]),a.type===this.fieldTypes.UPLOAD&&delete i.primaryFields.form_data[a.name])}),i.primaryFields.form_data.files=this.myForm.value.files;let e=this.pageType==="edit";if(e&&(i.primaryFields._id=this.DetailId,this.logService.logActivityOnUpdate(e,this.originalData,this.myForm.value,this.subModule.module_id,this.subModule.title,"update",this.originalData._id||null,()=>{},this.subModule.module_type)&&this.UploadFiles.length===0)){this.api.disabled=!1,this.toastr.warning("No changes detected","","toast-top-right");return}let o=e?"patch":"post",t=e?"event/update":"event/create";this.api[o](i.primaryFields,t).subscribe(a=>{a.statusCode===200&&(this.UploadFiles.length>0?(this.api.disabled=!0,this.uploadService.uploadFile(a.data.inserted_id,"event",this.UploadFiles,"Event Plan Images",this.subModule,"/apps/sfa/event-plan")):(this.api.disabled=!1,this.router.navigate([e?`/apps/sfa/event-plan/event-plan-detail/${this.DetailId}`:"/apps/sfa/event-plan"]),this.toastr.success(a.message,"","toast-top-right")))})}else{this.toastr.error("Form Is Invalid","","toast-top-right"),this.formValidation.markFormGroupTouched(this.myForm);let i=Object.keys(this.myForm.controls).filter(e=>this.myForm.get(e)?.invalid);console.warn("Invalid fields:",i)}}brandStatusChange(){this.skLoading=!0,this.comanFuncation.statusChange(this.data.status,this.modalData.DetailId,this.modalData.status,this.modalData.subModule,"without-toggle","brand-audit/status",this.data.reason).subscribe(i=>{this.skLoading=!1,i&&this.dialogRef.close(!0)})}closeModal(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(f(pe),f(me),f(oe),f(H),f(re),f(ne),f(te),f(ve),f(ie),f(be),f(Ie),f(xe),f(z),f(Se))};static \u0275cmp=N({type:n,selectors:[["app-branding-modal"]],inputs:{formFields:"formFields"},decls:3,vars:3,consts:[["dynamicForm",""],["f","ngForm"],["status","ngModel"],["reason","ngModel"],["class","mat-dialoge",4,"ngIf"],[1,"mat-dialoge"],[3,"close","title","closeBtn"],["class","box",4,"ngIf"],["class","xl:col-span-12 col-span-12",4,"ngIf"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","gap-x-6"],["class","xl:col-span-3 col-span-12 mb-4",4,"ngFor","ngForOf"],[1,"xl:col-span-3","col-span-12","mb-4"],[1,"xl:col-span-12","col-span-12"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"ngSubmit","formGroup"],["class","grid grid-cols-12 gap-x-6",4,"ngIf"],[1,"box-footer","border-t","border-block-start-dashed","sm:flex","justify-end"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],[4,"ngFor","ngForOf"],[3,"class",4,"ngIf"],[3,"valueChange","field","form"],[3,"ngSubmit"],[1,"mat-typography","py-1"],[1,""],[1,"form-label","mb-0"],[1,"text-red-500"],[1,"mat-custom-field","remove-space"],["placeholder","Select an option","name","status","required","",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["class","mt-1 text-xs text-red-500 text-right",4,"ngIf"],["class","mt-2",4,"ngIf"],["align","end",1,"gap-2"],[3,"value"],[1,"mt-1","text-xs","text-red-500","text-right"],[4,"ngIf"],[1,"mt-2"],[1,"mat-custom-field","remove-space","text-area-height"],["matInput","","placeholder","Type Here ...","name","reason","required","",3,"ngModelChange","ngModel"]],template:function(e,o){e&1&&_(0,Ue,4,4,"div",4)(1,We,4,4,"div",4)(2,Qe,18,13,"div",4),e&2&&(s("ngIf",o.modalData.formType==="add-audit-request"),r(),s("ngIf",o.modalData.formType==="add-branding-request"),r(),s("ngIf",o.modalData.lastPage==="branding-list"))},dependencies:[q,G,P,Fe,Q,J,Y,$,ee,X,K,Z,Te,ae,ye,ge,ue,se,_e,ce,le,de,fe,he],encapsulation:2})};export{Me as a};
