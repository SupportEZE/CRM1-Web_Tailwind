import{a as ce}from"./chunk-54KZ5YIV.js";import{a as me}from"./chunk-JUPJFX3F.js";import{a as oe}from"./chunk-OEHD5D2Y.js";import{a as pe}from"./chunk-GLWQGYBC.js";import{B as de,F as le,c as ie,s as re,w as se}from"./chunk-VHE3PQ3O.js";import{A as F,B as z,C as W,D as Y,H as J,M as K,P as U,Qa as ne,S as X,T as Z,V as ee,Z as te,hb as ae,w as j}from"./chunk-GYDYF5F3.js";import{K as H,M as $,e as q,f as O,g as A,n as R,o as B,t as P}from"./chunk-PD5VTTIY.js";import{Aa as w,Ba as E,Fc as M,G,Gc as k,Hb as V,Hc as T,K as Q,Mc as r,Nc as m,Ob as c,Oc as p,Yc as y,_b as d,bc as g,ed as f,fd as S,gd as C,kc as a,lc as t,mc as v,nc as x,oc as h,qc as I,rb as i,sb as b,wc as N,yc as u}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import"./chunk-66YHNWRR.js";var _e=["couponInput"],ge=["qrCodeLabel"],fe=()=>["Dispatch"],D=()=>[];function be(o,n){o&1&&(a(0,"div",20),v(1,"app-skeleton"),t()),o&2&&(i(),g("w180"))}function xe(o,n){o&1&&(a(0,"div",20),v(1,"app-skeleton"),t()),o&2&&(i(),g("w180"))}function he(o,n){o&1&&(x(0),a(1,"div",16)(2,"app-showcode-card",17)(3,"div")(4,"div",18),c(5,be,2,2,"div",19),t()()()(),a(6,"div",16)(7,"app-showcode-card",17)(8,"div")(9,"div",18),c(10,xe,2,2,"div",19),t()()()(),h()),o&2&&(i(2),d("titleView",!1)("view",!1),i(3),d("ngForOf",y(6,D).constructor(9)),i(2),d("titleView",!1)("view",!1),i(3),d("ngForOf",y(7,D).constructor(9)))}function ve(o,n){if(o&1&&(a(0,"div",25)(1,"div")(2,"span",26),r(3),t(),a(4,"span",27),r(5,"E-Way Number"),t()()()),o&2){let e=u(2);i(3),p(" ",e.dispatchDetail.e_way_number?e.dispatchDetail.e_way_number:"---"," ")}}function ye(o,n){if(o&1&&(a(0,"app-showcode-card",34)(1,"ul",23)(2,"li")(3,"form",35)(4,"div",36)(5,"div",37),v(6,"spk-input",38,1),t()()()()()()),o&2){let e=u(2);g("text-primarytint1color"),d("boxHeader","pt-3")("classbody","pt-0")("titleView",!1),i(3),d("formGroup",e.dispatchForm),i(3),g("focus-input"),d("fieldReq",!0)("maxlength",16)("minlength",16)}}function Se(o,n){if(o&1&&(x(0),r(1),h()),o&2){let e=u().$implicit;i(),p(" ",e.customer_id?"Scanned":"Not Scanned"," ")}}function Ce(o,n){if(o&1){let e=I();x(0),a(1,"a",43),N("click",function(){w(e);let l=u().$implicit,_=u(3);return E(_.goToDetail(l.dispatch_id))}),r(2),t(),h()}if(o&2){let e=u().$implicit;i(2),m(e.customer_id?"Scanned":"Not Scanned")}}function De(o,n){if(o&1&&(a(0,"tr",40)(1,"td",41),r(2),t(),a(3,"td"),r(4),t(),a(5,"td",42),c(6,Se,2,1,"ng-container",4)(7,Ce,3,1,"ng-container",4),t()()),o&2){let e=n.$implicit,s=n.index,l=u(3);d("ngClass",e.customer_id?"bg-green-500":"bg-red-500"),i(2),m(s+1),i(2),m(e.qr_master_box_code?e.qr_master_box_code:"---"),i(2),d("ngIf",!l.printStatus),i(),d("ngIf",l.printStatus)}}function we(o,n){if(o&1&&(x(0),c(1,De,8,5,"tr",39),h()),o&2){let e=u(2);i(),d("ngForOf",e.masterQrList)}}function Ee(o,n){o&1&&(a(0,"td"),v(1,"app-skeleton"),t()),o&2&&(i(),g("h20 bg-skeleton"))}function Ie(o,n){o&1&&(a(0,"tr",45),c(1,Ee,2,2,"td",15),t()),o&2&&(i(),d("ngForOf",y(1,D).constructor(3)))}function Ne(o,n){o&1&&(x(0),c(1,Ie,2,2,"tr",44),h()),o&2&&(i(),d("ngForOf",y(1,D).constructor(5)))}function Me(o,n){o&1&&(x(0),v(1,"app-data-not-found"),h())}function ke(o,n){if(o&1&&(a(0,"tr",46)(1,"td",41),r(2),t(),a(3,"td",47),r(4),f(5,"date"),t(),a(6,"td"),r(7),f(8,"titlecase"),t(),a(9,"td",48),r(10),t(),a(11,"td",49),r(12),t()()),o&2){let e=n.$implicit,s=n.index;i(2),m(s+1),i(2),m(e.order_date?C(5,5,e.order_date,"dd MMM yyyy"):"N/A"),i(3),m(e.customer_name?S(8,8,e.customer_name):"---"),i(3),m(e.order_no?e.order_no:"---"),i(2),m(e.totalScannedQuantity?e.totalScannedQuantity:"---")}}function Te(o,n){if(o&1&&(x(0),a(1,"div",21)(2,"app-showcode-card",22)(3,"ul",23)(4,"li")(5,"div",24)(6,"div",25)(7,"div")(8,"span",26),r(9),f(10,"date"),t(),a(11,"span",27),r(12,"Date Created"),t()()(),a(13,"div",25)(14,"div")(15,"span",26),r(16),t(),a(17,"span",27),r(18,"Invoice Number"),t()()(),a(19,"div",25)(20,"div")(21,"span",26),r(22),t(),a(23,"span",27),r(24,"Gatepass Number"),t()()(),c(25,ve,6,1,"div",28),a(26,"div",25)(27,"div")(28,"span",26),r(29),f(30,"titlecase"),t(),a(31,"span",27),r(32,"Driver Name"),t()()(),a(33,"div",25)(34,"div")(35,"span",26),r(36),t(),a(37,"span",27),r(38,"Mobile No."),t()()(),a(39,"div",25)(40,"div")(41,"span",26),r(42),t(),a(43,"span",27),r(44,"Vehicle No."),t()()(),a(45,"div",25)(46,"div")(47,"span",26),r(48),t(),a(49,"span",27),r(50,"Transportation Mode"),t()()()()()()(),c(51,ye,8,11,"app-showcode-card",29),t(),a(52,"div",21)(53,"app-showcode-card",30)(54,"div",31)(55,"spk-reusable-tables",32),c(56,we,2,1,"ng-container",4)(57,Ne,2,2,"ng-container",4),t(),c(58,Me,2,0,"ng-container",4),t()(),a(59,"app-showcode-card",30)(60,"div",31)(61,"spk-reusable-tables",32),c(62,ke,13,10,"tr",33),t()()()(),h()),o&2){let e=u();i(2),g("text-primarytint1color"),d("title","Gatepass Details")("boxHeader","pt-3")("classbody","pt-0")("titleView",!0),i(7),p(" ",e.dispatchDetail.created_at?C(10,41,e.dispatchDetail.created_at,"dd MMM yyyy hh:mm a"):"---"," "),i(7),p(" ",e.dispatchDetail.invoice_number?e.dispatchDetail.invoice_number:"---"," "),i(6),p(" ",e.dispatchDetail.gatepass_number?e.dispatchDetail.gatepass_number:"---"," "),i(3),d("ngIf",e.dispatchDetail.e_way_number),i(4),p(" ",e.dispatchDetail.driver_name?S(30,44,e.dispatchDetail.driver_name):"---"," "),i(7),p(" ",e.dispatchDetail.mobile?e.dispatchDetail.mobile:"---"," "),i(6),p(" ",e.dispatchDetail.vehicle_number?e.dispatchDetail.vehicle_number:"---"," "),i(6),p(" ",e.dispatchDetail.transportation_mode?e.dispatchDetail.transportation_mode:"---"," "),i(3),d("ngIf",!e.printStatus),i(2),g("text-primarytint1color"),d("title","Master Box Detail")("boxHeader","pt-3")("classbody","pt-0")("titleView",!0)("actionIcons",!1)("iconClass","ti-btn btn-wave ti-btn-sm ti-btn-soft-success waves-effect waves-light")("iconName","ri-printer-line"),i(2),d("columns",e.getColumns("master_qr"))("showAction",!1),i(),d("ngIf",!e.masterQrLoading),i(),d("ngIf",e.masterQrLoading&&e.masterQrList.length===0),i(),d("ngIf",e.masterQrList.length===0),i(),g("text-primarytint1color"),d("title","Order Detail")("boxHeader","pt-3")("classbody","pt-0")("titleView",!0)("actionIcons",!1)("iconClass","ti-btn btn-wave ti-btn-sm ti-btn-soft-success waves-effect waves-light")("iconName","ri-printer-line"),i(2),d("columns",e.getColumns("order"))("showAction",!1),i(),d("ngForOf",e.linkedOrders)}}function Fe(o,n){if(o&1&&(a(0,"tr")(1,"td",50),r(2),f(3,"date"),t(),a(4,"td",51),r(5),f(6,"titlecase"),t(),a(7,"td",51),r(8),t(),a(9,"td",52),r(10),t()()),o&2){let e=n.$implicit;i(2),m(e.order_date?C(3,4,e.order_date,"dd MMM yyyy"):"N/A"),i(3),m(e.customer_name?S(6,7,e.customer_name):"---"),i(3),m(e.order_no?e.order_no:"---"),i(2),m(e.totalScannedQuantity?e.totalScannedQuantity:"---")}}var ue=class o{constructor(n,e,s,l,_,L,Le){this.route=n;this.toastr=e;this.fb=s;this.dialog=l;this.api=_;this.router=L;this.removeSpace=Le;this.dispatchForm=this.fb.group({qr_code:["",[F.minLength(16),F.maxLength(16)]]})}couponInputComponent;qrCodeLabel;dispatchForm=new Y({});filter={};id={};skLoading=!1;dispatchDetail={};linkedOrders=[];masterQrList=[];itemList=[];count={};btnFlag=!1;pagination={};queScanList=[];masterQrLoading=!1;printStatus=!1;pageType;status;ngOnInit(){this.route.paramMap.subscribe(n=>{this.id=n.get("id"),this.pageType=n.get("type"),this.status=n.get("status"),this.id&&this.getDetail()}),this.dispatchForm.get("qr_code")?.valueChanges.pipe(Q(150),G(n=>!!n&&n.length===16)).subscribe(n=>{this.handleCouponScan(n)})}ngAfterViewInit(){setTimeout(()=>{this.couponInputComponent?.focusInput?.()},0)}getDetail(){this.skLoading=!0,this.api.post({_id:this.id},"gatepass/detail").subscribe(n=>{n.statusCode===200&&(this.skLoading=!1,this.dispatchDetail=n?.data?.gatePassData??{},this.linkedOrders=n?.data?.linkedOrders??[],this.getMasterCodes())})}getMasterCodes(){this.masterQrLoading=!0,this.api.post({page:this.pagination.cur_page??1,dispatch_status:this.pageType,_id:this.id,dispatch_id:this.dispatchDetail?.dispatch_id??[]},"gatepass/master-box-detail").subscribe(n=>{n.statusCode===200&&(this.masterQrLoading=!1,this.masterQrList=n?.data?.masterBoxList??[],this.printStatus=n?.data?.print_status??!1)})}pendingQueue=[];isSending=!1;handleCouponScan(n){console.log(n,"code");let e=`${n}-${Date.now()}`;this.pendingQueue.push({code:n,id:e}),this.queScanList.unshift({id:e,qr_code:n,status:"Pending",scanned_at:Date.now()}),this.dispatchForm.get("qr_code")?.setValue(""),this.processNextCode()}processNextCode(){if(this.isSending||this.pendingQueue.length===0)return;this.isSending=!0;let{code:n,id:e}=this.pendingQueue.shift(),s={gatepass_id:this.id,gatepass_no:this.dispatchDetail.gatepass_number,master_box_code:n};this.api.post(s,"qr-code/master-box-scan").subscribe({next:l=>{let _=this.queScanList.find(L=>L.qr_code===n);console.log(_,"scanned"),_&&(_.status=l?.statusCode===200?l?.message:"Failed",this.getMasterCodes())},error:()=>{let l=this.queScanList.find(_=>_.id===e);l&&(l.status="Error")},complete:()=>{this.isSending=!1,setTimeout(()=>this.processNextCode(),200)}})}getColumns(n){return n==="master_qr"?[{label:"Sr.No"},{label:"Master Box No."},{label:"Status"}]:[{label:"Sr.No"},{label:"Date Created"},{label:"Company Name"},{label:"Order Number"},{label:"Total Qty."}]}goToDetail(n){this.router.navigate(["/apps/wms/dispatch-list/gatepass_pending/dispatch-detail/"+n])}printLabel(){let n=this.qrCodeLabel.nativeElement.cloneNode(!0),e=window.open("","_blank","top=0,left=0,height=100%,width=auto");e?(e.document.open(),e.document.write(`
       <html>
          <head>
            <title>Print Gatepass</title>
            <style>
              @media print {
              @page {margin: 0;}
                html, body {margin: 0; padding: 0;}
                #QR_CODE_LABEL > div { page-break-after: always; break-after: always; page-break-inside: avoid; display: block;}
                body {font-family: 'Arial', sans-serif;}
              }
            </style>
          </head>
          <body></body>
        </html>
      `),e.document.close(),setTimeout(()=>{let s=e.document.body;s&&(s.appendChild(n),e.focus(),e.print(),e.close())},500)):console.error("Popup blocked.")}static \u0275fac=function(e){return new(e||o)(b(H),b(j),b(ee),b(ne),b(te),b($),b(ce))};static \u0275cmp=V({type:o,selectors:[["app-gatepass-detail"]],viewQuery:function(e,s){if(e&1&&(M(_e,5),M(ge,5)),e&2){let l;k(l=T())&&(s.couponInputComponent=l.first),k(l=T())&&(s.qrCodeLabel=l.first)}},decls:50,vars:24,consts:[["qrCodeLabel",""],["couponInput",""],[3,"buttonClick","title","title1","activeitem","btnShow","btnDisabled","buttonText","icon"],[1,"grid","grid-cols-12","sm:gap-x-4"],[4,"ngIf"],["id","QR_CODE_LABEL"],["hidden",""],[2,"font-size","20px","text-align","center","margin","16px 0px"],[2,"font-size","13px","margin","7px 0px","padding-left","16px"],[2,"font-size","13px"],[2,"width","100%","table-layout","fixed","border-collapse","collapse"],[2,"font-size","13px","padding","8px","text-align","right","font-weight","600","border-bottom","1px solid #000","width","100px"],[2,"font-size","13px","padding","8px","font-weight","600","border-bottom","1px solid #000"],[2,"font-size","13px","padding","8px","font-weight","600","border-bottom","1px solid #000","width","140px"],[2,"font-size","13px","padding","8px","font-weight","600","border-bottom","1px solid #000","width","120px","text-align","center"],[4,"ngFor","ngForOf"],[1,"xl:col-span-6","col-span-6"],[3,"titleView","view"],[1,"flex","gap-2","mb-1","flex-wrap"],["class","flex items-center",4,"ngFor","ngForOf"],[1,"flex","items-center"],[1,"xl:col-span-6","col-span-12"],[3,"title","boxHeader","classbody","titleView"],[1,"ti-list-group","list-group-flush","border-0"],[1,"flex","items-center","gap-5","flex-wrap","text-[12px]"],[1,"flex","items-center","me-2","flex-wrap"],[1,"block","font-medium"],[1,"text-textmuted","dark:text-textmuted/50"],["class","flex items-center me-2 flex-wrap",4,"ngIf"],[3,"class","boxHeader","classbody","titleView",4,"ngIf"],[3,"title","boxHeader","classbody","titleView","actionIcons","iconClass","iconName"],[1,"table-responsive","overflow-auto","table-bordered-default"],["tableClass","ti-custom-table ti-custom-table-head ti-custom-table-hover ti-head-primary",3,"columns","showAction"],["class","product-list border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[3,"boxHeader","classbody","titleView"],[3,"formGroup"],[1,"flex","items-center","gap-3","text-[12px]"],[1,"flex","items-center","flex-wrap","wp50","mt-4"],["formControlName","qr_code","label","Master Box No.","type","text",1,"remove-default-class","wp100",3,"fieldReq","maxlength","minlength"],["class","product-list border-b !border-defaultborder dark:!border-defaultborder/10",3,"ngClass",4,"ngFor","ngForOf"],[1,"product-list","border-b","!border-defaultborder","dark:!border-defaultborder/10",3,"ngClass"],[1,"text-center","w50"],[1,"text-center","w80"],[1,"underline",3,"click"],["class","border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[1,"border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"product-list","border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"w115"],[1,"w120"],[1,"text-center","w90"],[2,"padding","8px","text-align","right"],[2,"padding","8px"],[2,"padding","8px","text-align","center"]],template:function(e,s){if(e&1){let l=I();a(0,"app-page-header",2),N("buttonClick",function(){return w(l),E(s.printLabel())}),t(),a(1,"div",3),c(2,he,11,8,"ng-container",4)(3,Te,63,46,"ng-container",4),t(),a(4,"div",5,0)(6,"div",6)(7,"h2",7),r(8),t(),a(9,"p",8)(10,"strong",9),r(11,"Invoice No."),t(),r(12),t(),a(13,"p",8)(14,"strong",9),r(15,"Generate Date"),t(),r(16),f(17,"date"),t(),a(18,"p",8)(19,"strong",9),r(20,"Gatepass Number"),t(),r(21),t(),a(22,"p",8)(23,"strong",9),r(24,"Delivery Person"),t(),r(25),f(26,"titlecase"),t(),a(27,"p",8)(28,"strong",9),r(29,"Mobile No."),t(),r(30),t(),a(31,"p",8)(32,"strong",9),r(33,"Vehicle Number"),t(),r(34),t(),a(35,"p",8)(36,"strong",9),r(37,"Transportation Mode"),t(),r(38),t(),a(39,"table",10)(40,"tr")(41,"td",11),r(42," Date Created "),t(),a(43,"td",12),r(44," Company Name "),t(),a(45,"td",13),r(46," Order Number "),t(),a(47,"td",14),r(48," Total QTY. "),t()(),c(49,Fe,11,9,"tr",15),t()()()}e&2&&(d("title","WMS")("title1",y(23,fe))("activeitem",s.removeSpace.formatText(s.pageType))("btnShow",s.printStatus)("btnDisabled",s.btnFlag)("buttonText",s.btnFlag?"Please Wait":"Print Gatepass")("icon","print"),i(2),d("ngIf",s.skLoading),i(),d("ngIf",!s.skLoading),i(5),p(" ",s.dispatchDetail.billing_company?s.dispatchDetail.billing_company:"N/A"," "),i(4),p(" : ",s.dispatchDetail.invoice_number?s.dispatchDetail.invoice_number:"N/A"," "),i(4),p(" : ",s.dispatchDetail.created_at?C(17,18,s.dispatchDetail.created_at,"dd MMM yyyy hh:mm a"):"N/A"," "),i(5),p(" : ",s.dispatchDetail.gatepass_number?s.dispatchDetail.gatepass_number:"N/A"," "),i(4),p(" : ",s.dispatchDetail.driver_name?S(26,21,s.dispatchDetail.driver_name):"N/A"," "),i(5),p(" : ",s.dispatchDetail.mobile?s.dispatchDetail.mobile:"N/A"," "),i(4),p(" : ",s.dispatchDetail.vehicle_number?s.dispatchDetail.vehicle_number:"N/A"," "),i(4),p(" : ",s.dispatchDetail.transportation_mode?s.dispatchDetail.transportation_mode:"N/A"," "),i(11),d("ngForOf",s.linkedOrders))},dependencies:[le,q,O,A,J,z,W,X,Z,K,U,se,pe,ie,re,R,B,me,de,P,ae,oe],encapsulation:2})};export{ue as GatepassDetailComponent};
