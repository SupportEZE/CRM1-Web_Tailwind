import{a as Ke}from"./chunk-PU6S26UW.js";import{a as $e}from"./chunk-JUPJFX3F.js";import{d as Xe,e as Ze}from"./chunk-4JVCC6N3.js";import{a as Qe}from"./chunk-PJTW4QXW.js";import{a as z}from"./chunk-SQZ3YN6N.js";import{c as ze}from"./chunk-CIBZCVJQ.js";import{a as K}from"./chunk-OTFCGVEU.js";import{a as We}from"./chunk-HPLI5COI.js";import{a as G}from"./chunk-OEHD5D2Y.js";import{a as Je}from"./chunk-GLWQGYBC.js";import{a as Ee}from"./chunk-DC4QM32I.js";import{B as He,C as Ge,F as W,c as U,g as Le,h as Ne,j as Oe,k as Pe,r as Be,s as je,t as qe,v as Ye,w as Ue}from"./chunk-VHE3PQ3O.js";import{$ as Y,A as F,B as ce,C as ue,D as J,E as _e,G as xe,Ga as Ie,H as fe,I as ve,M as ge,Oa as we,P as be,Pa as Fe,Qa as Te,R as he,Ta as ke,Ua as Re,V as Ce,W as ye,X as Se,Ya as Ve,Z as q,_ as lt,hb as Ae,jb as H,oa as De,p as j,u as pe,w as de,wa as Me,z as me}from"./chunk-GYDYF5F3.js";import{K as le,M as se,Q as re,f as N,g as O,n as ae,o as P,q as oe,t as B}from"./chunk-PD5VTTIY.js";import{Aa as x,Ba as f,Fc as te,Gc as ie,Hb as R,Hc as ne,Lc as h,Mc as p,Nc as _,Ob as c,Oc as T,Pc as w,Uc as V,Vc as A,Wc as L,Yc as M,_b as r,bc as I,ed as E,fd as Q,gd as D,kc as n,lc as l,mc as g,nc as y,oc as S,qc as b,rb as o,sb as u,wc as v,yc as m}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as Z,b as ee,g as ot}from"./chunk-66YHNWRR.js";var tt=ot(lt());var vt=["filePond"],gt=()=>[];function bt(i,t){i&1&&(n(0,"div",22),g(1,"app-skeleton"),l())}function ht(i,t){i&1&&(n(0,"div",18)(1,"div",19)(2,"div",20),c(3,bt,2,0,"div",21),l()()()),i&2&&(o(3),r("ngForOf",M(1,gt).constructor(10)))}function Ct(i,t){if(i&1){let e=b();n(0,"div",24)(1,"spk-input",33),v("valueChange",function(s){x(e);let d=m(3);return f(d.onAmountCalculate(s))}),l()()}i&2&&(o(),r("label","KM")("fieldReq",!0)("type","number"))}function yt(i,t){if(i&1){let e=b();n(0,"div",23)(1,"div",24),g(2,"spk-flatpickr",25),l(),n(3,"div",24)(4,"spk-ng-select",26),v("selectedChange",function(s){x(e);let d=m(2);return f(d.onSingleSelectChange(s))}),l()(),c(5,Ct,2,3,"div",27),n(6,"div",24)(7,"spk-input",28),v("valueChange",function(s){x(e);let d=m(2);return f(d.onValueChange(s))}),l()(),n(8,"div",24),g(9,"spk-input",29),l(),n(10,"div",30)(11,"button",31),v("click",function(){x(e);let s=m(2);return f(s.addToList())}),g(12,"i",32),l()()()}if(i&2){let e=m(2);o(2),r("fieldReq",!0)("min",e.modalData.expenseDetail.start_date)("max",e.modalData.expenseDetail.end_date),o(2),r("fieldReq",!0)("options",e.expensePolicyType),o(),r("ngIf",e.expenseForm.value.expense_type==="Car"||e.expenseForm.value.expense_type==="Bike"),o(2),r("label","Expense Amount")("fieldReq",!0)("type","number"),o(2),r("label","Description")("fieldReq",!0)("type","textarea")}}function St(i,t){if(i&1){let e=b();n(0,"tr",37)(1,"td",38),p(2),l(),n(3,"td"),p(4),E(5,"date"),l(),n(6,"td"),p(7),l(),n(8,"td"),p(9),l(),n(10,"td"),p(11),l(),n(12,"td",39)(13,"div",40)(14,"app-icon-button",41),v("clickEvent",function(){let s=x(e).index,d=m(3);return f(d.deleteExpense(s))}),l()()()()}if(i&2){let e=t.$implicit,a=t.index,s=m(3);o(2),_(a+1),o(2),_(e.expense_date?D(5,8,e.expense_date,"d MMM yyyy"):"--"),o(3),_(e.expense_type),o(2),w("",s.CURRENCY_SYMBOLS.RUPEE," ",e.expense_amount,""),o(2),_(e.description),o(3),r("icon","ri-delete-bin-line")("buttonClass","ti-btn btn-wave product-btn ti-btn-sm ti-btn-soft-danger waves-effect waves-light")}}function Et(i,t){if(i&1&&(n(0,"div",34)(1,"spk-reusable-tables",35),c(2,St,15,11,"tr",36),l()()),i&2){let e=m(2);o(),r("columns",e.headerColumn)("tableHead","border-b")("showCheckbox",!1),o(),r("ngForOf",e.expenseList)}}function Dt(i,t){if(i&1){let e=b();n(0,"div",5)(1,"app-modal-header",6),v("close",function(){x(e);let s=m();return f(s.closeModal())}),l(),c(2,ht,4,2,"div",7),n(3,"form",8),v("ngSubmit",function(){x(e);let s=m();return f(s.onSubmitExpenseData())}),n(4,"mat-dialog-content",9),c(5,yt,13,12,"div",10)(6,Et,3,4,"div",11),n(7,"div",12)(8,"label",13),p(9,"Upload Bills/Attachment"),n(10,"span",14),p(11,"*"),l()(),n(12,"file-pond",15),v("onremovefile",function(s){x(e);let d=m();return f(d.onFileRemove(s,"image"))})("onprocessfile",function(s){x(e);let d=m();return f(d.onFileProcessed(s,"image"))}),l()()(),n(13,"mat-dialog-actions",16),g(14,"app-button",17),l()()()}if(i&2){let e=m();o(),r("title","Add Expense")("closeBtn",!0),o(),r("ngIf",e.skLoading),o(),r("formGroup",e.expenseForm),o(2),r("ngIf",!e.skLoading),o(),r("ngIf",e.expenseList.length>0),o(6),r("options",e.pondOptions)("files",e.pondFiles),o(2),r("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",e.api.disabled)("formType",e.pageType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}function Mt(i,t){if(i&1&&(n(0,"mat-option",49),p(1),l()),i&2){let e=t.$implicit;r("value",e.name),o(),_(e.name)}}function It(i,t){i&1&&(y(0),p(1,"This field is required"),S())}function wt(i,t){if(i&1&&(n(0,"div",50),c(1,It,2,0,"ng-container",51),l()),i&2){m();let e=h(12);o(),r("ngIf",e.errors==null?null:e.errors.required)}}function Ft(i,t){i&1&&(y(0),p(1,"This field is required"),S())}function Tt(i,t){if(i&1&&(n(0,"div",50),c(1,Ft,2,0,"ng-container",51),l()),i&2){m();let e=h(7);o(),r("ngIf",e.errors==null?null:e.errors.required)}}function kt(i,t){if(i&1){let e=b();n(0,"div",52)(1,"label",13),p(2,"Approved Amount"),n(3,"span",14),p(4,"*"),l()(),n(5,"mat-form-field",44)(6,"input",53,2),L("ngModelChange",function(s){x(e);let d=m(2);return A(d.data.approved_amount,s)||(d.data.approved_amount=s),f(s)}),v("input",function(){x(e);let s=m(2);return f(s.onInputChange(s.data.approved_amount))}),l()(),c(8,Tt,2,1,"div",47),l()}if(i&2){let e=h(7);m();let a=h(3),s=m();o(6),V("ngModel",s.data.approved_amount),o(2),r("ngIf",e.touched||a.submitted)}}function Rt(i,t){i&1&&(y(0),p(1,"This field is required"),S())}function Vt(i,t){if(i&1&&(n(0,"div",50),c(1,Rt,2,0,"ng-container",51),l()),i&2){m();let e=h(7);o(),r("ngIf",e.errors==null?null:e.errors.required)}}function At(i,t){if(i&1){let e=b();n(0,"div",52)(1,"label",13),p(2,"Reject Reason"),n(3,"span",14),p(4,"*"),l()(),n(5,"mat-form-field",54)(6,"textarea",55,3),L("ngModelChange",function(s){x(e);let d=m(2);return A(d.data.reason,s)||(d.data.reason=s),f(s)}),l()(),c(8,Vt,2,1,"div",47),l()}if(i&2){let e=h(7);m();let a=h(3),s=m();o(6),V("ngModel",s.data.reason),o(2),r("ngIf",e.touched||a.submitted)}}function Lt(i,t){if(i&1){let e=b();n(0,"div",5)(1,"app-modal-header",6),v("close",function(){x(e);let s=m();return f(s.closeModal())}),l(),n(2,"form",42,0),v("ngSubmit",function(){x(e);let s=h(3),d=m();return f(s.valid&&d.expenseStatusChange())}),n(4,"mat-dialog-content",9)(5,"div",43)(6,"label",13),p(7,"Status"),n(8,"span",14),p(9,"*"),l()(),n(10,"mat-form-field",44)(11,"mat-select",45,1),L("ngModelChange",function(s){x(e);let d=m();return A(d.data.status,s)||(d.data.status=s),f(s)}),c(13,Mt,2,2,"mat-option",46),l()(),c(14,wt,2,1,"div",47),l(),c(15,kt,9,2,"div",48)(16,At,9,2,"div",48),l(),n(17,"mat-dialog-actions",16),g(18,"app-button",17),l()()()}if(i&2){let e=h(3),a=h(12),s=m();o(),r("title","Change Expense Status")("closeBtn",!0),o(10),V("ngModel",s.data.status),o(2),r("ngForOf",s.expenseStatusOptions),o(),r("ngIf",a.touched||e.submitted),o(),r("ngIf",s.data.status=="Approved"),o(),r("ngIf",s.data.status=="Reject"),o(2),r("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",s.api.disabled)("formType",s.modalData.formType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}var k=class i{constructor(t,e,a,s,d,C,X,it,nt,at){this.modalData=t;this.dialogRef=e;this.api=a;this.toastr=s;this.uploadService=d;this.fb=C;this.formValidation=X;this.dateService=it;this.logService=nt;this.alert=at}CURRENCY_SYMBOLS=j;data={};expenseForm=new J({});eventExpenseForm=new J({});today=new Date;skLoading=!1;expenseList=[];pondFiles=[];pond;pageType="add";submodule;ngOnInit(){this.modalData.lastPage=="expense-modal"&&this.getExpensePolicyType(),this.expenseForm=this.fb.group({expense_date:["",F.required],expense_type:["",F.required],km:[""],expense_type_unit:[""],expense_type_value:[""],expense_amount:[{value:"",disabled:!0},F.required],description:["",F.required]}),this.expenseForm.get("expense_type")?.valueChanges.subscribe(t=>{t==="Car"||t==="Bike"?this.expenseForm.get("km")?.setValidators([F.required]):this.expenseForm.get("km")?.clearValidators()})}expensePolicyType=[];getExpensePolicyType(){this.api.post({user_id:this.modalData.expenseDetail.user_id},"expense/policy").subscribe(t=>{t.statusCode===200&&(this.expensePolicyType=t.data)})}onSingleSelectChange(t){let e=this.expensePolicyType.find(a=>a.value===t);e&&(this.expenseForm.patchValue({expense_type_unit:e.unit}),this.expenseForm.patchValue({expense_type_value:e.unit_value}),this.expenseForm.patchValue({expense_amount:""}),this.expenseForm.patchValue({km:""})),this.expenseForm.value.expense_type_unit!=="km"?this.expenseForm.get("expense_amount")?.enable():this.expenseForm.get("expense_amount")?.disable()}onAmountCalculate(t){let e=this.expensePolicyType.find(a=>a.value===this.expenseForm.value.expense_type);if(e){let a=Number(t)*e.unit_value;this.expenseForm.patchValue({expense_amount:a})}}onValueChange(t){this.expenseForm.value.expense_type_unit==="amount"&&this.expenseForm.value.expense_type_value>0&&t>this.expenseForm.value.expense_type_value&&(this.toastr.warning("Entered amount exceeds the assigned limit i.e. "+this.expenseForm.value.expense_type_value,"","toast-top-right"),this.expenseForm.patchValue({expense_amount:""}))}pondOptions=this.getPondOptions("image");getPondOptions(t){let e={allowFileTypeValidation:!0,labelIdle:"Click or drag files here to upload...",maxFiles:5,server:{process:(a,s,d,C)=>{setTimeout(()=>{C(Date.now().toString())},1e3)},revert:(a,s)=>{s()}}};if(t==="image")return ee(Z({},e),{allowMultiple:!1,acceptedFileTypes:["image/jpeg","image/png","image/jpg"],maxFileSize:"2MB",allowImageValidateSize:!0,labelFileTypeNotAllowed:"Only PNG and JPEG files are allowed",fileValidateTypeLabelExpectedTypes:"Allowed: PNG, JPEG",labelImageValidateSizeTooSmall:"Image is too small. Min: {minWidth}\xD7{minHeight}",labelImageValidateSizeTooBig:"Image is too large. Max: {maxWidth}\xD7{maxHeight}"})}onFileProcessed(t,e){let a=t.file.file;Object.assign(a,{image_type:e}),e==="image"&&(this.pondFiles=[...this.pondFiles||[],a])}onFileRemove(t,e){let a=t.file.file;if(e==="image"){let s=this.pondFiles.findIndex(d=>d.name===a.name&&d.size===a.size);s>-1&&this.pondFiles.splice(s,1)}}addToList(){if(this.expenseForm.invalid){this.expenseForm.markAllAsTouched();return}let t=this.expenseForm.getRawValue(),e=this.dateService.formatToYYYYMMDD(new Date(t.expense_date));if([...this.expenseList||[],...this.modalData?.sub_expense||[]].some(C=>this.dateService.formatToYYYYMMDD(new Date(C.expense_date))===e&&C.expense_type===t.expense_type)){this.toastr.error("Entry with the same date and expense type already exists.","","toast-top-right");return}let d={expense_date:t.expense_date,expense_type:t.expense_type,expense_type_unit:t.expense_type_unit,expense_type_value:t.expense_type_value,km:t.km,expense_amount:t.expense_amount,description:t.description};this.expenseList.push(d),this.expenseForm.reset()}onSubmitExpenseData(){let t=this.modalData.expenseId,a=[...this.modalData.sub_expense||[],...this.expenseList],s={expense_id:t,sub_expense:a};if(this.pondFiles.length===0){this.toastr.error("Please upload at least one file.","","toast-top-right");return}if(this.expenseList.length===0){this.toastr.error("Please upload at least one sub expense.","","toast-top-right");return}this.api.disabled=!0,this.api.post(s,"expense/create-sub-expense").subscribe(d=>{d.statusCode===200&&(this.pondFiles.length>0?(this.api.disabled=!0,this.uploadService.uploadFile(d.data.inserted_id,"expense",this.pondFiles,"Expense Images",this.modalData.subModule,void 0,()=>this.dialogRef.close(!0))):(this.api.disabled=!1,this.toastr.success(d.message,"","toast-top-right"),this.dialogRef.close(!0)))})}deleteExpense(t){this.expenseList.splice(t,1)}closeModal(){this.dialogRef.close()}expenseStatusChange(){this.alert.confirm("Are you sure?","You want to change status","Yes it!").then(t=>{if(t.isConfirmed){this.api.disabled=!0;let e=this.modalData.status,a=this.data.status,d="edit"==="edit";if(d&&this.logService.logActivityOnUpdate(d,{status:e},{status:a},this.modalData?.subModule?.module_id,this.modalData?.subModule?.module_name,"update",this.modalData?.expenseId||null,()=>{},this.modalData?.subModule?.module_type)){this.api.disabled=!1,this.toastr.warning("No changes detected","","toast-top-right");return}this.api.patch({_id:this.modalData.expenseId,status:this.data.status,approved_amount:this.data.approved_amount,reason:this.data.reason},"expense/update-status").subscribe(C=>{C.statusCode===200&&(this.api.disabled=!1,this.toastr.success(C.message,"","toast-top-right"),this.dialogRef.close(!0))})}})}onInputChange(t){t>this.modalData.claim_amount&&(this.toastr.warning("Entered amount should not be greater than the claim amount i.e. "+this.modalData.claim_amount,"","toast-top-right"),this.data.approved_amount="")}headerColumn=[{label:"S.No",table_class:"text-center"},{label:"Expense Date",table_class:""},{label:"Expense Type",table_class:""},{label:"Expense Amount",table_class:""},{label:"Description",table_class:""},{label:"Action",table_class:"text-center"}];expenseStatusOptions=[{name:"Submitted"},{name:"Approved"},{name:"Paid"},{name:"Reject"}];static \u0275fac=function(e){return new(e||i)(u(Fe),u(we),u(q),u(de),u(Ke),u(Ce),u(Ye),u(H),u(K),u(Y))};static \u0275cmp=R({type:i,selectors:[["app-expense-modal"]],viewQuery:function(e,a){if(e&1&&te(vt,5),e&2){let s;ie(s=ne())&&(a.pond=s.first)}},decls:2,vars:2,consts:[["f","ngForm"],["status","ngModel"],["approved_amount","ngModel"],["reason","ngModel"],["class","mat-dialoge",4,"ngIf"],[1,"mat-dialoge"],[3,"close","title","closeBtn"],["class","box",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"mat-typography","py-1"],["class","grid grid-cols-12 sm:gap-x-6",4,"ngIf"],["class","table-responsive overflow-auto table-bordered-default mt-4 mb-4",4,"ngIf"],[1,"xl:col-span-6","col-span-12"],[1,"form-label","mb-0"],[1,"text-red-500"],[1,"filepond","basic-filepond",3,"onremovefile","onprocessfile","options","files"],["align","end",1,"gap-2"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","gap-x-6"],["class","xl:col-span-3 col-span-12 mb-4",4,"ngFor","ngForOf"],[1,"xl:col-span-3","col-span-12","mb-4"],[1,"grid","grid-cols-12","sm:gap-x-6"],[1,"xl:col-span-4","col-span-12"],["placeholder","Expense Date","label","Expense Date","formControlName","expense_date",1,"form-control","custom-datepickr",3,"fieldReq","min","max"],["formControlName","expense_type","label","Expense Type",3,"selectedChange","fieldReq","options"],["class","xl:col-span-4 col-span-12",4,"ngIf"],["formControlName","expense_amount",1,"remove-default-class",3,"valueChange","label","fieldReq","type"],["formControlName","description",1,"remove-default-class",3,"label","fieldReq","type"],[1,"flex","justify-end","mt-6"],["type","button","aria-label","button",1,"ti-btn","ti-btn-icon","ti-btn-primary","btn-wave",3,"click"],[1,"ri-add-line"],["formControlName","km",1,"remove-default-class",3,"valueChange","label","fieldReq","type"],[1,"table-responsive","overflow-auto","table-bordered-default","mt-4","mb-4"],["tableClass","ti-custom-table ti-custom-table-head ti-custom-table-hover ti-head-primary whitespace-nowrap",3,"columns","tableHead","showCheckbox"],["class","product-list border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[1,"product-list","border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"w60","text-center"],[1,"w60","relative"],[1,"flex","flex-row","items-center","!gap-2","text-[0.9375rem]"],[3,"clickEvent","icon","buttonClass"],[3,"ngSubmit"],[1,""],[1,"mat-custom-field","remove-space"],["placeholder","Select an option","name","status","required","",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["class","mt-1 text-xs text-red-500 text-right",4,"ngIf"],["class","mt-2",4,"ngIf"],[3,"value"],[1,"mt-1","text-xs","text-red-500","text-right"],[4,"ngIf"],[1,"mt-2"],["type","number","matInput","","placeholder","Type Here ...","name","approved_amount","required","",3,"ngModelChange","input","ngModel"],[1,"mat-custom-field","remove-space","text-area-height"],["matInput","","placeholder","Type Here ...","name","reason","required","",3,"ngModelChange","ngModel"]],template:function(e,a){e&1&&c(0,Dt,15,14,"div",4)(1,Lt,19,13,"div",4),e&2&&(r("ngIf",a.modalData.lastPage==="expense-modal"),o(),r("ngIf",a.modalData.lastPage==="expense-status-modal"))},dependencies:[Se,fe,me,ve,ce,ue,he,ge,be,Ae,De,Re,ke,Ie,Me,Ve,W,N,O,xe,_e,Ue,Le,U,Ge,z,P,B,ye,Be,G,Pe,Oe,Ne],encapsulation:2})};var Nt=()=>["Expense"],$=()=>[];function Ot(i,t){if(i&1){let e=b();n(0,"a",25),v("click",function(){x(e);let s=m(2);return f(s.updateStatus())}),n(1,"i",26),p(2,"edit"),l()()}}function Pt(i,t){if(i&1&&(n(0,"div",16)(1,"div")(2,"span",19),p(3),l(),n(4,"span",18),p(5,"Approved Amount"),l()()()),i&2){let e=m(2);o(3),w("",e.CURRENCY_SYMBOLS.RUPEE," ",(e.Detail==null?null:e.Detail.approved_amount)||"---","")}}function Bt(i,t){if(i&1&&(n(0,"div",16)(1,"div")(2,"span",17),p(3),E(4,"titlecase"),l(),n(5,"span",18),p(6,"Updated By"),l()()()),i&2){let e=m(2);o(3),_(e.Detail!=null&&e.Detail.updated_name?Q(4,1,e.Detail==null?null:e.Detail.updated_name):"---")}}function jt(i,t){if(i&1&&(n(0,"div",16)(1,"div")(2,"span",17),p(3),l(),n(4,"span",18),p(5),l()()()),i&2){let e=t.$implicit;o(3),_(e.value),o(2),_(e.key)}}function qt(i,t){if(i&1&&(n(0,"div",16)(1,"div")(2,"div")(3,"span",17),p(4),l(),n(5,"span",18),p(6,"Reject Reason"),l()()()()),i&2){let e=m(2);o(4),_((e.Detail==null?null:e.Detail.reason)||"---")}}function Yt(i,t){if(i&1&&(n(0,"div")(1,"div",15)(2,"div",16)(3,"div")(4,"span",17),p(5),E(6,"date"),l(),n(7,"span",18),p(8,"Created At"),l()()(),n(9,"div",16)(10,"div")(11,"span",17),p(12),l(),n(13,"span",18),p(14,"Created By"),l()()(),n(15,"div",16)(16,"div")(17,"span",17),p(18),l(),n(19,"span",18),p(20,"Expense Id"),l()()(),n(21,"div",16)(22,"div")(23,"span",17),p(24),l(),n(25,"span",18),p(26,"Expense Type"),l()()(),n(27,"div",16)(28,"div")(29,"span",17),p(30),E(31,"date"),l(),n(32,"span",18),p(33,"Expense Start"),l()()(),n(34,"div",16)(35,"div")(36,"span",17),p(37),E(38,"date"),l(),n(39,"span",18),p(40,"Expense End"),l()()(),n(41,"div",16)(42,"div")(43,"span",19),p(44),l(),n(45,"span",18),p(46,"Claim Amount"),l()()(),n(47,"div",16)(48,"div")(49,"span",17),p(50),l(),n(51,"span",18),p(52,"Total Item"),l()()(),n(53,"div",16)(54,"div")(55,"span",20),p(56),c(57,Ot,3,0,"a",21),l(),n(58,"span",18),p(59,"Status"),l()()(),c(60,Pt,6,2,"div",22)(61,Bt,7,3,"div",22),n(62,"div",16)(63,"div")(64,"span",17),p(65),E(66,"date"),l(),n(67,"span",18),p(68,"Updated At"),l()()(),c(69,jt,6,2,"div",23),E(70,"keyvalue"),n(71,"div",16)(72,"div")(73,"span",17),p(74),l(),n(75,"span",24),p(76,"Description"),l()()(),c(77,qt,7,1,"div",22),l()()),i&2){let e=m();o(5),_(e.Detail!=null&&e.Detail.created_at?D(6,17,e.Detail==null?null:e.Detail.created_at,"d MMM yyyy, hh:mm a"):"---"),o(7),_((e.Detail==null?null:e.Detail.created_name)||"---"),o(6),_((e.Detail==null?null:e.Detail.expense_id)||"---"),o(6),_((e.Detail==null?null:e.Detail.expense_type)||"---"),o(6),_(e.Detail!=null&&e.Detail.start_date?D(31,20,e.Detail==null?null:e.Detail.start_date,"d MMM yyyy"):"---"),o(7),_(e.Detail!=null&&e.Detail.end_date?D(38,23,e.Detail==null?null:e.Detail.end_date,"d MMM yyyy"):"---"),o(7),w("",e.CURRENCY_SYMBOLS.RUPEE," ",(e.Detail==null?null:e.Detail.claim_amount)||"---",""),o(6),_((e.Detail==null?null:e.Detail.total_item)||"---"),o(6),T("",(e.Detail==null?null:e.Detail.status)||"--"," "),o(),r("ngIf",e.accessRight==null?null:e.accessRight.approveRight),o(3),r("ngIf",e.Detail==null?null:e.Detail.approved_amount),o(),r("ngIf",e.Detail==null?null:e.Detail.updated_name),o(4),_(e.Detail!=null&&e.Detail.updated_at?D(66,26,e.Detail==null?null:e.Detail.updated_at,"d MMM yyyy, hh:mm a"):"---"),o(4),r("ngForOf",Q(70,29,e.formattedKeysFormData)),o(5),_((e.Detail==null?null:e.Detail.description)||"---"),o(3),r("ngIf",e.Detail==null?null:e.Detail.reason)}}function Ut(i,t){i&1&&(n(0,"div",29),g(1,"app-skeleton"),l()),i&2&&(o(),I("w180"))}function Ht(i,t){i&1&&(n(0,"div")(1,"div",27),c(2,Ut,2,2,"div",28),l()()),i&2&&(o(2),r("ngForOf",M(1,$).constructor(10)))}function Gt(i,t){if(i&1){let e=b();n(0,"app-icon-button",37),v("clickEvent",function(){x(e);let s=m().$implicit,d=m(2);return f(d.delete(s._id,"expense/delete-sub-expense","Sub Expense"))}),l()}i&2&&r("icon","ri-delete-bin-line")("buttonClass","ti-btn btn-wave product-btn ti-btn-sm ti-btn-soft-danger waves-effect waves-light")}function Wt(i,t){if(i&1&&(n(0,"tr")(1,"td",31),p(2),l(),n(3,"td")(4,"span"),p(5),E(6,"date"),l()(),n(7,"td")(8,"span"),p(9),l()(),n(10,"td",32)(11,"span"),p(12),l()(),n(13,"td")(14,"span",33),p(15),l()(),n(16,"td",34)(17,"div",35),c(18,Gt,1,2,"app-icon-button",36),l()()()),i&2){let e=t.$implicit,a=t.index,s=m(2);o(2),_(a+1),o(3),T(" ",e.expense_date?D(6,7,e.expense_date,"d MMM yyyy"):"---",""),o(4),T(" ",e.expense_type||"---",""),o(3),w("",s.CURRENCY_SYMBOLS.RUPEE," ",e.expense_amount||"---",""),o(3),T(" ",e.description||"---",""),o(3),r("ngIf",(s.accessRight==null?null:s.accessRight.deleteRight)&&(s.Detail==null?null:s.Detail.status)==="Draft")}}function Kt(i,t){if(i&1&&(y(0),c(1,Wt,19,10,"tr",30),S()),i&2){let e=m();o(),r("ngForOf",e.subExpenseDetail)}}function zt(i,t){i&1&&(n(0,"td"),g(1,"app-skeleton"),l()),i&2&&(o(),I("h20 bg-skeleton"))}function Qt(i,t){i&1&&(n(0,"tr",39),c(1,zt,2,2,"td",30),l()),i&2&&(o(),r("ngForOf",M(1,$).constructor(6)))}function Jt(i,t){i&1&&(y(0),c(1,Qt,2,2,"tr",38),S()),i&2&&(o(),r("ngForOf",M(1,$).constructor(8)))}function $t(i,t){i&1&&(y(0),g(1,"app-data-not-found"),S())}function Xt(i,t){if(i&1){let e=b();n(0,"div",42)(1,"spk-product-card",43),v("delete",function(){let s=x(e).$implicit,d=m(2);return f(d.delete(s._id,"expense/delete-file","delete"))}),l()()}if(i&2){let e=t.$implicit,a=m(2);o(),r("apiPath","expense/get-doc")("imageData",e)("editBtn",!1)("heading",!1)("subHeading",!1)("delBtn",(a.accessRight==null?null:a.accessRight.deleteRight)&&(a.Detail==null?null:a.Detail.status)==="Draft")}}function Zt(i,t){if(i&1&&(n(0,"div",40),y(1),c(2,Xt,2,6,"div",41),S(),l()),i&2){let e=m();o(2),r("ngForOf",e.Detail==null?null:e.Detail.files)}}function ei(i,t){i&1&&(y(0),g(1,"app-data-not-found"),S())}var et=class i{constructor(t,e,a,s,d,C,X,it,nt,at,ti){this.lightbox=t;this.router=e;this.alert=a;this.route=s;this.api=d;this.toastr=C;this.moduleService=X;this.logService=it;this.dialog=nt;this.dateService=at;this.comanFuncation=ti}CURRENCY_SYMBOLS=j;FORMID=We;logList=[];Detail;subExpenseDetail=[];formattedKeysFormData={};formattedKeysRecentActivities={};expenseDetailFormData;skLoading=!1;subModule={};accessRight={};expenseId;ngOnInit(){let t=this.moduleService.getAccessMap("SFA","Expense");t&&(this.accessRight=t);let e=this.moduleService.getSubModuleByName("SFA","Expense");e&&(this.subModule=e),this.route.paramMap.subscribe(a=>{this.expenseId=a.get("id"),this.expenseId&&this.getexpenseDetail()})}subExpenseColumns=[{label:"Expense Date"},{label:"Expense Title"},{label:"Expense Amount",table_class:"text-right"},{label:"Description"}];getexpenseDetail(){this.skLoading=!0,this.api.post({_id:this.expenseId},"expense/detail").subscribe(t=>{t.statusCode===200&&(this.skLoading=!1,this.Detail=t.data,this.subExpenseDetail=t.data.sub_expense,this.expenseDetailFormData=t.data.form_data,this.formattedKeysFormData=this.formatAndPrintFormData(this.expenseDetailFormData),this.logService.getLogs(this.subModule.module_id,e=>{this.logList=e},this.expenseId?this.expenseId:"",this.subModule.module_type))})}delete(t,e,a){this.comanFuncation.delete(t,this.subModule,a,e,"single_action",this.expenseId).subscribe(s=>{s===!0&&this.getexpenseDetail()})}formatAndPrintFormData(t){let e={};for(let a in t)if(t.hasOwnProperty(a)){let s=a.split("_").map(d=>d.charAt(0).toUpperCase()+d.slice(1)).join(" ");e[s]=t[a]}return e}onDeleteImage(t){this.api.disabled=!0,this.alert.confirm("Are you sure you want to delete this?","Once deleted, this item cannot be restored.","Delete it!").then(e=>{e.isConfirmed&&this.api.patch({_id:this.expenseId,file_id:t.file_id,file_path:t.filepath},"expense/delete-file").subscribe(a=>{a.statusCode===200&&(this.api.disabled=!1,tt.default.fire("Deleted!",a.message,"success"),this.logService.logActivityOnDelete(this.subModule.module_id,this.subModule.module_name,"delete",t.file_id),this.getexpenseDetail())})})}updateStatus(){this.dialog.open(k,{width:"450px",data:{lastPage:"expense-status-modal",expenseId:this.expenseId,status:this.Detail.status,approved_amount:this.Detail.approved_amount,reason:this.Detail.reason,claim_amount:this.Detail.claim_amount,subModule:this.subModule}}).afterClosed().subscribe(e=>{e===!0&&this.getexpenseDetail()})}addExpenseModal(){this.dialog.open(k,{width:"800px",data:{lastPage:"expense-modal",expenseId:this.expenseId,status:this.Detail.status,expenseDetail:this.Detail,subModule:this.subModule,sub_expense:this.Detail.sub_expense}}).afterClosed().subscribe(e=>{e===!0&&this.getexpenseDetail()})}deleteSubExpense(t,e,a){this.comanFuncation.delete(t,this.subModule,a,e,"single_action",this.expenseId).subscribe(s=>{s===!0&&this.getexpenseDetail()})}static \u0275fac=function(e){return new(e||i)(u(Xe),u(se),u(Y),u(le),u(q),u(pe),u(Ee),u(K),u(Te),u(H),u(ze))};static \u0275cmp=R({type:i,selectors:[["app-expense-detail"]],decls:21,vars:43,consts:[[3,"title","title1","activeitem","buttonText","icon","icon1"],[1,"grid","grid-cols-12","gap-x-6"],[1,"xxl:col-span-8","xl:col-span-8","lg:col-span-8","md:col-span-7","col-span-12"],[3,"title","titleView","classbody"],[4,"ngIf"],[1,"grid","grid-cols-12","sm:gap-x-6"],[1,"xl:col-span-12","col-span-12"],[3,"btnClick","title","titleView","iconClass","boxHeader","classbody","btn1","iconName","buttonName"],[1,"table-responsive","table-bordered-default"],["tableClass","ti-custom-table ti-custom-table-hover ti-head-primary",3,"columns","tableHead","showS_No","showAction"],[1,"xxl:col-span-4","xl:col-span-4","lg:col-span-4","md:col-span-5","col-span-12"],[3,"logList","scrollHeight","closeBtn"],[1,"xl:col-span-4","col-span-12"],[3,"title","titleView","iconClass","classbody","iconName"],["class","grid grid-cols-12 gap-x-4",4,"ngIf"],[1,"flex","gap-6","mb-1","flex-wrap","text-[11px]"],[1,"flex","items-center","gap-2"],[1,"block","font-medium"],[1,"text-xs","text-textmuted","dark:text-textmuted/50"],[1,"block","font-medium","text-right"],[1,"flex","items-center","block","font-medium","badge","bg-info/10","text-info"],["class","text-info font-medium",3,"click",4,"ngIf"],["class","flex items-center gap-2",4,"ngIf"],["class","flex items-center gap-2",4,"ngFor","ngForOf"],[1,"text-xs","text-textmuted","dark:text-textmuted/50","ellipsis"],[1,"text-info","font-medium",3,"click"],[1,"material-icons","ms-1"],[1,"flex","gap-2","mb-1","flex-wrap"],["class","flex items-center",4,"ngFor","ngForOf"],[1,"flex","items-center"],[4,"ngFor","ngForOf"],[1,"text-center"],[1,"text-right"],[1,"ellipsis"],[1,"w60","relative"],[1,"flex","flex-row","items-center","!gap-2","text-[0.9375rem]"],[3,"icon","buttonClass","clickEvent",4,"ngIf"],[3,"clickEvent","icon","buttonClass"],["class","border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[1,"border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"grid","grid-cols-12","gap-x-4"],["class","xxl:col-span-4 lg:col-span-3 xl:col-span-4 sm:col-span-6 col-span-12",4,"ngFor","ngForOf"],[1,"xxl:col-span-4","lg:col-span-3","xl:col-span-4","sm:col-span-6","col-span-12"],[3,"delete","apiPath","imageData","editBtn","heading","subHeading","delBtn"]],template:function(e,a){e&1&&(g(0,"app-page-header",0),n(1,"div",1)(2,"div",2)(3,"app-showcode-card",3),c(4,Yt,78,31,"div",4)(5,Ht,3,2,"div",4),l(),n(6,"div",5)(7,"div",6)(8,"div",2)(9,"app-showcode-card",7),v("btnClick",function(){return a.addExpenseModal()}),n(10,"div",8)(11,"spk-reusable-tables",9),c(12,Kt,2,1,"ng-container",4)(13,Jt,2,2,"ng-container",4),l(),c(14,$t,2,0,"ng-container",4),l()()()()()(),n(15,"div",10),g(16,"app-logs",11),n(17,"div",12)(18,"app-showcode-card",13),c(19,Zt,3,1,"div",14)(20,ei,2,0,"ng-container",4),l()()()()),e&2&&(r("title","SFA Modules")("title1",M(42,Nt))("activeitem","Expense Details")("buttonText","Filter")("icon","filter_list")("icon1","add"),o(3),I("box-title font-medium text-[15px] block text-primarytint1color"),r("title","Basic Detail")("titleView",!0)("classbody","pt-0"),o(),r("ngIf",!a.skLoading),o(),r("ngIf",a.skLoading),o(4),I("box-title font-medium text-[15px] block text-primarytint1color"),r("title","Expense Detail")("titleView",!0)("iconClass","ti-btn btn-wave ti-btn-sm ti-btn-soft-primary waves-effect waves-light")("boxHeader","py-1")("classbody","pt-0")("btn1",(a.accessRight==null?null:a.accessRight.addRight)&&(a.Detail==null?null:a.Detail.status)==="Draft")("iconName","ri-draft-line")("buttonName","Add New"),o(2),r("columns",a.subExpenseColumns)("tableHead","border-b")("showS_No",!0)("showAction",!0),o(),r("ngIf",!a.skLoading),o(),r("ngIf",a.skLoading),o(),r("ngIf",a.subExpenseDetail.length===0&&!a.skLoading),o(2),r("logList",a.logList)("scrollHeight","250")("closeBtn",!1),o(2),I("box-title font-medium text-[15px] block text-primarytint1color"),r("title","Attachments")("titleView",!0)("iconClass","ti-btn btn-wave ti-btn-sm ti-btn-soft-primary waves-effect waves-light")("classbody","pt-0")("iconName","ri-add-line"),o(),r("ngIf",(a.Detail==null?null:a.Detail.files.length)>0),o(),r("ngIf",(a.Detail==null?null:a.Detail.files.length)===0))},dependencies:[W,N,O,Je,U,je,z,qe,ae,P,oe,re,He,Ze,$e,B,G,Qe],encapsulation:2})};export{et as ExpenseDetailComponent};
