import{a as K}from"./chunk-PU6S26UW.js";import{a as A}from"./chunk-CNF4GSI7.js";import{C as Y,F as $,g as z,j as L,k as U,r as H,v as J,w as W}from"./chunk-VHE3PQ3O.js";import{A as v,B as M,C as I,H as V,M as R,Oa as G,P as w,Pa as N,Ra as E,Ta as B,Ua as q,V as D,X as P,Z as j,hb as O,w as T}from"./chunk-GYDYF5F3.js";import{g as k,t as x}from"./chunk-PD5VTTIY.js";import{Aa as c,Ba as u,Hb as y,Mc as C,Ob as _,_b as a,kc as l,lc as m,mc as f,qc as b,rb as n,sb as p,wc as g,yc as d}from"./chunk-2NSPOFEK.js";import{a as h,b as S}from"./chunk-66YHNWRR.js";function X(r,o){if(r&1){let e=b();l(0,"div",6)(1,"label",12),C(2,"Upload Bill Copy "),l(3,"span",13),C(4,"*"),m()(),l(5,"file-pond",14),g("onremovefile",function(i){c(e);let s=d(2);return u(s.onFileRemove(i,"image"))})("onprocessfile",function(i){c(e);let s=d(2);return u(s.onFileProcessed(i,"image"))}),m()()}if(r&2){let e=d(2);n(5),a("options",e.getPondOptions("image"))("files",e.pondImages)}}function Z(r,o){r&1&&(l(0,"div",6),f(1,"spk-input",15),m()),r&2&&(n(),a("fieldReq",!0))}function ee(r,o){if(r&1){let e=b();l(0,"div",1)(1,"app-modal-header",2),g("close",function(){c(e);let i=d();return u(i.closeModal())}),m(),l(2,"form",3),g("ngSubmit",function(){c(e);let i=d();return u(i.onSubmit())}),l(3,"mat-dialog-content",4)(4,"div",5)(5,"div",6),f(6,"spk-ng-select",7),m(),_(7,X,6,2,"div",8)(8,Z,2,1,"div",8),m()(),l(9,"mat-dialog-actions",9),f(10,"app-button",10)(11,"app-button",11),m()()()}if(r&2){let e,t,i=d();n(),a("title","Update Grn Status")("closeBtn",!0),n(),a("formGroup",i.stockForm),n(4),a("fieldReq",!0)("options",i.statusList)("multiple",!1),n(),a("ngIf",((e=i.stockForm.get("grn_status"))==null?null:e.value)==="Received"),n(),a("ngIf",((t=i.stockForm.get("grn_status"))==null?null:t.value)==="Reject"),n(2),a("buttonType","button")("buttonClass","ti-btn ti-btn-outline-danger m-2")("label","Cancel"),n(),a("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",i.api.disabled)("formType","add")("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}function te(r,o){r&1&&(l(0,"div",6),f(1,"spk-input",15),m()),r&2&&(n(),a("fieldReq",!0))}function ie(r,o){if(r&1){let e=b();l(0,"div",1)(1,"app-modal-header",2),g("close",function(){c(e);let i=d();return u(i.closeModal())}),m(),l(2,"form",3),g("ngSubmit",function(){c(e);let i=d();return u(i.submitStatus())}),l(3,"mat-dialog-content",4)(4,"div",5)(5,"div",6),f(6,"spk-ng-select",16),m(),_(7,te,2,1,"div",8),m()(),l(8,"mat-dialog-actions",9),f(9,"app-button",10)(10,"app-button",11),m()()()}if(r&2){let e,t=d();n(),a("title","Update Status")("closeBtn",!0),n(),a("formGroup",t.statusForm),n(4),a("fieldReq",!0)("options",t.stockStatusList)("multiple",!1),n(),a("ngIf",((e=t.statusForm.get("status"))==null?null:e.value)==="Reject"),n(2),a("buttonType","button")("buttonClass","ti-btn ti-btn-outline-danger m-2")("label","Cancel"),n(),a("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",t.api.disabled)("formType","add")("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}var Q=class r{constructor(o,e,t,i,s,F,oe,ae){this.toastr=o;this.api=e;this.formValidation=t;this.fb=i;this.uploadService=s;this.commonApi=F;this.modalData=oe;this.dialogRef=ae}skLoading=!1;stockForm;statusForm;today=new Date;pondPdf=[];pondImages=[];pondOptions=this.getPondOptions("image");pondDocumentOptions=this.getPondOptions("pdf");pondFiles=[];statusList=[{label:"Received",value:"Received"},{label:"Reject",value:"Reject"}];stockStatusList=[{label:"Approved",value:"Approved"},{label:"Reject",value:"Reject"}];ngOnInit(){this.stockForm=this.fb.group({grn_status:["",v.required],remarks:[""]}),this.statusForm=this.fb.group({status:["",v.required],remarks:[""]}),this.stockForm.get("grn_status")?.valueChanges.subscribe(o=>{let e=this.stockForm.get("remarks");o==="Reject"?e?.setValidators([v.required]):e?.clearValidators(),e?.updateValueAndValidity()}),this.stockForm.get("status")?.valueChanges.subscribe(o=>{let e=this.stockForm.get("remarks");o==="Reject"?e?.setValidators([v.required]):e?.clearValidators(),e?.updateValueAndValidity()})}closeModal(){this.dialogRef.close()}getPondOptions(o){let e={allowFileTypeValidation:!0,allowFileSizeValidation:!0,labelIdle:"Click or drag files here to upload...",server:{process:(t,i,s,F)=>{setTimeout(()=>{F(Date.now().toString())},1e3)},revert:(t,i)=>{i()}}};return o==="image"?S(h({},e),{allowMultiple:!0,acceptedFileTypes:["image/jpeg","image/png","image/jpg","application/pdf"],maxFiles:2,allowImageValidateSize:!0,labelFileTypeNotAllowed:"Only PNG, JPEG, or PDF files are allowed",fileValidateTypeLabelExpectedTypes:"Allowed: PNG, JPEG, PDF",labelImageValidateSizeTooSmall:"Image is too small. Min: {minWidth}\xD7{minHeight}",labelImageValidateSizeTooBig:"Image is too large. Max: {maxWidth}\xD7{maxHeight}",fileValidateFunction:t=>{let i=t.type==="application/pdf",s=i?1*1024*1024:2*1024*1024;return t.size>s?Promise.reject(`Max size exceeded: ${i?"10MB for PDF":"2MB for images"}`):Promise.resolve()}}):S(h({},e),{allowMultiple:!1,maxFiles:2,acceptedFileTypes:["application/pdf"],maxFileSize:"10MB",labelFileTypeNotAllowed:"Only PDF files are allowed",fileValidateTypeLabelExpectedTypes:"Allowed: PDF"})}onFileProcessed(o,e){let t=o.file.file;Object.assign(t,{image_type:e}),e==="image"?this.pondImages=[...this.pondImages||[],t]:e==="pdf"&&(this.pondPdf=[...this.pondPdf||[],t])}onFileRemove(o,e){let t=o.file.file;if(e==="image"){let i=this.pondImages.findIndex(s=>s.name===t.name&&s.size===t.size);i>-1&&this.pondImages.splice(i,1)}else if(e==="pdf"){let i=this.pondPdf.findIndex(s=>s.name===t.name&&s.size===t.size);i>-1&&this.pondPdf.splice(i,1)}}onSubmit(){if(this.stockForm.valid){if(this.stockForm.value._id=this.modalData._id,this.stockForm.value.grn_status==="Received"&&(this.pondFiles=[...this.pondImages,...this.pondPdf],this.pondFiles.length===0)){this.toastr.error("Bill image is required","","toast-top-right");return}this.api.disabled=!0,this.api.patch(this.stockForm.value,"invoice/status").subscribe(o=>{o.statusCode==200&&(this.pondFiles.length>0?(this.uploadService.uploadFile(this.modalData._id,"invoice",this.pondFiles,"GRN Bill Copy",this.modalData.submodule,void 0,()=>this.dialogRef.close(!0)),this.api.disabled=!1):(this.api.disabled=!1,this.toastr.success(o.message,"","toast-top-right"),this.dialogRef.close(!0)))})}else this.formValidation.markFormGroupTouched(this.stockForm)}submitStatus(){this.statusForm.valid?(this.api.disabled=!0,this.statusForm.value._id=this.modalData._id,this.api.patch(this.statusForm.value,"stock-transfer/status").subscribe(o=>{o.statusCode==200&&(this.api.disabled=!1,this.toastr.success(o.message,"","toast-top-right"),this.dialogRef.close(!0))})):this.formValidation.markFormGroupTouched(this.statusForm)}static \u0275fac=function(e){return new(e||r)(p(T),p(j),p(J),p(D),p(K),p(A),p(N),p(G))};static \u0275cmp=y({type:r,selectors:[["app-stock-transfer-modal"]],decls:2,vars:2,consts:[["class","mat-dialoge",4,"ngIf"],[1,"mat-dialoge"],[3,"close","title","closeBtn"],[3,"ngSubmit","formGroup"],[1,"mat-typography"],[1,"grid","grid-cols-12","sm:gap-x-6","gap-y-5"],[1,"xxl:col-span-12","xl:col-span-12","lg:col-span-12","md:col-span-12","col-span-12"],["formControlName","grn_status","label","Grn Status",3,"fieldReq","options","multiple"],["class","xxl:col-span-12 xl:col-span-12 lg:col-span-12 md:col-span-12 col-span-12",4,"ngIf"],["align","end"],["mat-dialog-close","",3,"buttonType","buttonClass","label"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],[1,"form-label","mb-0"],[1,"text-red-500"],[1,"filepond","basic-filepond",3,"onremovefile","onprocessfile","options","files"],["label","Remark","formControlName","remarks","type","textarea",1,"remove-default-class",3,"fieldReq"],["formControlName","status","label","Status",3,"fieldReq","options","multiple"]],template:function(e,t){e&1&&_(0,ee,12,17,"div",0)(1,ie,11,16,"div",0),e&2&&(a("ngIf",t.modalData.pageType==="grn_stock"),n(),a("ngIf",t.modalData.pageType==="customer_stock"))},dependencies:[W,z,$,k,V,M,I,R,w,Y,O,E,q,B,x,P,H,U,L],encapsulation:2})};export{Q as a};
