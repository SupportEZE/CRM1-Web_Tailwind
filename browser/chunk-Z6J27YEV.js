import{a as X}from"./chunk-CNF4GSI7.js";import{a as ce}from"./chunk-GLWQGYBC.js";import{B as ae,C as se,F as le,c as Z,g as ie,h as oe,v as ne,w as re}from"./chunk-VHE3PQ3O.js";import{A as f,B as O,C as G,D as j,H as $,I as L,M as H,N as U,O as Y,P as z,V as J,W as K,X as Q,Z as W,hb as ee,jb as te,o as R,w as q,z as M}from"./chunk-GYDYF5F3.js";import{M as P,Q as B,e as V,f as E,g as I,t as T}from"./chunk-PD5VTTIY.js";import{Aa as v,Ba as g,Hb as A,Mc as m,Nc as C,Ob as _,Oc as N,Yc as F,_b as s,bc as x,kc as l,lc as c,mc as b,nc as k,oc as D,qc as y,rb as n,sb as u,wc as h,yc as p}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as w}from"./chunk-66YHNWRR.js";var pe=()=>["Bonus"],me=()=>[];function ue(r,t){r&1&&(l(0,"div",7),b(1,"app-skeleton"),c())}function _e(r,t){r&1&&(l(0,"div",3)(1,"div",4)(2,"div",5),_(3,ue,2,0,"div",6),c()()()),r&2&&(n(3),s("ngForOf",F(1,me).constructor(10)))}function fe(r,t){if(r&1){let e=y();l(0,"div",28)(1,"input",29),h("change",function(){let a=v(e).$implicit,d=p(2);return g(d.toggleStateSelection(a))}),c(),l(2,"span",30),m(3),c()()}if(r&2){let e=t.$implicit;n(),s("value",e.value),n(2),C(e.label)}}function ve(r,t){if(r&1){let e=y();l(0,"div",28)(1,"input",36),h("change",function(){let a=v(e).$implicit,d=p().$implicit,o=p(3);return g(o.toggleDistrictSelection(a,d))}),c(),l(2,"span",30),m(3),c()()}if(r&2){let e=t.$implicit;n(),s("checked",e.sel)("value",e.value),n(2),C(e.label)}}function ge(r,t){if(r&1){let e=y();k(0),l(1,"div",33)(2,"input",34),h("change",function(a){let d=v(e).$implicit,o=p(3);return g(o.selectAll(a,d))}),c(),l(3,"h6",35),m(4),c()(),_(5,ve,4,3,"div",19),D()}if(r&2){let e=t.$implicit,i=p(3);n(2),s("checked",i.selectAllChecked[e]),n(),s("ngClass",i.selectAllChecked[e]?"text-primary":"text-primarytint1color"),n(),N(" Districts of ",e,""),n(),s("ngForOf",i.stateDistricts[e])}}function be(r,t){if(r&1&&(l(0,"app-showcode-card",16)(1,"div",31),_(2,ge,6,4,"ng-container",32),c()()),r&2){let e=p(2);x("box-title font-medium text-[15px] block text-primarytint1color"),s("title","Select Districts")("titleView",!0)("iconClass","ti-btn btn-wave ti-btn-sm ti-btn-soft-primary waves-effect waves-light")("classbody","pt-0")("iconName","ri-add-line"),n(2),s("ngForOf",e.selectedStates)}}function he(r,t){if(r&1&&(l(0,"tr",37)(1,"td",23),m(2),c(),l(3,"td",23),m(4),c(),l(5,"td"),b(6,"input",38),c()()),r&2){let e=t.$implicit,i=t.index;s("formGroupName",i),n(2),C(i+1),n(2),C(e.value.point_category_name)}}function ye(r,t){if(r&1){let e=y();l(0,"div",8)(1,"form",9),h("ngSubmit",function(){v(e);let a=p();return g(a.onSubmit())}),l(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",10)(6,"spk-ng-select",11),h("selectedChange",function(a){v(e);let d=p();return g(d.findName(a))}),c()(),l(7,"div",10),b(8,"spk-input",12),c(),l(9,"div",10)(10,"spk-flatpickr",13),h("dateChange",function(){v(e);let a=p();return g(a.onDateChange())}),c()(),l(11,"div",10),b(12,"spk-flatpickr",14),c()(),l(13,"div",15)(14,"app-showcode-card",16)(15,"div",17)(16,"div",18),_(17,fe,4,2,"div",19),c()()(),_(18,be,3,8,"app-showcode-card",20),l(19,"app-showcode-card",16)(20,"table",21)(21,"thead")(22,"tr",22)(23,"th",23),m(24,"S.No"),c(),l(25,"th",23),m(26,"Point Category"),c(),l(27,"th",23),m(28,"Additional Points"),c()()(),l(29,"tbody",24),_(30,he,7,3,"tr",25),c()()()(),l(31,"div",26),b(32,"app-button",27),c()()()()()}if(r&2){let e=p();n(),s("formGroup",e.bonusForm),n(5),s("multiple",!0)("fieldReq",!0)("options",e.commonApi.customerCategorySubType),n(2),s("fieldReq",!0),n(2),s("fieldReq",!0)("min",e.today),n(2),s("min",e.bonusForm.value.start_date)("fieldReq",!0),n(2),x("box-title font-medium text-[15px] block text-primarytint1color"),s("title","Select States")("titleView",!0)("iconClass","ti-btn btn-wave ti-btn-sm ti-btn-soft-primary waves-effect waves-light")("classbody","pt-0")("iconName","ri-add-line"),n(3),s("ngForOf",e.commonApi.statList),n(),s("ngIf",e.selectedStates.length>0),n(),x("box-title font-medium text-[15px] block text-primarytint1color"),s("title","Category Bonus Points")("titleView",!0)("iconClass","ti-btn btn-wave ti-btn-sm ti-btn-soft-primary waves-effect waves-light")("classbody","pt-0")("iconName","ri-add-line"),n(11),s("ngForOf",e.rows.controls),n(2),s("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("iconClass",e.api.disabled?"ri-loader-2-fill animate-spin":"ri-save-line")("disabled",e.api.disabled)("loadingIconClass","ri-loader-2-fill")}}var de=class r{constructor(t,e,i,a,d,o,S){this.toastr=t;this.api=e;this.formValidation=i;this.fb=a;this.dateService=d;this.router=o;this.commonApi=S}skLoading=!1;bonusForm=new j({});today=new Date;pointCategoriesData=[];selectedDistricts=[];selectedStates=[];stateDistricts={};selectAllChecked={};ngOnInit(){this.getPointCategoryData(),this.bonusForm=this.fb.group({customer_type_id:[[],f.required],customer_type_name:[[]],title:["",f.required],start_date:["",f.required],end_date:["",f.required],selectedStates:[[],f.required],rows:this.fb.array([])}),this.commonApi.getStates(),this.commonApi.getCustomerCategorySubType([R.INFLUENCER])}findName(t){let e=t;if(Array.isArray(e)&&e.length>0){let i=this.commonApi.customerCategorySubType.filter(a=>e.includes(a.value)).map(a=>a.label);this.bonusForm.patchValue({customer_type_name:i})}}get rows(){return this.bonusForm.get("rows")}populateRows(){this.pointCategoriesData.forEach(t=>{this.rows.push(this.fb.group({point_category_name:[t.point_category_name],_id:[t._id],point_category_value:[t.point_category_value,[f.required,f.min(0)]]}))})}onDateChange(){this.bonusForm.get("end_date")?.reset()}onSubmit(){if(this.bonusForm.valid){this.api.disabled=!0;let t=w({},this.bonusForm.value),e=this.bonusForm.get("selectedStates")?.value||[],i=[];for(let o of e)this.stateDistricts[o]&&i.push(...this.stateDistricts[o].filter(S=>this.selectedDistricts.includes(S.value)).map(S=>S.value));let a=this.bonusForm.get("rows")?.value.map(o=>({point_category_name:o.point_category_name,point_category_id:o._id,point_category_value:o.point_category_value}))||[],d={customer_type_name:t.customer_type_name||[],customer_type_id:t.customer_type_id||[],title:t.title,start_date:t.start_date,end_date:t.end_date,state:e,district:i,product_point:a};this.api.post(d,"bonus/create").subscribe({next:o=>{this.api.disabled=!1,o.statusCode===200&&(this.toastr.success(o.message,"","toast-top-right"),this.router.navigate(["/apps/loyalty/bonus"]),this.bonusForm.reset())}})}else this.toastr.error("Form Is Invalid","","toast-top-right"),this.formValidation.markFormGroupTouched(this.bonusForm)}getPointCategoryData(){this.api.post({},"bonus/read-point-category").subscribe(t=>{t.statusCode===200&&(this.pointCategoriesData=t.data,this.populateRows())})}getDistrict(t){this.api.post({state:t},"postal-code/districts").subscribe(e=>{e.statusCode===200&&Array.isArray(e.data)?this.stateDistricts[t]=e.data.map(i=>typeof i=="string"?{label:i,value:""}:i):this.stateDistricts[t]=[]})}toggleStateSelection(t){this.selectedStates.includes(t.value)?(this.selectedStates=this.selectedStates.filter(e=>e!==t.value),delete this.stateDistricts[t.value]):(this.selectedStates.push(t.value),this.getDistrict(t.value)),this.bonusForm.patchValue({selectedStates:this.selectedStates})}selectAll(t,e){let i=t.target.checked;this.selectAllChecked[e]=i;let a=this.stateDistricts[e];if(a.forEach(d=>d.sel=i),i){let d=a.map(o=>o.value).filter(o=>!this.selectedDistricts.includes(o));this.selectedDistricts.push(...d)}else{let d=a.map(o=>o.value);this.selectedDistricts=this.selectedDistricts.filter(o=>!d.includes(o))}}toggleDistrictSelection(t,e){let i=this.selectedDistricts.indexOf(t.value);i>-1?this.selectedDistricts.splice(i,1):this.selectedDistricts.push(t.value);let a=this.stateDistricts[e].find(o=>o.value===t.value);a&&(a.sel=i===-1);let d=this.stateDistricts[e].every(o=>this.selectedDistricts.includes(o.value));this.selectAllChecked[e]=d}getPointControl(t){return this.bonusForm.get(`points.points_${t}`)}static \u0275fac=function(e){return new(e||r)(u(q),u(W),u(ne),u(J),u(te),u(P),u(X))};static \u0275cmp=A({type:r,selectors:[["app-bonus-point-add"]],decls:3,vars:7,consts:[[3,"title","title1","activeitem","btnShow1"],["class","box",4,"ngIf"],["class","xl:col-span-12 col-span-12",4,"ngIf"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","gap-x-6"],["class","xl:col-span-3 col-span-12 mb-4",4,"ngFor","ngForOf"],[1,"xl:col-span-3","col-span-12","mb-4"],[1,"xl:col-span-12","col-span-12"],[3,"ngSubmit","formGroup"],[1,"col-span-12","mb-4","xl:col-span-4","xxl:col-span-3"],["formControlName","customer_type_id","label","Customer Category",3,"selectedChange","multiple","fieldReq","options"],["label","Title","formControlName","title","type","text",1,"remove-default-class",3,"fieldReq"],["placeholder","Start Date","label","Start Date","formControlName","start_date",1,"form-control","custom-datepickr",3,"dateChange","fieldReq","min"],["placeholder","End Date","label","End Date","formControlName","end_date",1,"form-control","custom-datepickr",3,"min","fieldReq"],[1,"grid","grid-cols-3","gap-4"],[3,"title","titleView","iconClass","classbody","iconName"],[1,""],[1,"px-0","py-3","pb-0","scroll-y-400"],["class","form-check mb-2 !flex items-center border-b pb-2 dark:border-defaultborder/10",4,"ngFor","ngForOf"],[3,"title","class","titleView","iconClass","classbody","iconName",4,"ngIf"],[1,"ti-custom-table","ti-custom-table-head","ti-head-secondary","w-full"],[1,"border-b","border-defaultborder","dark:border-defaultborder/10"],[1,"text-start"],["formArrayName","rows"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-end","mt-10","gap-2"],[3,"buttonType","buttonClass","iconClass","disabled","loadingIconClass"],[1,"form-check","mb-2","!flex","items-center","border-b","pb-2","dark:border-defaultborder/10"],["type","checkbox",1,"form-check-input","me-2",3,"change","value"],[1,"text-sm"],[1,"scroll-y-400"],[4,"ngFor","ngForOf"],[1,"flex","gap-2","items-center","mb-2","ng-star-inserted","pb-2","border-b-2"],["type","checkbox","id","selectAllCol3",1,"form-check-input",3,"change","checked"],[1,"block","box-title","font-bold","font-medium","rounded-sm","text-[12px]",3,"ngClass"],["type","checkbox",1,"form-check-input","me-2",3,"change","checked","value"],[3,"formGroupName"],["type","number","placeholder","Enter points","formControlName","point_category_value",1,"ti-input","!py-1","!px-2","w-full","border","rounded"]],template:function(e,i){e&1&&(b(0,"app-page-header",0),_(1,_e,4,2,"div",1)(2,ye,33,31,"div",2)),e&2&&(s("title","Bonus")("title1",F(6,pe))("activeitem","Bonus Add")("btnShow1",!1),n(),s("ngIf",i.skLoading),n(),s("ngIf",!i.skLoading))},dependencies:[le,V,E,I,$,M,L,O,G,H,z,U,Y,re,ie,ce,Z,se,ee,T,K,B,Q,ae,oe],encapsulation:2})};export{de as BonusPointAddComponent};
