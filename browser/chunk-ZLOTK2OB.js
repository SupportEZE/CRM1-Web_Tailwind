import{a as ee}from"./chunk-PU6S26UW.js";import"./chunk-OTFCGVEU.js";import{a as L}from"./chunk-CNF4GSI7.js";import{a as ie}from"./chunk-GLWQGYBC.js";import{a as H}from"./chunk-DC4QM32I.js";import{C as Z,F as $,g as J,h as W,j as K,k as Q,v as X,w as Y}from"./chunk-VHE3PQ3O.js";import{A as v,B as P,C as R,D as B,H as D,M as j,P as q,V as E,W as G,X as O,Z as z,hb as U,w as M}from"./chunk-GYDYF5F3.js";import{K as w,M as N,g as A,n as V,t as k}from"./chunk-PD5VTTIY.js";import{Aa as u,Ba as f,Hb as C,Mc as S,Ob as b,Yc as x,_b as a,ed as I,fd as T,kc as l,lc as s,mc as p,qc as y,rb as m,sb as n,wc as g,yc as d}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as _,b as F}from"./chunk-66YHNWRR.js";var oe=()=>["Scheme"];function re(c,o){if(c&1){let e=y();l(0,"div",2)(1,"form",3),g("ngSubmit",function(){u(e);let t=d();return f(t.onSubmit())}),l(2,"div",4)(3,"div",5)(4,"div",6)(5,"div",7),p(6,"spk-ng-select",8),s(),l(7,"div",9)(8,"spk-flatpickr",10),g("dateChange",function(){u(e);let t=d();return f(t.onDateChange())}),s()(),l(9,"div",9),p(10,"spk-flatpickr",11),s(),l(11,"div",12)(12,"label",13),S(13,"Banner"),l(14,"span",14),S(15,"*"),s()(),l(16,"file-pond",15),g("onremovefile",function(t){u(e);let r=d();return f(r.onFileRemove(t,"image"))})("onprocessfile",function(t){u(e);let r=d();return f(r.onFileProcessed(t,"image"))}),s()(),l(17,"div",12),p(18,"spk-input",16),s()()(),l(19,"div",17),p(20,"app-button",18),s()()()()}if(c&2){let e=d();m(),a("formGroup",e.schemeForm),m(5),a("fieldReq",!0)("multiple",!0)("options",e.CommonApiService.productList),m(2),a("fieldReq",!0)("min",e.today),m(2),a("min",e.schemeForm.value.date_from)("fieldReq",!0),m(6),a("options",e.pondOptions)("files",e.pondBannerFiles),m(2),a("fieldReq",!0),m(2),a("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",e.api.disabled)("formType",e.pageType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}var te=class c{constructor(o,e,i,t,r,h,ne,ae,le){this.api=o;this.toastr=e;this.CommonApiService=i;this.moduleService=t;this.uploadService=r;this.router=h;this.route=ne;this.formValidation=ae;this.fb=le}schemeForm=new B({});pageType="add";skLoading=!1;modules={};pondFiles=[];pondBannerFiles=[];today=new Date;ngOnInit(){this.CommonApiService.getProduct();let o=this.moduleService.getModuleByName("Scheme");o&&(this.modules=o),this.schemeForm=this.fb.group({product_data:[[],v.required],date_from:["",v.required],date_to:["",v.required],description:["",v.required]})}onDateChange(){this.schemeForm.get("end_date")?.reset()}onProductChange(o){let e=this.CommonApiService.productList.filter(i=>o.includes(i.value)).map(i=>({product_id:i.value,product_name:i.label}));this.schemeForm.patchValue({product_data:e})}pondOptions=this.getPondOptions("image");getPondOptions(o){let e={allowFileTypeValidation:!0,labelIdle:"Click or drag files here to upload...",maxFiles:1,server:{process:(i,t,r,h)=>{setTimeout(()=>{h(Date.now().toString())},1e3)},revert:(i,t)=>{t()}}};if(o==="image")return F(_({},e),{allowMultiple:!1,acceptedFileTypes:["image/jpeg","image/png","image/jpg"],maxFileSize:"2MB",allowImageValidateSize:!0,labelFileTypeNotAllowed:"Only PNG and JPEG files are allowed",fileValidateTypeLabelExpectedTypes:"Allowed: PNG, JPEG",labelImageValidateSizeTooSmall:"Image is too small. Min: {minWidth}\xD7{minHeight}",labelImageValidateSizeTooBig:"Image is too large. Max: {maxWidth}\xD7{maxHeight}"})}onFileProcessed(o,e){let i=o.file.file;Object.assign(i,{image_type:e}),e==="image"&&(this.pondBannerFiles=[...this.pondBannerFiles||[],i])}onFileRemove(o,e){let i=o.file.file;if(e==="image"){let t=this.pondBannerFiles.findIndex(r=>r.name===i.name&&r.size===i.size);t>-1&&this.pondBannerFiles.splice(t,1)}}onSubmit(){if(this.schemeForm.valid){let o=this.schemeForm.value;if(this.pondFiles=[...this.pondBannerFiles],this.pondFiles.length===0&&this.pageType==="add"){this.toastr.error("Please upload at least one file.","","toast-top-right");return}let e=o.product_data.map(t=>{let r=this.CommonApiService.productList.find(h=>h.value===t);return{product_id:r?.value,product_name:r?.label}}),i={date_from:o.date_from,date_to:o.date_to,description:o.description,product_data:e};this.api.disabled=!0,this.api.post(i,"order/create-scheme").subscribe(t=>{t.statusCode==200&&(this.pondFiles.length>0?this.uploadService.uploadFile(t.data.inserted_id,"order",this.pondFiles,"Order Scheme Images",this.modules,"/apps/sfa/scheme"):(this.api.disabled=!1,this.router.navigate(["/apps/sfa/scheme"]),this.toastr.success(t.message,"","toast-top-right"),this.schemeForm.reset()))})}else this.formValidation.markFormGroupTouched(this.schemeForm)}static \u0275fac=function(e){return new(e||c)(n(z),n(M),n(L),n(H),n(ee),n(N),n(w),n(X),n(E))};static \u0275cmp=C({type:c,selectors:[["app-scheme-add"]],decls:3,vars:7,consts:[[3,"title","title1","activeitem"],["class","xl:col-span-12 col-span-12",4,"ngIf"],[1,"xl:col-span-12","col-span-12"],[3,"ngSubmit","formGroup"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","sm:gap-x-6"],[1,"xl:col-span-4","col-span-12","mb-3"],["formControlName","product_data","label","Products",3,"fieldReq","multiple","options"],[1,"col-span-12","mb-4","xl:col-span-4","xxl:col-span-3"],["placeholder","Date From","label","Date From","formControlName","date_from",1,"form-control","custom-datepickr",3,"dateChange","fieldReq","min"],["placeholder","End Date","label","End Date","formControlName","date_to",1,"form-control","custom-datepickr",3,"min","fieldReq"],[1,"xl:col-span-6","col-span-12","mb-3"],[1,"form-label","mb-0"],[1,"text-red-500"],[1,"filepond","basic-filepond",3,"onremovefile","onprocessfile","options","files"],["label","Description","formControlName","description","type","textarea",1,"remove-default-class",3,"fieldReq"],[1,"box-footer","border-t","border-block-start-dashed","sm:flex","justify-end"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"]],template:function(e,i){e&1&&(p(0,"app-page-header",0),I(1,"titlecase"),b(2,re,21,17,"div",1)),e&2&&(a("title","Scheme")("title1",x(6,oe))("activeitem",T(1,4,i.pageType)+" Scheme"),m(2),a("ngIf",!i.skLoading))},dependencies:[G,D,P,R,k,A,V,$,j,q,Y,J,ie,Z,O,U,Q,K,W],encapsulation:2})};export{te as SchemeAddComponent};
