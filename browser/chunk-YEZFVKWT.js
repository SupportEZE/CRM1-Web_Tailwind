import{a as k}from"./chunk-56RTIVDZ.js";import{a as se}from"./chunk-REKAXM5L.js";import"./chunk-PU6S26UW.js";import{e as re}from"./chunk-4JVCC6N3.js";import"./chunk-SQZ3YN6N.js";import{c as ae}from"./chunk-CIBZCVJQ.js";import{a as ne}from"./chunk-OTFCGVEU.js";import{a as ie}from"./chunk-HPLI5COI.js";import"./chunk-CNF4GSI7.js";import"./chunk-OEHD5D2Y.js";import{a as oe}from"./chunk-GLWQGYBC.js";import{a as Q}from"./chunk-DC4QM32I.js";import{B as Z,C as ee,F as te,c as K,t as Y}from"./chunk-VHE3PQ3O.js";import{$ as z,D as J,Qa as W,V as G,W as H,X as U,Z as q,hb as X,w as $}from"./chunk-GYDYF5F3.js";import{K as O,M as R,Q as j,e as P,f as T,g as L,n as A,o as N,t as V}from"./chunk-PD5VTTIY.js";import{Aa as f,Ba as h,Hb as M,Mc as d,Nc as g,Ob as u,Oc as B,Yc as I,_b as l,bc as b,ed as D,fd as F,gd as w,kc as o,lc as s,mc as x,nc as C,oc as y,qc as S,rb as a,sb as _,wc as v,yc as m}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import"./chunk-66YHNWRR.js";var de=()=>["Area Bonus Detail"],E=()=>[];function ce(i,t){if(i&1&&(o(0,"div",7)(1,"div")(2,"span",8),d(3),D(4,"titlecase"),s(),o(5,"span",9),d(6,"Updated By"),s()()()),i&2){let e=m(2);a(3),B(" ",e.areaBonusDetail.updated_name?F(4,1,e.areaBonusDetail.updated_name):"---"," ")}}function pe(i,t){if(i&1&&(o(0,"div",7)(1,"div")(2,"span",8),d(3),D(4,"date"),s(),o(5,"span",9),d(6,"Updated At"),s()()()),i&2){let e=m(2);a(3),B(" ",e.areaBonusDetail.updated_at?w(4,1,e.areaBonusDetail.updated_at,"dd MMM yyyy hh:mm a"):"---"," ")}}function me(i,t){if(i&1){let e=S();o(0,"div")(1,"div",6)(2,"div",7)(3,"div")(4,"span",8),d(5),D(6,"date"),s(),o(7,"span",9),d(8,"Created At"),s()()(),o(9,"div",7)(10,"div")(11,"span",8),d(12),s(),o(13,"span",9),d(14,"Created By Name"),s()()(),o(15,"div",7)(16,"div")(17,"span",8),d(18),s(),o(19,"span",9),d(20,"Title "),s()()(),o(21,"div",7)(22,"div")(23,"span",8),d(24),s(),o(25,"span",9),d(26,"Customer Type"),s()()(),o(27,"div",7)(28,"div")(29,"span",8),d(30),D(31,"date"),s(),o(32,"span",9),d(33,"Start Date"),s()()(),o(34,"div",7)(35,"div")(36,"span",8),d(37),D(38,"date"),s(),o(39,"span",9),d(40,"End Date"),s()()(),o(41,"div",10)(42,"div")(43,"div",11)(44,"span",12),d(45),s(),o(46,"app-toggle",13),v("checkedChange",function(r){f(e);let c=m();return h(c.onToggleChange(r,c.bonusId,c.areaBonusDetail.status))}),s()(),o(47,"span",14),d(48,"Status"),s()()(),u(49,ce,7,3,"div",15)(50,pe,7,4,"div",15),s()()}if(i&2){let e=m();a(5),g(w(6,13,e.areaBonusDetail.created_at,"dd MMM yyyy hh:mm a")),a(7),g(e.areaBonusDetail.created_name),a(6),g(e.areaBonusDetail.title),a(6),g(e.areaBonusDetail.customer_type_name),a(6),g(w(31,16,e.areaBonusDetail.start_date,"dd MMM yyyy hh:mm a")),a(7),g(w(38,19,e.areaBonusDetail.end_date,"dd MMM yyyy hh:mm a")),a(7),l("ngClass",e.areaBonusDetail.status==="Active"?"bg-success/10 text-success":"bg-danger/10 text-danger"),a(),g(e.areaBonusDetail.status),a(),b("ti-switch-custom"),l("checked",e.areaBonusDetail.status==="Active"),a(3),l("ngIf",e.areaBonusDetail.updated_name),a(),l("ngIf",e.areaBonusDetail.updated_at)}}function ue(i,t){i&1&&(o(0,"div",18),x(1,"app-skeleton"),s()),i&2&&(a(),b("w180"))}function ge(i,t){i&1&&(o(0,"div")(1,"div",16),u(2,ue,2,2,"div",17),s()()),i&2&&(a(2),l("ngForOf",I(1,E).constructor(10)))}function _e(i,t){if(i&1){let e=S();o(0,"div",33)(1,"input",34),v("change",function(){let r=f(e).$implicit,c=m(3);return h(c.toggleStateSelection(r))}),s(),o(2,"span",35),d(3),s()()}if(i&2){let e=t.$implicit;a(),l("checked",e.checked)("value",e.value),a(2),g(e.label)}}function ve(i,t){if(i&1&&(C(0),u(1,_e,4,3,"div",32),y()),i&2){let e=m(2);a(),l("ngForOf",e.statList)}}function fe(i,t){i&1&&(o(0,"div",37),x(1,"app-skeleton",38),s())}function he(i,t){i&1&&(C(0),u(1,fe,2,0,"div",36),y()),i&2&&(a(),l("ngForOf",I(1,E).constructor(15)))}function be(i,t){if(i&1){let e=S();o(0,"div",33)(1,"input",43),v("change",function(){let r=f(e).$implicit,c=m().$implicit,p=m(3);return h(p.toggleDistrictSelection(r,c))}),s(),o(2,"span",35),d(3),s()()}if(i&2){let e=t.$implicit;a(),l("checked",e.checked),a(2),g(e.label)}}function xe(i,t){if(i&1){let e=S();C(0),o(1,"div",40)(2,"input",41),v("change",function(r){let c=f(e).$implicit,p=m(3);return h(p.selectAll(r,c))}),s(),o(3,"h6",42),d(4),s()(),u(5,be,4,2,"div",32),y()}if(i&2){let e=t.$implicit,n=m(3);a(2),l("checked",n.selectAllChecked[e]),a(),l("ngClass",n.selectAllChecked[e]?"text-primary":"text-primarytint1color"),a(),B(" Districts of ",e,""),a(),l("ngForOf",n.stateDistricts[e])}}function Ce(i,t){if(i&1&&(C(0),u(1,xe,6,4,"ng-container",39),y()),i&2){let e=m(2);a(),l("ngForOf",e.selectedStates)}}function ye(i,t){i&1&&(o(0,"div",37),x(1,"app-skeleton",38),s())}function Se(i,t){i&1&&(C(0),u(1,ye,2,0,"div",36),y()),i&2&&(a(),l("ngForOf",I(1,E).constructor(15)))}function De(i,t){if(i&1&&(o(0,"tr",27)(1,"td",29),d(2),s(),o(3,"td",29),d(4),s(),o(5,"td",44)(6,"strong"),d(7),s()()()),i&2){let e=t.$implicit,n=t.index;a(2),g(n+1),a(2),g(e.point_category_name),a(3),B(" ",e.point_category_value?e.point_category_value+"PT":""," ")}}function Be(i,t){if(i&1){let e=S();o(0,"div",1)(1,"div",19)(2,"app-showcode-card",20)(3,"div",1)(4,"div",19)(5,"app-showcode-card",21)(6,"div",22)(7,"div",23),u(8,ve,2,1,"ng-container",4)(9,he,2,2,"ng-container",4),s()()()(),o(10,"div",19)(11,"app-showcode-card",21)(12,"div",22)(13,"div",23),u(14,Ce,2,1,"ng-container",4)(15,Se,2,2,"ng-container",4),s()()()()(),o(16,"div",1)(17,"div",24)(18,"app-button",25),v("click",function(){f(e);let r=m();return h(r.updateArea())}),s()()()()(),o(19,"div",19)(20,"app-showcode-card",3),v("action",function(){f(e);let r=m();return h(r.updateBonusPoints("bonus-point-category"))}),o(21,"table",26)(22,"thead")(23,"tr",27)(24,"th",28),d(25,"S.No"),s(),o(26,"th",29),d(27,"Point Category"),s(),o(28,"th",30),d(29,"Points"),s()()(),o(30,"tbody"),u(31,De,8,3,"tr",31),s()()()()()}if(i&2){let e=m();a(2),l("titleView",!1),a(3),b("box-title font-medium text-[15px] block text-primarytint1color"),l("title","Selected States")("boxClass","shadow-none")("titleView",!0)("iconClass","ti-btn btn-wave ti-btn-sm ti-btn-soft-primary waves-effect waves-light")("classbody","pt-0")("iconName","ri-add-line"),a(3),l("ngIf",!e.stateLoading),a(),l("ngIf",e.stateLoading),a(2),b("box-title font-medium text-[15px] block text-primarytint1color"),l("title","Selected Districts")("boxClass","shadow-none")("titleView",!0)("iconClass","ti-btn btn-wave ti-btn-sm ti-btn-soft-primary waves-effect waves-light")("classbody","pt-0")("iconName","ri-add-line"),a(3),l("ngIf",!e.districtLoading),a(),l("ngIf",e.districtLoading),a(3),l("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("iconClass",e.api.disabled?"ri-loader-2-fill animate-spin":"ri-save-line")("loadingIconClass","ri-loader-2-fill"),a(2),b("box-title font-medium text-[15px] block text-primarytint1color"),l("title","Point Category Bonus Points")("titleView",!0)("actionIcons",!0)("iconClass","ti-btn btn-wave ti-btn-sm ti-btn-soft-primary waves-effect waves-light")("classbody","pt-0")("iconName","ri-pencil-line"),a(11),l("ngForOf",e.areaBonusDetail==null?null:e.areaBonusDetail.product_point)}}function Ie(i,t){if(i&1&&(o(0,"div",1)(1,"div",19),x(2,"app-logs",45),s()()),i&2){let e=m();a(2),l("logList",e.logList)("closeBtn",!1)}}var le=class i{constructor(t,e,n,r,c,p,we,ke,Ee,Me){this.router=t;this.alert=e;this.route=n;this.api=r;this.toastr=c;this.moduleService=p;this.logService=we;this.fb=ke;this.dialog=Ee;this.comanFuncation=Me}areaBonusForm=new J({});areaBonusDetail;skLoading=!1;stateLoading=!1;districtLoading=!1;bonusId;submodule=0;FORMID=ie;moduleName="";moduleFormId=0;moduleId=0;selectedDistricts=[];selectedState=null;districtList=[];pointCategoriesData=[];statList=[];isEditing=!1;logList=[];selectedStates=[];documentForm;stateDistricts={};selectAllChecked={};ngOnInit(){let t=this.moduleService.getSubModuleByName("IRP","Bonus"),e=this.moduleService.getSubSubModuleByName("IRP","Bonus","Area Bonus"),n=this.moduleService.getFormById("IRP","Bonus",this.FORMID.ID.BonusFormList);t&&(this.moduleId=t.module_id,this.moduleName=t.title),e&&(this.submodule=e,this.moduleName=e.title),n&&(this.moduleFormId=n.form_id),this.route.paramMap.subscribe(r=>{this.bonusId=r.get("id"),this.bonusId&&(this.getBonusDetail(),this.getPointCategoryData(),this.areaBonusForm=this.fb.group({}))})}originalData={};getBonusDetail(){this.skLoading=!0,this.api.post({_id:this.bonusId},"bonus/detail").subscribe(t=>{t.statusCode===200&&(this.skLoading=!1,this.areaBonusDetail=t.data,this.originalData.state=JSON.parse(JSON.stringify(this.areaBonusDetail.state)),this.originalData.district=JSON.parse(JSON.stringify(this.areaBonusDetail.district)),this.originalData._id=this.bonusId,this.getState(),this.logService.getLogs(this.submodule.module_id,e=>{this.logList=e},this.bonusId?this.bonusId:"",this.submodule.module_type))})}onToggleChange(t,e,n){this.comanFuncation.statusChange(t,e,n,this.submodule,"toggle","bonus/update-status").subscribe(r=>{this.getBonusDetail()})}getPointCategoryData(){this.api.post({},"bonus/read-point-category").subscribe(t=>{t.statusCode===200&&(this.pointCategoriesData=t.data)})}getState(){this.stateLoading=!0,this.api.post({},"postal-code/states").subscribe(t=>{t.statusCode===200&&(this.selectedStates=this.areaBonusDetail?.state||[],this.stateLoading=!1,this.statList=t.data.map(e=>{let n=typeof e=="string"?e:e.value,r=this.selectedStates.includes(n);return r&&(e.checked=!0,this.getDistrict(n)),{label:typeof e=="string"?e:e.label,value:n,checked:r}}))})}getDistrict(t){this.districtLoading=!0,this.api.post({state:t},"postal-code/districts").subscribe(e=>{if(e.statusCode===200){this.selectedDistricts=this.areaBonusDetail?.district||[],this.districtList=e.data.map(r=>{let c=typeof r=="string"?r:r.value;return{label:typeof r=="string"?r:r.label,value:c,checked:this.selectedDistricts.includes(c)}}),e.statusCode===200&&Array.isArray(this.districtList)&&(this.stateDistricts[t]=this.districtList.map(r=>typeof r=="string"?{label:r}:r)),this.districtLoading=!1;let n=this.stateDistricts[t].every(r=>r.checked);this.selectAllChecked[t]=n}})}toggleStateSelection(t){this.selectedStates.includes(t.value)?(this.selectedStates=this.selectedStates.filter(e=>e!==t.value),delete this.stateDistricts[t.value]):(this.selectedStates.push(t.value),this.getDistrict(t.value))}toggleDistrictSelection(t,e){let n=this.selectedDistricts.indexOf(t.value);n>-1?this.selectedDistricts.splice(n,1):this.selectedDistricts.push(t.value);let r=this.stateDistricts[e].find(p=>p.value===t.value);r&&(r.sel=n===-1);let c=this.stateDistricts[e].every(p=>this.selectedDistricts.includes(p.value));this.selectAllChecked[e]=c}selectAll(t,e){let n=t.target.checked;this.selectAllChecked[e]=n;let r=this.stateDistricts[e];if(r.forEach(c=>c.checked=n),n){let c=r.map(p=>p.value).filter(p=>!this.selectedDistricts.includes(p));this.selectedDistricts.push(...c)}else{let c=r.map(p=>p.value);this.selectedDistricts=this.selectedDistricts.filter(p=>!c.includes(p))}}toggleSelectAllDistricts(t){let e=t.target.checked;this.areaBonusDetail?.district&&(this.areaBonusDetail.district.forEach(n=>{n.selected=e}),this.selectedDistricts=e?this.areaBonusDetail.district.map(n=>n.name):[])}updateStatus(t){this.dialog.open(k,{width:"600px",data:{lastPage:t,bonusId:this.bonusId,status:this.areaBonusDetail.status}}).afterClosed().subscribe(n=>{n===!0&&this.getBonusDetail()})}updateBonusPoints(t){this.dialog.open(k,{width:"400px",data:{lastPage:t,bonusId:this.bonusId,module_id:this.submodule.module_id,module_name:this.moduleName}}).afterClosed().subscribe(n=>{n===!0&&this.getBonusDetail()})}updateArea(){{let n={state:this.selectedStates,district:this.selectedDistricts,_id:this.bonusId};if(this.logService.logActivityOnUpdate(!0,this.originalData,n,this.submodule.module_id,this.moduleName,"update",this.bonusId||null,()=>{},this.submodule.module_type)){this.api.disabled=!1,this.toastr.warning("No changes detected","","toast-top-right");return}}this.api.disabled=!0;let e={state:this.selectedStates,district:this.selectedDistricts,_id:this.bonusId};this.api.post(e,"bonus/update-states").subscribe(n=>{n.statusCode===200&&(this.api.disabled=!1,this.toastr.success(n.message,"","toast-top-right"))})}static \u0275fac=function(e){return new(e||i)(_(R),_(z),_(O),_(q),_($),_(Q),_(ne),_(G),_(W),_(ae))};static \u0275cmp=M({type:i,selectors:[["app-bonus-point-detail"]],decls:8,vars:20,consts:[[3,"title","title1","activeitem","buttonText","icon","btnShow","buttonValue"],[1,"grid","grid-cols-12","gap-x-6"],[1,"xxl:col-span-12","xl:col-span-12","lg:col-span-12","md:col-span-12","col-span-12"],[3,"action","title","titleView","actionIcons","iconClass","classbody","iconName"],[4,"ngIf"],["class","grid grid-cols-12 gap-x-6",4,"ngIf"],[1,"flex","gap-5","mb-1","flex-wrap"],[1,"flex","items-center","gap-2"],[1,"block","text-[14px]","font-medium"],[1,"text-xs","text-textmuted","dark:text-textmuted/50"],[1,"flex","items-center","me-2","gap-3","flex-wrap"],[1,"flex","gap-2"],[1,"text-[11px]","badge",3,"ngClass"],[3,"checkedChange","checked"],[1,"text-textmuted","dark:text-textmuted/50","font-medium"],["class","flex items-center gap-2",4,"ngIf"],[1,"flex","gap-2","mb-1","flex-wrap"],["class","flex items-center",4,"ngFor","ngForOf"],[1,"flex","items-center"],[1,"xxl:col-span-6","xl:col-span-6","lg:col-span-6","md:col-span-6","col-span-12"],[3,"titleView"],[3,"title","boxClass","titleView","iconClass","classbody","iconName"],[1,""],[1,"px-0","py-3","pb-0","scroll-y-400"],[1,"flex","items-center","justify-end","col-span-12"],[3,"click","buttonType","buttonClass","iconClass","loadingIconClass"],[1,"ti-custom-table","ti-custom-table-head","ti-head-secondary","w-full"],[1,"border-b","border-defaultborder","dark:border-defaultborder/10"],[1,"text-start","w50"],[1,"text-start"],[1,"text-start","text-right","w100"],["class","border-b border-defaultborder dark:border-defaultborder/10",4,"ngFor","ngForOf"],["class","form-check mb-2 !flex items-center border-b pb-2 dark:border-defaultborder/10",4,"ngFor","ngForOf"],[1,"form-check","mb-2","!flex","items-center","border-b","pb-2","dark:border-defaultborder/10"],["type","checkbox",1,"form-check-input","me-2",3,"change","checked","value"],[1,"text-sm"],["class","form-check mb-2 !flex items-center border-b pb-2 dark:border-defaultborder/10 wp100",4,"ngFor","ngForOf"],[1,"form-check","mb-2","!flex","items-center","border-b","pb-2","dark:border-defaultborder/10","wp100"],[2,"width","100%"],[4,"ngFor","ngForOf"],[1,"flex","gap-2","items-center","mb-2","ng-star-inserted","pb-2","border-b-2"],["type","checkbox","id","selectAllCol3",1,"form-check-input",3,"change","checked"],[1,"block","box-title","font-bold","font-medium","rounded-sm","text-[12px]",3,"ngClass"],["type","checkbox",1,"form-check-input","me-2",3,"change","checked"],[1,"text-start","text-right"],[3,"logList","closeBtn"]],template:function(e,n){e&1&&(x(0,"app-page-header",0),o(1,"div",1)(2,"div",2)(3,"app-showcode-card",3),v("action",function(){return n.updateStatus("bonus-basic-detail")}),u(4,me,51,22,"div",4)(5,ge,3,2,"div",4),s()()(),u(6,Be,32,34,"div",5)(7,Ie,3,2,"div",5)),e&2&&(l("title","Loyalty")("title1",I(19,de))("activeitem","Bonus Details")("buttonText","Filter")("icon","filter_list")("btnShow",!1)("buttonValue",""),a(3),b("box-title font-medium text-[15px] block text-primarytint1color"),l("title","Basic Detail")("titleView",!0)("actionIcons",!0)("iconClass","ti-btn btn-wave ti-btn-sm ti-btn-soft-primary waves-effect waves-light")("classbody","pt-0")("iconName","ri-pencil-line"),a(),l("ngIf",!n.skLoading),a(),l("ngIf",n.skLoading),a(),l("ngIf",!n.skLoading),a(),l("ngIf",!n.skLoading))},dependencies:[te,P,T,L,oe,K,ee,se,Y,A,N,j,Z,re,V,H,X,U],encapsulation:2})};export{le as BonusPointDetailComponent};
