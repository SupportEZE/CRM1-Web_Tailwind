import{a as ie}from"./chunk-PU6S26UW.js";import{a as re}from"./chunk-SQZ3YN6N.js";import"./chunk-OTFCGVEU.js";import{a as G}from"./chunk-CNF4GSI7.js";import{a as J}from"./chunk-OEHD5D2Y.js";import{a as oe}from"./chunk-GLWQGYBC.js";import{a as U}from"./chunk-DC4QM32I.js";import{C as ee,F as te,c as Y,g as Q,h as W,j as $,k as K,v as X,w as Z}from"./chunk-VHE3PQ3O.js";import{A as u,B as P,C as E,H as M,M as O,P as j,V as B,X as L,Z as z,hb as H,o as g,w as N}from"./chunk-GYDYF5F3.js";import{K as D,M as R,Q as q,f as I,g as w,t as A}from"./chunk-PD5VTTIY.js";import{Aa as m,Ba as p,Hb as V,Mc as y,Nc as b,Ob as v,Yc as x,_b as n,f as T,kc as a,lc as l,mc as h,qc as k,rb as s,sb as _,wc as f,yc as c}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as C,b as S}from"./chunk-66YHNWRR.js";var ae=()=>["Stock Transfer"],ne=()=>[];function le(d,o){d&1&&(a(0,"div",7),h(1,"app-skeleton"),l())}function de(d,o){d&1&&(a(0,"div",3)(1,"div",4)(2,"div",5),v(3,le,2,0,"div",6),l()()()),d&2&&(s(3),n("ngForOf",x(1,ne).constructor(10)))}function ce(d,o){if(d&1){let e=k();a(0,"tr")(1,"td",37),y(2),l(),a(3,"td"),y(4),l(),a(5,"td",38),y(6),l(),a(7,"td",39)(8,"div",40)(9,"app-icon-button",41),f("clickEvent",function(){let i=m(e).index,r=c(3);return p(r.delete(i))}),l()()()()}if(d&2){let e=o.$implicit,t=o.index;s(2),b(t+1),s(2),b(e.label?e.label:"---"),s(2),b(e.qty?e.qty:"0"),s(3),n("icon","ri-delete-bin-line")("buttonClass","ti-btn btn-wave product-btn ti-btn-sm ti-btn-soft-danger waves-effect waves-light")}}function me(d,o){if(d&1&&(a(0,"div",23)(1,"div",34)(2,"spk-reusable-tables",35),v(3,ce,10,5,"tr",36),l()()()),d&2){let e=c(2);s(2),n("columns",e.headerColumn)("tableHead","border-b")("showCheckbox",!1),s(),n("ngForOf",e.selectedItems)}}function pe(d,o){if(d&1){let e=k();a(0,"div",8)(1,"form",9),f("ngSubmit",function(){m(e);let i=c();return p(i.onSubmit())}),a(2,"div",3)(3,"div",4)(4,"div",10)(5,"div",11)(6,"spk-ng-select",12),f("selectedChange",function(i){m(e);let r=c();return r.getSenderCustomer(i),p(r.findName(i,"sender_customer_type_id"))}),l()(),a(7,"div",11)(8,"spk-ng-select",13),f("searchChanged",function(i){m(e);let r=c();return p(r.onSearch(i,"sender_customer"))})("selectedChange",function(i){m(e);let r=c();return r.findName(i,"sender_customer_id"),p(r.getProduct())}),l()(),a(9,"div",11)(10,"spk-ng-select",14),f("selectedChange",function(i){m(e);let r=c();return r.getReceiverCustomer(i),p(r.findName(i,"receiver_customer_type_id"))}),l()(),a(11,"div",11)(12,"spk-ng-select",15),f("searchChanged",function(i){m(e);let r=c();return p(r.onSearch(i,"receiver_customer"))})("selectedChange",function(i){m(e);let r=c();return p(r.findName(i,"receiver_customer_id"))}),l()(),a(13,"div",16),h(14,"spk-flatpickr",17),l(),a(15,"div",16),h(16,"spk-input",18),l(),a(17,"div",16),h(18,"spk-input",19),l(),a(19,"div",16)(20,"label",20),y(21,"Upload Bill Copy "),l(),a(22,"file-pond",21),f("onremovefile",function(i){m(e);let r=c();return p(r.onFileRemove(i,"image"))})("onprocessfile",function(i){m(e);let r=c();return p(r.onFileProcessed(i,"image"))}),l()()(),a(23,"div",22)(24,"div",23)(25,"div",24)(26,"div",25)(27,"spk-ng-select",26),f("searchChanged",function(i){m(e);let r=c();return p(r.onSearch(i,"product"))}),l()(),a(28,"div",25)(29,"div",27),h(30,"spk-input",28),a(31,"button",29),f("click",function(){m(e);let i=c();return p(i.addToList())}),h(32,"i",30),l()()()()(),v(33,me,4,4,"div",31),l(),a(34,"div",32),h(35,"app-button",33),l()()()()()}if(d&2){let e=c();s(),n("formGroup",e.stockForm),s(5),n("fieldReq",!0)("options",e.commonApi.customerCategorySubType)("multiple",!1),s(2),n("fieldReq",!0)("search",!0)("options",e.commonApi.customerData)("multiple",!1),s(2),n("fieldReq",!0)("options",e.customerCategorySubType)("multiple",!1),s(2),n("fieldReq",!0)("search",!0)("options",e.customerData)("multiple",!1),s(2),n("fieldReq",!0)("max",e.today),s(2),n("fieldReq",!0),s(2),n("fieldReq",!0),s(4),n("options",e.getPondOptions("image"))("files",e.pondImages),s(5),n("search",!0)("fieldReq",e.selectedItems.length===0)("options",e.product)("multiple",!1),s(3),n("fieldReq",e.selectedItems.length===0),s(3),n("ngIf",e.selectedItems.length>0),s(2),n("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("iconClass",e.api.disabled?"ri-loader-2-fill animate-spin":"ri-save-line")("loadingIconClass","ri-loader-2-fill")("disabled",e.api.disabled)}}var se=class d{constructor(o,e,t,i,r,F,ue,_e,fe){this.toastr=o;this.api=e;this.formValidation=t;this.fb=i;this.router=r;this.route=F;this.commonApi=ue;this.uploadService=_e;this.moduleService=fe}skLoading=!1;stockForm;today=new Date;pondFiles=[];submodule;pondPdf=[];pondImages=[];pondOptions=this.getPondOptions("image");pondDocumentOptions=this.getPondOptions("pdf");product=[];selectedItems=[];detailData={};ngOnInit(){let o=this.router.getCurrentNavigation();if(o?.extras?.state?.detail)this.detailData=o.extras.state.detail;else{let t=history.state;t?.detail&&(this.detailData=t.detail)}let e=this.moduleService.getSubModuleByName("IRP","Stock Transfer");e&&(this.submodule=e),this.stockForm=this.fb.group({bill_date:["",u.required],bill_amount:["",u.required],bill_number:["",u.required],sender_login_type_id:[""],sender_customer_type_id:[{value:"",disabled:!1},u.required],sender_customer_id:[{value:"",disabled:!1},u.required],receiver_login_type_id:[""],receiver_customer_type_id:[{value:"",disabled:!1},u.required],receiver_customer_id:[{value:"",disabled:!1},u.required],product_id:["",u.required],receiver_customer_name:[""],receiver_customer_type_name:[""],sender_customer_type_name:[""],sender_customer_name:[""],qty:["",u.required],selectedItems:[""]}),this.detailData&&Object.keys(this.detailData).length>0?(this.detailData.pageFrom==="Stock Transfer"&&(this.stockForm.patchValue({sender_customer_type_id:this.detailData.customer_type_id}),this.stockForm.get("sender_customer_type_id")?.disable(),this.stockForm.patchValue({sender_login_type_id:this.detailData.login_type_id}),this.getSenderCustomer(this.detailData.login_type_id),this.stockForm.patchValue({sender_customer_id:this.detailData._id}),this.stockForm.get("sender_customer_id")?.disable(),this.stockForm.patchValue({sender_customer_name:this.detailData.customer_name}),this.stockForm.patchValue({sender_customer_type_name:this.detailData.customer_type_name}),this.commonApi.getCustomerCategorySubType([this.detailData.login_type_id]),this.getCustomerCategorySubType([g.INFLUENCER,g.SECONDARY]),this.stockForm.value.sender_customer_id=this.detailData._id,this.getProduct()),this.detailData.pageFrom==="Purchase Request"&&(this.stockForm.patchValue({receiver_customer_type_id:this.detailData.customer_type_id}),this.stockForm.get("receiver_customer_type_id")?.disable(),this.stockForm.patchValue({receiver_login_type_id:this.detailData.login_type_id}),this.getReceiverCustomer(this.detailData.login_type_id),this.stockForm.patchValue({receiver_customer_id:this.detailData._id}),this.stockForm.get("receiver_customer_id")?.disable(),this.stockForm.patchValue({receiver_customer_name:this.detailData.customer_name}),this.stockForm.patchValue({receiver_customer_type_name:this.detailData.customer_type_name}),this.commonApi.getCustomerCategorySubType([g.PRIMARY]),this.getCustomerCategorySubType([g.INFLUENCER,g.SECONDARY]))):(this.commonApi.getCustomerCategorySubType([g.PRIMARY,g.SECONDARY]),this.getCustomerCategorySubType([g.INFLUENCER,g.SECONDARY]))}getPondOptions(o){let e={allowFileTypeValidation:!0,allowFileSizeValidation:!0,labelIdle:"Click or drag files here to upload...",server:{process:(t,i,r,F)=>{setTimeout(()=>{F(Date.now().toString())},1e3)},revert:(t,i)=>{i()}}};return o==="image"?S(C({},e),{allowMultiple:!0,acceptedFileTypes:["image/jpeg","image/png","image/jpg","application/pdf"],maxFiles:2,allowImageValidateSize:!0,labelFileTypeNotAllowed:"Only PNG, JPEG, or PDF files are allowed",fileValidateTypeLabelExpectedTypes:"Allowed: PNG, JPEG, PDF",labelImageValidateSizeTooSmall:"Image is too small. Min: {minWidth}\xD7{minHeight}",labelImageValidateSizeTooBig:"Image is too large. Max: {maxWidth}\xD7{maxHeight}",fileValidateFunction:t=>{let i=t.type==="application/pdf",r=i?1*1024*1024:2*1024*1024;return t.size>r?Promise.reject(`Max size exceeded: ${i?"10MB for PDF":"2MB for images"}`):Promise.resolve()}}):S(C({},e),{allowMultiple:!1,maxFiles:2,acceptedFileTypes:["application/pdf"],maxFileSize:"10MB",labelFileTypeNotAllowed:"Only PDF files are allowed",fileValidateTypeLabelExpectedTypes:"Allowed: PDF"})}onFileProcessed(o,e){let t=o.file.file;Object.assign(t,{image_type:e}),e==="image"?this.pondImages=[...this.pondImages||[],t]:e==="pdf"&&(this.pondPdf=[...this.pondPdf||[],t])}onFileRemove(o,e){let t=o.file.file;if(e==="image"){let i=this.pondImages.findIndex(r=>r.name===t.name&&r.size===t.size);i>-1&&this.pondImages.splice(i,1)}else if(e==="pdf"){let i=this.pondPdf.findIndex(r=>r.name===t.name&&r.size===t.size);i>-1&&this.pondPdf.splice(i,1)}}customerLoginType=[];customerLoginType$=new T;getCustomerLoginType(o){this.api.post({login_type_ids:o},"rbac/read-login-types").subscribe(e=>{e.statusCode===200&&(this.customerLoginType=e.data,this.customerLoginType$.next(e.data))})}customerCategorySubType=[];getCustomerCategorySubType(o,e){this.api.post({login_type_id:o,search:e},"rbac/read-customer-type").subscribe(t=>{t.statusCode===200&&(this.customerCategorySubType=t.data)})}getSenderCustomer(o){let e=this.commonApi.customerCategorySubType.find(t=>t.value===o);e&&(this.stockForm.patchValue({sender_login_type_name:e.label}),this.stockForm.patchValue({sender_login_type_id:e.login_type_id})),this.commonApi.getCustomerData(this.stockForm.value.sender_customer_type_id,this.stockForm.value.sender_login_type_id)}getReceiverCustomer(o){let e=this.customerCategorySubType.find(t=>t.value===o);e&&(this.stockForm.patchValue({receiver_login_type_name:e.label}),this.stockForm.patchValue({receiver_login_type_id:e.login_type_id})),this.getCustomerData(this.stockForm.value.receiver_customer_type_id,this.stockForm.value.receiver_login_type_id)}customerData=[];getCustomerData(o,e,t){this.api.post({customer_type_id:o,login_type_id:e,search:t},"customer/read-dropdown").subscribe(i=>{i.statusCode===200&&(this.customerData=i.data)})}lastSearchTerm="";onSearch(o,e){let t=o?.trim()||"";t!==this.lastSearchTerm&&(this.lastSearchTerm=t,e==="sender_customer"&&this.commonApi.getCustomerData(this.stockForm.value.sender_customer_type_id,this.stockForm.value.sender_login_type_id,o),e==="receiver_customer"&&this.getCustomerData(this.stockForm.value.receiver_customer_type_id,this.stockForm.value.receiver_login_type_id,o),e==="product"&&this.getProduct(o))}getProduct(o){this.api.post({customer_id:this.stockForm.value.sender_customer_id,"dropdown-name":"Product",filters:{search:o}},"stock-transfer/read-dropdown").subscribe(e=>{e.statusCode==200&&(this.product=e.data)})}addToList(){let o=this.stockForm.get("product_id")?.value,e=this.stockForm.get("qty")?.value;if(this.selectedItems.length===0){if(!o){this.toastr.error("Please select a product.","","toast-top-right");return}if(e<=0){this.toastr.error("Please enter a valid quantity greater than 0.","","toast-top-right");return}}let t=this.product.find(r=>r.value===o);if(!t){this.toastr.error("Selected product not found.","","toast-top-right");return}let i=this.selectedItems.find(r=>r.value===o);i?i.qty+=e:this.selectedItems.push({label:t.label,value:t.value,product_code:t.product_code,qty:e}),this.stockForm.get("product_id")?.reset(),this.stockForm.get("qty")?.reset(),this.selectedItems.length>0&&(this.stockForm.get("product_id")?.clearValidators(),this.stockForm.get("qty")?.clearValidators(),this.stockForm.get("product_id")?.updateValueAndValidity(),this.stockForm.get("qty")?.updateValueAndValidity())}headerColumn=[{label:"S.No",table_class:"text-center"},{label:"Product Name",table_class:""},{label:"QTY",table_class:"text-center"},{label:"Action",table_class:"text-center"}];delete(o){this.selectedItems.splice(o,1),this.toastr.success("Produc removed from the list.","","toast-top-right"),this.selectedItems.length===0&&(this.stockForm.get("product_id")?.setValidators(u.required),this.stockForm.get("qty")?.setValidators([u.required,u.min(1)]))}findName(o,e){if(e==="sender_customer_type_id"){let t=this.commonApi.customerCategorySubType.findIndex(i=>i.value===o);t!==-1&&this.stockForm.patchValue({sender_customer_type_name:this.commonApi.customerCategorySubType[t].label})}if(e==="sender_customer_id"){let t=this.commonApi.customerData.findIndex(i=>i.value===o);t!==-1&&this.stockForm.patchValue({sender_customer_name:this.commonApi.customerData[t].label})}if(e==="receiver_customer_type_id"){let t=this.customerCategorySubType.findIndex(i=>i.value===o);t!==-1&&this.stockForm.patchValue({receiver_customer_type_name:this.customerCategorySubType[t].label})}if(e==="receiver_customer_id"){let t=this.customerData.findIndex(i=>i.value===o);t!==-1&&this.stockForm.patchValue({receiver_customer_name:this.customerData[t].label})}}onSubmit(){if(this.stockForm.valid){if(this.stockForm.value.sender_customer_type_id===this.stockForm.value.receiver_customer_type_id){this.toastr.success("Sender and Receiver customer category both are same","","toast-top-right");return}this.api.disabled=!0,this.stockForm.patchValue({selectedItems:this.selectedItems}),this.pondFiles=[...this.pondImages,...this.pondPdf],this.api.post(this.stockForm.getRawValue(),"stock-transfer/create").subscribe(o=>{o.statusCode==200&&(this.pondFiles.length>0?(this.uploadService.uploadFile(o.data.inserted_id,"stock-transfer",this.pondFiles,"Customer Stock Bill",this.submodule,"/apps/loyalty/stock-transfer-list/customer"),this.api.disabled=!1):(this.api.disabled=!1,this.router.navigate(["/apps/loyalty/stock-transfer-list/customer"]),this.toastr.success(o.message,"","toast-top-right")))})}else this.formValidation.markFormGroupTouched(this.stockForm)}static \u0275fac=function(e){return new(e||d)(_(N),_(z),_(X),_(B),_(R),_(D),_(G),_(ie),_(U))};static \u0275cmp=V({type:d,selectors:[["app-stock-transfer-add"]],decls:3,vars:7,consts:[[3,"title","title1","activeitem","btnShow1"],["class","box",4,"ngIf"],["class","xl:col-span-12 col-span-12",4,"ngIf"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","gap-x-6"],["class","xl:col-span-3 col-span-12 ",4,"ngFor","ngForOf"],[1,"xl:col-span-3","col-span-12"],[1,"xl:col-span-12","col-span-12"],[3,"ngSubmit","formGroup"],[1,"grid","grid-cols-12","sm:gap-x-4","sm:gap-y-4"],[1,"xxl:col-span-3","xl:col-span-3","lg:col-span-3","md:col-span-4","col-span-12"],["formControlName","sender_customer_type_id","label","Sender Customer Category",3,"selectedChange","fieldReq","options","multiple"],["formControlName","sender_customer_id","label","Sender Customer",3,"searchChanged","selectedChange","fieldReq","search","options","multiple"],["formControlName","receiver_customer_type_id","label","Receiver Customer Category",3,"selectedChange","fieldReq","options","multiple"],["formControlName","receiver_customer_id","label","Receiver Customer",3,"searchChanged","selectedChange","fieldReq","search","options","multiple"],[1,"col-span-12","xl:col-span-4","xxl:col-span-3"],["placeholder","Bill Date","label","Bill Date","formControlName","bill_date",1,"form-control","custom-datepickr",3,"fieldReq","max"],["label","Bill/Slip Number","formControlName","bill_number","type","text",1,"remove-default-class",3,"fieldReq"],["label","Bill Amount","formControlName","bill_amount","type","number",1,"remove-default-class",3,"fieldReq"],[1,"form-label","mb-0"],[1,"filepond","basic-filepond",3,"onremovefile","onprocessfile","options","files"],[1,"grid","grid-cols-12","sm:gap-x-6"],[1,"xl:col-span-6","col-span-12"],[1,"grid","grid-cols-12","sm:gap-x-3"],[1,"xxl:col-span-6","xl:col-span-6","lg:col-span-6","md:col-span-6","col-span-12"],["formControlName","product_id","label","Select Product",3,"searchChanged","search","fieldReq","options","multiple"],[1,"flex","gap-4","justify-center","items-end"],["label","QTY","formControlName","qty","type","number",1,"remove-default-class",3,"fieldReq"],["type","button","aria-label","button",1,"ti-btn","m-0","ti-btn-icon","ti-btn-primary","btn-wave",3,"click"],[1,"ri-add-line"],["class","xl:col-span-6 col-span-12",4,"ngIf"],[1,"flex","items-center","justify-end","mt-10","gap-2"],[3,"buttonType","buttonClass","iconClass","loadingIconClass","disabled"],[1,"table-responsive","mt-4","table-bordered-default"],["tableClass","ti-custom-table ti-custom-table-hover ti-head-primary",3,"columns","tableHead","showCheckbox"],[4,"ngFor","ngForOf"],[1,"w60","text-center"],[1,"text-center"],[1,"w60","relative"],[1,"flex","flex-row","items-center","!gap-2","text-[0.9375rem]"],[3,"clickEvent","icon","buttonClass"]],template:function(e,t){e&1&&(h(0,"app-page-header",0),v(1,de,4,2,"div",1)(2,pe,36,32,"div",2)),e&2&&(n("title","IRP")("title1",x(6,ae))("activeitem","Stock Transfer")("btnShow1",!1),s(),n("ngIf",t.skLoading),s(),n("ngIf",!t.skLoading))},dependencies:[Q,te,I,w,M,P,E,O,j,Z,oe,Y,ee,re,H,A,L,q,K,$,W,J],encapsulation:2})};export{se as StockTransferAddComponent};
