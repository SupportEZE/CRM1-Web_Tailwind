import{a as ve}from"./chunk-J4NDCUAB.js";import{a as ye}from"./chunk-REKAXM5L.js";import{a as be}from"./chunk-ZON5AR26.js";import"./chunk-LGZVJJDX.js";import{a as Ce}from"./chunk-54KZ5YIV.js";import"./chunk-SQZ3YN6N.js";import{b as _e,c as de}from"./chunk-CIBZCVJQ.js";import{a as ge}from"./chunk-OTFCGVEU.js";import{a as ue}from"./chunk-HPLI5COI.js";import{b as fe}from"./chunk-DUVWFXSE.js";import{a as te}from"./chunk-CNF4GSI7.js";import{a as se}from"./chunk-OEHD5D2Y.js";import{a as he}from"./chunk-GLWQGYBC.js";import{a as ne}from"./chunk-DC4QM32I.js";import{F as pe,c as ie,q as le,s as me,u as ce}from"./chunk-VHE3PQ3O.js";import{$ as ee,F as I,Qa as oe,V as X,W as Y,Z,Za as ae,jb as re,l as U,v as z,w as J}from"./chunk-GYDYF5F3.js";import{K,M as Q,N as q,Q as G,f as $,g as O,o as j,t as W}from"./chunk-PD5VTTIY.js";import{$c as A,Aa as u,Ba as g,Bc as H,Fc as M,Gc as V,Hb as D,Hc as E,Mc as b,Nc as P,Ob as d,Oc as v,Yc as x,Zc as w,_b as l,ac as R,bc as L,ed as B,gd as N,kc as p,lc as c,mc as S,nc as h,oc as f,qc as y,rb as r,sb as _,wc as C,yc as s}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import"./chunk-66YHNWRR.js";var Se=["reusableTable"],F=()=>[],xe=(n,i,e)=>({name:n,count:i,label:e}),Le=n=>[n];function we(n,i){n&1&&S(0,"app-skeleton"),n&2&&L("w100 h25")}function Ie(n,i){n&1&&(h(0),d(1,we,1,2,"app-skeleton",11),f()),n&2&&(r(),l("ngForOf",x(1,F).constructor(4)))}function Fe(n,i){if(n&1){let e=y();p(0,"app-listing-tab",13),C("tabChange",function(o){u(e);let a=s(2);return g(a.onTabChange(o.tab))}),c()}if(n&2){let e=i.$implicit,t=s(2);l("tabs",w(6,Le,A(2,xe,e.name,e.value,e.name)))("activeTab",t.activeTab)}}function ke(n,i){if(n&1&&(h(0),d(1,Fe,1,8,"app-listing-tab",12),f()),n&2){let e=s();r(),l("ngForOf",e.mainTabs)}}function De(n,i){if(n&1&&(h(0),b(1),B(2,"date"),f()),n&2){let e,t=s(2).$implicit,o=s().$implicit,a=s(2);r(),v(" ",N(2,1,(e=o==null?null:o[t==null?null:t.name])!==null&&e!==void 0?e:o==null||o.form_data==null?null:o.form_data[t==null?null:t.name],a.getDateFormat(t==null?null:t.name))," ")}}function Re(n,i){if(n&1&&(h(0),b(1),f()),n&2){let e,t=s(2).$implicit,o=s().$implicit;r(),v(" ",(e=(e=o==null?null:o[t==null?null:t.name])!==null&&e!==void 0?e:o==null||o.form_data==null?null:o.form_data[t==null?null:t.name])!==null&&e!==void 0?e:"--"," ")}}function He(n,i){if(n&1&&(h(0),d(1,De,3,4,"ng-container",4)(2,Re,2,1,"ng-container",4),f()),n&2){let e,t,o=s().$implicit,a=s().$implicit,m=s(2);r(),l("ngIf",m.isValidDate((e=a==null?null:a[o==null?null:o.name])!==null&&e!==void 0?e:a==null||a.form_data==null?null:a.form_data[o==null?null:o.name])),r(),l("ngIf",!m.isValidDate((t=a==null?null:a[o==null?null:o.name])!==null&&t!==void 0?t:a==null||a.form_data==null?null:a.form_data[o==null?null:o.name]))}}function Me(n,i){if(n&1){let e=y();p(0,"span",20)(1,"a",21),C("click",function(){u(e);let o=s(2).$implicit,a=s(2);return g(a.setHighLight(o._id))}),b(2),c()()}if(n&2){let e=s().$implicit,t=s().$implicit,o=s(2);r(),l("routerLink",w(2,Le,"/apps/customer/customer-list/"+o.customerLoginType+"/"+o.customerLoginTypeId+"/"+o.customerType+"/"+o.customerTypeId+"/customer-detail/"+t._id)),r(),v(" ",t[e==null?null:e.name]||"--"," ")}}function Ve(n,i){if(n&1&&(h(0),p(1,"span",22),b(2),c(),f()),n&2){let e=s().$implicit,t=s().$implicit;r(),H("matTooltip",t[e==null?null:e.name]||(t.form_data==null?null:t.form_data[e==null?null:e.name])||"--"),r(),v(" ",t[e==null?null:e.name]||(t.form_data==null?null:t.form_data[e==null?null:e.name])||"--"," ")}}function Ee(n,i){if(n&1){let e=y();h(0),p(1,"app-toggle",24),C("checkedChange",function(o){u(e);let a=s(3).$implicit,m=s(2);return g(m.onToggleChange(o,a._id,a.status))}),c(),f()}if(n&2){let e=s(3).$implicit;r(),l("checked",e.isChecked)}}function Pe(n,i){if(n&1&&(p(0,"span",23),d(1,Ee,2,1,"ng-container",4),c()),n&2){let e=s(4);r(),l("ngIf",e.accessRight==null?null:e.accessRight.modifyRight)}}function Ae(n,i){if(n&1&&(p(0,"span"),b(1),c()),n&2){let e,t=s().$implicit,o=s().$implicit;r(),v(" ",(e=(e=o[(t==null?null:t.actual_name)||(t==null?null:t.name)])!==null&&e!==void 0?e:o.form_data==null?null:o.form_data[t==null?null:t.name])!==null&&e!==void 0?e:"--"," ")}}function Be(n,i){if(n&1&&(h(0),p(1,"td"),d(2,He,3,2,"ng-container",4)(3,Me,3,4,"span",18)(4,Ve,3,2,"ng-container",4)(5,Pe,2,1,"span",19)(6,Ae,2,1,"span",4),c(),f()),n&2){let e=i.$implicit,t=s(3);r(2),l("ngIf",t.isDateHeader(e==null?null:e.name)&&(e==null?null:e.name)!=="pincode"),r(),l("ngIf",(e==null?null:e.name)==="customer_name"),r(),l("ngIf",(e==null?null:e.name)==="assigned_user"||(e==null?null:e.name)==="assigned_customer"),r(),l("ngIf",(e==null?null:e.name)=="status"),r(),l("ngIf",!(e!=null&&e.name.includes("date")||e!=null&&e.name.endsWith("_at")||e!=null&&e.name.endsWith("_app_login")||e!=null&&e.name.endsWith("dob")||(e==null?null:e.name)==="status"||(e==null?null:e.name)==="customer_name"||(e==null?null:e.name)==="assigned_user"||(e==null?null:e.name)==="assigned_customer"))}}function Ne(n,i){if(n&1&&(p(0,"tr",15)(1,"td",16),b(2),c(),d(3,Be,7,5,"ng-container",17),c()),n&2){let e=i.$implicit,t=i.index,o=s(2);R("bg-gray-400",o.isHighlighted(e._id)),r(2),P((o.pagination.cur_page-1)*o.pagination.limit+t+1),r(),l("ngForOf",o.visibleHeaders)}}function $e(n,i){if(n&1&&(h(0),d(1,Ne,4,4,"tr",14),f()),n&2){let e=s();r(),l("ngForOf",e.listData)}}function Oe(n,i){n&1&&(p(0,"td"),S(1,"app-skeleton"),c()),n&2&&(r(),L("h20 bg-skeleton"))}function je(n,i){n&1&&(p(0,"tr",26),d(1,Oe,2,2,"td",17),c()),n&2&&(r(),l("ngForOf",x(1,F).constructor(11)))}function We(n,i){n&1&&(h(0),d(1,je,2,2,"tr",25),f()),n&2&&(r(),l("ngForOf",x(1,F).constructor(8)))}function Ke(n,i){n&1&&(h(0),S(1,"app-data-not-found"),f())}var Te=class n{constructor(i,e,t,o,a,m,T,k,Qe,qe,Ge,Ue,ze,Je){this.toastr=i;this.api=e;this.remove=t;this.logService=o;this.alert=a;this.router=m;this.dialog=T;this.fb=k;this.moduleService=Qe;this.comanFuncation=qe;this.dateService=Ge;this.route=Ue;this.CommonApiService=ze;this.highlightService=Je;this.range=this.fb.group({start:new I(null),end:new I(null)})}reusableTable;Date=Date;isNaN=isNaN;range;customerType;customerTypeId;customerLoginType;customerLoginTypeId;skLoading=!1;filter={};sorting={};userPageDropdowns={};listData=[];pagination={};submodule;FORMID=ue;fieldTypes=U;activeTab="Active";pageKey="customer-list";highlightedId;accessRight={};ngOnInit(){let i=this.moduleService.getAccessMap("Customers");i&&(this.accessRight=i),this.route.params.subscribe(e=>{if(e){this.customerLoginType=e.login_type,this.customerLoginTypeId=e.login_type_id,this.customerType=e.type_name,this.customerTypeId=e.type_id;let t=this.highlightService.getHighlight(this.pageKey);t!==void 0?(this.activeTab=t.tab,this.highlightedId=t.rowId,this.pagination.cur_page=t.pageIndex,this.filter=t.filters,this.highlightService.clearHighlight(this.pageKey)):this.activeTab=this.customerLoginType==="Influencer"?"Pending":"Active";let o=this.moduleService.getModuleByName("Customers");this.customerType=this.customerType?.replace(/_/g," ")||"";let a=o?.children?.find(k=>k.title===this.customerType),m,T;a&&a.tables?.length&&(T=a.tables[0]),a&&a.forms?.length&&(m=a.forms[0]),o&&(this.submodule=o),m&&T&&(this.submodule.form_id=m.form_id,this.submodule.table_id=T.table_id,this.getHeaderConfigListing())}})}isHighlighted(i){return this.highlightedId===i}setHighLight(i){this.comanFuncation.setHighLight(this.pageKey,i,this.activeTab,this.filter,this.pagination.cur_page?this.pagination.cur_page:1)}mainTabs=[];getList(){this.skLoading=!0,this.filter.state&&this.getDistrict(this.filter.state),this.api.post({filters:this.filter,login_type_name:this.customerLoginType,login_type_id:Number(this.customerLoginTypeId),customer_type_name:this.customerType,customer_type_id:this.customerTypeId,sorting:this.sorting,page:this.pagination.cur_page??1,active_tab:this.activeTab,dropdown:this.userPageDropdowns},"customer/read").subscribe(i=>{i.statusCode===200&&(this.skLoading=!1,this.listData=i.data.result,this.mainTabs=i.data.profile_status_tabs,this.listData.forEach(e=>e.isChecked=e.status==="Active"),this.pagination=i.pagination)})}getState(){this.api.post({},"postal-code/states").subscribe(i=>{if(i.statusCode===200)for(let e=0;e<this.visibleHeaders.length;e++)this.visibleHeaders[e].name==="state"&&(this.visibleHeaders[e].options=i.data)})}getDistrict(i){this.api.post({state:i},"postal-code/districts").subscribe(e=>{if(e.statusCode===200)for(let t=0;t<this.visibleHeaders.length;t++)this.visibleHeaders[t].name==="district"&&(this.visibleHeaders[t].options=e.data)})}changeToPagination(i){i=="Previous"?this.pagination.prev&&this.pagination.cur_page>1&&(this.pagination.cur_page--,this.getList()):this.pagination.next&&(this.pagination.cur_page++,this.getList())}changeToPage(i){this.pagination.cur_page=i,this.getList()}onTabChange(i){this.activeTab=i,this.getList()}tableConfigData={};visibleHeaders=[];getHeaderConfigListing(){this.CommonApiService.getHeaderConfigListing(this.submodule.table_id,this.submodule.form_id).subscribe(i=>{this.tableConfigData=i.data.table_data;let e=this.tableConfigData.tableHead;this.visibleHeaders=e.filter(t=>t.list_view_checked&&t.key_name_required!==!0&&t.type!=this.fieldTypes.UPLOAD),this.getList()})}onSortChanged(i){this.sorting={},this.sorting[i.field]=i.order,this.getList()}handleSelectionChange(i){let{category_name:e,selections:t}=i;this.filter[e]=t,this.getList()}updateSearchFilter(i){this.filter[i.name]=i.searchText,this.getList()}handleDateRangeChange(i){this.filter=i,this.getList()}onRefresh(){this.filter={},this.reusableTable.clearSearchInputs(),this.getHeaderConfigListing()}openMainLogModal(i){this.comanFuncation.listLogsModal(this.submodule.module_id,i,this.submodule.module_type).subscribe(e=>{})}onToggleChange(i,e,t){this.comanFuncation.statusChange(i,e,t,this.submodule,"toggle","customer/update-status").subscribe(o=>{o?this.getHeaderConfigListing():this.getHeaderConfigListing()})}goToPage(){this.router.navigate(["/apps/customer/customer-list/"+this.customerLoginType+"/"+this.customerLoginTypeId+"/"+this.customerType+"/"+this.customerTypeId+"/customer-add"])}openHeaderSettingModal(){this.dialog.open(be,{width:"450px",panelClass:"mat-right-modal",position:{right:"0px"},data:{lastPage:"header-config",moduleFormId:this.submodule.form_id,moduleTableId:this.submodule.table_id,moduleName:this.submodule.title,tableConfigData:this.tableConfigData}}).afterClosed().subscribe(e=>{e===!0&&(this.visibleHeaders=e.headers,this.getHeaderConfigListing())})}isValidDate(i){return typeof i=="string"&&!isNaN(Date.parse(i))}isDateHeader(i){return i?.includes("date")||i?.endsWith("_at")||i?.endsWith("_app_login")||i?.endsWith("dob")}getDateFormat(i){return["dob"].includes(i)?"d MMM yyyy":"d MMM yyyy, hh:mm a"}static \u0275fac=function(e){return new(e||n)(_(J),_(Z),_(Ce),_(ge),_(ee),_(Q),_(oe),_(X),_(ne),_(de),_(re),_(K),_(te),_(_e))};static \u0275cmp=D({type:n,selectors:[["app-customer-list"]],viewQuery:function(e,t){if(e&1&&M(Se,5),e&2){let o;V(o=E())&&(t.reusableTable=o.first)}},decls:15,vars:35,consts:[["reusableTable",""],[3,"buttonClick","title","title1","activeitem","btnShow","icon","buttonText"],[1,"box","py-3","px-4"],["aria-label","Tabs","role","tablist",1,"sm:flex","sm:space-x-2","sm:rtl:space-x-reverse","gap-1"],[4,"ngIf"],[1,"row"],[1,"col-xl-12"],[3,"onRefresh","logBtn","button1","pageTitle","listLength","btnShow","refreshLabel","btnShow1","logsLabel","btnShow2","addBtnLabel"],[1,"table-responsive","overflow-auto","table-bordered-default"],["tableClass","ti-custom-table ti-custom-table-head ti-custom-table-hover ti-head-primary whitespace-nowrap",3,"sortChanged","selectionChange","textSearchChange","dateRangeChange","tableHead","showCheckbox","showS_No","showSorting","showFilterRow","showAction","columns","subModule"],[3,"preButtonClick","nextButtonClick","pageChange","currentPage","totalPage","pageLimit","listLength","preBtn","nextBtn"],[3,"class",4,"ngFor","ngForOf"],[3,"tabs","activeTab","tabChange",4,"ngFor","ngForOf"],[3,"tabChange","tabs","activeTab"],["class","user-list border-b !border-defaultborder dark:!border-defaultborder/10",3,"bg-gray-400",4,"ngFor","ngForOf"],[1,"user-list","border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"!text-center"],[4,"ngFor","ngForOf"],["class","font-semibold",4,"ngIf"],["class","badge",4,"ngIf"],[1,"font-semibold"],[1,"text-primary","underline",3,"click","routerLink"],[1,"ellipsis",3,"matTooltip"],[1,"badge"],[3,"checkedChange","checked"],["class","border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[1,"border-b","!border-defaultborder","dark:!border-defaultborder/10"]],template:function(e,t){if(e&1){let o=y();p(0,"app-page-header",1),C("buttonClick",function(){return u(o),g(t.openHeaderSettingModal())}),c(),p(1,"div",2)(2,"nav",3),d(3,Ie,2,2,"ng-container",4)(4,ke,2,1,"ng-container",4),c(),p(5,"div",5)(6,"div",6)(7,"app-page-sub-header",7),C("onRefresh",function(){return u(o),g(t.onRefresh())})("logBtn",function(){return u(o),g(t.openMainLogModal(""))})("button1",function(){return u(o),g(t.goToPage())}),c(),p(8,"div",8)(9,"spk-reusable-tables",9,0),C("sortChanged",function(m){return u(o),g(t.onSortChanged(m))})("selectionChange",function(m){return u(o),g(t.handleSelectionChange(m))})("textSearchChange",function(m){return u(o),g(t.updateSearchFilter(m))})("dateRangeChange",function(m){return u(o),g(t.handleDateRangeChange(m))}),d(11,$e,2,1,"ng-container",4)(12,We,2,2,"ng-container",4),c(),d(13,Ke,2,0,"ng-container",4),c(),p(14,"app-pagination-footer",10),C("preButtonClick",function(){return u(o),g(t.changeToPagination("Previous"))})("nextButtonClick",function(){return u(o),g(t.changeToPagination("Next"))})("pageChange",function(m){return u(o),g(t.changeToPage(m))}),c()()()()}e&2&&(l("title","Customer")("title1",t.remove.formatText(t.customerType))("activeitem",t.remove.formatText(t.customerType)+" List")("btnShow",t.accessRight==null?null:t.accessRight.modifyRight)("icon","settings")("buttonText","Header Config"),r(3),l("ngIf",t.skLoading),r(),l("ngIf",!t.skLoading&&t.mainTabs.length>0),r(3),L("p-0 pt-3"),l("pageTitle",t.remove.formatText(t.customerType)+" List")("listLength",t.pagination.total)("btnShow",!0)("refreshLabel","Refresh")("btnShow1",!0)("logsLabel","Logs")("btnShow2",t.accessRight==null?null:t.accessRight.addRight)("addBtnLabel","Add "+t.remove.formatText(t.customerType)),r(2),l("tableHead","border-b")("showCheckbox",!1)("showS_No",!0)("showSorting",!0)("showFilterRow",!0)("showAction",!1)("columns",t.visibleHeaders)("subModule",t.submodule),r(2),l("ngIf",!t.skLoading),r(),l("ngIf",t.skLoading),r(),l("ngIf",!t.listData.length&&!t.skLoading),r(),l("currentPage",t.pagination.cur_page)("totalPage",t.pagination.total_pages)("pageLimit",t.pagination.limit)("listLength",t.listData.length)("preBtn",!t.pagination.prev)("nextBtn",!t.pagination.next))},dependencies:[pe,$,O,he,ie,me,le,ve,ye,ce,ae,j,W,G,q,se,Y,fe,z],encapsulation:2})};export{Te as CustomerListComponent};
