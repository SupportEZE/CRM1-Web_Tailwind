import{a as Qe}from"./chunk-QJWAKITZ.js";import{a as Fe,b as In,e as Tr,k as br,l as Ay}from"./chunk-652BJ45M.js";import{A as Vt,B as Jn,C as cl,D as to,E as gh,F as by,H as Cy,J as H,K as Tt,L as $e,M as _h,N as Sy,O as no,P as le,Q as nn,R as hl,S as yh,T as Ft,U as Er,_ as dl,a as F,aa as fl,b as wr,c as gy,d as _y,e as yy,fa as Ir,h as _t,i as ll,j as eo,k as mh,n as vy,p as tn,q as ph,r as wy,u as Ey,w as ul,x as je,y as Iy,z as Ty}from"./chunk-6BBIP5QY.js";import{a as hy}from"./chunk-CNF4GSI7.js";import{C as my,F as py,g as dy,v as fy}from"./chunk-VHE3PQ3O.js";import{A as qe,B as Z_,C as ey,H as ty,M as ny,P as iy,R as ry,T as sy,V as oy,W as ay,X as ly,Z as uy,aa as cy,c as H_,d as hh,f as ol,h as dh,q as al,u as fh,v as Y_,w as J_,z as X_}from"./chunk-GYDYF5F3.js";import{F as z_,G as K_,M as W_,N as $_,Q as Q_,b as M_,c as U_,e as B_,f as q_,g as j_,t as G_,v as sl}from"./chunk-PD5VTTIY.js";import{$ as nl,Aa as be,Ba as Ce,Bc as il,Cc as P_,Dc as k_,F as Js,Fc as Qn,G as Xs,Gc as Hn,Hb as x_,Hc as Yn,Ib as $n,La as pt,Lc as Gt,Mc as oe,Nc as Zs,Ob as Be,Oc as N_,P as Za,Pa as S_,S as el,Ua as Kn,Uc as D_,V as tl,Vc as V_,W as Vi,Wc as F_,X as I_,Xc as O_,Y as ah,Yc as rl,Zc as uh,_ as T_,_b as X,aa as En,ba as lh,c as Di,cc as R_,f as E_,fa as b_,j as Ja,ka as jn,kc as B,la as Gn,lb as Wn,lc as q,ld as L_,mc as De,n as Ys,na as Xe,nc as Zt,o as Xa,oc as en,p as qn,pa as Y,pd as ch,q as Xt,qa as At,qc as Fi,ra as C_,rb as Q,sb as gt,v as Ne,wa as zn,wc as nt,xb as A_,yc as ie}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as Je,b as jt,h as oh,i as N}from"./chunk-66YHNWRR.js";var Tb="firebase",bb="11.2.0";Qe.registerVersion(Tb,bb,"app-compat");var Cb=["ngOnDestroy"],Ry=(n,e,t,i={})=>new Proxy(n,{get:(r,s)=>t.runOutsideAngular(()=>{if(n[s])return i?.spy?.get&&i.spy.get(s,n[s]),n[s];if(Cb.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let u=a?.[s];return typeof u=="function"?u.bind(a):u?.then?u.then(c=>t.run(()=>c)):t.run(()=>u)});return new Proxy(()=>{},{get:(a,u)=>o[u],apply:(a,u,c)=>o.then(d=>{let m=d?.(...c);return i?.spy?.apply&&i.spy.apply(s,c,m),m})})})});var ml=class{constructor(e){return e}},Xn=new Xe("angularfire2.app.options"),Zn=new Xe("angularfire2.app.name");function Oi(n,e,t){let i=typeof t=="string"&&t||"[DEFAULT]",r=typeof t=="object"&&t||{};r.name=r.name||i;let o=Qe.apps.filter(a=>a&&a.name===r.name)[0]||e.runOutsideAngular(()=>Qe.initializeApp(n,r));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;Sb("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new ml(o)}var Sb=(n,...e)=>{ch()&&typeof console<"u"&&console[n](...e)},Ab={provide:ml,useFactory:Oi,deps:[Xn,pt,[new C_,Zn]]},Py=(()=>{class n{static initializeApp(t,i){return{ngModule:n,providers:[{provide:Xn,useValue:t},{provide:Zn,useValue:i}]}}constructor(t){Qe.registerVersion("angularfire",In.full,"core"),Qe.registerVersion("angularfire",In.full,"app-compat"),Qe.registerVersion("angular",L_.full,t.toString())}static \u0275fac=function(i){return new(i||n)(Y(Kn))};static \u0275mod=$n({type:n});static \u0275inj=Gn({providers:[Ab]})}return n})();function Cr(n,e,t,i,r){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return xb(r,o)||(xy("error",`${e} was already initialized on the ${t} Firebase App with different settings.${Rb?" You may need to reload as Firebase is not HMR aware.":""}`),xy("warn",{is:r,was:o})),s;{let a=i();return globalThis.\u0275AngularfireInstanceCache.push([n,a,r]),a}}function xb(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var Rb=typeof module<"u"&&!!module.hot,xy=(n,...e)=>{ch()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var ro=new Xe("angularfire2.auth.use-emulator"),so=new Xe("angularfire2.auth.settings"),oo=new Xe("angularfire2.auth.tenant-id"),ao=new Xe("angularfire2.auth.langugage-code"),lo=new Xe("angularfire2.auth.use-device-language"),uo=new Xe("angularfire.auth.persistence"),co=(n,e,t,i,r,s,o,a)=>Cr(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let u=e.runOutsideAngular(()=>n.auth());if(t&&u.useEmulator(...t),i&&(u.tenantId=i),u.languageCode=r,s&&u.useDeviceLanguage(),o)for(let[c,d]of Object.entries(o))u.settings[c]=d;return a&&u.setPersistence(a),u},[t,i,r,s,o,a]),ho=(()=>{class n{injector=At(zn);authState;idToken;user;idTokenResult;credential;constructor(t,i,r,s,o,a,u,c,d,m,p,y){let C=new E_,P=Xt(void 0).pipe(Ys(o.outsideAngular),En(()=>s.runOutsideAngular(()=>import("./chunk-53NKRMCD.js"))),Ne(()=>Oi(t,s,i)),Ne(k=>co(k,s,a,c,d,m,u,p)),ah({bufferSize:1,refCount:!1}));if(sl(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Xt(null);else{P.pipe(el()).subscribe();let k=P.pipe(En(O=>O.getRedirectResult().then($=>$,()=>null)),Fe(this.injector),ah({bufferSize:1,refCount:!1})),G=P.pipe(En(O=>new Di($=>({unsubscribe:s.runOutsideAngular(()=>O.onAuthStateChanged(Z=>$.next(Z),Z=>$.error(Z),()=>$.complete()))})))),K=P.pipe(En(O=>new Di($=>({unsubscribe:s.runOutsideAngular(()=>O.onIdTokenChanged(Z=>$.next(Z),Z=>$.error(Z),()=>$.complete()))}))));this.authState=k.pipe(lh(G),Xa(o.outsideAngular),Ys(o.insideAngular)),this.user=k.pipe(lh(K),Xa(o.outsideAngular),Ys(o.insideAngular)),this.idToken=this.user.pipe(En(O=>O?qn(O.getIdToken()):Xt(null))),this.idTokenResult=this.user.pipe(En(O=>O?qn(O.getIdTokenResult()):Xt(null))),this.credential=Js(k,C,this.authState.pipe(Xs(O=>!O))).pipe(Ne(O=>O?.user?O:null),Xa(o.outsideAngular),Ys(o.insideAngular))}return Ry(this,P,s,{spy:{apply:(k,G,K)=>{(k.startsWith("signIn")||k.startsWith("createUser"))&&K.then(O=>C.next(O))}}})}static \u0275fac=function(i){return new(i||n)(Y(Xn),Y(Zn,8),Y(Kn),Y(pt),Y(Tr),Y(ro,8),Y(so,8),Y(oo,8),Y(ao,8),Y(lo,8),Y(uo,8),Y(br,8))};static \u0275prov=jn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),Dy=(()=>{class n{constructor(){Qe.registerVersion("angularfire",In.full,"auth-compat")}static \u0275fac=function(i){return new(i||n)};static \u0275mod=$n({type:n});static \u0275inj=Gn({providers:[ho]})}return n})();var Fy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Oy={};var Tn,vh;(function(){var n;function e(E,_){function w(){}w.prototype=_.prototype,E.D=_.prototype,E.prototype=new w,E.prototype.constructor=E,E.C=function(I,T,S){for(var v=Array(arguments.length-2),yn=2;yn<arguments.length;yn++)v[yn-2]=arguments[yn];return _.prototype[T].apply(I,v)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(E,_,w){w||(w=0);var I=Array(16);if(typeof _=="string")for(var T=0;16>T;++T)I[T]=_.charCodeAt(w++)|_.charCodeAt(w++)<<8|_.charCodeAt(w++)<<16|_.charCodeAt(w++)<<24;else for(T=0;16>T;++T)I[T]=_[w++]|_[w++]<<8|_[w++]<<16|_[w++]<<24;_=E.g[0],w=E.g[1],T=E.g[2];var S=E.g[3],v=_+(S^w&(T^S))+I[0]+3614090360&4294967295;_=w+(v<<7&4294967295|v>>>25),v=S+(T^_&(w^T))+I[1]+3905402710&4294967295,S=_+(v<<12&4294967295|v>>>20),v=T+(w^S&(_^w))+I[2]+606105819&4294967295,T=S+(v<<17&4294967295|v>>>15),v=w+(_^T&(S^_))+I[3]+3250441966&4294967295,w=T+(v<<22&4294967295|v>>>10),v=_+(S^w&(T^S))+I[4]+4118548399&4294967295,_=w+(v<<7&4294967295|v>>>25),v=S+(T^_&(w^T))+I[5]+1200080426&4294967295,S=_+(v<<12&4294967295|v>>>20),v=T+(w^S&(_^w))+I[6]+2821735955&4294967295,T=S+(v<<17&4294967295|v>>>15),v=w+(_^T&(S^_))+I[7]+4249261313&4294967295,w=T+(v<<22&4294967295|v>>>10),v=_+(S^w&(T^S))+I[8]+1770035416&4294967295,_=w+(v<<7&4294967295|v>>>25),v=S+(T^_&(w^T))+I[9]+2336552879&4294967295,S=_+(v<<12&4294967295|v>>>20),v=T+(w^S&(_^w))+I[10]+4294925233&4294967295,T=S+(v<<17&4294967295|v>>>15),v=w+(_^T&(S^_))+I[11]+2304563134&4294967295,w=T+(v<<22&4294967295|v>>>10),v=_+(S^w&(T^S))+I[12]+1804603682&4294967295,_=w+(v<<7&4294967295|v>>>25),v=S+(T^_&(w^T))+I[13]+4254626195&4294967295,S=_+(v<<12&4294967295|v>>>20),v=T+(w^S&(_^w))+I[14]+2792965006&4294967295,T=S+(v<<17&4294967295|v>>>15),v=w+(_^T&(S^_))+I[15]+1236535329&4294967295,w=T+(v<<22&4294967295|v>>>10),v=_+(T^S&(w^T))+I[1]+4129170786&4294967295,_=w+(v<<5&4294967295|v>>>27),v=S+(w^T&(_^w))+I[6]+3225465664&4294967295,S=_+(v<<9&4294967295|v>>>23),v=T+(_^w&(S^_))+I[11]+643717713&4294967295,T=S+(v<<14&4294967295|v>>>18),v=w+(S^_&(T^S))+I[0]+3921069994&4294967295,w=T+(v<<20&4294967295|v>>>12),v=_+(T^S&(w^T))+I[5]+3593408605&4294967295,_=w+(v<<5&4294967295|v>>>27),v=S+(w^T&(_^w))+I[10]+38016083&4294967295,S=_+(v<<9&4294967295|v>>>23),v=T+(_^w&(S^_))+I[15]+3634488961&4294967295,T=S+(v<<14&4294967295|v>>>18),v=w+(S^_&(T^S))+I[4]+3889429448&4294967295,w=T+(v<<20&4294967295|v>>>12),v=_+(T^S&(w^T))+I[9]+568446438&4294967295,_=w+(v<<5&4294967295|v>>>27),v=S+(w^T&(_^w))+I[14]+3275163606&4294967295,S=_+(v<<9&4294967295|v>>>23),v=T+(_^w&(S^_))+I[3]+4107603335&4294967295,T=S+(v<<14&4294967295|v>>>18),v=w+(S^_&(T^S))+I[8]+1163531501&4294967295,w=T+(v<<20&4294967295|v>>>12),v=_+(T^S&(w^T))+I[13]+2850285829&4294967295,_=w+(v<<5&4294967295|v>>>27),v=S+(w^T&(_^w))+I[2]+4243563512&4294967295,S=_+(v<<9&4294967295|v>>>23),v=T+(_^w&(S^_))+I[7]+1735328473&4294967295,T=S+(v<<14&4294967295|v>>>18),v=w+(S^_&(T^S))+I[12]+2368359562&4294967295,w=T+(v<<20&4294967295|v>>>12),v=_+(w^T^S)+I[5]+4294588738&4294967295,_=w+(v<<4&4294967295|v>>>28),v=S+(_^w^T)+I[8]+2272392833&4294967295,S=_+(v<<11&4294967295|v>>>21),v=T+(S^_^w)+I[11]+1839030562&4294967295,T=S+(v<<16&4294967295|v>>>16),v=w+(T^S^_)+I[14]+4259657740&4294967295,w=T+(v<<23&4294967295|v>>>9),v=_+(w^T^S)+I[1]+2763975236&4294967295,_=w+(v<<4&4294967295|v>>>28),v=S+(_^w^T)+I[4]+1272893353&4294967295,S=_+(v<<11&4294967295|v>>>21),v=T+(S^_^w)+I[7]+4139469664&4294967295,T=S+(v<<16&4294967295|v>>>16),v=w+(T^S^_)+I[10]+3200236656&4294967295,w=T+(v<<23&4294967295|v>>>9),v=_+(w^T^S)+I[13]+681279174&4294967295,_=w+(v<<4&4294967295|v>>>28),v=S+(_^w^T)+I[0]+3936430074&4294967295,S=_+(v<<11&4294967295|v>>>21),v=T+(S^_^w)+I[3]+3572445317&4294967295,T=S+(v<<16&4294967295|v>>>16),v=w+(T^S^_)+I[6]+76029189&4294967295,w=T+(v<<23&4294967295|v>>>9),v=_+(w^T^S)+I[9]+3654602809&4294967295,_=w+(v<<4&4294967295|v>>>28),v=S+(_^w^T)+I[12]+3873151461&4294967295,S=_+(v<<11&4294967295|v>>>21),v=T+(S^_^w)+I[15]+530742520&4294967295,T=S+(v<<16&4294967295|v>>>16),v=w+(T^S^_)+I[2]+3299628645&4294967295,w=T+(v<<23&4294967295|v>>>9),v=_+(T^(w|~S))+I[0]+4096336452&4294967295,_=w+(v<<6&4294967295|v>>>26),v=S+(w^(_|~T))+I[7]+1126891415&4294967295,S=_+(v<<10&4294967295|v>>>22),v=T+(_^(S|~w))+I[14]+2878612391&4294967295,T=S+(v<<15&4294967295|v>>>17),v=w+(S^(T|~_))+I[5]+4237533241&4294967295,w=T+(v<<21&4294967295|v>>>11),v=_+(T^(w|~S))+I[12]+1700485571&4294967295,_=w+(v<<6&4294967295|v>>>26),v=S+(w^(_|~T))+I[3]+2399980690&4294967295,S=_+(v<<10&4294967295|v>>>22),v=T+(_^(S|~w))+I[10]+4293915773&4294967295,T=S+(v<<15&4294967295|v>>>17),v=w+(S^(T|~_))+I[1]+2240044497&4294967295,w=T+(v<<21&4294967295|v>>>11),v=_+(T^(w|~S))+I[8]+1873313359&4294967295,_=w+(v<<6&4294967295|v>>>26),v=S+(w^(_|~T))+I[15]+4264355552&4294967295,S=_+(v<<10&4294967295|v>>>22),v=T+(_^(S|~w))+I[6]+2734768916&4294967295,T=S+(v<<15&4294967295|v>>>17),v=w+(S^(T|~_))+I[13]+1309151649&4294967295,w=T+(v<<21&4294967295|v>>>11),v=_+(T^(w|~S))+I[4]+4149444226&4294967295,_=w+(v<<6&4294967295|v>>>26),v=S+(w^(_|~T))+I[11]+3174756917&4294967295,S=_+(v<<10&4294967295|v>>>22),v=T+(_^(S|~w))+I[2]+718787259&4294967295,T=S+(v<<15&4294967295|v>>>17),v=w+(S^(T|~_))+I[9]+3951481745&4294967295,E.g[0]=E.g[0]+_&4294967295,E.g[1]=E.g[1]+(T+(v<<21&4294967295|v>>>11))&4294967295,E.g[2]=E.g[2]+T&4294967295,E.g[3]=E.g[3]+S&4294967295}i.prototype.u=function(E,_){_===void 0&&(_=E.length);for(var w=_-this.blockSize,I=this.B,T=this.h,S=0;S<_;){if(T==0)for(;S<=w;)r(this,E,S),S+=this.blockSize;if(typeof E=="string"){for(;S<_;)if(I[T++]=E.charCodeAt(S++),T==this.blockSize){r(this,I),T=0;break}}else for(;S<_;)if(I[T++]=E[S++],T==this.blockSize){r(this,I),T=0;break}}this.h=T,this.o+=_},i.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var _=1;_<E.length-8;++_)E[_]=0;var w=8*this.o;for(_=E.length-8;_<E.length;++_)E[_]=w&255,w/=256;for(this.u(E),E=Array(16),_=w=0;4>_;++_)for(var I=0;32>I;I+=8)E[w++]=this.g[_]>>>I&255;return E};function s(E,_){var w=a;return Object.prototype.hasOwnProperty.call(w,E)?w[E]:w[E]=_(E)}function o(E,_){this.h=_;for(var w=[],I=!0,T=E.length-1;0<=T;T--){var S=E[T]|0;I&&S==_||(w[T]=S,I=!1)}this.g=w}var a={};function u(E){return-128<=E&&128>E?s(E,function(_){return new o([_|0],0>_?-1:0)}):new o([E|0],0>E?-1:0)}function c(E){if(isNaN(E)||!isFinite(E))return m;if(0>E)return k(c(-E));for(var _=[],w=1,I=0;E>=w;I++)_[I]=E/w|0,w*=4294967296;return new o(_,0)}function d(E,_){if(E.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(E.charAt(0)=="-")return k(d(E.substring(1),_));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=c(Math.pow(_,8)),I=m,T=0;T<E.length;T+=8){var S=Math.min(8,E.length-T),v=parseInt(E.substring(T,T+S),_);8>S?(S=c(Math.pow(_,S)),I=I.j(S).add(c(v))):(I=I.j(w),I=I.add(c(v)))}return I}var m=u(0),p=u(1),y=u(16777216);n=o.prototype,n.m=function(){if(P(this))return-k(this).m();for(var E=0,_=1,w=0;w<this.g.length;w++){var I=this.i(w);E+=(0<=I?I:4294967296+I)*_,_*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(C(this))return"0";if(P(this))return"-"+k(this).toString(E);for(var _=c(Math.pow(E,6)),w=this,I="";;){var T=$(w,_).g;w=G(w,T.j(_));var S=((0<w.g.length?w.g[0]:w.h)>>>0).toString(E);if(w=T,C(w))return S+I;for(;6>S.length;)S="0"+S;I=S+I}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function C(E){if(E.h!=0)return!1;for(var _=0;_<E.g.length;_++)if(E.g[_]!=0)return!1;return!0}function P(E){return E.h==-1}n.l=function(E){return E=G(this,E),P(E)?-1:C(E)?0:1};function k(E){for(var _=E.g.length,w=[],I=0;I<_;I++)w[I]=~E.g[I];return new o(w,~E.h).add(p)}n.abs=function(){return P(this)?k(this):this},n.add=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],I=0,T=0;T<=_;T++){var S=I+(this.i(T)&65535)+(E.i(T)&65535),v=(S>>>16)+(this.i(T)>>>16)+(E.i(T)>>>16);I=v>>>16,S&=65535,v&=65535,w[T]=v<<16|S}return new o(w,w[w.length-1]&-2147483648?-1:0)};function G(E,_){return E.add(k(_))}n.j=function(E){if(C(this)||C(E))return m;if(P(this))return P(E)?k(this).j(k(E)):k(k(this).j(E));if(P(E))return k(this.j(k(E)));if(0>this.l(y)&&0>E.l(y))return c(this.m()*E.m());for(var _=this.g.length+E.g.length,w=[],I=0;I<2*_;I++)w[I]=0;for(I=0;I<this.g.length;I++)for(var T=0;T<E.g.length;T++){var S=this.i(I)>>>16,v=this.i(I)&65535,yn=E.i(T)>>>16,ks=E.i(T)&65535;w[2*I+2*T]+=v*ks,K(w,2*I+2*T),w[2*I+2*T+1]+=S*ks,K(w,2*I+2*T+1),w[2*I+2*T+1]+=v*yn,K(w,2*I+2*T+1),w[2*I+2*T+2]+=S*yn,K(w,2*I+2*T+2)}for(I=0;I<_;I++)w[I]=w[2*I+1]<<16|w[2*I];for(I=_;I<2*_;I++)w[I]=0;return new o(w,0)};function K(E,_){for(;(E[_]&65535)!=E[_];)E[_+1]+=E[_]>>>16,E[_]&=65535,_++}function O(E,_){this.g=E,this.h=_}function $(E,_){if(C(_))throw Error("division by zero");if(C(E))return new O(m,m);if(P(E))return _=$(k(E),_),new O(k(_.g),k(_.h));if(P(_))return _=$(E,k(_)),new O(k(_.g),_.h);if(30<E.g.length){if(P(E)||P(_))throw Error("slowDivide_ only works with positive integers.");for(var w=p,I=_;0>=I.l(E);)w=Z(w),I=Z(I);var T=ee(w,1),S=ee(I,1);for(I=ee(I,2),w=ee(w,2);!C(I);){var v=S.add(I);0>=v.l(E)&&(T=T.add(w),S=v),I=ee(I,1),w=ee(w,1)}return _=G(E,T.j(_)),new O(T,_)}for(T=m;0<=E.l(_);){for(w=Math.max(1,Math.floor(E.m()/_.m())),I=Math.ceil(Math.log(w)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),S=c(w),v=S.j(_);P(v)||0<v.l(E);)w-=I,S=c(w),v=S.j(_);C(S)&&(S=p),T=T.add(S),E=G(E,v)}return new O(T,E)}n.A=function(E){return $(this,E).h},n.and=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],I=0;I<_;I++)w[I]=this.i(I)&E.i(I);return new o(w,this.h&E.h)},n.or=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],I=0;I<_;I++)w[I]=this.i(I)|E.i(I);return new o(w,this.h|E.h)},n.xor=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],I=0;I<_;I++)w[I]=this.i(I)^E.i(I);return new o(w,this.h^E.h)};function Z(E){for(var _=E.g.length+1,w=[],I=0;I<_;I++)w[I]=E.i(I)<<1|E.i(I-1)>>>31;return new o(w,E.h)}function ee(E,_){var w=_>>5;_%=32;for(var I=E.g.length-w,T=[],S=0;S<I;S++)T[S]=0<_?E.i(S+w)>>>_|E.i(S+w+1)<<32-_:E.i(S+w);return new o(T,E.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,vh=Oy.Md5=i,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,Tn=Oy.Integer=o}).apply(typeof Fy<"u"?Fy:typeof self<"u"?self:typeof window<"u"?window:{});var pl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},bn={};var wh,Pb,Sr,Eh,fo,gl,Ih,Th,bh;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,h,f){return l==Array.prototype||l==Object.prototype||(l[h]=f.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof pl=="object"&&pl];for(var h=0;h<l.length;++h){var f=l[h];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var i=t(this);function r(l,h){if(h)e:{var f=i;l=l.split(".");for(var g=0;g<l.length-1;g++){var b=l[g];if(!(b in f))break e;f=f[b]}l=l[l.length-1],g=f[l],h=h(g),h!=g&&h!=null&&e(f,l,{configurable:!0,writable:!0,value:h})}}function s(l,h){l instanceof String&&(l+="");var f=0,g=!1,b={next:function(){if(!g&&f<l.length){var x=f++;return{value:h(x,l[x]),done:!1}}return g=!0,{done:!0,value:void 0}}};return b[Symbol.iterator]=function(){return b},b}r("Array.prototype.values",function(l){return l||function(){return s(this,function(h,f){return f})}});var o=o||{},a=this||self;function u(l){var h=typeof l;return h=h!="object"?h:l?Array.isArray(l)?"array":h:"null",h=="array"||h=="object"&&typeof l.length=="number"}function c(l){var h=typeof l;return h=="object"&&l!=null||h=="function"}function d(l,h,f){return l.call.apply(l.bind,arguments)}function m(l,h,f){if(!l)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var b=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(b,g),l.apply(h,b)}}return function(){return l.apply(h,arguments)}}function p(l,h,f){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:m,p.apply(null,arguments)}function y(l,h){var f=Array.prototype.slice.call(arguments,1);return function(){var g=f.slice();return g.push.apply(g,arguments),l.apply(this,g)}}function C(l,h){function f(){}f.prototype=h.prototype,l.aa=h.prototype,l.prototype=new f,l.prototype.constructor=l,l.Qb=function(g,b,x){for(var L=Array(arguments.length-2),ye=2;ye<arguments.length;ye++)L[ye-2]=arguments[ye];return h.prototype[b].apply(g,L)}}function P(l){let h=l.length;if(0<h){let f=Array(h);for(let g=0;g<h;g++)f[g]=l[g];return f}return[]}function k(l,h){for(let f=1;f<arguments.length;f++){let g=arguments[f];if(u(g)){let b=l.length||0,x=g.length||0;l.length=b+x;for(let L=0;L<x;L++)l[b+L]=g[L]}else l.push(g)}}class G{constructor(h,f){this.i=h,this.j=f,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function K(l){return/^[\s\xa0]*$/.test(l)}function O(){var l=a.navigator;return l&&(l=l.userAgent)?l:""}function $(l){return $[" "](l),l}$[" "]=function(){};var Z=O().indexOf("Gecko")!=-1&&!(O().toLowerCase().indexOf("webkit")!=-1&&O().indexOf("Edge")==-1)&&!(O().indexOf("Trident")!=-1||O().indexOf("MSIE")!=-1)&&O().indexOf("Edge")==-1;function ee(l,h,f){for(let g in l)h.call(f,l[g],g,l)}function E(l,h){for(let f in l)h.call(void 0,l[f],f,l)}function _(l){let h={};for(let f in l)h[f]=l[f];return h}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(l,h){let f,g;for(let b=1;b<arguments.length;b++){g=arguments[b];for(f in g)l[f]=g[f];for(let x=0;x<w.length;x++)f=w[x],Object.prototype.hasOwnProperty.call(g,f)&&(l[f]=g[f])}}function T(l){var h=1;l=l.split(":");let f=[];for(;0<h&&l.length;)f.push(l.shift()),h--;return l.length&&f.push(l.join(":")),f}function S(l){a.setTimeout(()=>{throw l},0)}function v(){var l=Fc;let h=null;return l.g&&(h=l.g,l.g=l.g.next,l.g||(l.h=null),h.next=null),h}class yn{constructor(){this.h=this.g=null}add(h,f){let g=ks.get();g.set(h,f),this.h?this.h.next=g:this.g=g,this.h=g}}var ks=new G(()=>new G0,l=>l.reset());class G0{constructor(){this.next=this.g=this.h=null}set(h,f){this.h=h,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let Ns,Ds=!1,Fc=new yn,wg=()=>{let l=a.Promise.resolve(void 0);Ns=()=>{l.then(z0)}};var z0=()=>{for(var l;l=v();){try{l.h.call(l.g)}catch(f){S(f)}var h=ks;h.j(l),100>h.h&&(h.h++,l.next=h.g,h.g=l)}Ds=!1};function Ln(){this.s=this.s,this.C=this.C}Ln.prototype.s=!1,Ln.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ln.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function st(l,h){this.type=l,this.g=this.target=h,this.defaultPrevented=!1}st.prototype.h=function(){this.defaultPrevented=!0};var K0=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var l=!1,h=Object.defineProperty({},"passive",{get:function(){l=!0}});try{let f=()=>{};a.addEventListener("test",f,h),a.removeEventListener("test",f,h)}catch{}return l}();function Vs(l,h){if(st.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var f=this.type=l.type,g=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=h,h=l.relatedTarget){if(Z){e:{try{$(h.nodeName);var b=!0;break e}catch{}b=!1}b||(h=null)}}else f=="mouseover"?h=l.fromElement:f=="mouseout"&&(h=l.toElement);this.relatedTarget=h,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:W0[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&Vs.aa.h.call(this)}}C(Vs,st);var W0={2:"touch",3:"pen",4:"mouse"};Vs.prototype.h=function(){Vs.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var Fs="closure_listenable_"+(1e6*Math.random()|0),$0=0;function Q0(l,h,f,g,b){this.listener=l,this.proxy=null,this.src=h,this.type=f,this.capture=!!g,this.ha=b,this.key=++$0,this.da=this.fa=!1}function Va(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function Fa(l){this.src=l,this.g={},this.h=0}Fa.prototype.add=function(l,h,f,g,b){var x=l.toString();l=this.g[x],l||(l=this.g[x]=[],this.h++);var L=Lc(l,h,g,b);return-1<L?(h=l[L],f||(h.fa=!1)):(h=new Q0(h,this.src,x,!!g,b),h.fa=f,l.push(h)),h};function Oc(l,h){var f=h.type;if(f in l.g){var g=l.g[f],b=Array.prototype.indexOf.call(g,h,void 0),x;(x=0<=b)&&Array.prototype.splice.call(g,b,1),x&&(Va(h),l.g[f].length==0&&(delete l.g[f],l.h--))}}function Lc(l,h,f,g){for(var b=0;b<l.length;++b){var x=l[b];if(!x.da&&x.listener==h&&x.capture==!!f&&x.ha==g)return b}return-1}var Mc="closure_lm_"+(1e6*Math.random()|0),Uc={};function Eg(l,h,f,g,b){if(g&&g.once)return Tg(l,h,f,g,b);if(Array.isArray(h)){for(var x=0;x<h.length;x++)Eg(l,h[x],f,g,b);return null}return f=Gc(f),l&&l[Fs]?l.K(h,f,c(g)?!!g.capture:!!g,b):Ig(l,h,f,!1,g,b)}function Ig(l,h,f,g,b,x){if(!h)throw Error("Invalid event type");var L=c(b)?!!b.capture:!!b,ye=qc(l);if(ye||(l[Mc]=ye=new Fa(l)),f=ye.add(h,f,g,L,x),f.proxy)return f;if(g=H0(),f.proxy=g,g.src=l,g.listener=f,l.addEventListener)K0||(b=L),b===void 0&&(b=!1),l.addEventListener(h.toString(),g,b);else if(l.attachEvent)l.attachEvent(Cg(h.toString()),g);else if(l.addListener&&l.removeListener)l.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return f}function H0(){function l(f){return h.call(l.src,l.listener,f)}let h=Y0;return l}function Tg(l,h,f,g,b){if(Array.isArray(h)){for(var x=0;x<h.length;x++)Tg(l,h[x],f,g,b);return null}return f=Gc(f),l&&l[Fs]?l.L(h,f,c(g)?!!g.capture:!!g,b):Ig(l,h,f,!0,g,b)}function bg(l,h,f,g,b){if(Array.isArray(h))for(var x=0;x<h.length;x++)bg(l,h[x],f,g,b);else g=c(g)?!!g.capture:!!g,f=Gc(f),l&&l[Fs]?(l=l.i,h=String(h).toString(),h in l.g&&(x=l.g[h],f=Lc(x,f,g,b),-1<f&&(Va(x[f]),Array.prototype.splice.call(x,f,1),x.length==0&&(delete l.g[h],l.h--)))):l&&(l=qc(l))&&(h=l.g[h.toString()],l=-1,h&&(l=Lc(h,f,g,b)),(f=-1<l?h[l]:null)&&Bc(f))}function Bc(l){if(typeof l!="number"&&l&&!l.da){var h=l.src;if(h&&h[Fs])Oc(h.i,l);else{var f=l.type,g=l.proxy;h.removeEventListener?h.removeEventListener(f,g,l.capture):h.detachEvent?h.detachEvent(Cg(f),g):h.addListener&&h.removeListener&&h.removeListener(g),(f=qc(h))?(Oc(f,l),f.h==0&&(f.src=null,h[Mc]=null)):Va(l)}}}function Cg(l){return l in Uc?Uc[l]:Uc[l]="on"+l}function Y0(l,h){if(l.da)l=!0;else{h=new Vs(h,this);var f=l.listener,g=l.ha||l.src;l.fa&&Bc(l),l=f.call(g,h)}return l}function qc(l){return l=l[Mc],l instanceof Fa?l:null}var jc="__closure_events_fn_"+(1e9*Math.random()>>>0);function Gc(l){return typeof l=="function"?l:(l[jc]||(l[jc]=function(h){return l.handleEvent(h)}),l[jc])}function ot(){Ln.call(this),this.i=new Fa(this),this.M=this,this.F=null}C(ot,Ln),ot.prototype[Fs]=!0,ot.prototype.removeEventListener=function(l,h,f,g){bg(this,l,h,f,g)};function ft(l,h){var f,g=l.F;if(g)for(f=[];g;g=g.F)f.push(g);if(l=l.M,g=h.type||h,typeof h=="string")h=new st(h,l);else if(h instanceof st)h.target=h.target||l;else{var b=h;h=new st(g,l),I(h,b)}if(b=!0,f)for(var x=f.length-1;0<=x;x--){var L=h.g=f[x];b=Oa(L,g,!0,h)&&b}if(L=h.g=l,b=Oa(L,g,!0,h)&&b,b=Oa(L,g,!1,h)&&b,f)for(x=0;x<f.length;x++)L=h.g=f[x],b=Oa(L,g,!1,h)&&b}ot.prototype.N=function(){if(ot.aa.N.call(this),this.i){var l=this.i,h;for(h in l.g){for(var f=l.g[h],g=0;g<f.length;g++)Va(f[g]);delete l.g[h],l.h--}}this.F=null},ot.prototype.K=function(l,h,f,g){return this.i.add(String(l),h,!1,f,g)},ot.prototype.L=function(l,h,f,g){return this.i.add(String(l),h,!0,f,g)};function Oa(l,h,f,g){if(h=l.i.g[String(h)],!h)return!0;h=h.concat();for(var b=!0,x=0;x<h.length;++x){var L=h[x];if(L&&!L.da&&L.capture==f){var ye=L.listener,tt=L.ha||L.src;L.fa&&Oc(l.i,L),b=ye.call(tt,g)!==!1&&b}}return b&&!g.defaultPrevented}function Sg(l,h,f){if(typeof l=="function")f&&(l=p(l,f));else if(l&&typeof l.handleEvent=="function")l=p(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(l,h||0)}function Ag(l){l.g=Sg(()=>{l.g=null,l.i&&(l.i=!1,Ag(l))},l.l);let h=l.h;l.h=null,l.m.apply(null,h)}class J0 extends Ln{constructor(h,f){super(),this.m=h,this.l=f,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:Ag(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Os(l){Ln.call(this),this.h=l,this.g={}}C(Os,Ln);var xg=[];function Rg(l){ee(l.g,function(h,f){this.g.hasOwnProperty(f)&&Bc(h)},l),l.g={}}Os.prototype.N=function(){Os.aa.N.call(this),Rg(this)},Os.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var zc=a.JSON.stringify,X0=a.JSON.parse,Z0=class{stringify(l){return a.JSON.stringify(l,void 0)}parse(l){return a.JSON.parse(l,void 0)}};function Kc(){}Kc.prototype.h=null;function Pg(l){return l.h||(l.h=l.i())}function kg(){}var Ls={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Wc(){st.call(this,"d")}C(Wc,st);function $c(){st.call(this,"c")}C($c,st);var Ri={},Ng=null;function La(){return Ng=Ng||new ot}Ri.La="serverreachability";function Dg(l){st.call(this,Ri.La,l)}C(Dg,st);function Ms(l){let h=La();ft(h,new Dg(h))}Ri.STAT_EVENT="statevent";function Vg(l,h){st.call(this,Ri.STAT_EVENT,l),this.stat=h}C(Vg,st);function mt(l){let h=La();ft(h,new Vg(h,l))}Ri.Ma="timingevent";function Fg(l,h){st.call(this,Ri.Ma,l),this.size=h}C(Fg,st);function Us(l,h){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){l()},h)}function Bs(){this.g=!0}Bs.prototype.xa=function(){this.g=!1};function eb(l,h,f,g,b,x){l.info(function(){if(l.g)if(x)for(var L="",ye=x.split("&"),tt=0;tt<ye.length;tt++){var fe=ye[tt].split("=");if(1<fe.length){var at=fe[0];fe=fe[1];var lt=at.split("_");L=2<=lt.length&&lt[1]=="type"?L+(at+"="+fe+"&"):L+(at+"=redacted&")}}else L=null;else L=x;return"XMLHTTP REQ ("+g+") [attempt "+b+"]: "+h+`
`+f+`
`+L})}function tb(l,h,f,g,b,x,L){l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+b+"]: "+h+`
`+f+`
`+x+" "+L})}function gr(l,h,f,g){l.info(function(){return"XMLHTTP TEXT ("+h+"): "+ib(l,f)+(g?" "+g:"")})}function nb(l,h){l.info(function(){return"TIMEOUT: "+h})}Bs.prototype.info=function(){};function ib(l,h){if(!l.g)return h;if(!h)return null;try{var f=JSON.parse(h);if(f){for(l=0;l<f.length;l++)if(Array.isArray(f[l])){var g=f[l];if(!(2>g.length)){var b=g[1];if(Array.isArray(b)&&!(1>b.length)){var x=b[0];if(x!="noop"&&x!="stop"&&x!="close")for(var L=1;L<b.length;L++)b[L]=""}}}}return zc(f)}catch{return h}}var Ma={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Og={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Qc;function Ua(){}C(Ua,Kc),Ua.prototype.g=function(){return new XMLHttpRequest},Ua.prototype.i=function(){return{}},Qc=new Ua;function Mn(l,h,f,g){this.j=l,this.i=h,this.l=f,this.R=g||1,this.U=new Os(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Lg}function Lg(){this.i=null,this.g="",this.h=!1}var Mg={},Hc={};function Yc(l,h,f){l.L=1,l.v=Ga(vn(h)),l.m=f,l.P=!0,Ug(l,null)}function Ug(l,h){l.F=Date.now(),Ba(l),l.A=vn(l.v);var f=l.A,g=l.R;Array.isArray(g)||(g=[String(g)]),Zg(f.i,"t",g),l.C=0,f=l.j.J,l.h=new Lg,l.g=__(l.j,f?h:null,!l.m),0<l.O&&(l.M=new J0(p(l.Y,l,l.g),l.O)),h=l.U,f=l.g,g=l.ca;var b="readystatechange";Array.isArray(b)||(b&&(xg[0]=b.toString()),b=xg);for(var x=0;x<b.length;x++){var L=Eg(f,b[x],g||h.handleEvent,!1,h.h||h);if(!L)break;h.g[L.key]=L}h=l.H?_(l.H):{},l.m?(l.u||(l.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,h)):(l.u="GET",l.g.ea(l.A,l.u,null,h)),Ms(),eb(l.i,l.u,l.A,l.l,l.R,l.m)}Mn.prototype.ca=function(l){l=l.target;let h=this.M;h&&wn(l)==3?h.j():this.Y(l)},Mn.prototype.Y=function(l){try{if(l==this.g)e:{let lt=wn(this.g);var h=this.g.Ba();let vr=this.g.Z();if(!(3>lt)&&(lt!=3||this.g&&(this.h.h||this.g.oa()||o_(this.g)))){this.J||lt!=4||h==7||(h==8||0>=vr?Ms(3):Ms(2)),Jc(this);var f=this.g.Z();this.X=f;t:if(Bg(this)){var g=o_(this.g);l="";var b=g.length,x=wn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Pi(this),qs(this);var L="";break t}this.h.i=new a.TextDecoder}for(h=0;h<b;h++)this.h.h=!0,l+=this.h.i.decode(g[h],{stream:!(x&&h==b-1)});g.length=0,this.h.g+=l,this.C=0,L=this.h.g}else L=this.g.oa();if(this.o=f==200,tb(this.i,this.u,this.A,this.l,this.R,lt,f),this.o){if(this.T&&!this.K){t:{if(this.g){var ye,tt=this.g;if((ye=tt.g?tt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(ye)){var fe=ye;break t}}fe=null}if(f=fe)gr(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Xc(this,f);else{this.o=!1,this.s=3,mt(12),Pi(this),qs(this);break e}}if(this.P){f=!0;let qt;for(;!this.J&&this.C<L.length;)if(qt=rb(this,L),qt==Hc){lt==4&&(this.s=4,mt(14),f=!1),gr(this.i,this.l,null,"[Incomplete Response]");break}else if(qt==Mg){this.s=4,mt(15),gr(this.i,this.l,L,"[Invalid Chunk]"),f=!1;break}else gr(this.i,this.l,qt,null),Xc(this,qt);if(Bg(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),lt!=4||L.length!=0||this.h.h||(this.s=1,mt(16),f=!1),this.o=this.o&&f,!f)gr(this.i,this.l,L,"[Invalid Chunked Response]"),Pi(this),qs(this);else if(0<L.length&&!this.W){this.W=!0;var at=this.j;at.g==this&&at.ba&&!at.M&&(at.j.info("Great, no buffering proxy detected. Bytes received: "+L.length),rh(at),at.M=!0,mt(11))}}else gr(this.i,this.l,L,null),Xc(this,L);lt==4&&Pi(this),this.o&&!this.J&&(lt==4?f_(this.j,this):(this.o=!1,Ba(this)))}else Eb(this.g),f==400&&0<L.indexOf("Unknown SID")?(this.s=3,mt(12)):(this.s=0,mt(13)),Pi(this),qs(this)}}}catch{}finally{}};function Bg(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function rb(l,h){var f=l.C,g=h.indexOf(`
`,f);return g==-1?Hc:(f=Number(h.substring(f,g)),isNaN(f)?Mg:(g+=1,g+f>h.length?Hc:(h=h.slice(g,g+f),l.C=g+f,h)))}Mn.prototype.cancel=function(){this.J=!0,Pi(this)};function Ba(l){l.S=Date.now()+l.I,qg(l,l.I)}function qg(l,h){if(l.B!=null)throw Error("WatchDog timer not null");l.B=Us(p(l.ba,l),h)}function Jc(l){l.B&&(a.clearTimeout(l.B),l.B=null)}Mn.prototype.ba=function(){this.B=null;let l=Date.now();0<=l-this.S?(nb(this.i,this.A),this.L!=2&&(Ms(),mt(17)),Pi(this),this.s=2,qs(this)):qg(this,this.S-l)};function qs(l){l.j.G==0||l.J||f_(l.j,l)}function Pi(l){Jc(l);var h=l.M;h&&typeof h.ma=="function"&&h.ma(),l.M=null,Rg(l.U),l.g&&(h=l.g,l.g=null,h.abort(),h.ma())}function Xc(l,h){try{var f=l.j;if(f.G!=0&&(f.g==l||Zc(f.h,l))){if(!l.K&&Zc(f.h,l)&&f.G==3){try{var g=f.Da.g.parse(h)}catch{g=null}if(Array.isArray(g)&&g.length==3){var b=g;if(b[0]==0){e:if(!f.u){if(f.g)if(f.g.F+3e3<l.F)Qa(f),Wa(f);else break e;ih(f),mt(18)}}else f.za=b[1],0<f.za-f.T&&37500>b[2]&&f.F&&f.v==0&&!f.C&&(f.C=Us(p(f.Za,f),6e3));if(1>=zg(f.h)&&f.ca){try{f.ca()}catch{}f.ca=void 0}}else Ni(f,11)}else if((l.K||f.g==l)&&Qa(f),!K(h))for(b=f.Da.g.parse(h),h=0;h<b.length;h++){let fe=b[h];if(f.T=fe[0],fe=fe[1],f.G==2)if(fe[0]=="c"){f.K=fe[1],f.ia=fe[2];let at=fe[3];at!=null&&(f.la=at,f.j.info("VER="+f.la));let lt=fe[4];lt!=null&&(f.Aa=lt,f.j.info("SVER="+f.Aa));let vr=fe[5];vr!=null&&typeof vr=="number"&&0<vr&&(g=1.5*vr,f.L=g,f.j.info("backChannelRequestTimeoutMs_="+g)),g=f;let qt=l.g;if(qt){let Ya=qt.g?qt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ya){var x=g.h;x.g||Ya.indexOf("spdy")==-1&&Ya.indexOf("quic")==-1&&Ya.indexOf("h2")==-1||(x.j=x.l,x.g=new Set,x.h&&(eh(x,x.h),x.h=null))}if(g.D){let sh=qt.g?qt.g.getResponseHeader("X-HTTP-Session-Id"):null;sh&&(g.ya=sh,Ie(g.I,g.D,sh))}}f.G=3,f.l&&f.l.ua(),f.ba&&(f.R=Date.now()-l.F,f.j.info("Handshake RTT: "+f.R+"ms")),g=f;var L=l;if(g.qa=g_(g,g.J?g.ia:null,g.W),L.K){Kg(g.h,L);var ye=L,tt=g.L;tt&&(ye.I=tt),ye.B&&(Jc(ye),Ba(ye)),g.g=L}else h_(g);0<f.i.length&&$a(f)}else fe[0]!="stop"&&fe[0]!="close"||Ni(f,7);else f.G==3&&(fe[0]=="stop"||fe[0]=="close"?fe[0]=="stop"?Ni(f,7):nh(f):fe[0]!="noop"&&f.l&&f.l.ta(fe),f.v=0)}}Ms(4)}catch{}}var sb=class{constructor(l,h){this.g=l,this.map=h}};function jg(l){this.l=l||10,a.PerformanceNavigationTiming?(l=a.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Gg(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function zg(l){return l.h?1:l.g?l.g.size:0}function Zc(l,h){return l.h?l.h==h:l.g?l.g.has(h):!1}function eh(l,h){l.g?l.g.add(h):l.h=h}function Kg(l,h){l.h&&l.h==h?l.h=null:l.g&&l.g.has(h)&&l.g.delete(h)}jg.prototype.cancel=function(){if(this.i=Wg(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let l of this.g.values())l.cancel();this.g.clear()}};function Wg(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let h=l.i;for(let f of l.g.values())h=h.concat(f.D);return h}return P(l.i)}function ob(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(u(l)){for(var h=[],f=l.length,g=0;g<f;g++)h.push(l[g]);return h}h=[],f=0;for(g in l)h[f++]=l[g];return h}function ab(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(u(l)||typeof l=="string"){var h=[];l=l.length;for(var f=0;f<l;f++)h.push(f);return h}h=[],f=0;for(let g in l)h[f++]=g;return h}}}function $g(l,h){if(l.forEach&&typeof l.forEach=="function")l.forEach(h,void 0);else if(u(l)||typeof l=="string")Array.prototype.forEach.call(l,h,void 0);else for(var f=ab(l),g=ob(l),b=g.length,x=0;x<b;x++)h.call(void 0,g[x],f&&f[x],l)}var Qg=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function lb(l,h){if(l){l=l.split("&");for(var f=0;f<l.length;f++){var g=l[f].indexOf("="),b=null;if(0<=g){var x=l[f].substring(0,g);b=l[f].substring(g+1)}else x=l[f];h(x,b?decodeURIComponent(b.replace(/\+/g," ")):"")}}}function ki(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof ki){this.h=l.h,qa(this,l.j),this.o=l.o,this.g=l.g,ja(this,l.s),this.l=l.l;var h=l.i,f=new zs;f.i=h.i,h.g&&(f.g=new Map(h.g),f.h=h.h),Hg(this,f),this.m=l.m}else l&&(h=String(l).match(Qg))?(this.h=!1,qa(this,h[1]||"",!0),this.o=js(h[2]||""),this.g=js(h[3]||"",!0),ja(this,h[4]),this.l=js(h[5]||"",!0),Hg(this,h[6]||"",!0),this.m=js(h[7]||"")):(this.h=!1,this.i=new zs(null,this.h))}ki.prototype.toString=function(){var l=[],h=this.j;h&&l.push(Gs(h,Yg,!0),":");var f=this.g;return(f||h=="file")&&(l.push("//"),(h=this.o)&&l.push(Gs(h,Yg,!0),"@"),l.push(encodeURIComponent(String(f)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.s,f!=null&&l.push(":",String(f))),(f=this.l)&&(this.g&&f.charAt(0)!="/"&&l.push("/"),l.push(Gs(f,f.charAt(0)=="/"?hb:cb,!0))),(f=this.i.toString())&&l.push("?",f),(f=this.m)&&l.push("#",Gs(f,fb)),l.join("")};function vn(l){return new ki(l)}function qa(l,h,f){l.j=f?js(h,!0):h,l.j&&(l.j=l.j.replace(/:$/,""))}function ja(l,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);l.s=h}else l.s=null}function Hg(l,h,f){h instanceof zs?(l.i=h,mb(l.i,l.h)):(f||(h=Gs(h,db)),l.i=new zs(h,l.h))}function Ie(l,h,f){l.i.set(h,f)}function Ga(l){return Ie(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function js(l,h){return l?h?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function Gs(l,h,f){return typeof l=="string"?(l=encodeURI(l).replace(h,ub),f&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function ub(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var Yg=/[#\/\?@]/g,cb=/[#\?:]/g,hb=/[#\?]/g,db=/[#\?@]/g,fb=/#/g;function zs(l,h){this.h=this.g=null,this.i=l||null,this.j=!!h}function Un(l){l.g||(l.g=new Map,l.h=0,l.i&&lb(l.i,function(h,f){l.add(decodeURIComponent(h.replace(/\+/g," ")),f)}))}n=zs.prototype,n.add=function(l,h){Un(this),this.i=null,l=_r(this,l);var f=this.g.get(l);return f||this.g.set(l,f=[]),f.push(h),this.h+=1,this};function Jg(l,h){Un(l),h=_r(l,h),l.g.has(h)&&(l.i=null,l.h-=l.g.get(h).length,l.g.delete(h))}function Xg(l,h){return Un(l),h=_r(l,h),l.g.has(h)}n.forEach=function(l,h){Un(this),this.g.forEach(function(f,g){f.forEach(function(b){l.call(h,b,g,this)},this)},this)},n.na=function(){Un(this);let l=Array.from(this.g.values()),h=Array.from(this.g.keys()),f=[];for(let g=0;g<h.length;g++){let b=l[g];for(let x=0;x<b.length;x++)f.push(h[g])}return f},n.V=function(l){Un(this);let h=[];if(typeof l=="string")Xg(this,l)&&(h=h.concat(this.g.get(_r(this,l))));else{l=Array.from(this.g.values());for(let f=0;f<l.length;f++)h=h.concat(l[f])}return h},n.set=function(l,h){return Un(this),this.i=null,l=_r(this,l),Xg(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[h]),this.h+=1,this},n.get=function(l,h){return l?(l=this.V(l),0<l.length?String(l[0]):h):h};function Zg(l,h,f){Jg(l,h),0<f.length&&(l.i=null,l.g.set(_r(l,h),P(f)),l.h+=f.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let l=[],h=Array.from(this.g.keys());for(var f=0;f<h.length;f++){var g=h[f];let x=encodeURIComponent(String(g)),L=this.V(g);for(g=0;g<L.length;g++){var b=x;L[g]!==""&&(b+="="+encodeURIComponent(String(L[g]))),l.push(b)}}return this.i=l.join("&")};function _r(l,h){return h=String(h),l.j&&(h=h.toLowerCase()),h}function mb(l,h){h&&!l.j&&(Un(l),l.i=null,l.g.forEach(function(f,g){var b=g.toLowerCase();g!=b&&(Jg(this,g),Zg(this,b,f))},l)),l.j=h}function pb(l,h){let f=new Bs;if(a.Image){let g=new Image;g.onload=y(Bn,f,"TestLoadImage: loaded",!0,h,g),g.onerror=y(Bn,f,"TestLoadImage: error",!1,h,g),g.onabort=y(Bn,f,"TestLoadImage: abort",!1,h,g),g.ontimeout=y(Bn,f,"TestLoadImage: timeout",!1,h,g),a.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=l}else h(!1)}function gb(l,h){let f=new Bs,g=new AbortController,b=setTimeout(()=>{g.abort(),Bn(f,"TestPingServer: timeout",!1,h)},1e4);fetch(l,{signal:g.signal}).then(x=>{clearTimeout(b),x.ok?Bn(f,"TestPingServer: ok",!0,h):Bn(f,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(b),Bn(f,"TestPingServer: error",!1,h)})}function Bn(l,h,f,g,b){try{b&&(b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null),g(f)}catch{}}function _b(){this.g=new Z0}function yb(l,h,f){let g=f||"";try{$g(l,function(b,x){let L=b;c(b)&&(L=zc(b)),h.push(g+x+"="+encodeURIComponent(L))})}catch(b){throw h.push(g+"type="+encodeURIComponent("_badmap")),b}}function Ks(l){this.l=l.Ub||null,this.j=l.eb||!1}C(Ks,Kc),Ks.prototype.g=function(){return new za(this.l,this.j)},Ks.prototype.i=function(l){return function(){return l}}({});function za(l,h){ot.call(this),this.D=l,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(za,ot),n=za.prototype,n.open=function(l,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=h,this.readyState=1,$s(this)},n.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(h.body=l),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ws(this)),this.readyState=0},n.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,$s(this)),this.g&&(this.readyState=3,$s(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;e_(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function e_(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}n.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var h=l.value?l.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!l.done}))&&(this.response=this.responseText+=h)}l.done?Ws(this):$s(this),this.readyState==3&&e_(this)}},n.Ra=function(l){this.g&&(this.response=this.responseText=l,Ws(this))},n.Qa=function(l){this.g&&(this.response=l,Ws(this))},n.ga=function(){this.g&&Ws(this)};function Ws(l){l.readyState=4,l.l=null,l.j=null,l.v=null,$s(l)}n.setRequestHeader=function(l,h){this.u.append(l,h)},n.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let l=[],h=this.h.entries();for(var f=h.next();!f.done;)f=f.value,l.push(f[0]+": "+f[1]),f=h.next();return l.join(`\r
`)};function $s(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(za.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function t_(l){let h="";return ee(l,function(f,g){h+=g,h+=":",h+=f,h+=`\r
`}),h}function th(l,h,f){e:{for(g in f){var g=!1;break e}g=!0}g||(f=t_(f),typeof l=="string"?f!=null&&encodeURIComponent(String(f)):Ie(l,h,f))}function ke(l){ot.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(ke,ot);var vb=/^https?$/i,wb=["POST","PUT"];n=ke.prototype,n.Ha=function(l){this.J=l},n.ea=function(l,h,f,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);h=h?h.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Qc.g(),this.v=this.o?Pg(this.o):Pg(Qc),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(h,String(l),!0),this.B=!1}catch(x){n_(this,x);return}if(l=f||"",f=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var b in g)f.set(b,g[b]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(let x of g.keys())f.set(x,g.get(x));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(f.keys()).find(x=>x.toLowerCase()=="content-type"),b=a.FormData&&l instanceof a.FormData,!(0<=Array.prototype.indexOf.call(wb,h,void 0))||g||b||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[x,L]of f)this.g.setRequestHeader(x,L);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{s_(this),this.u=!0,this.g.send(l),this.u=!1}catch(x){n_(this,x)}};function n_(l,h){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=h,l.m=5,i_(l),Ka(l)}function i_(l){l.A||(l.A=!0,ft(l,"complete"),ft(l,"error"))}n.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,ft(this,"complete"),ft(this,"abort"),Ka(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ka(this,!0)),ke.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?r_(this):this.bb())},n.bb=function(){r_(this)};function r_(l){if(l.h&&typeof o<"u"&&(!l.v[1]||wn(l)!=4||l.Z()!=2)){if(l.u&&wn(l)==4)Sg(l.Ea,0,l);else if(ft(l,"readystatechange"),wn(l)==4){l.h=!1;try{let L=l.Z();e:switch(L){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var f;if(!(f=h)){var g;if(g=L===0){var b=String(l.D).match(Qg)[1]||null;!b&&a.self&&a.self.location&&(b=a.self.location.protocol.slice(0,-1)),g=!vb.test(b?b.toLowerCase():"")}f=g}if(f)ft(l,"complete"),ft(l,"success");else{l.m=6;try{var x=2<wn(l)?l.g.statusText:""}catch{x=""}l.l=x+" ["+l.Z()+"]",i_(l)}}finally{Ka(l)}}}}function Ka(l,h){if(l.g){s_(l);let f=l.g,g=l.v[0]?()=>{}:null;l.g=null,l.v=null,h||ft(l,"ready");try{f.onreadystatechange=g}catch{}}}function s_(l){l.I&&(a.clearTimeout(l.I),l.I=null)}n.isActive=function(){return!!this.g};function wn(l){return l.g?l.g.readyState:0}n.Z=function(){try{return 2<wn(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(l){if(this.g){var h=this.g.responseText;return l&&h.indexOf(l)==0&&(h=h.substring(l.length)),X0(h)}};function o_(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function Eb(l){let h={};l=(l.g&&2<=wn(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<l.length;g++){if(K(l[g]))continue;var f=T(l[g]);let b=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();let x=h[b]||[];h[b]=x,x.push(f)}E(h,function(g){return g.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Qs(l,h,f){return f&&f.internalChannelParams&&f.internalChannelParams[l]||h}function a_(l){this.Aa=0,this.i=[],this.j=new Bs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Qs("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Qs("baseRetryDelayMs",5e3,l),this.cb=Qs("retryDelaySeedMs",1e4,l),this.Wa=Qs("forwardChannelMaxRetries",2,l),this.wa=Qs("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new jg(l&&l.concurrentRequestLimit),this.Da=new _b,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=a_.prototype,n.la=8,n.G=1,n.connect=function(l,h,f,g){mt(0),this.W=l,this.H=h||{},f&&g!==void 0&&(this.H.OSID=f,this.H.OAID=g),this.F=this.X,this.I=g_(this,null,this.W),$a(this)};function nh(l){if(l_(l),l.G==3){var h=l.U++,f=vn(l.I);if(Ie(f,"SID",l.K),Ie(f,"RID",h),Ie(f,"TYPE","terminate"),Hs(l,f),h=new Mn(l,l.j,h),h.L=2,h.v=Ga(vn(f)),f=!1,a.navigator&&a.navigator.sendBeacon)try{f=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!f&&a.Image&&(new Image().src=h.v,f=!0),f||(h.g=__(h.j,null),h.g.ea(h.v)),h.F=Date.now(),Ba(h)}p_(l)}function Wa(l){l.g&&(rh(l),l.g.cancel(),l.g=null)}function l_(l){Wa(l),l.u&&(a.clearTimeout(l.u),l.u=null),Qa(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&a.clearTimeout(l.s),l.s=null)}function $a(l){if(!Gg(l.h)&&!l.s){l.s=!0;var h=l.Ga;Ns||wg(),Ds||(Ns(),Ds=!0),Fc.add(h,l),l.B=0}}function Ib(l,h){return zg(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=h.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=Us(p(l.Ga,l,h),m_(l,l.B)),l.B++,!0)}n.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;let b=new Mn(this,this.j,l),x=this.o;if(this.S&&(x?(x=_(x),I(x,this.S)):x=this.S),this.m!==null||this.O||(b.H=x,x=null),this.P)e:{for(var h=0,f=0;f<this.i.length;f++){t:{var g=this.i[f];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(h+=g,4096<h){h=f;break e}if(h===4096||f===this.i.length-1){h=f+1;break e}}h=1e3}else h=1e3;h=c_(this,b,h),f=vn(this.I),Ie(f,"RID",l),Ie(f,"CVER",22),this.D&&Ie(f,"X-HTTP-Session-Id",this.D),Hs(this,f),x&&(this.O?h="headers="+encodeURIComponent(String(t_(x)))+"&"+h:this.m&&th(f,this.m,x)),eh(this.h,b),this.Ua&&Ie(f,"TYPE","init"),this.P?(Ie(f,"$req",h),Ie(f,"SID","null"),b.T=!0,Yc(b,f,null)):Yc(b,f,h),this.G=2}}else this.G==3&&(l?u_(this,l):this.i.length==0||Gg(this.h)||u_(this))};function u_(l,h){var f;h?f=h.l:f=l.U++;let g=vn(l.I);Ie(g,"SID",l.K),Ie(g,"RID",f),Ie(g,"AID",l.T),Hs(l,g),l.m&&l.o&&th(g,l.m,l.o),f=new Mn(l,l.j,f,l.B+1),l.m===null&&(f.H=l.o),h&&(l.i=h.D.concat(l.i)),h=c_(l,f,1e3),f.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),eh(l.h,f),Yc(f,g,h)}function Hs(l,h){l.H&&ee(l.H,function(f,g){Ie(h,g,f)}),l.l&&$g({},function(f,g){Ie(h,g,f)})}function c_(l,h,f){f=Math.min(l.i.length,f);var g=l.l?p(l.l.Na,l.l,l):null;e:{var b=l.i;let x=-1;for(;;){let L=["count="+f];x==-1?0<f?(x=b[0].g,L.push("ofs="+x)):x=0:L.push("ofs="+x);let ye=!0;for(let tt=0;tt<f;tt++){let fe=b[tt].g,at=b[tt].map;if(fe-=x,0>fe)x=Math.max(0,b[tt].g-100),ye=!1;else try{yb(at,L,"req"+fe+"_")}catch{g&&g(at)}}if(ye){g=L.join("&");break e}}}return l=l.i.splice(0,f),h.D=l,g}function h_(l){if(!l.g&&!l.u){l.Y=1;var h=l.Fa;Ns||wg(),Ds||(Ns(),Ds=!0),Fc.add(h,l),l.v=0}}function ih(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=Us(p(l.Fa,l),m_(l,l.v)),l.v++,!0)}n.Fa=function(){if(this.u=null,d_(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=Us(p(this.ab,this),l)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,mt(10),Wa(this),d_(this))};function rh(l){l.A!=null&&(a.clearTimeout(l.A),l.A=null)}function d_(l){l.g=new Mn(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var h=vn(l.qa);Ie(h,"RID","rpc"),Ie(h,"SID",l.K),Ie(h,"AID",l.T),Ie(h,"CI",l.F?"0":"1"),!l.F&&l.ja&&Ie(h,"TO",l.ja),Ie(h,"TYPE","xmlhttp"),Hs(l,h),l.m&&l.o&&th(h,l.m,l.o),l.L&&(l.g.I=l.L);var f=l.g;l=l.ia,f.L=1,f.v=Ga(vn(h)),f.m=null,f.P=!0,Ug(f,l)}n.Za=function(){this.C!=null&&(this.C=null,Wa(this),ih(this),mt(19))};function Qa(l){l.C!=null&&(a.clearTimeout(l.C),l.C=null)}function f_(l,h){var f=null;if(l.g==h){Qa(l),rh(l),l.g=null;var g=2}else if(Zc(l.h,h))f=h.D,Kg(l.h,h),g=1;else return;if(l.G!=0){if(h.o)if(g==1){f=h.m?h.m.length:0,h=Date.now()-h.F;var b=l.B;g=La(),ft(g,new Fg(g,f)),$a(l)}else h_(l);else if(b=h.s,b==3||b==0&&0<h.X||!(g==1&&Ib(l,h)||g==2&&ih(l)))switch(f&&0<f.length&&(h=l.h,h.i=h.i.concat(f)),b){case 1:Ni(l,5);break;case 4:Ni(l,10);break;case 3:Ni(l,6);break;default:Ni(l,2)}}}function m_(l,h){let f=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(f*=2),f*h}function Ni(l,h){if(l.j.info("Error code "+h),h==2){var f=p(l.fb,l),g=l.Xa;let b=!g;g=new ki(g||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||qa(g,"https"),Ga(g),b?pb(g.toString(),f):gb(g.toString(),f)}else mt(2);l.G=0,l.l&&l.l.sa(h),p_(l),l_(l)}n.fb=function(l){l?(this.j.info("Successfully pinged google.com"),mt(2)):(this.j.info("Failed to ping google.com"),mt(1))};function p_(l){if(l.G=0,l.ka=[],l.l){let h=Wg(l.h);(h.length!=0||l.i.length!=0)&&(k(l.ka,h),k(l.ka,l.i),l.h.i.length=0,P(l.i),l.i.length=0),l.l.ra()}}function g_(l,h,f){var g=f instanceof ki?vn(f):new ki(f);if(g.g!="")h&&(g.g=h+"."+g.g),ja(g,g.s);else{var b=a.location;g=b.protocol,h=h?h+"."+b.hostname:b.hostname,b=+b.port;var x=new ki(null);g&&qa(x,g),h&&(x.g=h),b&&ja(x,b),f&&(x.l=f),g=x}return f=l.D,h=l.ya,f&&h&&Ie(g,f,h),Ie(g,"VER",l.la),Hs(l,g),g}function __(l,h,f){if(h&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=l.Ca&&!l.pa?new ke(new Ks({eb:f})):new ke(l.pa),h.Ha(l.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function y_(){}n=y_.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Ha(){}Ha.prototype.g=function(l,h){return new St(l,h)};function St(l,h){ot.call(this),this.g=new a_(h),this.l=l,this.h=h&&h.messageUrlParams||null,l=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(l?l["X-WebChannel-Content-Type"]=h.messageContentType:l={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(l?l["X-WebChannel-Client-Profile"]=h.va:l={"X-WebChannel-Client-Profile":h.va}),this.g.S=l,(l=h&&h.Sb)&&!K(l)&&(this.g.m=l),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!K(h)&&(this.g.D=h,l=this.h,l!==null&&h in l&&(l=this.h,h in l&&delete l[h])),this.j=new yr(this)}C(St,ot),St.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},St.prototype.close=function(){nh(this.g)},St.prototype.o=function(l){var h=this.g;if(typeof l=="string"){var f={};f.__data__=l,l=f}else this.u&&(f={},f.__data__=zc(l),l=f);h.i.push(new sb(h.Ya++,l)),h.G==3&&$a(h)},St.prototype.N=function(){this.g.l=null,delete this.j,nh(this.g),delete this.g,St.aa.N.call(this)};function v_(l){Wc.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var h=l.__sm__;if(h){e:{for(let f in h){l=f;break e}l=void 0}(this.i=l)&&(l=this.i,h=h!==null&&l in h?h[l]:void 0),this.data=h}else this.data=l}C(v_,Wc);function w_(){$c.call(this),this.status=1}C(w_,$c);function yr(l){this.g=l}C(yr,y_),yr.prototype.ua=function(){ft(this.g,"a")},yr.prototype.ta=function(l){ft(this.g,new v_(l))},yr.prototype.sa=function(l){ft(this.g,new w_)},yr.prototype.ra=function(){ft(this.g,"b")},Ha.prototype.createWebChannel=Ha.prototype.g,St.prototype.send=St.prototype.o,St.prototype.open=St.prototype.m,St.prototype.close=St.prototype.close,bh=bn.createWebChannelTransport=function(){return new Ha},Th=bn.getStatEventTarget=function(){return La()},Ih=bn.Event=Ri,gl=bn.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ma.NO_ERROR=0,Ma.TIMEOUT=8,Ma.HTTP_ERROR=6,fo=bn.ErrorCode=Ma,Og.COMPLETE="complete",Eh=bn.EventType=Og,kg.EventType=Ls,Ls.OPEN="a",Ls.CLOSE="b",Ls.ERROR="c",Ls.MESSAGE="d",ot.prototype.listen=ot.prototype.K,Sr=bn.WebChannel=kg,Pb=bn.FetchXmlHttpFactory=Ks,ke.prototype.listenOnce=ke.prototype.L,ke.prototype.getLastError=ke.prototype.Ka,ke.prototype.getLastErrorCode=ke.prototype.Ba,ke.prototype.getStatus=ke.prototype.Z,ke.prototype.getResponseJson=ke.prototype.Oa,ke.prototype.getResponseText=ke.prototype.oa,ke.prototype.send=ke.prototype.ea,ke.prototype.setWithCredentials=ke.prototype.Ha,wh=bn.XhrIo=ke}).apply(typeof pl<"u"?pl:typeof self<"u"?self:typeof window<"u"?window:{});var Ly="@firebase/firestore";var Ke=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Ke.UNAUTHENTICATED=new Ke(null),Ke.GOOGLE_CREDENTIALS=new Ke("google-credentials-uid"),Ke.FIRST_PARTY=new Ke("first-party-uid"),Ke.MOCK_USER=new Ke("mock-user");var is="11.2.0";var oi=new Er("@firebase/firestore");function kr(){return oi.logLevel}function Uv(n){oi.setLogLevel(n)}function V(n,...e){if(oi.logLevel<=Ft.DEBUG){let t=e.map(Rf);oi.debug(`Firestore (${is}): ${n}`,...t)}}function Oe(n,...e){if(oi.logLevel<=Ft.ERROR){let t=e.map(Rf);oi.error(`Firestore (${is}): ${n}`,...t)}}function zt(n,...e){if(oi.logLevel<=Ft.WARN){let t=e.map(Rf);oi.warn(`Firestore (${is}): ${n}`,...t)}}function Rf(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function j(n="Unexpected state"){let e=`FIRESTORE (${is}) INTERNAL ASSERTION FAILED: `+n;throw Oe(e),new Error(e)}function z(n,e){n||j()}function Bv(n,e){n||j()}function M(n,e){return n}var R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},D=class extends Ey{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var He=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var xl=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Ph=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ke.UNAUTHENTICATED))}shutdown(){}},kh=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Nh=class{constructor(e){this.t=e,this.currentUser=Ke.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){z(this.o===void 0);let i=this.i,r=u=>this.i!==i?(i=this.i,t(u)):Promise.resolve(),s=new He;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new He,e.enqueueRetryable(()=>r(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>N(this,null,function*(){yield u.promise,yield r(this.currentUser)}))},a=u=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new He)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(z(typeof i.accessToken=="string"),new xl(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return z(e===null||typeof e=="string"),new Ke(e)}},Dh=class{constructor(e,t,i){this.l=e,this.h=t,this.P=i,this.type="FirstParty",this.user=Ke.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);let e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}},Vh=class{constructor(e,t,i){this.l=e,this.h=t,this.P=i}getToken(){return Promise.resolve(new Dh(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ke.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Fh=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Oh=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){z(this.o===void 0);let i=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,V("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};let r=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?r(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(z(typeof t.token=="string"),this.R=t.token,new Fh(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function Vb(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}var Rl=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,i="";for(;i.length<20;){let r=Vb(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<t&&(i+=e.charAt(r[s]%e.length))}return i}};function J(n,e){return n<e?-1:n>e?1:0}function Br(n,e,t){return n.length===e.length&&n.every((i,r)=>t(i,e[r]))}function qv(n){return n+"\0"}var xe=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new n(t,i)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new D(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?J(this.nanoseconds,e.nanoseconds):J(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var W=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new xe(0,0))}static max(){return new n(new xe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Pl=class n{constructor(e,t,i){t===void 0?t=0:t>e.length&&j(),i===void 0?i=e.length-t:i>e.length-t&&j(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let i=Math.min(e.length,t.length);for(let r=0;r<i;r++){let s=n.compareSegments(e.get(r),t.get(r));if(s!==0)return s}return Math.sign(e.length-t.length)}static compareSegments(e,t){let i=n.isNumericId(e),r=n.isNumericId(t);return i&&!r?-1:!i&&r?1:i&&r?n.extractNumericId(e).compare(n.extractNumericId(t)):e<t?-1:e>t?1:0}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Tn.fromString(e.substring(4,e.length-2))}},he=class n extends Pl{construct(e,t,i){return new n(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let i of e){if(i.indexOf("//")>=0)throw new D(R.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new n(t)}static emptyPath(){return new n([])}},Fb=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Le=class n extends Pl{construct(e,t,i){return new n(e,t,i)}static isValidIdentifier(e){return Fb.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],i="",r=0,s=()=>{if(i.length===0)throw new D(R.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""},o=!1;for(;r<e.length;){let a=e[r];if(a==="\\"){if(r+1===e.length)throw new D(R.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[r+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new D(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=u,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(i+=a,r++):(s(),r++)}if(s(),o)throw new D(R.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var U=class n{constructor(e){this.path=e}static fromPath(e){return new n(he.fromString(e))}static fromName(e){return new n(he.fromString(e).popFirst(5))}static empty(){return new n(he.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&he.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return he.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new he(e.slice()))}};var qr=class{constructor(e,t,i,r){this.indexId=e,this.collectionGroup=t,this.fields=i,this.indexState=r}};function Lh(n){return n.fields.find(e=>e.kind===2)}function Mi(n){return n.fields.filter(e=>e.kind!==2)}qr.UNKNOWN_ID=-1;var Lr=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Co=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,Ot.min())}};function jv(n,e){let t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=W.fromTimestamp(i===1e9?new xe(t+1,0):new xe(t,i));return new Ot(r,U.empty(),e)}function Gv(n){return new Ot(n.readTime,n.key,-1)}var Ot=class n{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new n(W.min(),U.empty(),-1)}static max(){return new n(W.max(),U.empty(),-1)}};function Pf(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=U.comparator(n.documentKey,e.documentKey),t!==0?t:J(n.largestBatchId,e.largestBatchId))}var zv="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",kl=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function gi(n){return N(this,null,function*(){if(n.code!==R.FAILED_PRECONDITION||n.message!==zv)throw n;V("LocalStore","Unexpectedly lost primary lease")})}var A=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&j(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,i)=>{t(e)})}static reject(e){return new n((t,i)=>{i(e)})}static waitFor(e){return new n((t,i)=>{let r=0,s=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++s,o&&s===r&&t()},u=>i(u))}),o=!0,s===r&&t()})}static or(e){let t=n.resolve(!1);for(let i of e)t=t.next(r=>r?n.resolve(r):i());return t}static forEach(e,t){let i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new n((i,r)=>{let s=e.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let c=u;t(e[c]).next(d=>{o[c]=d,++a,a===s&&i(o)},d=>r(d))}})}static doWhile(e,t){return new n((i,r)=>{let s=()=>{e()===!0?t().next(()=>{s()},r):i()};s()})}};var Nl=class n{static open(e,t,i,r){try{return new n(t,e.transaction(r,i))}catch(s){throw new zi(t,s)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new He,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new zi(e,t.error)):this.V.resolve()},this.transaction.onerror=i=>{let r=kf(i.target.error);this.V.reject(new zi(e,r))}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(V("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Uh(t)}},ai=class n{static delete(e){return V("SimpleDb","Removing database:",e),Ui(window.indexedDB.deleteDatabase(e)).toPromise()}static p(){if(!wy())return!1;if(n.S())return!0;let e=eo(),t=n.D(e),i=0<t&&t<10,r=Kv(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)}static S(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.v)==="YES"}static C(e,t){return e.store(t)}static D(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}constructor(e,t,i){this.name=e,this.version=t,this.F=i,n.D(eo())===12.2&&Oe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}M(e){return N(this,null,function*(){return this.db||(V("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,i)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=s=>{let o=s.target.result;t(o)},r.onblocked=()=>{i(new zi(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=s=>{let o=s.target.error;o.name==="VersionError"?i(new D(R.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?i(new D(R.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):i(new zi(e,o))},r.onupgradeneeded=s=>{V("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.F.O(o,r.transaction,s.oldVersion,this.version).next(()=>{V("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}B(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,i,r){return N(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let a=Nl.open(this.db,e,s?"readonly":"readwrite",i),u=r(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),A.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(V("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function Kv(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Mh=class{constructor(e){this.L=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.L=e}done(){this.k=!0}$(e){this.q=e}delete(){return Ui(this.L.delete())}},zi=class extends D{constructor(e,t){super(R.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function _i(n){return n.name==="IndexedDbTransactionError"}var Uh=class{constructor(e){this.store=e}put(e,t){let i;return t!==void 0?(V("SimpleDb","PUT",this.store.name,e,t),i=this.store.put(t,e)):(V("SimpleDb","PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),Ui(i)}add(e){return V("SimpleDb","ADD",this.store.name,e,e),Ui(this.store.add(e))}get(e){return Ui(this.store.get(e)).next(t=>(t===void 0&&(t=null),V("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return V("SimpleDb","DELETE",this.store.name,e),Ui(this.store.delete(e))}count(){return V("SimpleDb","COUNT",this.store.name),Ui(this.store.count())}U(e,t){let i=this.options(e,t),r=i.index?this.store.index(i.index):this.store;if(typeof r.getAll=="function"){let s=r.getAll(i.range);return new A((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(i),o=[];return this.W(s,(a,u)=>{o.push(u)}).next(()=>o)}}G(e,t){let i=this.store.getAll(e,t===null?void 0:t);return new A((r,s)=>{i.onerror=o=>{s(o.target.error)},i.onsuccess=o=>{r(o.target.result)}})}j(e,t){V("SimpleDb","DELETE ALL",this.store.name);let i=this.options(e,t);i.H=!1;let r=this.cursor(i);return this.W(r,(s,o,a)=>a.delete())}J(e,t){let i;t?i=e:(i={},t=e);let r=this.cursor(i);return this.W(r,t)}Y(e){let t=this.cursor({});return new A((i,r)=>{t.onerror=s=>{let o=kf(s.target.error);r(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():i()}):i()}})}W(e,t){let i=[];return new A((r,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void r();let u=new Mh(a),c=t(a.primaryKey,a.value,u);if(c instanceof A){let d=c.catch(m=>(u.done(),A.reject(m)));i.push(d)}u.isDone?r():u.K===null?a.continue():a.continue(u.K)}}).next(()=>A.waitFor(i))}options(e,t){let i;return e!==void 0&&(typeof e=="string"?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let i=this.store.index(e.index);return e.H?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function Ui(n){return new A((e,t)=>{n.onsuccess=i=>{let r=i.target.result;e(r)},n.onerror=i=>{let r=kf(i.target.error);t(r)}})}var My=!1;function kf(n){let e=ai.D(eo());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let i=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return My||(My=!0,setTimeout(()=>{throw i},0)),i}}return n}var Bh=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){V("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>N(this,null,function*(){this.task=null;try{V("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){_i(t)?V("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield gi(t)}yield this.X(6e4)}))}},qh=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return N(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let i=new Set,r=t,s=!0;return A.doWhile(()=>s===!0&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!i.has(o))return V("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,r).next(a=>{r-=a,i.add(o)});s=!1})).next(()=>t-r)}ne(e,t,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,i).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(r,s)).next(a=>(V("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let i=e;return t.changes.forEach((r,s)=>{let o=Gv(s);Pf(o,i)>0&&(i=o)}),new Ot(i.readTime,i.documentKey,Math.max(t.batchId,e.largestBatchId))}};var xt=(()=>{class n{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=r=>this.ie(r),this.se=r=>i.writeSequenceNumber(r))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function $o(n){return n==null}function So(n){return n===0&&1/n==-1/0}function Wv(n){return typeof n=="number"&&Number.isInteger(n)&&!So(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function ht(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Uy(e)),e=Ob(n.get(t),e);return Uy(e)}function Ob(n,e){let t=e,i=n.length;for(let r=0;r<i;r++){let s=n.charAt(r);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function Uy(n){return n+""}function rn(n){let e=n.length;if(z(e>=2),e===2)return z(n.charAt(0)===""&&n.charAt(1)===""),he.emptyPath();let t=e-2,i=[],r="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&j(),n.charAt(o+1)){case"":let a=n.substring(s,o),u;r.length===0?u=a:(r+=a,u=r,r=""),i.push(u);break;case"":r+=n.substring(s,o),r+="\0";break;case"":r+=n.substring(s,o+1);break;default:j()}s=o+2}return new he(i)}var By=["userId","batchId"];function Il(n,e){return[n,ht(e)]}function $v(n,e,t){return[n,ht(e),t]}var Lb={},Mb=["prefixPath","collectionGroup","readTime","documentId"],Ub=["prefixPath","collectionGroup","documentId"],Bb=["collectionGroup","readTime","prefixPath","documentId"],qb=["canonicalId","targetId"],jb=["targetId","path"],Gb=["path","targetId"],zb=["collectionId","parent"],Kb=["indexId","uid"],Wb=["uid","sequenceNumber"],$b=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Qb=["indexId","uid","orderedDocumentKey"],Hb=["userId","collectionPath","documentId"],Yb=["userId","collectionPath","largestBatchId"],Jb=["userId","collectionGroup","largestBatchId"],Qv=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Xb=[...Qv,"documentOverlays"],Hv=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Yv=Hv,Nf=[...Yv,"indexConfiguration","indexState","indexEntries"],Zb=Nf,eC=[...Nf,"globals"];var Ao=class extends kl{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function Ye(n,e){let t=M(n);return ai.C(t._e,e)}function qy(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function yi(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Jv(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Te=class n{constructor(e,t){this.comparator=e,this.root=t||on.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,on.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,on.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){let r=this.comparator(e,i.key);if(r===0)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){let e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Or(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Or(this.root,e,this.comparator,!1)}getReverseIterator(){return new Or(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Or(this.root,e,this.comparator,!0)}},Or=class{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},on=class n{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=i??n.RED,this.left=r??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,r,s){return new n(e??this.key,t??this.value,i??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this,s=i(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,i),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return n.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw j();let e=this.left.check();if(e!==this.right.check())throw j();return e+(this.isRed()?0:1)}};on.EMPTY=null,on.RED=!0,on.BLACK=!1;on.EMPTY=new class{constructor(){this.size=0}get key(){throw j()}get value(){throw j()}get color(){throw j()}get left(){throw j()}get right(){throw j()}copy(e,t,i,r,s){return this}insert(e,t,i){return new on(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var _e=class n{constructor(e){this.comparator=e,this.data=new Te(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){let i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){let r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Dl(this.data.getIterator())}getIteratorFrom(e){return new Dl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Dl=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Ar(n){return n.hasNext()?n.getNext():void 0}var Rt=class n{constructor(e){this.fields=e,e.sort(Le.comparator)}static empty(){return new n([])}unionWith(e){let t=new _e(Le.comparator);for(let i of this.fields)t=t.add(i);for(let i of e)t=t.add(i);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Br(this.fields,e.fields,(t,i)=>t.isEqual(i))}};var Vl=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function Xv(){return typeof atob<"u"}var Ue=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Vl("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(r){let s="";for(let o=0;o<r.length;++o)s+=String.fromCharCode(r[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return J(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ue.EMPTY_BYTE_STRING=new Ue("");var tC=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function An(n){if(z(!!n),typeof n=="string"){let e=0,t=tC.exec(n);if(z(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}let i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Se(n.seconds),nanos:Se(n.nanos)}}function Se(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function xn(n){return typeof n=="string"?Ue.fromBase64String(n):Ue.fromUint8Array(n)}function Su(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Au(n){let e=n.mapValue.fields.__previous_value__;return Su(e)?Au(e):e}function xo(n){let e=An(n.mapValue.fields.__local_write_time__.timestampValue);return new xe(e.seconds,e.nanos)}var jh=class{constructor(e,t,i,r,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},li=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var ri={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Tl={nullValue:"NULL_VALUE"};function ui(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Su(n)?4:Zv(n)?9007199254740991:xu(n)?10:11:j()}function un(n,e){if(n===e)return!0;let t=ui(n);if(t!==ui(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return xo(n).isEqual(xo(e));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;let o=An(r.timestampValue),a=An(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,s){return xn(r.bytesValue).isEqual(xn(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return Se(r.geoPointValue.latitude)===Se(s.geoPointValue.latitude)&&Se(r.geoPointValue.longitude)===Se(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return Se(r.integerValue)===Se(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){let o=Se(r.doubleValue),a=Se(s.doubleValue);return o===a?So(o)===So(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Br(n.arrayValue.values||[],e.arrayValue.values||[],un);case 10:case 11:return function(r,s){let o=r.mapValue.fields||{},a=s.mapValue.fields||{};if(qy(o)!==qy(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!un(o[u],a[u])))return!1;return!0}(n,e);default:return j()}}function Ro(n,e){return(n.values||[]).find(t=>un(t,e))!==void 0}function ci(n,e){if(n===e)return 0;let t=ui(n),i=ui(e);if(t!==i)return J(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return J(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=Se(s.integerValue||s.doubleValue),u=Se(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return jy(n.timestampValue,e.timestampValue);case 4:return jy(xo(n),xo(e));case 5:return J(n.stringValue,e.stringValue);case 6:return function(s,o){let a=xn(s),u=xn(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let d=J(a[c],u[c]);if(d!==0)return d}return J(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=J(Se(s.latitude),Se(o.latitude));return a!==0?a:J(Se(s.longitude),Se(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Gy(n.arrayValue,e.arrayValue);case 10:return function(s,o){var a,u,c,d;let m=s.fields||{},p=o.fields||{},y=(a=m.value)===null||a===void 0?void 0:a.arrayValue,C=(u=p.value)===null||u===void 0?void 0:u.arrayValue,P=J(((c=y?.values)===null||c===void 0?void 0:c.length)||0,((d=C?.values)===null||d===void 0?void 0:d.length)||0);return P!==0?P:Gy(y,C)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===ri.mapValue&&o===ri.mapValue)return 0;if(s===ri.mapValue)return 1;if(o===ri.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),c=o.fields||{},d=Object.keys(c);u.sort(),d.sort();for(let m=0;m<u.length&&m<d.length;++m){let p=J(u[m],d[m]);if(p!==0)return p;let y=ci(a[u[m]],c[d[m]]);if(y!==0)return y}return J(u.length,d.length)}(n.mapValue,e.mapValue);default:throw j()}}function jy(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return J(n,e);let t=An(n),i=An(e),r=J(t.seconds,i.seconds);return r!==0?r:J(t.nanos,i.nanos)}function Gy(n,e){let t=n.values||[],i=e.values||[];for(let r=0;r<t.length&&r<i.length;++r){let s=ci(t[r],i[r]);if(s)return s}return J(t.length,i.length)}function jr(n){return Gh(n)}function Gh(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let i=An(t);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return xn(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return U.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let i="[",r=!0;for(let s of t.values||[])r?r=!1:i+=",",i+=Gh(s);return i+"]"}(n.arrayValue):"mapValue"in n?function(t){let i=Object.keys(t.fields||{}).sort(),r="{",s=!0;for(let o of i)s?s=!1:r+=",",r+=`${o}:${Gh(t.fields[o])}`;return r+"}"}(n.mapValue):j()}function bl(n){switch(ui(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=Au(n);return e?16+bl(e):16;case 5:return 2*n.stringValue.length;case 6:return xn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(i){return(i.values||[]).reduce((r,s)=>r+bl(s),0)}(n.arrayValue);case 10:case 11:return function(i){let r=0;return yi(i.fields,(s,o)=>{r+=s.length+bl(o)}),r}(n.mapValue);default:throw j()}}function Ki(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function zh(n){return!!n&&"integerValue"in n}function Po(n){return!!n&&"arrayValue"in n}function zy(n){return!!n&&"nullValue"in n}function Ky(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Cl(n){return!!n&&"mapValue"in n}function xu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function wo(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return yi(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=wo(i)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=wo(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Zv(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var ew={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function nC(n){return"nullValue"in n?Tl:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ki(li.empty(),U.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?xu(n)?ew:{mapValue:{}}:j()}function iC(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ki(li.empty(),U.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?ew:"mapValue"in n?xu(n)?{mapValue:{}}:ri:j()}function Wy(n,e){let t=ci(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function $y(n,e){let t=ci(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var ct=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!Cl(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=wo(t)}setAll(e){let t=Le.emptyPath(),i={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let u=this.getFieldsMap(t);this.applyChanges(u,i,r),i={},r=[],t=a.popLast()}o?i[a.lastSegment()]=wo(o):r.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){let t=this.field(e.popLast());Cl(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return un(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];Cl(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){yi(t,(r,s)=>e[r]=s);for(let r of i)delete e[r]}clone(){return new n(wo(this.value))}};function tw(n){let e=[];return yi(n.fields,(t,i)=>{let r=new Le([t]);if(Cl(i)){let s=tw(i.mapValue).fields;if(s.length===0)e.push(r);else for(let o of s)e.push(r.child(o))}else e.push(r)}),new Rt(e)}var We=class n{constructor(e,t,i,r,s,o,a){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,W.min(),W.min(),W.min(),ct.empty(),0)}static newFoundDocument(e,t,i,r){return new n(e,1,t,W.min(),i,r,0)}static newNoDocument(e,t){return new n(e,2,t,W.min(),W.min(),ct.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,W.min(),W.min(),ct.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(W.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ct.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ct.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=W.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var cn=class{constructor(e,t){this.position=e,this.inclusive=t}};function Qy(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){let s=e[r],o=n.position[r];if(s.field.isKeyField()?i=U.comparator(U.fromName(o.referenceValue),t.key):i=ci(o,t.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function Hy(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!un(n.position[t],e.position[t]))return!1;return!0}var Wi=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function rC(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Fl=class{},ue=class n extends Fl{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new $h(e,t,i):t==="array-contains"?new Yh(e,i):t==="in"?new Ol(e,i):t==="not-in"?new Jh(e,i):t==="array-contains-any"?new Xh(e,i):new n(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new Qh(e,i):new Hh(e,i)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(ci(t,this.value)):t!==null&&ui(this.value)===ui(t)&&this.matchesComparison(ci(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return j()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ge=class n extends Fl{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return Gr(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Gr(n){return n.op==="and"}function Kh(n){return n.op==="or"}function Df(n){return nw(n)&&Gr(n)}function nw(n){for(let e of n.filters)if(e instanceof ge)return!1;return!0}function Wh(n){if(n instanceof ue)return n.field.canonicalString()+n.op.toString()+jr(n.value);if(Df(n))return n.filters.map(e=>Wh(e)).join(",");{let e=n.filters.map(t=>Wh(t)).join(",");return`${n.op}(${e})`}}function iw(n,e){return n instanceof ue?function(i,r){return r instanceof ue&&i.op===r.op&&i.field.isEqual(r.field)&&un(i.value,r.value)}(n,e):n instanceof ge?function(i,r){return r instanceof ge&&i.op===r.op&&i.filters.length===r.filters.length?i.filters.reduce((s,o,a)=>s&&iw(o,r.filters[a]),!0):!1}(n,e):void j()}function rw(n,e){let t=n.filters.concat(e);return ge.create(t,n.op)}function sw(n){return n instanceof ue?function(t){return`${t.field.canonicalString()} ${t.op} ${jr(t.value)}`}(n):n instanceof ge?function(t){return t.op.toString()+" {"+t.getFilters().map(sw).join(" ,")+"}"}(n):"Filter"}var $h=class extends ue{constructor(e,t,i){super(e,t,i),this.key=U.fromName(i.referenceValue)}matches(e){let t=U.comparator(e.key,this.key);return this.matchesComparison(t)}},Qh=class extends ue{constructor(e,t){super(e,"in",t),this.keys=ow("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Hh=class extends ue{constructor(e,t){super(e,"not-in",t),this.keys=ow("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function ow(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>U.fromName(i.referenceValue))}var Yh=class extends ue{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Po(t)&&Ro(t.arrayValue,this.value)}},Ol=class extends ue{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Ro(this.value.arrayValue,t)}},Jh=class extends ue{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ro(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Ro(this.value.arrayValue,t)}},Xh=class extends ue{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Po(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>Ro(this.value.arrayValue,i))}};var Zh=class{constructor(e,t=null,i=[],r=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function ed(n,e=null,t=[],i=[],r=null,s=null,o=null){return new Zh(n,e,t,i,r,s,o)}function $i(n){let e=M(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>Wh(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),$o(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>jr(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>jr(i)).join(",")),e.ue=t}return e.ue}function Qo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!rC(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!iw(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Hy(n.startAt,e.startAt)&&Hy(n.endAt,e.endAt)}function Ll(n){return U.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Ml(n,e){return n.filters.filter(t=>t instanceof ue&&t.field.isEqual(e))}function Yy(n,e,t){let i=Tl,r=!0;for(let s of Ml(n,e)){let o=Tl,a=!0;switch(s.op){case"<":case"<=":o=nC(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Tl}Wy({value:i,inclusive:r},{value:o,inclusive:a})<0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];Wy({value:i,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(i=o,r=t.inclusive);break}}return{value:i,inclusive:r}}function Jy(n,e,t){let i=ri,r=!0;for(let s of Ml(n,e)){let o=ri,a=!0;switch(s.op){case">=":case">":o=iC(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=ri}$y({value:i,inclusive:r},{value:o,inclusive:a})>0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];$y({value:i,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(i=o,r=t.inclusive);break}}return{value:i,inclusive:r}}var Kt=class{constructor(e,t=null,i=[],r=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function aw(n,e,t,i,r,s,o,a){return new Kt(n,e,t,i,r,s,o,a)}function rs(n){return new Kt(n)}function Xy(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Vf(n){return n.collectionGroup!==null}function Mr(n){let e=M(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new _e(Le.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Wi(s,i))}),t.has(Le.keyField().canonicalString())||e.ce.push(new Wi(Le.keyField(),i))}return e.ce}function yt(n){let e=M(n);return e.le||(e.le=sC(e,Mr(n))),e.le}function sC(n,e){if(n.limitType==="F")return ed(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{let s=r.dir==="desc"?"asc":"desc";return new Wi(r.field,s)});let t=n.endAt?new cn(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new cn(n.startAt.position,n.startAt.inclusive):null;return ed(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function td(n,e){let t=n.filters.concat([e]);return new Kt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Ul(n,e,t){return new Kt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ho(n,e){return Qo(yt(n),yt(e))&&n.limitType===e.limitType}function lw(n){return`${$i(yt(n))}|lt:${n.limitType}`}function Nr(n){return`Query(target=${function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map(r=>sw(r)).join(", ")}]`),$o(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(r=>jr(r)).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(r=>jr(r)).join(",")),`Target(${i})`}(yt(n))}; limitType=${n.limitType})`}function Yo(n,e){return e.isFoundDocument()&&function(i,r){let s=r.key.path;return i.collectionGroup!==null?r.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):U.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s)}(n,e)&&function(i,r){for(let s of Mr(i))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(n,e)&&function(i,r){for(let s of i.filters)if(!s.matches(r))return!1;return!0}(n,e)&&function(i,r){return!(i.startAt&&!function(o,a,u){let c=Qy(o,a,u);return o.inclusive?c<=0:c<0}(i.startAt,Mr(i),r)||i.endAt&&!function(o,a,u){let c=Qy(o,a,u);return o.inclusive?c>=0:c>0}(i.endAt,Mr(i),r))}(n,e)}function uw(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function cw(n){return(e,t)=>{let i=!1;for(let r of Mr(n)){let s=oC(r,e,t);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function oC(n,e,t){let i=n.field.isKeyField()?U.comparator(e.key,t.key):function(s,o,a){let u=o.data.field(s),c=a.data.field(s);return u!==null&&c!==null?ci(u,c):j()}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return j()}}var Wt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(let[r,s]of i)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){yi(this.inner,(t,i)=>{for(let[r,s]of i)e(r,s)})}isEmpty(){return Jv(this.inner)}size(){return this.innerSize}};var aC=new Te(U.comparator);function Ct(){return aC}var hw=new Te(U.comparator);function yo(...n){let e=hw;for(let t of n)e=e.insert(t.key,t);return e}function dw(n){let e=hw;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function sn(){return Eo()}function fw(){return Eo()}function Eo(){return new Wt(n=>n.toString(),(n,e)=>n.isEqual(e))}var lC=new Te(U.comparator),uC=new _e(U.comparator);function ne(...n){let e=uC;for(let t of n)e=e.add(t);return e}var cC=new _e(J);function Ff(){return cC}function Of(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:So(e)?"-0":e}}function mw(n){return{integerValue:""+n}}function pw(n,e){return Wv(e)?mw(e):Of(n,e)}var zr=class{constructor(){this._=void 0}};function hC(n,e,t){return n instanceof hi?function(r,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&Su(s)&&(s=Au(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Rn?_w(n,e):n instanceof Pn?yw(n,e):function(r,s){let o=gw(r,s),a=Zy(o)+Zy(r.Pe);return zh(o)&&zh(r.Pe)?mw(a):Of(r.serializer,a)}(n,e)}function dC(n,e,t){return n instanceof Rn?_w(n,e):n instanceof Pn?yw(n,e):t}function gw(n,e){return n instanceof di?function(i){return zh(i)||function(s){return!!s&&"doubleValue"in s}(i)}(e)?e:{integerValue:0}:null}var hi=class extends zr{},Rn=class extends zr{constructor(e){super(),this.elements=e}};function _w(n,e){let t=vw(e);for(let i of n.elements)t.some(r=>un(r,i))||t.push(i);return{arrayValue:{values:t}}}var Pn=class extends zr{constructor(e){super(),this.elements=e}};function yw(n,e){let t=vw(e);for(let i of n.elements)t=t.filter(r=>!un(r,i));return{arrayValue:{values:t}}}var di=class extends zr{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function Zy(n){return Se(n.integerValue||n.doubleValue)}function vw(n){return Po(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Qi=class{constructor(e,t){this.field=e,this.transform=t}};function fC(n,e){return n.field.isEqual(e.field)&&function(i,r){return i instanceof Rn&&r instanceof Rn||i instanceof Pn&&r instanceof Pn?Br(i.elements,r.elements,un):i instanceof di&&r instanceof di?un(i.Pe,r.Pe):i instanceof hi&&r instanceof hi}(n.transform,e.transform)}var nd=class{constructor(e,t){this.version=e,this.transformResults=t}},Ve=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Sl(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Kr=class{};function ww(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new mi(n.key,Ve.none()):new fi(n.key,n.data,Ve.none());{let t=n.data,i=ct.empty(),r=new _e(Le.comparator);for(let s of e.fields)if(!r.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?i.delete(s):i.set(s,o),r=r.add(s)}return new $t(n.key,i,new Rt(r.toArray()),Ve.none())}}function mC(n,e,t){n instanceof fi?function(r,s,o){let a=r.value.clone(),u=tv(r.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof $t?function(r,s,o){if(!Sl(r.precondition,s))return void s.convertToUnknownDocument(o.version);let a=tv(r.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(Ew(r)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(r,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Io(n,e,t,i){return n instanceof fi?function(s,o,a,u){if(!Sl(s.precondition,o))return a;let c=s.value.clone(),d=nv(s.fieldTransforms,u,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,i):n instanceof $t?function(s,o,a,u){if(!Sl(s.precondition,o))return a;let c=nv(s.fieldTransforms,u,o),d=o.data;return d.setAll(Ew(s)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))}(n,e,t,i):function(s,o,a){return Sl(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function pC(n,e){let t=null;for(let i of n.fieldTransforms){let r=e.data.field(i.field),s=gw(i.transform,r||null);s!=null&&(t===null&&(t=ct.empty()),t.set(i.field,s))}return t||null}function ev(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(i,r){return i===void 0&&r===void 0||!(!i||!r)&&Br(i,r,(s,o)=>fC(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var fi=class extends Kr{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}},$t=class extends Kr{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Ew(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let i=n.data.field(t);e.set(t,i)}}),e}function tv(n,e,t){let i=new Map;z(n.length===t.length);for(let r=0;r<t.length;r++){let s=n[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,dC(o,a,t[r]))}return i}function nv(n,e,t){let i=new Map;for(let r of n){let s=r.transform,o=t.data.field(r.field);i.set(r.field,hC(s,o,e))}return i}var mi=class extends Kr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},ko=class extends Kr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var No=class{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){let i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){let s=this.mutations[r];s.key.isEqual(e.key)&&mC(s,e,i[r])}}applyToLocalView(e,t){for(let i of this.baseMutations)i.key.isEqual(e.key)&&(t=Io(i,e,t,this.localWriteTime));for(let i of this.mutations)i.key.isEqual(e.key)&&(t=Io(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let i=fw();return this.mutations.forEach(r=>{let s=e.get(r.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(r.key)?null:a;let u=ww(o,a);u!==null&&i.set(r.key,u),o.isValidDocument()||o.convertToNoDocument(W.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ne())}isEqual(e){return this.batchId===e.batchId&&Br(this.mutations,e.mutations,(t,i)=>ev(t,i))&&Br(this.baseMutations,e.baseMutations,(t,i)=>ev(t,i))}},id=class n{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){z(e.mutations.length===i.length);let r=function(){return lC}(),s=e.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,i[o].version);return new n(e,t,i,r)}};var Do=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var rd=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Ge,ce;function Iw(n){switch(n){default:return j();case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0}}function Tw(n){if(n===void 0)return Oe("GRPC error has no .code"),R.UNKNOWN;switch(n){case Ge.OK:return R.OK;case Ge.CANCELLED:return R.CANCELLED;case Ge.UNKNOWN:return R.UNKNOWN;case Ge.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case Ge.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case Ge.INTERNAL:return R.INTERNAL;case Ge.UNAVAILABLE:return R.UNAVAILABLE;case Ge.UNAUTHENTICATED:return R.UNAUTHENTICATED;case Ge.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case Ge.NOT_FOUND:return R.NOT_FOUND;case Ge.ALREADY_EXISTS:return R.ALREADY_EXISTS;case Ge.PERMISSION_DENIED:return R.PERMISSION_DENIED;case Ge.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case Ge.ABORTED:return R.ABORTED;case Ge.OUT_OF_RANGE:return R.OUT_OF_RANGE;case Ge.UNIMPLEMENTED:return R.UNIMPLEMENTED;case Ge.DATA_LOSS:return R.DATA_LOSS;default:return j()}}(ce=Ge||(Ge={}))[ce.OK=0]="OK",ce[ce.CANCELLED=1]="CANCELLED",ce[ce.UNKNOWN=2]="UNKNOWN",ce[ce.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ce[ce.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ce[ce.NOT_FOUND=5]="NOT_FOUND",ce[ce.ALREADY_EXISTS=6]="ALREADY_EXISTS",ce[ce.PERMISSION_DENIED=7]="PERMISSION_DENIED",ce[ce.UNAUTHENTICATED=16]="UNAUTHENTICATED",ce[ce.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ce[ce.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ce[ce.ABORTED=10]="ABORTED",ce[ce.OUT_OF_RANGE=11]="OUT_OF_RANGE",ce[ce.UNIMPLEMENTED=12]="UNIMPLEMENTED",ce[ce.INTERNAL=13]="INTERNAL",ce[ce.UNAVAILABLE=14]="UNAVAILABLE",ce[ce.DATA_LOSS=15]="DATA_LOSS";var iv=null;function bw(){return new TextEncoder}var gC=new Tn([4294967295,4294967295],0);function rv(n){let e=bw().encode(n),t=new vh;return t.update(e),new Uint8Array(t.digest())}function sv(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Tn([t,i],0),new Tn([r,s],0)]}var sd=class n{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new Gi(`Invalid padding: ${t}`);if(i<0)throw new Gi(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new Gi(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new Gi(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ie=Tn.fromNumber(this.Te)}de(e,t,i){let r=e.add(t.multiply(Tn.fromNumber(i)));return r.compare(gC)===1&&(r=new Tn([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ie).toNumber()}Ee(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;let t=rv(e),[i,r]=sv(t);for(let s=0;s<this.hashCount;s++){let o=this.de(i,r,s);if(!this.Ee(o))return!1}return!0}static create(e,t,i){let r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,r,t);return i.forEach(a=>o.insert(a)),o}insert(e){if(this.Te===0)return;let t=rv(e),[i,r]=sv(t);for(let s=0;s<this.hashCount;s++){let o=this.de(i,r,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}},Gi=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Vo=class n{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){let r=new Map;return r.set(e,Fo.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new n(W.min(),r,new Te(J),Ct(),ne())}},Fo=class n{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new n(i,t,ne(),ne(),ne())}};var Ur=class{constructor(e,t,i,r){this.Re=e,this.removedTargetIds=t,this.key=i,this.Ve=r}},Bl=class{constructor(e,t){this.targetId=e,this.me=t}},ql=class{constructor(e,t,i=Ue.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}},jl=class{constructor(){this.fe=0,this.ge=ov(),this.pe=Ue.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ne(),t=ne(),i=ne();return this.ge.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:j()}}),new Fo(this.pe,this.ye,e,t,i)}Ce(){this.we=!1,this.ge=ov()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,z(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},od=class{constructor(e){this.Be=e,this.Le=new Map,this.ke=Ct(),this.qe=_l(),this.Qe=_l(),this.Ke=new Te(J)}$e(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.Ue(t,e.Ve):this.We(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.We(t,e.key,e.Ve)}Ge(e){this.forEachTarget(e,t=>{let i=this.ze(t);switch(e.state){case 0:this.je(t)&&i.De(e.resumeToken);break;case 1:i.Oe(),i.Se||i.Ce(),i.De(e.resumeToken);break;case 2:i.Oe(),i.Se||this.removeTarget(t);break;case 3:this.je(t)&&(i.Ne(),i.De(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),i.De(e.resumeToken));break;default:j()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Le.forEach((i,r)=>{this.je(r)&&t(r)})}Je(e){let t=e.targetId,i=e.me.count,r=this.Ye(t);if(r){let s=r.target;if(Ll(s))if(i===0){let o=new U(s.path);this.We(t,o,We.newNoDocument(o,W.min()))}else z(i===1);else{let o=this.Ze(t);if(o!==i){let a=this.Xe(e),u=a?this.et(a,e,o):1;if(u!==0){this.He(t);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,c)}iv?.tt(function(d,m,p,y,C){var P,k,G,K,O,$;let Z={localCacheCount:d,existenceFilterCount:m.count,databaseId:p.database,projectId:p.projectId},ee=m.unchangedNames;return ee&&(Z.bloomFilter={applied:C===0,hashCount:(P=ee?.hashCount)!==null&&P!==void 0?P:0,bitmapLength:(K=(G=(k=ee?.bits)===null||k===void 0?void 0:k.bitmap)===null||G===void 0?void 0:G.length)!==null&&K!==void 0?K:0,padding:($=(O=ee?.bits)===null||O===void 0?void 0:O.padding)!==null&&$!==void 0?$:0,mightContain:E=>{var _;return(_=y?.mightContain(E))!==null&&_!==void 0&&_}}),Z}(o,e.me,this.Be.nt(),a,u))}}}}Xe(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=t,o,a;try{o=xn(i).toUint8Array()}catch(u){if(u instanceof Vl)return zt("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new sd(o,r,s)}catch(u){return zt(u instanceof Gi?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Te===0?null:a}et(e,t,i){return t.me.count===i-this.rt(e,t.targetId)?0:2}rt(e,t){let i=this.Be.getRemoteKeysForTarget(t),r=0;return i.forEach(s=>{let o=this.Be.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.We(t,s,null),r++)}),r}it(e){let t=new Map;this.Le.forEach((s,o)=>{let a=this.Ye(o);if(a){if(s.current&&Ll(a.target)){let u=new U(a.target.path);this.st(u).has(o)||this.ot(o,u)||this.We(o,u,We.newNoDocument(u,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let i=ne();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Ye(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(i=i.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let r=new Vo(e,t,this.Ke,this.ke,i);return this.ke=Ct(),this.qe=_l(),this.Qe=_l(),this.Ke=new Te(J),r}Ue(e,t){if(!this.je(e))return;let i=this.ot(e,t.key)?2:0;this.ze(e).Fe(t.key,i),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e)),this.Qe=this.Qe.insert(t.key,this._t(t.key).add(e))}We(e,t,i){if(!this.je(e))return;let r=this.ze(e);this.ot(e,t)?r.Fe(t,1):r.Me(t),this.Qe=this.Qe.insert(t,this._t(t).delete(e)),this.Qe=this.Qe.insert(t,this._t(t).add(e)),i&&(this.ke=this.ke.insert(t,i))}removeTarget(e){this.Le.delete(e)}Ze(e){let t=this.ze(e).ve();return this.Be.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.ze(e).xe()}ze(e){let t=this.Le.get(e);return t||(t=new jl,this.Le.set(e,t)),t}_t(e){let t=this.Qe.get(e);return t||(t=new _e(J),this.Qe=this.Qe.insert(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new _e(J),this.qe=this.qe.insert(e,t)),t}je(e){let t=this.Ye(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){let t=this.Le.get(e);return t&&t.Se?null:this.Be.ut(e)}He(e){this.Le.set(e,new jl),this.Be.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}ot(e,t){return this.Be.getRemoteKeysForTarget(e).has(t)}};function _l(){return new Te(U.comparator)}function ov(){return new Te(U.comparator)}var _C={asc:"ASCENDING",desc:"DESCENDING"},yC={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},vC={and:"AND",or:"OR"},ad=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function ld(n,e){return n.useProto3Json||$o(e)?e:{value:e}}function Wr(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Cw(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function wC(n,e){return Wr(n,e.toTimestamp())}function Me(n){return z(!!n),W.fromTimestamp(function(t){let i=An(t);return new xe(i.seconds,i.nanos)}(n))}function Lf(n,e){return ud(n,e).canonicalString()}function ud(n,e){let t=function(r){return new he(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Sw(n){let e=he.fromString(n);return z(Ow(e)),e}function Oo(n,e){return Lf(n.databaseId,e.path)}function an(n,e){let t=Sw(e);if(t.get(1)!==n.databaseId.projectId)throw new D(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new D(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new U(Rw(t))}function Aw(n,e){return Lf(n.databaseId,e)}function xw(n){let e=Sw(n);return e.length===4?he.emptyPath():Rw(e)}function cd(n){return new he(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Rw(n){return z(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function av(n,e,t){return{name:Oo(n,e),fields:t.value.mapValue.fields}}function Pw(n,e,t){let i=an(n,e.name),r=Me(e.updateTime),s=e.createTime?Me(e.createTime):W.min(),o=new ct({mapValue:{fields:e.fields}}),a=We.newFoundDocument(i,r,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function EC(n,e){return"found"in e?function(i,r){z(!!r.found),r.found.name,r.found.updateTime;let s=an(i,r.found.name),o=Me(r.found.updateTime),a=r.found.createTime?Me(r.found.createTime):W.min(),u=new ct({mapValue:{fields:r.found.fields}});return We.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(i,r){z(!!r.missing),z(!!r.readTime);let s=an(i,r.missing),o=Me(r.readTime);return We.newNoDocument(s,o)}(n,e):j()}function IC(n,e){let t;if("targetChange"in e){e.targetChange;let i=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:j()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(c,d){return c.useProto3Json?(z(d===void 0||typeof d=="string"),Ue.fromBase64String(d||"")):(z(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Ue.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){let d=c.code===void 0?R.UNKNOWN:Tw(c.code);return new D(d,c.message||"")}(o);t=new ql(i,r,s,a||null)}else if("documentChange"in e){e.documentChange;let i=e.documentChange;i.document,i.document.name,i.document.updateTime;let r=an(n,i.document.name),s=Me(i.document.updateTime),o=i.document.createTime?Me(i.document.createTime):W.min(),a=new ct({mapValue:{fields:i.document.fields}}),u=We.newFoundDocument(r,s,o,a),c=i.targetIds||[],d=i.removedTargetIds||[];t=new Ur(c,d,u.key,u)}else if("documentDelete"in e){e.documentDelete;let i=e.documentDelete;i.document;let r=an(n,i.document),s=i.readTime?Me(i.readTime):W.min(),o=We.newNoDocument(r,s),a=i.removedTargetIds||[];t=new Ur([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let i=e.documentRemove;i.document;let r=an(n,i.document),s=i.removedTargetIds||[];t=new Ur([],s,r,null)}else{if(!("filter"in e))return j();{e.filter;let i=e.filter;i.targetId;let{count:r=0,unchangedNames:s}=i,o=new rd(r,s),a=i.targetId;t=new Bl(a,o)}}return t}function Lo(n,e){let t;if(e instanceof fi)t={update:av(n,e.key,e.value)};else if(e instanceof mi)t={delete:Oo(n,e.key)};else if(e instanceof $t)t={update:av(n,e.key,e.data),updateMask:xC(e.fieldMask)};else{if(!(e instanceof ko))return j();t={verify:Oo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(s,o){let a=o.transform;if(a instanceof hi)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Rn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Pn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof di)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw j()}(0,i))),e.precondition.isNone||(t.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:wC(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:j()}(n,e.precondition)),t}function hd(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?Ve.updateTime(Me(s.updateTime)):s.exists!==void 0?Ve.exists(s.exists):Ve.none()}(e.currentDocument):Ve.none(),i=e.updateTransforms?e.updateTransforms.map(r=>function(o,a){let u=null;if("setToServerValue"in a)z(a.setToServerValue==="REQUEST_TIME"),u=new hi;else if("appendMissingElements"in a){let d=a.appendMissingElements.values||[];u=new Rn(d)}else if("removeAllFromArray"in a){let d=a.removeAllFromArray.values||[];u=new Pn(d)}else"increment"in a?u=new di(o,a.increment):j();let c=Le.fromServerFormat(a.fieldPath);return new Qi(c,u)}(n,r)):[];if(e.update){e.update.name;let r=an(n,e.update.name),s=new ct({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let c=u.fieldPaths||[];return new Rt(c.map(d=>Le.fromServerFormat(d)))}(e.updateMask);return new $t(r,s,o,t,i)}return new fi(r,s,t,i)}if(e.delete){let r=an(n,e.delete);return new mi(r,t)}if(e.verify){let r=an(n,e.verify);return new ko(r,t)}return j()}function TC(n,e){return n&&n.length>0?(z(e!==void 0),n.map(t=>function(r,s){let o=r.updateTime?Me(r.updateTime):Me(s);return o.isEqual(W.min())&&(o=Me(s)),new nd(o,r.transformResults||[])}(t,e))):[]}function kw(n,e){return{documents:[Aw(n,e.path)]}}function Nw(n,e){let t={structuredQuery:{}},i=e.path,r;e.collectionGroup!==null?(r=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=Aw(n,r);let s=function(c){if(c.length!==0)return Fw(ge.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(c){if(c.length!==0)return c.map(d=>function(p){return{field:Dr(p.field),direction:CC(p.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=ld(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ct:t,parent:r}}function Dw(n){let e=xw(n.parent),t=n.structuredQuery,i=t.from?t.from.length:0,r=null;if(i>0){z(i===1);let d=t.from[0];d.allDescendants?r=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=function(m){let p=Vw(m);return p instanceof ge&&Df(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=function(m){return m.map(p=>function(C){return new Wi(Vr(C.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(p))}(t.orderBy));let a=null;t.limit&&(a=function(m){let p;return p=typeof m=="object"?m.value:m,$o(p)?null:p}(t.limit));let u=null;t.startAt&&(u=function(m){let p=!!m.before,y=m.values||[];return new cn(y,p)}(t.startAt));let c=null;return t.endAt&&(c=function(m){let p=!m.before,y=m.values||[];return new cn(y,p)}(t.endAt)),aw(e,r,o,s,a,"F",u,c)}function bC(n,e){let t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return j()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Vw(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let i=Vr(t.unaryFilter.field);return ue.create(i,"==",{doubleValue:NaN});case"IS_NULL":let r=Vr(t.unaryFilter.field);return ue.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Vr(t.unaryFilter.field);return ue.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Vr(t.unaryFilter.field);return ue.create(o,"!=",{nullValue:"NULL_VALUE"});default:return j()}}(n):n.fieldFilter!==void 0?function(t){return ue.create(Vr(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return j()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ge.create(t.compositeFilter.filters.map(i=>Vw(i)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return j()}}(t.compositeFilter.op))}(n):j()}function CC(n){return _C[n]}function SC(n){return yC[n]}function AC(n){return vC[n]}function Dr(n){return{fieldPath:n.canonicalString()}}function Vr(n){return Le.fromServerFormat(n.fieldPath)}function Fw(n){return n instanceof ue?function(t){if(t.op==="=="){if(Ky(t.value))return{unaryFilter:{field:Dr(t.field),op:"IS_NAN"}};if(zy(t.value))return{unaryFilter:{field:Dr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Ky(t.value))return{unaryFilter:{field:Dr(t.field),op:"IS_NOT_NAN"}};if(zy(t.value))return{unaryFilter:{field:Dr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Dr(t.field),op:SC(t.op),value:t.value}}}(n):n instanceof ge?function(t){let i=t.getFilters().map(r=>Fw(r));return i.length===1?i[0]:{compositeFilter:{op:AC(t.op),filters:i}}}(n):j()}function xC(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Ow(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var $r=class n{constructor(e,t,i,r,s=W.min(),o=W.min(),a=Ue.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Gl=class{constructor(e){this.ht=e}};function RC(n,e){let t;if(e.document)t=Pw(n.ht,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let i=U.fromSegments(e.noDocument.path),r=Yi(e.noDocument.readTime);t=We.newNoDocument(i,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return j();{let i=U.fromSegments(e.unknownDocument.path),r=Yi(e.unknownDocument.version);t=We.newUnknownDocument(i,r)}}return e.readTime&&t.setReadTime(function(r){let s=new xe(r[0],r[1]);return W.fromTimestamp(s)}(e.readTime)),t}function lv(n,e){let t=e.key,i={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:zl(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document=function(s,o){return{name:Oo(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Wr(s,o.version.toTimestamp()),createTime:Wr(s,o.createTime.toTimestamp())}}(n.ht,e);else if(e.isNoDocument())i.noDocument={path:t.path.toArray(),readTime:Hi(e.version)};else{if(!e.isUnknownDocument())return j();i.unknownDocument={path:t.path.toArray(),version:Hi(e.version)}}return i}function zl(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Hi(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Yi(n){let e=new xe(n.seconds,n.nanoseconds);return W.fromTimestamp(e)}function Bi(n,e){let t=(e.baseMutations||[]).map(s=>hd(n.ht,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let i=e.mutations.map(s=>hd(n.ht,s)),r=xe.fromMillis(e.localWriteTimeMs);return new No(e.batchId,r,t,i)}function vo(n){let e=Yi(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Yi(n.lastLimboFreeSnapshotVersion):W.min(),i;return i=function(s){return s.documents!==void 0}(n.query)?function(s){return z(s.documents.length===1),yt(rs(xw(s.documents[0])))}(n.query):function(s){return yt(Dw(s))}(n.query),new $r(i,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ue.fromBase64String(n.resumeToken))}function Lw(n,e){let t=Hi(e.snapshotVersion),i=Hi(e.lastLimboFreeSnapshotVersion),r;r=Ll(e.target)?kw(n.ht,e.target):Nw(n.ht,e.target).ct;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:$i(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function Mf(n){let e=Dw({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ul(e,e.limit,"L"):e}function Ch(n,e){return new Do(e.largestBatchId,hd(n.ht,e.overlayMutation))}function uv(n,e){let t=e.path.lastSegment();return[n,ht(e.path.popLast()),t]}function cv(n,e,t,i){return{indexId:n,uid:e,sequenceNumber:t,readTime:Hi(i.readTime),documentKey:ht(i.documentKey.path),largestBatchId:i.largestBatchId}}var dd=class{getBundleMetadata(e,t){return hv(e).get(t).next(i=>{if(i)return function(s){return{id:s.bundleId,createTime:Yi(s.createTime),version:s.version}}(i)})}saveBundleMetadata(e,t){return hv(e).put(function(r){return{bundleId:r.id,createTime:Hi(Me(r.createTime)),version:r.version}}(t))}getNamedQuery(e,t){return dv(e).get(t).next(i=>{if(i)return function(s){return{name:s.name,query:Mf(s.bundledQuery),readTime:Yi(s.readTime)}}(i)})}saveNamedQuery(e,t){return dv(e).put(function(r){return{name:r.name,readTime:Hi(Me(r.readTime)),bundledQuery:r.bundledQuery}}(t))}};function hv(n){return Ye(n,"bundles")}function dv(n){return Ye(n,"namedQueries")}var Kl=class n{constructor(e,t){this.serializer=e,this.userId=t}static Pt(e,t){let i=t.uid||"";return new n(e,i)}getOverlay(e,t){return mo(e).get(uv(this.userId,t)).next(i=>i?Ch(this.serializer,i):null)}getOverlays(e,t){let i=sn();return A.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){let r=[];return i.forEach((s,o)=>{let a=new Do(t,o);r.push(this.Tt(e,a))}),A.waitFor(r)}removeOverlaysForBatchId(e,t,i){let r=new Set;t.forEach(o=>r.add(ht(o.getCollectionPath())));let s=[];return r.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,i],[this.userId,o,i+1],!1,!0);s.push(mo(e).j("collectionPathOverlayIndex",a))}),A.waitFor(s)}getOverlaysForCollection(e,t,i){let r=sn(),s=ht(t),o=IDBKeyRange.bound([this.userId,s,i],[this.userId,s,Number.POSITIVE_INFINITY],!0);return mo(e).U("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let c=Ch(this.serializer,u);r.set(c.getKey(),c)}return r})}getOverlaysForCollectionGroup(e,t,i,r){let s=sn(),o,a=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return mo(e).J({index:"collectionGroupOverlayIndex",range:a},(u,c,d)=>{let m=Ch(this.serializer,c);s.size()<r||m.largestBatchId===o?(s.set(m.getKey(),m),o=m.largestBatchId):d.done()}).next(()=>s)}Tt(e,t){return mo(e).put(function(r,s,o){let[a,u,c]=uv(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Lo(r.ht,o.mutation)}}(this.serializer,this.userId,t))}};function mo(n){return Ye(n,"documentOverlays")}var fd=class{It(e){return Ye(e,"globals")}getSessionToken(e){return this.It(e).get("sessionToken").next(t=>{let i=t?.value;return i?Ue.fromUint8Array(i):Ue.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.It(e).put({name:"sessionToken",value:t.toUint8Array()})}};var Cn=class{constructor(){}dt(e,t){this.Et(e,t),t.At()}Et(e,t){if("nullValue"in e)this.Rt(t,5);else if("booleanValue"in e)this.Rt(t,10),t.Vt(e.booleanValue?1:0);else if("integerValue"in e)this.Rt(t,15),t.Vt(Se(e.integerValue));else if("doubleValue"in e){let i=Se(e.doubleValue);isNaN(i)?this.Rt(t,13):(this.Rt(t,15),So(i)?t.Vt(0):t.Vt(i))}else if("timestampValue"in e){let i=e.timestampValue;this.Rt(t,20),typeof i=="string"&&(i=An(i)),t.ft(`${i.seconds||""}`),t.Vt(i.nanos||0)}else if("stringValue"in e)this.gt(e.stringValue,t),this.yt(t);else if("bytesValue"in e)this.Rt(t,30),t.wt(xn(e.bytesValue)),this.yt(t);else if("referenceValue"in e)this.St(e.referenceValue,t);else if("geoPointValue"in e){let i=e.geoPointValue;this.Rt(t,45),t.Vt(i.latitude||0),t.Vt(i.longitude||0)}else"mapValue"in e?Zv(e)?this.Rt(t,Number.MAX_SAFE_INTEGER):xu(e)?this.bt(e.mapValue,t):(this.Dt(e.mapValue,t),this.yt(t)):"arrayValue"in e?(this.vt(e.arrayValue,t),this.yt(t)):j()}gt(e,t){this.Rt(t,25),this.Ct(e,t)}Ct(e,t){t.ft(e)}Dt(e,t){let i=e.fields||{};this.Rt(t,55);for(let r of Object.keys(i))this.gt(r,t),this.Et(i[r],t)}bt(e,t){var i,r;let s=e.fields||{};this.Rt(t,53);let o="value",a=((r=(i=s[o].arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.length)||0;this.Rt(t,15),t.Vt(Se(a)),this.gt(o,t),this.Et(s[o],t)}vt(e,t){let i=e.values||[];this.Rt(t,50);for(let r of i)this.Et(r,t)}St(e,t){this.Rt(t,37),U.fromName(e).path.forEach(i=>{this.Rt(t,60),this.Ct(i,t)})}Rt(e,t){e.Vt(t)}yt(e){e.Vt(2)}};Cn.Ft=new Cn;function PC(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function fv(n){let e=64-function(i){let r=0;for(let s=0;s<8;++s){let o=PC(255&i[s]);if(r+=o,o!==8)break}return r}(n);return Math.ceil(e/8)}var md=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Mt(e){let t=e[Symbol.iterator](),i=t.next();for(;!i.done;)this.xt(i.value),i=t.next();this.Ot()}Nt(e){let t=e[Symbol.iterator](),i=t.next();for(;!i.done;)this.Bt(i.value),i=t.next();this.Lt()}kt(e){for(let t of e){let i=t.charCodeAt(0);if(i<128)this.xt(i);else if(i<2048)this.xt(960|i>>>6),this.xt(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.xt(480|i>>>12),this.xt(128|63&i>>>6),this.xt(128|63&i);else{let r=t.codePointAt(0);this.xt(240|r>>>18),this.xt(128|63&r>>>12),this.xt(128|63&r>>>6),this.xt(128|63&r)}}this.Ot()}qt(e){for(let t of e){let i=t.charCodeAt(0);if(i<128)this.Bt(i);else if(i<2048)this.Bt(960|i>>>6),this.Bt(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.Bt(480|i>>>12),this.Bt(128|63&i>>>6),this.Bt(128|63&i);else{let r=t.codePointAt(0);this.Bt(240|r>>>18),this.Bt(128|63&r>>>12),this.Bt(128|63&r>>>6),this.Bt(128|63&r)}}this.Lt()}Qt(e){let t=this.Kt(e),i=fv(t);this.$t(1+i),this.buffer[this.position++]=255&i;for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=255&t[r]}Ut(e){let t=this.Kt(e),i=fv(t);this.$t(1+i),this.buffer[this.position++]=~(255&i);for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}Wt(){this.Gt(255),this.Gt(255)}zt(){this.jt(255),this.jt(255)}reset(){this.position=0}seed(e){this.$t(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ht(){return this.buffer.slice(0,this.position)}Kt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),i=(128&t[0])!=0;t[0]^=i?255:128;for(let r=1;r<t.length;++r)t[r]^=i?255:0;return t}xt(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(t)}Bt(e){let t=255&e;t===0?(this.jt(0),this.jt(255)):t===255?(this.jt(255),this.jt(0)):this.jt(e)}Ot(){this.Gt(0),this.Gt(1)}Lt(){this.jt(0),this.jt(1)}Gt(e){this.$t(1),this.buffer[this.position++]=e}jt(e){this.$t(1),this.buffer[this.position++]=~e}$t(e){let t=e+this.position;if(t<=this.buffer.length)return;let i=2*this.buffer.length;i<t&&(i=t);let r=new Uint8Array(i);r.set(this.buffer),this.buffer=r}},pd=class{constructor(e){this.Jt=e}wt(e){this.Jt.Mt(e)}ft(e){this.Jt.kt(e)}Vt(e){this.Jt.Qt(e)}At(){this.Jt.Wt()}},gd=class{constructor(e){this.Jt=e}wt(e){this.Jt.Nt(e)}ft(e){this.Jt.qt(e)}Vt(e){this.Jt.Ut(e)}At(){this.Jt.zt()}},qi=class{constructor(){this.Jt=new md,this.Yt=new pd(this.Jt),this.Zt=new gd(this.Jt)}seed(e){this.Jt.seed(e)}Xt(e){return e===0?this.Yt:this.Zt}Ht(){return this.Jt.Ht()}reset(){this.Jt.reset()}};var ji=class n{constructor(e,t,i,r){this.indexId=e,this.documentKey=t,this.arrayValue=i,this.directionalValue=r}en(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,i=new Uint8Array(t);return i.set(this.directionalValue,0),t!==e?i.set([0],this.directionalValue.length):++i[i.length-1],new n(this.indexId,this.documentKey,this.arrayValue,i)}};function ei(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=mv(n.arrayValue,e.arrayValue),t!==0?t:(t=mv(n.directionalValue,e.directionalValue),t!==0?t:U.comparator(n.documentKey,e.documentKey)))}function mv(n,e){for(let t=0;t<n.length&&t<e.length;++t){let i=n[t]-e[t];if(i!==0)return i}return n.length-e.length}var Wl=class{constructor(e){this.tn=new _e((t,i)=>Le.comparator(t.field,i.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.nn=e.orderBy,this.rn=[];for(let t of e.filters){let i=t;i.isInequality()?this.tn=this.tn.add(i):this.rn.push(i)}}get sn(){return this.tn.size>1}on(e){if(z(e.collectionGroup===this.collectionId),this.sn)return!1;let t=Lh(e);if(t!==void 0&&!this._n(t))return!1;let i=Mi(e),r=new Set,s=0,o=0;for(;s<i.length&&this._n(i[s]);++s)r=r.add(i[s].fieldPath.canonicalString());if(s===i.length)return!0;if(this.tn.size>0){let a=this.tn.getIterator().getNext();if(!r.has(a.field.canonicalString())){let u=i[s];if(!this.an(a,u)||!this.un(this.nn[o++],u))return!1}++s}for(;s<i.length;++s){let a=i[s];if(o>=this.nn.length||!this.un(this.nn[o++],a))return!1}return!0}cn(){if(this.sn)return null;let e=new _e(Le.comparator),t=[];for(let i of this.rn)if(!i.field.isKeyField())if(i.op==="array-contains"||i.op==="array-contains-any")t.push(new Lr(i.field,2));else{if(e.has(i.field))continue;e=e.add(i.field),t.push(new Lr(i.field,0))}for(let i of this.nn)i.field.isKeyField()||e.has(i.field)||(e=e.add(i.field),t.push(new Lr(i.field,i.dir==="asc"?0:1)));return new qr(qr.UNKNOWN_ID,this.collectionId,t,Co.empty())}_n(e){for(let t of this.rn)if(this.an(t,e))return!0;return!1}an(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let i=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===i}un(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function Mw(n){var e,t;if(z(n instanceof ue||n instanceof ge),n instanceof ue){if(n instanceof Ol){let r=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>ue.create(n.field,"==",s)))||[];return ge.create(r,"or")}return n}let i=n.filters.map(r=>Mw(r));return ge.create(i,n.op)}function kC(n){if(n.getFilters().length===0)return[];let e=vd(Mw(n));return z(Uw(e)),_d(e)||yd(e)?[e]:e.getFilters()}function _d(n){return n instanceof ue}function yd(n){return n instanceof ge&&Df(n)}function Uw(n){return _d(n)||yd(n)||function(t){if(t instanceof ge&&Kh(t)){for(let i of t.getFilters())if(!_d(i)&&!yd(i))return!1;return!0}return!1}(n)}function vd(n){if(z(n instanceof ue||n instanceof ge),n instanceof ue)return n;if(n.filters.length===1)return vd(n.filters[0]);let e=n.filters.map(i=>vd(i)),t=ge.create(e,n.op);return t=$l(t),Uw(t)?t:(z(t instanceof ge),z(Gr(t)),z(t.filters.length>1),t.filters.reduce((i,r)=>Uf(i,r)))}function Uf(n,e){let t;return z(n instanceof ue||n instanceof ge),z(e instanceof ue||e instanceof ge),t=n instanceof ue?e instanceof ue?function(r,s){return ge.create([r,s],"and")}(n,e):pv(n,e):e instanceof ue?pv(e,n):function(r,s){if(z(r.filters.length>0&&s.filters.length>0),Gr(r)&&Gr(s))return rw(r,s.getFilters());let o=Kh(r)?r:s,a=Kh(r)?s:r,u=o.filters.map(c=>Uf(c,a));return ge.create(u,"or")}(n,e),$l(t)}function pv(n,e){if(Gr(e))return rw(e,n.getFilters());{let t=e.filters.map(i=>Uf(n,i));return ge.create(t,"or")}}function $l(n){if(z(n instanceof ue||n instanceof ge),n instanceof ue)return n;let e=n.getFilters();if(e.length===1)return $l(e[0]);if(nw(n))return n;let t=e.map(r=>$l(r)),i=[];return t.forEach(r=>{r instanceof ue?i.push(r):r instanceof ge&&(r.op===n.op?i.push(...r.filters):i.push(r))}),i.length===1?i[0]:ge.create(i,n.op)}var wd=class{constructor(){this.ln=new Mo}addToCollectionParentIndex(e,t){return this.ln.add(t),A.resolve()}getCollectionParents(e,t){return A.resolve(this.ln.getEntries(t))}addFieldIndex(e,t){return A.resolve()}deleteFieldIndex(e,t){return A.resolve()}deleteAllFieldIndexes(e){return A.resolve()}createTargetIndexes(e,t){return A.resolve()}getDocumentsMatchingTarget(e,t){return A.resolve(null)}getIndexType(e,t){return A.resolve(0)}getFieldIndexes(e,t){return A.resolve([])}getNextCollectionGroupToUpdate(e){return A.resolve(null)}getMinOffset(e,t){return A.resolve(Ot.min())}getMinOffsetFromCollectionGroup(e,t){return A.resolve(Ot.min())}updateCollectionGroup(e,t,i){return A.resolve()}updateIndexEntries(e,t){return A.resolve()}},Mo=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new _e(he.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new _e(he.comparator)).toArray()}};var yl=new Uint8Array(0),Ed=class{constructor(e,t){this.databaseId=t,this.hn=new Mo,this.Pn=new Wt(i=>$i(i),(i,r)=>Qo(i,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.hn.has(t)){let i=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.hn.add(t)});let s={collectionId:i,parent:ht(r)};return gv(e).put(s)}return A.resolve()}getCollectionParents(e,t){let i=[],r=IDBKeyRange.bound([t,""],[qv(t),""],!1,!0);return gv(e).U(r).next(s=>{for(let o of s){if(o.collectionId!==t)break;i.push(rn(o.parent))}return i})}addFieldIndex(e,t){let i=po(e),r=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete r.indexId;let s=i.add(r);if(t.indexState){let o=Rr(e);return s.next(a=>{o.put(cv(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let i=po(e),r=Rr(e),s=xr(e);return i.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=po(e),i=xr(e),r=Rr(e);return t.j().next(()=>i.j()).next(()=>r.j())}createTargetIndexes(e,t){return A.forEach(this.Tn(t),i=>this.getIndexType(e,i).next(r=>{if(r===0||r===1){let s=new Wl(i).cn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let i=xr(e),r=!0,s=new Map;return A.forEach(this.Tn(t),o=>this.In(e,o).next(a=>{r&&(r=!!a),s.set(o,a)})).next(()=>{if(r){let o=ne(),a=[];return A.forEach(s,(u,c)=>{V("IndexedDbIndexManager",`Using index ${function(O){return`id=${O.indexId}|cg=${O.collectionGroup}|f=${O.fields.map($=>`${$.fieldPath}:${$.kind}`).join(",")}`}(u)} to execute ${$i(t)}`);let d=function(O,$){let Z=Lh($);if(Z===void 0)return null;for(let ee of Ml(O,Z.fieldPath))switch(ee.op){case"array-contains-any":return ee.value.arrayValue.values||[];case"array-contains":return[ee.value]}return null}(c,u),m=function(O,$){let Z=new Map;for(let ee of Mi($))for(let E of Ml(O,ee.fieldPath))switch(E.op){case"==":case"in":Z.set(ee.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return Z.set(ee.fieldPath.canonicalString(),E.value),Array.from(Z.values())}return null}(c,u),p=function(O,$){let Z=[],ee=!0;for(let E of Mi($)){let _=E.kind===0?Yy(O,E.fieldPath,O.startAt):Jy(O,E.fieldPath,O.startAt);Z.push(_.value),ee&&(ee=_.inclusive)}return new cn(Z,ee)}(c,u),y=function(O,$){let Z=[],ee=!0;for(let E of Mi($)){let _=E.kind===0?Jy(O,E.fieldPath,O.endAt):Yy(O,E.fieldPath,O.endAt);Z.push(_.value),ee&&(ee=_.inclusive)}return new cn(Z,ee)}(c,u),C=this.dn(u,c,p),P=this.dn(u,c,y),k=this.En(u,c,m),G=this.An(u.indexId,d,C,p.inclusive,P,y.inclusive,k);return A.forEach(G,K=>i.G(K,t.limit).next(O=>{O.forEach($=>{let Z=U.fromSegments($.documentKey);o.has(Z)||(o=o.add(Z),a.push(Z))})}))}).next(()=>a)}return A.resolve(null)})}Tn(e){let t=this.Pn.get(e);return t||(e.filters.length===0?t=[e]:t=kC(ge.create(e.filters,"and")).map(i=>ed(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.Pn.set(e,t),t)}An(e,t,i,r,s,o,a){let u=(t!=null?t.length:1)*Math.max(i.length,s.length),c=u/(t!=null?t.length:1),d=[];for(let m=0;m<u;++m){let p=t?this.Rn(t[m/c]):yl,y=this.Vn(e,p,i[m%c],r),C=this.mn(e,p,s[m%c],o),P=a.map(k=>this.Vn(e,p,k,!0));d.push(...this.createRange(y,C,P))}return d}Vn(e,t,i,r){let s=new ji(e,U.empty(),t,i);return r?s:s.en()}mn(e,t,i,r){let s=new ji(e,U.empty(),t,i);return r?s.en():s}In(e,t){let i=new Wl(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(s=>{let o=null;for(let a of s)i.on(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let i=2,r=this.Tn(t);return A.forEach(r,s=>this.In(e,s).next(o=>{o?i!==0&&o.fields.length<function(u){let c=new _e(Le.comparator),d=!1;for(let m of u.filters)for(let p of m.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?d=!0:c=c.add(p.field));for(let m of u.orderBy)m.field.isKeyField()||(c=c.add(m.field));return c.size+(d?1:0)}(s)&&(i=1):i=0})).next(()=>function(o){return o.limit!==null}(t)&&r.length>1&&i===2?1:i)}fn(e,t){let i=new qi;for(let r of Mi(e)){let s=t.data.field(r.fieldPath);if(s==null)return null;let o=i.Xt(r.kind);Cn.Ft.dt(s,o)}return i.Ht()}Rn(e){let t=new qi;return Cn.Ft.dt(e,t.Xt(0)),t.Ht()}gn(e,t){let i=new qi;return Cn.Ft.dt(Ki(this.databaseId,t),i.Xt(function(s){let o=Mi(s);return o.length===0?0:o[o.length-1].kind}(e))),i.Ht()}En(e,t,i){if(i===null)return[];let r=[];r.push(new qi);let s=0;for(let o of Mi(e)){let a=i[s++];for(let u of r)if(this.pn(t,o.fieldPath)&&Po(a))r=this.yn(r,o,a);else{let c=u.Xt(o.kind);Cn.Ft.dt(a,c)}}return this.wn(r)}dn(e,t,i){return this.En(e,t,i.position)}wn(e){let t=[];for(let i=0;i<e.length;++i)t[i]=e[i].Ht();return t}yn(e,t,i){let r=[...e],s=[];for(let o of i.arrayValue.values||[])for(let a of r){let u=new qi;u.seed(a.Ht()),Cn.Ft.dt(o,u.Xt(t.kind)),s.push(u)}return s}pn(e,t){return!!e.filters.find(i=>i instanceof ue&&i.field.isEqual(t)&&(i.op==="in"||i.op==="not-in"))}getFieldIndexes(e,t){let i=po(e),r=Rr(e);return(t?i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):i.U()).next(s=>{let o=[];return A.forEach(s,a=>r.get([a.indexId,this.uid]).next(u=>{o.push(function(d,m){let p=m?new Co(m.sequenceNumber,new Ot(Yi(m.readTime),new U(rn(m.documentKey)),m.largestBatchId)):Co.empty(),y=d.fields.map(([C,P])=>new Lr(Le.fromServerFormat(C),P));return new qr(d.indexId,d.collectionGroup,y,p)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((i,r)=>{let s=i.indexState.sequenceNumber-r.indexState.sequenceNumber;return s!==0?s:J(i.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,i){let r=po(e),s=Rr(e);return this.Sn(e).next(o=>r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>A.forEach(a,u=>s.put(cv(u.indexId,this.uid,o,i)))))}updateIndexEntries(e,t){let i=new Map;return A.forEach(t,(r,s)=>{let o=i.get(r.collectionGroup);return(o?A.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next(a=>(i.set(r.collectionGroup,a),A.forEach(a,u=>this.bn(e,r,u).next(c=>{let d=this.Dn(s,u);return c.isEqual(d)?A.resolve():this.vn(e,s,u,c,d)}))))})}Cn(e,t,i,r){return xr(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.gn(i,t.key),documentKey:t.key.path.toArray()})}Fn(e,t,i,r){return xr(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.gn(i,t.key),t.key.path.toArray()])}bn(e,t,i){let r=xr(e),s=new _e(ei);return r.J({index:"documentKeyIndex",range:IDBKeyRange.only([i.indexId,this.uid,this.gn(i,t)])},(o,a)=>{s=s.add(new ji(i.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}Dn(e,t){let i=new _e(ei),r=this.fn(t,e);if(r==null)return i;let s=Lh(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Po(o))for(let a of o.arrayValue.values||[])i=i.add(new ji(t.indexId,e.key,this.Rn(a),r))}else i=i.add(new ji(t.indexId,e.key,yl,r));return i}vn(e,t,i,r,s){V("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(u,c,d,m,p){let y=u.getIterator(),C=c.getIterator(),P=Ar(y),k=Ar(C);for(;P||k;){let G=!1,K=!1;if(P&&k){let O=d(P,k);O<0?K=!0:O>0&&(G=!0)}else P!=null?K=!0:G=!0;G?(m(k),k=Ar(C)):K?(p(P),P=Ar(y)):(P=Ar(y),k=Ar(C))}}(r,s,ei,a=>{o.push(this.Cn(e,t,i,a))},a=>{o.push(this.Fn(e,t,i,a))}),A.waitFor(o)}Sn(e){let t=1;return Rr(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,r,s)=>{s.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,i){i=i.sort((o,a)=>ei(o,a)).filter((o,a,u)=>!a||ei(o,u[a-1])!==0);let r=[];r.push(e);for(let o of i){let a=ei(o,e),u=ei(o,t);if(a===0)r[0]=e.en();else if(a>0&&u<0)r.push(o),r.push(o.en());else if(u>0)break}r.push(t);let s=[];for(let o=0;o<r.length;o+=2){if(this.Mn(r[o],r[o+1]))return[];let a=[r[o].indexId,this.uid,r[o].arrayValue,r[o].directionalValue,yl,[]],u=[r[o+1].indexId,this.uid,r[o+1].arrayValue,r[o+1].directionalValue,yl,[]];s.push(IDBKeyRange.bound(a,u))}return s}Mn(e,t){return ei(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(_v)}getMinOffset(e,t){return A.mapArray(this.Tn(t),i=>this.In(e,i).next(r=>r||j())).next(_v)}};function gv(n){return Ye(n,"collectionParents")}function xr(n){return Ye(n,"indexEntries")}function po(n){return Ye(n,"indexConfiguration")}function Rr(n){return Ye(n,"indexState")}function _v(n){z(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let i=1;i<n.length;i++){let r=n[i].indexState.offset;Pf(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new Ot(e.readTime,e.documentKey,t)}var yv={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},bt=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}};function Bw(n,e,t){let i=n.store("mutations"),r=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,u=i.J({range:o},(d,m,p)=>(a++,p.delete()));s.push(u.next(()=>{z(a===1)}));let c=[];for(let d of t.mutations){let m=$v(e,d.key.path,t.batchId);s.push(r.delete(m)),c.push(d.key)}return A.waitFor(s).next(()=>c)}function Ql(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw j();e=n.noDocument}return JSON.stringify(e).length}bt.DEFAULT_COLLECTION_PERCENTILE=10,bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,bt.DEFAULT=new bt(41943040,bt.DEFAULT_COLLECTION_PERCENTILE,bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),bt.DISABLED=new bt(-1,0,0);var Hl=class n{constructor(e,t,i,r){this.userId=e,this.serializer=t,this.indexManager=i,this.referenceDelegate=r,this.xn={}}static Pt(e,t,i,r){z(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,i,r)}checkEmpty(e){let t=!0,i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ti(e).J({index:"userMutationsIndex",range:i},(r,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,i,r){let s=Fr(e),o=ti(e);return o.add({}).next(a=>{z(typeof a=="number");let u=new No(a,t,i,r),c=function(y,C,P){let k=P.baseMutations.map(K=>Lo(y.ht,K)),G=P.mutations.map(K=>Lo(y.ht,K));return{userId:C,batchId:P.batchId,localWriteTimeMs:P.localWriteTime.toMillis(),baseMutations:k,mutations:G}}(this.serializer,this.userId,u),d=[],m=new _e((p,y)=>J(p.canonicalString(),y.canonicalString()));for(let p of r){let y=$v(this.userId,p.key.path,a);m=m.add(p.key.path.popLast()),d.push(o.put(c)),d.push(s.put(y,Lb))}return m.forEach(p=>{d.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.xn[a]=u.keys()}),A.waitFor(d).next(()=>u)})}lookupMutationBatch(e,t){return ti(e).get(t).next(i=>i?(z(i.userId===this.userId),Bi(this.serializer,i)):null)}On(e,t){return this.xn[t]?A.resolve(this.xn[t]):this.lookupMutationBatch(e,t).next(i=>{if(i){let r=i.keys();return this.xn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let i=t+1,r=IDBKeyRange.lowerBound([this.userId,i]),s=null;return ti(e).J({index:"userMutationsIndex",range:r},(o,a,u)=>{a.userId===this.userId&&(z(a.batchId>=i),s=Bi(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),i=-1;return ti(e).J({index:"userMutationsIndex",range:t,reverse:!0},(r,s,o)=>{i=s.batchId,o.done()}).next(()=>i)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ti(e).U("userMutationsIndex",t).next(i=>i.map(r=>Bi(this.serializer,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){let i=Il(this.userId,t.path),r=IDBKeyRange.lowerBound(i),s=[];return Fr(e).J({range:r},(o,a,u)=>{let[c,d,m]=o,p=rn(d);if(c===this.userId&&t.path.isEqual(p))return ti(e).get(m).next(y=>{if(!y)throw j();z(y.userId===this.userId),s.push(Bi(this.serializer,y))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new _e(J),r=[];return t.forEach(s=>{let o=Il(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=Fr(e).J({range:a},(c,d,m)=>{let[p,y,C]=c,P=rn(y);p===this.userId&&s.path.isEqual(P)?i=i.add(C):m.done()});r.push(u)}),A.waitFor(r).next(()=>this.Nn(e,i))}getAllMutationBatchesAffectingQuery(e,t){let i=t.path,r=i.length+1,s=Il(this.userId,i),o=IDBKeyRange.lowerBound(s),a=new _e(J);return Fr(e).J({range:o},(u,c,d)=>{let[m,p,y]=u,C=rn(p);m===this.userId&&i.isPrefixOf(C)?C.length===r&&(a=a.add(y)):d.done()}).next(()=>this.Nn(e,a))}Nn(e,t){let i=[],r=[];return t.forEach(s=>{r.push(ti(e).get(s).next(o=>{if(o===null)throw j();z(o.userId===this.userId),i.push(Bi(this.serializer,o))}))}),A.waitFor(r).next(()=>i)}removeMutationBatch(e,t){return Bw(e._e,this.userId,t).next(i=>(e.addOnCommittedListener(()=>{this.Bn(t.batchId)}),A.forEach(i,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}Bn(e){delete this.xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return A.resolve();let i=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),r=[];return Fr(e).J({range:i},(s,o,a)=>{if(s[0]===this.userId){let u=rn(s[1]);r.push(u)}else a.done()}).next(()=>{z(r.length===0)})})}containsKey(e,t){return qw(e,this.userId,t)}Ln(e){return jw(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function qw(n,e,t){let i=Il(e,t.path),r=i[1],s=IDBKeyRange.lowerBound(i),o=!1;return Fr(n).J({range:s,H:!0},(a,u,c)=>{let[d,m,p]=a;d===e&&m===r&&(o=!0),c.done()}).next(()=>o)}function ti(n){return Ye(n,"mutations")}function Fr(n){return Ye(n,"documentMutations")}function jw(n){return Ye(n,"mutationQueues")}var Qr=class n{constructor(e){this.kn=e}next(){return this.kn+=2,this.kn}static qn(){return new n(0)}static Qn(){return new n(-1)}};var Id=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Kn(e).next(t=>{let i=new Qr(t.highestTargetId);return t.highestTargetId=i.next(),this.$n(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Kn(e).next(t=>W.fromTimestamp(new xe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Kn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,i){return this.Kn(e).next(r=>(r.highestListenSequenceNumber=t,i&&(r.lastRemoteSnapshotVersion=i.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.$n(e,r)))}addTargetData(e,t){return this.Un(e,t).next(()=>this.Kn(e).next(i=>(i.targetCount+=1,this.Wn(t,i),this.$n(e,i))))}updateTargetData(e,t){return this.Un(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Pr(e).delete(t.targetId)).next(()=>this.Kn(e)).next(i=>(z(i.targetCount>0),i.targetCount-=1,this.$n(e,i)))}removeTargets(e,t,i){let r=0,s=[];return Pr(e).J((o,a)=>{let u=vo(a);u.sequenceNumber<=t&&i.get(u.targetId)===null&&(r++,s.push(this.removeTargetData(e,u)))}).next(()=>A.waitFor(s)).next(()=>r)}forEachTarget(e,t){return Pr(e).J((i,r)=>{let s=vo(r);t(s)})}Kn(e){return vv(e).get("targetGlobalKey").next(t=>(z(t!==null),t))}$n(e,t){return vv(e).put("targetGlobalKey",t)}Un(e,t){return Pr(e).put(Lw(this.serializer,t))}Wn(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.Kn(e).next(t=>t.targetCount)}getTargetData(e,t){let i=$i(t),r=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]),s=null;return Pr(e).J({range:r,index:"queryTargetsIndex"},(o,a,u)=>{let c=vo(a);Qo(t,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,t,i){let r=[],s=ni(e);return t.forEach(o=>{let a=ht(o.path);r.push(s.put({targetId:i,path:a})),r.push(this.referenceDelegate.addReference(e,i,o))}),A.waitFor(r)}removeMatchingKeys(e,t,i){let r=ni(e);return A.forEach(t,s=>{let o=ht(s.path);return A.waitFor([r.delete([i,o]),this.referenceDelegate.removeReference(e,i,s)])})}removeMatchingKeysForTargetId(e,t){let i=ni(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(r)}getMatchingKeysForTargetId(e,t){let i=IDBKeyRange.bound([t],[t+1],!1,!0),r=ni(e),s=ne();return r.J({range:i,H:!0},(o,a,u)=>{let c=rn(o[1]),d=new U(c);s=s.add(d)}).next(()=>s)}containsKey(e,t){let i=ht(t.path),r=IDBKeyRange.bound([i],[qv(i)],!1,!0),s=0;return ni(e).J({index:"documentTargetsIndex",H:!0,range:r},([o,a],u,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}ut(e,t){return Pr(e).get(t).next(i=>i?vo(i):null)}};function Pr(n){return Ye(n,"targets")}function vv(n){return Ye(n,"targetGlobal")}function ni(n){return Ye(n,"targetDocuments")}function wv([n,e],[t,i]){let r=J(n,t);return r===0?J(e,i):r}var Td=class{constructor(e){this.Gn=e,this.buffer=new _e(wv),this.zn=0}jn(){return++this.zn}Hn(e){let t=[e,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(t);else{let i=this.buffer.last();wv(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}},Yl=class{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return this.Jn!==null}Yn(e){V("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>N(this,null,function*(){this.Jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){_i(t)?V("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield gi(t)}yield this.Yn(3e5)}))}},bd=class{constructor(e,t){this.Zn=e,this.params=t}calculateTargetCount(e,t){return this.Zn.Xn(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return A.resolve(xt.oe);let i=new Td(t);return this.Zn.forEachTarget(e,r=>i.Hn(r.sequenceNumber)).next(()=>this.Zn.er(e,r=>i.Hn(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.Zn.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.Zn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),A.resolve(yv)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),yv):this.tr(e,t))}getCacheSize(e){return this.Zn.getCacheSize(e)}tr(e,t){let i,r,s,o,a,u,c,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),r=this.params.maximumSequenceNumbersToCollect):r=m,o=Date.now(),this.nthSequenceNumber(e,r))).next(m=>(i=m,a=Date.now(),this.removeTargets(e,i,t))).next(m=>(s=m,u=Date.now(),this.removeOrphanedDocuments(e,i))).next(m=>(c=Date.now(),kr()<=Ft.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${m} documents in `+(c-u)+`ms
Total Duration: ${c-d}ms`),A.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:m})))}};function Gw(n,e){return new bd(n,e)}var Cd=class{constructor(e,t){this.db=e,this.garbageCollector=Gw(this,t)}Xn(e){let t=this.nr(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}nr(e){let t=0;return this.er(e,i=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}er(e,t){return this.rr(e,(i,r)=>t(r))}addReference(e,t,i){return vl(e,i)}removeReference(e,t,i){return vl(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return vl(e,t)}ir(e,t){return function(r,s){let o=!1;return jw(r).Y(a=>qw(r,a,s).next(u=>(u&&(o=!0),A.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],s=0;return this.rr(e,(o,a)=>{if(a<=t){let u=this.ir(e,o).next(c=>{if(!c)return s++,i.getEntry(e,o).next(()=>(i.removeEntry(o,W.min()),ni(e).delete(function(m){return[0,ht(m.path)]}(o))))});r.push(u)}}).next(()=>A.waitFor(r)).next(()=>i.apply(e)).next(()=>s)}removeTarget(e,t){let i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return vl(e,t)}rr(e,t){let i=ni(e),r,s=xt.oe;return i.J({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(s!==xt.oe&&t(new U(rn(r)),s),s=c,r=u):s=xt.oe}).next(()=>{s!==xt.oe&&t(new U(rn(r)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function vl(n,e){return ni(n).put(function(i,r){return{targetId:0,path:ht(i.path),sequenceNumber:r}}(e,n.currentSequenceNumber))}var Jl=class{constructor(){this.changes=new Wt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,We.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let i=this.changes.get(t);return i!==void 0?A.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Sd=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return Li(e).put(i)}removeEntry(e,t,i){return Li(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],zl(o),a[a.length-1]]}(t,i))}updateMetadata(e,t){return this.getMetadata(e).next(i=>(i.byteSize+=t,this.sr(e,i)))}getEntry(e,t){let i=We.newInvalidDocument(t);return Li(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(go(t))},(r,s)=>{i=this._r(t,s)}).next(()=>i)}ar(e,t){let i={size:0,document:We.newInvalidDocument(t)};return Li(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(go(t))},(r,s)=>{i={document:this._r(t,s),size:Ql(s)}}).next(()=>i)}getEntries(e,t){let i=Ct();return this.ur(e,t,(r,s)=>{let o=this._r(r,s);i=i.insert(r,o)}).next(()=>i)}cr(e,t){let i=Ct(),r=new Te(U.comparator);return this.ur(e,t,(s,o)=>{let a=this._r(s,o);i=i.insert(s,a),r=r.insert(s,Ql(o))}).next(()=>({documents:i,lr:r}))}ur(e,t,i){if(t.isEmpty())return A.resolve();let r=new _e(Tv);t.forEach(u=>r=r.add(u));let s=IDBKeyRange.bound(go(r.first()),go(r.last())),o=r.getIterator(),a=o.getNext();return Li(e).J({index:"documentKeyIndex",range:s},(u,c,d)=>{let m=U.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&Tv(a,m)<0;)i(a,null),a=o.getNext();a&&a.isEqual(m)&&(i(a,c),a=o.hasNext()?o.getNext():null),a?d.$(go(a)):d.done()}).next(()=>{for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,i,r,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),zl(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Li(e).U(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let d=Ct();for(let m of c){let p=this._r(U.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);p.isFoundDocument()&&(Yo(t,p)||r.has(p.key))&&(d=d.insert(p.key,p))}return d})}getAllFromCollectionGroup(e,t,i,r){let s=Ct(),o=Iv(t,i),a=Iv(t,Ot.max());return Li(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,d)=>{let m=this._r(U.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(m.key,m),s.size===r&&d.done()}).next(()=>s)}newChangeBuffer(e){return new Ad(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Ev(e).get("remoteDocumentGlobalKey").next(t=>(z(!!t),t))}sr(e,t){return Ev(e).put("remoteDocumentGlobalKey",t)}_r(e,t){if(t){let i=RC(this.serializer,t);if(!(i.isNoDocument()&&i.version.isEqual(W.min())))return i}return We.newInvalidDocument(e)}};function zw(n){return new Sd(n)}var Ad=class extends Jl{constructor(e,t){super(),this.hr=e,this.trackRemovals=t,this.Pr=new Wt(i=>i.toString(),(i,r)=>i.isEqual(r))}applyChanges(e){let t=[],i=0,r=new _e((s,o)=>J(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.Pr.get(s);if(t.push(this.hr.removeEntry(e,s,a.readTime)),o.isValidDocument()){let u=lv(this.hr.serializer,o);r=r.add(s.path.popLast());let c=Ql(u);i+=c-a.size,t.push(this.hr.addEntry(e,s,u))}else if(i-=a.size,this.trackRemovals){let u=lv(this.hr.serializer,o.convertToNoDocument(W.min()));t.push(this.hr.addEntry(e,s,u))}}),r.forEach(s=>{t.push(this.hr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.hr.updateMetadata(e,i)),A.waitFor(t)}getFromCache(e,t){return this.hr.ar(e,t).next(i=>(this.Pr.set(t,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(e,t){return this.hr.cr(e,t).next(({documents:i,lr:r})=>(r.forEach((s,o)=>{this.Pr.set(s,{size:o,readTime:i.get(s).readTime})}),i))}};function Ev(n){return Ye(n,"remoteDocumentGlobal")}function Li(n){return Ye(n,"remoteDocumentsV14")}function go(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Iv(n,e){let t=e.documentKey.path.toArray();return[n,zl(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Tv(n,e){let t=n.path.toArray(),i=e.path.toArray(),r=0;for(let s=0;s<t.length-2&&s<i.length-2;++s)if(r=J(t[s],i[s]),r)return r;return r=J(t.length,i.length),r||(r=J(t[t.length-2],i[i.length-2]),r||J(t[t.length-1],i[i.length-1]))}var xd=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Xl=class{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(i!==null&&Io(i.mutation,r,Rt.empty(),xe.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,ne()).next(()=>i))}getLocalViewOfDocuments(e,t,i=ne()){let r=sn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let o=yo();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let i=sn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,ne()))}populateOverlays(e,t,i){let r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,i,r){let s=Ct(),o=Eo(),a=function(){return Eo()}();return t.forEach((u,c)=>{let d=i.get(c.key);r.has(c.key)&&(d===void 0||d.mutation instanceof $t)?s=s.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),Io(d.mutation,c,d.mutation.getFieldMask(),xe.now())):o.set(c.key,Rt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var m;return a.set(c,new xd(d,(m=o.get(c))!==null&&m!==void 0?m:null))}),a))}recalculateAndSaveOverlays(e,t){let i=Eo(),r=new Te((o,a)=>o-a),s=ne();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=t.get(u);if(c===null)return;let d=i.get(u)||Rt.empty();d=a.applyToLocalView(c,d),i.set(u,d);let m=(r.get(a.batchId)||ne()).add(u);r=r.insert(a.batchId,m)})}).next(()=>{let o=[],a=r.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,d=u.value,m=fw();d.forEach(p=>{if(!s.has(p)){let y=ww(t.get(p),i.get(p));y!==null&&m.set(p,y),s=s.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,m))}return A.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,r){return function(o){return U.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Vf(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,r):this.getDocumentsMatchingCollectionQuery(e,t,i,r)}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{let o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):A.resolve(sn()),a=-1,u=s;return o.next(c=>A.forEach(c,(d,m)=>(a<m.largestBatchId&&(a=m.largestBatchId),s.get(d)?A.resolve():this.remoteDocumentCache.getEntry(e,d).next(p=>{u=u.insert(d,p)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,ne())).next(d=>({batchId:a,changes:dw(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new U(t)).next(i=>{let r=yo();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i,r){let s=t.collectionGroup,o=yo();return this.indexManager.getCollectionParents(e,s).next(a=>A.forEach(a,u=>{let c=function(m,p){return new Kt(p,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,i,r).next(d=>{d.forEach((m,p)=>{o=o.insert(m,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,s,r))).next(o=>{s.forEach((u,c)=>{let d=c.getKey();o.get(d)===null&&(o=o.insert(d,We.newInvalidDocument(d)))});let a=yo();return o.forEach((u,c)=>{let d=s.get(u);d!==void 0&&Io(d.mutation,c,Rt.empty(),xe.now()),Yo(t,c)&&(a=a.insert(u,c))}),a})}};var Rd=class{constructor(e){this.serializer=e,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(e,t){return A.resolve(this.Tr.get(t))}saveBundleMetadata(e,t){return this.Tr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:Me(r.createTime)}}(t)),A.resolve()}getNamedQuery(e,t){return A.resolve(this.Ir.get(t))}saveNamedQuery(e,t){return this.Ir.set(t.name,function(r){return{name:r.name,query:Mf(r.bundledQuery),readTime:Me(r.readTime)}}(t)),A.resolve()}};var Pd=class{constructor(){this.overlays=new Te(U.comparator),this.dr=new Map}getOverlay(e,t){return A.resolve(this.overlays.get(t))}getOverlays(e,t){let i=sn();return A.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.Tt(e,t,s)}),A.resolve()}removeOverlaysForBatchId(e,t,i){let r=this.dr.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.dr.delete(i)),A.resolve()}getOverlaysForCollection(e,t,i){let r=sn(),s=t.length+1,o=new U(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>i&&r.set(u.getKey(),u)}return A.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new Te((c,d)=>c-d),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>i){let d=s.get(c.largestBatchId);d===null&&(d=sn(),s=s.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}let a=sn(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=r)););return A.resolve(a)}Tt(e,t,i){let r=this.overlays.get(i.key);if(r!==null){let o=this.dr.get(r.largestBatchId).delete(i.key);this.dr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new Do(t,i));let s=this.dr.get(t);s===void 0&&(s=ne(),this.dr.set(t,s)),this.dr.set(t,s.add(i.key))}};var kd=class{constructor(){this.sessionToken=Ue.EMPTY_BYTE_STRING}getSessionToken(e){return A.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,A.resolve()}};var Uo=class{constructor(){this.Er=new _e(ze.Ar),this.Rr=new _e(ze.Vr)}isEmpty(){return this.Er.isEmpty()}addReference(e,t){let i=new ze(e,t);this.Er=this.Er.add(i),this.Rr=this.Rr.add(i)}mr(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.gr(new ze(e,t))}pr(e,t){e.forEach(i=>this.removeReference(i,t))}yr(e){let t=new U(new he([])),i=new ze(t,e),r=new ze(t,e+1),s=[];return this.Rr.forEachInRange([i,r],o=>{this.gr(o),s.push(o.key)}),s}wr(){this.Er.forEach(e=>this.gr(e))}gr(e){this.Er=this.Er.delete(e),this.Rr=this.Rr.delete(e)}Sr(e){let t=new U(new he([])),i=new ze(t,e),r=new ze(t,e+1),s=ne();return this.Rr.forEachInRange([i,r],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new ze(e,0),i=this.Er.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}},ze=class{constructor(e,t){this.key=e,this.br=t}static Ar(e,t){return U.comparator(e.key,t.key)||J(e.br,t.br)}static Vr(e,t){return J(e.br,t.br)||U.comparator(e.key,t.key)}};var Nd=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Dr=1,this.vr=new _e(ze.Ar)}checkEmpty(e){return A.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,r){let s=this.Dr;this.Dr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new No(s,t,i,r);this.mutationQueue.push(o);for(let a of r)this.vr=this.vr.add(new ze(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return A.resolve(o)}lookupMutationBatch(e,t){return A.resolve(this.Cr(t))}getNextMutationBatchAfterBatchId(e,t){let i=t+1,r=this.Fr(i),s=r<0?0:r;return A.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return A.resolve(this.mutationQueue.length===0?-1:this.Dr-1)}getAllMutationBatches(e){return A.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let i=new ze(t,0),r=new ze(t,Number.POSITIVE_INFINITY),s=[];return this.vr.forEachInRange([i,r],o=>{let a=this.Cr(o.br);s.push(a)}),A.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new _e(J);return t.forEach(r=>{let s=new ze(r,0),o=new ze(r,Number.POSITIVE_INFINITY);this.vr.forEachInRange([s,o],a=>{i=i.add(a.br)})}),A.resolve(this.Mr(i))}getAllMutationBatchesAffectingQuery(e,t){let i=t.path,r=i.length+1,s=i;U.isDocumentKey(s)||(s=s.child(""));let o=new ze(new U(s),0),a=new _e(J);return this.vr.forEachWhile(u=>{let c=u.key.path;return!!i.isPrefixOf(c)&&(c.length===r&&(a=a.add(u.br)),!0)},o),A.resolve(this.Mr(a))}Mr(e){let t=[];return e.forEach(i=>{let r=this.Cr(i);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){z(this.Or(t.batchId,"removed")===0),this.mutationQueue.shift();let i=this.vr;return A.forEach(t.mutations,r=>{let s=new ze(r.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.vr=i})}Bn(e){}containsKey(e,t){let i=new ze(t,0),r=this.vr.firstAfterOrEqual(i);return A.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,A.resolve()}Or(e,t){return this.Fr(e)}Fr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Cr(e){let t=this.Fr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Dd=class{constructor(e){this.Nr=e,this.docs=function(){return new Te(U.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let i=t.key,r=this.docs.get(i),s=r?r.size:0,o=this.Nr(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let i=this.docs.get(t);return A.resolve(i?i.document.mutableCopy():We.newInvalidDocument(t))}getEntries(e,t){let i=Ct();return t.forEach(r=>{let s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():We.newInvalidDocument(r))}),A.resolve(i)}getDocumentsMatchingQuery(e,t,i,r){let s=Ct(),o=t.path,a=new U(o.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:d}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Pf(Gv(d),i)<=0||(r.has(d.key)||Yo(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return A.resolve(s)}getAllFromCollectionGroup(e,t,i,r){j()}Br(e,t){return A.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new Vd(this)}getSize(e){return A.resolve(this.size)}},Vd=class extends Jl{constructor(e){super(),this.hr=e}applyChanges(e){let t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.hr.addEntry(e,r)):this.hr.removeEntry(i)}),A.waitFor(t)}getFromCache(e,t){return this.hr.getEntry(e,t)}getAllFromCache(e,t){return this.hr.getEntries(e,t)}};var Fd=class{constructor(e){this.persistence=e,this.Lr=new Wt(t=>$i(t),Qo),this.lastRemoteSnapshotVersion=W.min(),this.highestTargetId=0,this.kr=0,this.qr=new Uo,this.targetCount=0,this.Qr=Qr.qn()}forEachTarget(e,t){return this.Lr.forEach((i,r)=>t(r)),A.resolve()}getLastRemoteSnapshotVersion(e){return A.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return A.resolve(this.kr)}allocateTargetId(e){return this.highestTargetId=this.Qr.next(),A.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.kr&&(this.kr=t),A.resolve()}Un(e){this.Lr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Qr=new Qr(t),this.highestTargetId=t),e.sequenceNumber>this.kr&&(this.kr=e.sequenceNumber)}addTargetData(e,t){return this.Un(t),this.targetCount+=1,A.resolve()}updateTargetData(e,t){return this.Un(t),A.resolve()}removeTargetData(e,t){return this.Lr.delete(t.target),this.qr.yr(t.targetId),this.targetCount-=1,A.resolve()}removeTargets(e,t,i){let r=0,s=[];return this.Lr.forEach((o,a)=>{a.sequenceNumber<=t&&i.get(a.targetId)===null&&(this.Lr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),A.waitFor(s).next(()=>r)}getTargetCount(e){return A.resolve(this.targetCount)}getTargetData(e,t){let i=this.Lr.get(t)||null;return A.resolve(i)}addMatchingKeys(e,t,i){return this.qr.mr(t,i),A.resolve()}removeMatchingKeys(e,t,i){this.qr.pr(t,i);let r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(o=>{s.push(r.markPotentiallyOrphaned(e,o))}),A.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.qr.yr(t),A.resolve()}getMatchingKeysForTargetId(e,t){let i=this.qr.Sr(t);return A.resolve(i)}containsKey(e,t){return A.resolve(this.qr.containsKey(t))}};var Bo=class{constructor(e,t){this.Kr={},this.overlays={},this.$r=new xt(0),this.Ur=!1,this.Ur=!0,this.Wr=new kd,this.referenceDelegate=e(this),this.Gr=new Fd(this),this.indexManager=new wd,this.remoteDocumentCache=function(r){return new Dd(r)}(i=>this.referenceDelegate.zr(i)),this.serializer=new Gl(t),this.jr=new Rd(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Pd,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.Kr[e.toKey()];return i||(i=new Nd(t,this.referenceDelegate),this.Kr[e.toKey()]=i),i}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(e,t,i){V("MemoryPersistence","Starting transaction:",e);let r=new Od(this.$r.next());return this.referenceDelegate.Hr(),i(r).next(s=>this.referenceDelegate.Jr(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Yr(e,t){return A.or(Object.values(this.Kr).map(i=>()=>i.containsKey(e,t)))}},Od=class extends kl{constructor(e){super(),this.currentSequenceNumber=e}},Zl=class n{constructor(e){this.persistence=e,this.Zr=new Uo,this.Xr=null}static ei(e){return new n(e)}get ti(){if(this.Xr)return this.Xr;throw j()}addReference(e,t,i){return this.Zr.addReference(i,t),this.ti.delete(i.toString()),A.resolve()}removeReference(e,t,i){return this.Zr.removeReference(i,t),this.ti.add(i.toString()),A.resolve()}markPotentiallyOrphaned(e,t){return this.ti.add(t.toString()),A.resolve()}removeTarget(e,t){this.Zr.yr(t.targetId).forEach(r=>this.ti.add(r.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.ti.add(s.toString()))}).next(()=>i.removeTargetData(e,t))}Hr(){this.Xr=new Set}Jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return A.forEach(this.ti,i=>{let r=U.fromPath(i);return this.ni(e,r).next(s=>{s||t.removeEntry(r,W.min())})}).next(()=>(this.Xr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ni(e,t).next(i=>{i?this.ti.delete(t.toString()):this.ti.add(t.toString())})}zr(e){return 0}ni(e,t){return A.or([()=>A.resolve(this.Zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Yr(e,t)])}},eu=class n{constructor(e,t){this.persistence=e,this.ri=new Wt(i=>ht(i.path),(i,r)=>i.isEqual(r)),this.garbageCollector=Gw(this,t)}static ei(e,t){return new n(e,t)}Hr(){}Jr(e){return A.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Xn(e){let t=this.nr(e);return this.persistence.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}nr(e){let t=0;return this.er(e,i=>{t++}).next(()=>t)}er(e,t){return A.forEach(this.ri,(i,r)=>this.ir(e,i,r).next(s=>s?A.resolve():t(r)))}removeTargets(e,t,i){return this.persistence.getTargetCache().removeTargets(e,t,i)}removeOrphanedDocuments(e,t){let i=0,r=this.persistence.getRemoteDocumentCache(),s=r.newChangeBuffer();return r.Br(e,o=>this.ir(e,o,t).next(a=>{a||(i++,s.removeEntry(o,W.min()))})).next(()=>s.apply(e)).next(()=>i)}markPotentiallyOrphaned(e,t){return this.ri.set(t,e.currentSequenceNumber),A.resolve()}removeTarget(e,t){let i=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,i)}addReference(e,t,i){return this.ri.set(i,e.currentSequenceNumber),A.resolve()}removeReference(e,t,i){return this.ri.set(i,e.currentSequenceNumber),A.resolve()}updateLimboDocument(e,t){return this.ri.set(t,e.currentSequenceNumber),A.resolve()}zr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=bl(e.data.value)),t}ir(e,t,i){return A.or([()=>this.persistence.Yr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let r=this.ri.get(t);return A.resolve(r!==void 0&&r>i)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var Ld=class{constructor(e){this.serializer=e}O(e,t,i,r){let s=new Nl("createOrUpgrade",t);i<1&&r>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",By,{unique:!0}),u.createObjectStore("documentMutations")}(e),bv(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=A.resolve();return i<3&&r>=3&&(i!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),bv(e)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:W.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(s))),i<4&&r>=4&&(i!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").U().next(d=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",By,{unique:!0});let m=c.store("mutations"),p=d.map(y=>m.put(y));return A.waitFor(p)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),i<5&&r>=5&&(o=o.next(()=>this.ii(s))),i<6&&r>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.si(s)))),i<7&&r>=7&&(o=o.next(()=>this.oi(s))),i<8&&r>=8&&(o=o.next(()=>this._i(e,s))),i<9&&r>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),i<10&&r>=10&&(o=o.next(()=>this.ai(s))),i<11&&r>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),i<12&&r>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:Hb});c.createIndex("collectionPathOverlayIndex",Yb,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",Jb,{unique:!1})})(e)})),i<13&&r>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:Mb});c.createIndex("documentKeyIndex",Ub),c.createIndex("collectionGroupIndex",Bb)}(e)).next(()=>this.ui(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),i<14&&r>=14&&(o=o.next(()=>this.ci(e,s))),i<15&&r>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:Kb}).createIndex("sequenceNumberIndex",Wb,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:$b}).createIndex("documentKeyIndex",Qb,{unique:!1})}(e))),i<16&&r>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),i<17&&r>=17&&(o=o.next(()=>{(function(u){u.createObjectStore("globals",{keyPath:"name"})})(e)})),o}si(e){let t=0;return e.store("remoteDocuments").J((i,r)=>{t+=Ql(r)}).next(()=>{let i={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",i)})}ii(e){let t=e.store("mutationQueues"),i=e.store("mutations");return t.U().next(r=>A.forEach(r,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return i.U("userMutationsIndex",o).next(a=>A.forEach(a,u=>{z(u.userId===s.userId);let c=Bi(this.serializer,u);return Bw(e,s.userId,c).next(()=>{})}))}))}oi(e){let t=e.store("targetDocuments"),i=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(r=>{let s=[];return i.J((o,a)=>{let u=new he(o),c=function(m){return[0,ht(m)]}(u);s.push(t.get(c).next(d=>d?A.resolve():(m=>t.put({targetId:0,path:ht(m),sequenceNumber:r.highestListenSequenceNumber}))(u)))}).next(()=>A.waitFor(s))})}_i(e,t){e.createObjectStore("collectionParents",{keyPath:zb});let i=t.store("collectionParents"),r=new Mo,s=o=>{if(r.add(o)){let a=o.lastSegment(),u=o.popLast();return i.put({collectionId:a,parent:ht(u)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{let u=new he(o);return s(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,u],c)=>{let d=rn(a);return s(d.popLast())}))}ai(e){let t=e.store("targets");return t.J((i,r)=>{let s=vo(r),o=Lw(this.serializer,s);return t.put(o)})}ui(e,t){let i=t.store("remoteDocuments"),r=[];return i.J((s,o)=>{let a=t.store("remoteDocumentsV14"),u=function(m){return m.document?new U(he.fromString(m.document.name).popFirst(5)):m.noDocument?U.fromSegments(m.noDocument.path):m.unknownDocument?U.fromSegments(m.unknownDocument.path):j()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(a.put(c))}).next(()=>A.waitFor(r))}ci(e,t){let i=t.store("mutations"),r=zw(this.serializer),s=new Bo(Zl.ei,this.serializer.ht);return i.U().next(o=>{let a=new Map;return o.forEach(u=>{var c;let d=(c=a.get(u.userId))!==null&&c!==void 0?c:ne();Bi(this.serializer,u).keys().forEach(m=>d=d.add(m)),a.set(u.userId,d)}),A.forEach(a,(u,c)=>{let d=new Ke(c),m=Kl.Pt(this.serializer,d),p=s.getIndexManager(d),y=Hl.Pt(d,this.serializer,p,s.referenceDelegate);return new Xl(r,y,m,p).recalculateAndSaveOverlaysForDocumentKeys(new Ao(t,xt.oe),u).next()})})}};function bv(n){n.createObjectStore("targetDocuments",{keyPath:jb}).createIndex("documentTargetsIndex",Gb,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",qb,{unique:!0}),n.createObjectStore("targetGlobal")}var Sh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Md=class n{constructor(e,t,i,r,s,o,a,u,c,d,m=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.li=s,this.window=o,this.document=a,this.hi=c,this.Pi=d,this.Ti=m,this.$r=null,this.Ur=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ii=null,this.inForeground=!1,this.di=null,this.Ei=null,this.Ai=Number.NEGATIVE_INFINITY,this.Ri=p=>Promise.resolve(),!n.p())throw new D(R.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Cd(this,r),this.Vi=t+"main",this.serializer=new Gl(u),this.mi=new ai(this.Vi,this.Ti,new Ld(this.serializer)),this.Wr=new fd,this.Gr=new Id(this.referenceDelegate,this.serializer),this.remoteDocumentCache=zw(this.serializer),this.jr=new dd,this.window&&this.window.localStorage?this.fi=this.window.localStorage:(this.fi=null,d===!1&&Oe("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.gi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new D(R.FAILED_PRECONDITION,Sh);return this.pi(),this.yi(),this.wi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Gr.getHighestSequenceNumber(e))}).then(e=>{this.$r=new xt(e,this.hi)}).then(()=>{this.Ur=!0}).catch(e=>(this.mi&&this.mi.close(),Promise.reject(e)))}Si(e){return this.Ri=t=>N(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.mi.B(t=>N(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.li.enqueueAndForget(()=>N(this,null,function*(){this.started&&(yield this.gi())})))}gi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>wl(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.bi(e).next(t=>{t||(this.isPrimary=!1,this.li.enqueueRetryable(()=>this.Ri(!1)))})}).next(()=>this.Di(e)).next(t=>this.isPrimary&&!t?this.vi(e).next(()=>!1):!!t&&this.Ci(e).next(()=>!0))).catch(e=>{if(_i(e))return V("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return V("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.li.enqueueRetryable(()=>this.Ri(e)),this.isPrimary=e})}bi(e){return _o(e).get("owner").next(t=>A.resolve(this.Fi(t)))}Mi(e){return wl(e).delete(this.clientId)}xi(){return N(this,null,function*(){if(this.isPrimary&&!this.Oi(this.Ai,18e5)){this.Ai=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let i=Ye(t,"clientMetadata");return i.U().next(r=>{let s=this.Ni(r,18e5),o=r.filter(a=>s.indexOf(a)===-1);return A.forEach(o,a=>i.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.fi)for(let t of e)this.fi.removeItem(this.Bi(t.clientId))}})}wi(){this.Ei=this.li.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.gi().then(()=>this.xi()).then(()=>this.wi()))}Fi(e){return!!e&&e.ownerId===this.clientId}Di(e){return this.Pi?A.resolve(!0):_o(e).get("owner").next(t=>{if(t!==null&&this.Oi(t.leaseTimestampMs,5e3)&&!this.Li(t.ownerId)){if(this.Fi(t)&&this.networkEnabled)return!0;if(!this.Fi(t)){if(!t.allowTabSynchronization)throw new D(R.FAILED_PRECONDITION,Sh);return!1}}return!(!this.networkEnabled||!this.inForeground)||wl(e).U().next(i=>this.Ni(i,5e3).find(r=>{if(this.clientId!==r.clientId){let s=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,a=this.networkEnabled===r.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&V("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return N(this,null,function*(){this.Ur=!1,this.ki(),this.Ei&&(this.Ei.cancel(),this.Ei=null),this.qi(),this.Qi(),yield this.mi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new Ao(e,xt.oe);return this.vi(t).next(()=>this.Mi(t))}),this.mi.close(),this.Ki()})}Ni(e,t){return e.filter(i=>this.Oi(i.updateTimeMs,t)&&!this.Li(i.clientId))}$i(){return this.runTransaction("getActiveClients","readonly",e=>wl(e).U().next(t=>this.Ni(t,18e5).map(i=>i.clientId)))}get started(){return this.Ur}getGlobalsCache(){return this.Wr}getMutationQueue(e,t){return Hl.Pt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Ed(e,this.serializer.ht.databaseId)}getDocumentOverlayCache(e){return Kl.Pt(this.serializer,e)}getBundleCache(){return this.jr}runTransaction(e,t,i){V("IndexedDbPersistence","Starting transaction:",e);let r=t==="readonly"?"readonly":"readwrite",s=function(u){return u===17?eC:u===16?Zb:u===15?Nf:u===14?Yv:u===13?Hv:u===12?Xb:u===11?Qv:void j()}(this.Ti),o;return this.mi.runTransaction(e,r,s,a=>(o=new Ao(a,this.$r?this.$r.next():xt.oe),t==="readwrite-primary"?this.bi(o).next(u=>!!u||this.Di(o)).next(u=>{if(!u)throw Oe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.li.enqueueRetryable(()=>this.Ri(!1)),new D(R.FAILED_PRECONDITION,zv);return i(o)}).next(u=>this.Ci(o).next(()=>u)):this.Ui(o).next(()=>i(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ui(e){return _o(e).get("owner").next(t=>{if(t!==null&&this.Oi(t.leaseTimestampMs,5e3)&&!this.Li(t.ownerId)&&!this.Fi(t)&&!(this.Pi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new D(R.FAILED_PRECONDITION,Sh)})}Ci(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return _o(e).put("owner",t)}static p(){return ai.p()}vi(e){let t=_o(e);return t.get("owner").next(i=>this.Fi(i)?(V("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):A.resolve())}Oi(e,t){let i=Date.now();return!(e<i-t)&&(!(e>i)||(Oe(`Detected an update time that is in the future: ${e} > ${i}`),!1))}pi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.di=()=>{this.li.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.gi()))},this.document.addEventListener("visibilitychange",this.di),this.inForeground=this.document.visibilityState==="visible")}qi(){this.di&&(this.document.removeEventListener("visibilitychange",this.di),this.di=null)}yi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Ii=()=>{this.ki();let t=/(?:Version|Mobile)\/1[456]/;ph()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.li.enterRestrictedMode(!0),this.li.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ii))}Qi(){this.Ii&&(this.window.removeEventListener("pagehide",this.Ii),this.Ii=null)}Li(e){var t;try{let i=((t=this.fi)===null||t===void 0?void 0:t.getItem(this.Bi(e)))!==null;return V("IndexedDbPersistence",`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return Oe("IndexedDbPersistence","Failed to get zombied client id.",i),!1}}ki(){if(this.fi)try{this.fi.setItem(this.Bi(this.clientId),String(Date.now()))}catch(e){Oe("Failed to set zombie client id.",e)}}Ki(){if(this.fi)try{this.fi.removeItem(this.Bi(this.clientId))}catch{}}Bi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function _o(n){return Ye(n,"owner")}function wl(n){return Ye(n,"clientMetadata")}function Bf(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var Ud=class n{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.Wi=i,this.Gi=r}static zi(e,t){let i=ne(),r=ne();for(let s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new n(e,t.fromCache,i,r)}};var Bd=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var tu=class{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=function(){return ph()?8:Kv(eo())>0?6:4}()}initialize(e,t){this.Zi=e,this.indexManager=t,this.ji=!0}getDocumentsMatchingQuery(e,t,i,r){let s={result:null};return this.Xi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.es(e,t,r,i).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Bd;return this.ts(e,t,o).next(a=>{if(s.result=a,this.Hi)return this.ns(e,t,o,a.size)})}).next(()=>s.result)}ns(e,t,i,r){return i.documentReadCount<this.Ji?(kr()<=Ft.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",Nr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),A.resolve()):(kr()<=Ft.DEBUG&&V("QueryEngine","Query:",Nr(t),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.Yi*r?(kr()<=Ft.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",Nr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,yt(t))):A.resolve())}Xi(e,t){if(Xy(t))return A.resolve(null);let i=yt(t);return this.indexManager.getIndexType(e,i).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=Ul(t,null,"F"),i=yt(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{let o=ne(...s);return this.Zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,i).next(u=>{let c=this.rs(t,a);return this.ss(t,c,o,u.readTime)?this.Xi(e,Ul(t,null,"F")):this.os(e,c,t,u)}))})))}es(e,t,i,r){return Xy(t)||r.isEqual(W.min())?A.resolve(null):this.Zi.getDocuments(e,i).next(s=>{let o=this.rs(t,s);return this.ss(t,o,i,r)?A.resolve(null):(kr()<=Ft.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Nr(t)),this.os(e,o,t,jv(r,-1)).next(a=>a))})}rs(e,t){let i=new _e(cw(e));return t.forEach((r,s)=>{Yo(e,s)&&(i=i.add(s))}),i}ss(e,t,i,r){if(e.limit===null)return!1;if(i.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}ts(e,t,i){return kr()<=Ft.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",Nr(t)),this.Zi.getDocumentsMatchingQuery(e,t,Ot.min(),i)}os(e,t,i,r){return this.Zi.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var qd=class{constructor(e,t,i,r){this.persistence=e,this._s=t,this.serializer=r,this.us=new Te(J),this.cs=new Wt(s=>$i(s),Qo),this.ls=new Map,this.hs=e.getRemoteDocumentCache(),this.Gr=e.getTargetCache(),this.jr=e.getBundleCache(),this.Ps(i)}Ps(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Xl(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.us))}};function Kw(n,e,t,i){return new qd(n,e,t,i)}function Ww(n,e){return N(this,null,function*(){let t=M(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let r;return t.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,t.Ps(e),t.mutationQueue.getAllMutationBatches(i))).next(s=>{let o=[],a=[],u=ne();for(let c of r){o.push(c.batchId);for(let d of c.mutations)u=u.add(d.key)}for(let c of s){a.push(c.batchId);for(let d of c.mutations)u=u.add(d.key)}return t.localDocuments.getDocuments(i,u).next(c=>({Ts:c,removedBatchIds:o,addedBatchIds:a}))})})})}function NC(n,e){let t=M(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{let r=e.batch.keys(),s=t.hs.newChangeBuffer({trackRemovals:!0});return function(a,u,c,d){let m=c.batch,p=m.keys(),y=A.resolve();return p.forEach(C=>{y=y.next(()=>d.getEntry(u,C)).next(P=>{let k=c.docVersions.get(C);z(k!==null),P.version.compareTo(k)<0&&(m.applyToRemoteDocument(P,c),P.isValidDocument()&&(P.setReadTime(c.commitVersion),d.addEntry(P)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(u,m))}(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(a){let u=ne();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function $w(n){let e=M(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Gr.getLastRemoteSnapshotVersion(t))}function DC(n,e){let t=M(n),i=e.snapshotVersion,r=t.us;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.hs.newChangeBuffer({trackRemovals:!0});r=t.us;let a=[];e.targetChanges.forEach((d,m)=>{let p=r.get(m);if(!p)return;a.push(t.Gr.removeMatchingKeys(s,d.removedDocuments,m).next(()=>t.Gr.addMatchingKeys(s,d.addedDocuments,m)));let y=p.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?y=y.withResumeToken(Ue.EMPTY_BYTE_STRING,W.min()).withLastLimboFreeSnapshotVersion(W.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,i)),r=r.insert(m,y),function(P,k,G){return P.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-P.snapshotVersion.toMicroseconds()>=3e8?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0}(p,y,d)&&a.push(t.Gr.updateTargetData(s,y))});let u=Ct(),c=ne();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push(Qw(s,o,e.documentUpdates).next(d=>{u=d.Is,c=d.ds})),!i.isEqual(W.min())){let d=t.Gr.getLastRemoteSnapshotVersion(s).next(m=>t.Gr.setTargetsMetadata(s,s.currentSequenceNumber,i));a.push(d)}return A.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.us=r,s))}function Qw(n,e,t){let i=ne(),r=ne();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let o=Ct();return t.forEach((a,u)=>{let c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(r=r.add(a)),u.isNoDocument()&&u.version.isEqual(W.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):V("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{Is:o,ds:r}})}function VC(n,e){let t=M(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function Hr(n,e){let t=M(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.Gr.getTargetData(i,e).next(s=>s?(r=s,A.resolve(r)):t.Gr.allocateTargetId(i).next(o=>(r=new $r(e,o,"TargetPurposeListen",i.currentSequenceNumber),t.Gr.addTargetData(i,r).next(()=>r))))}).then(i=>{let r=t.us.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.us=t.us.insert(i.targetId,i),t.cs.set(e,i.targetId)),i})}function Yr(n,e,t){return N(this,null,function*(){let i=M(n),r=i.us.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield i.persistence.runTransaction("Release target",s,o=>i.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!_i(o))throw o;V("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}i.us=i.us.remove(e),i.cs.delete(r.target)})}function nu(n,e,t){let i=M(n),r=W.min(),s=ne();return i.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,d){let m=M(u),p=m.cs.get(d);return p!==void 0?A.resolve(m.us.get(p)):m.Gr.getTargetData(c,d)}(i,o,yt(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,i.Gr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>i._s.getDocumentsMatchingQuery(o,e,t?r:W.min(),t?s:ne())).next(a=>(Jw(i,uw(e),a),{documents:a,Es:s})))}function Hw(n,e){let t=M(n),i=M(t.Gr),r=t.us.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",s=>i.ut(s,e).next(o=>o?o.target:null))}function Yw(n,e){let t=M(n),i=t.ls.get(e)||W.min();return t.persistence.runTransaction("Get new document changes","readonly",r=>t.hs.getAllFromCollectionGroup(r,e,jv(i,-1),Number.MAX_SAFE_INTEGER)).then(r=>(Jw(t,e,r),r))}function Jw(n,e,t){let i=n.ls.get(e)||W.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.ls.set(e,i)}function FC(n,e,t,i){return N(this,null,function*(){let r=M(n),s=ne(),o=Ct();for(let c of t){let d=e.As(c.metadata.name);c.document&&(s=s.add(d));let m=e.Rs(c);m.setReadTime(e.Vs(c.metadata.readTime)),o=o.insert(d,m)}let a=r.hs.newChangeBuffer({trackRemovals:!0}),u=yield Hr(r,function(d){return yt(rs(he.fromString(`__bundle__/docs/${d}`)))}(i));return r.persistence.runTransaction("Apply bundle documents","readwrite",c=>Qw(c,a,o).next(d=>(a.apply(c),d)).next(d=>r.Gr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>r.Gr.addMatchingKeys(c,s,u.targetId)).next(()=>r.localDocuments.getLocalViewOfDocuments(c,d.Is,d.ds)).next(()=>d.Is)))})}function OC(i,r){return N(this,arguments,function*(n,e,t=ne()){let s=yield Hr(n,yt(Mf(e.bundledQuery))),o=M(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=Me(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.jr.saveNamedQuery(a,e);let c=s.withResumeToken(Ue.EMPTY_BYTE_STRING,u);return o.us=o.us.insert(c.targetId,c),o.Gr.updateTargetData(a,c).next(()=>o.Gr.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Gr.addMatchingKeys(a,t,s.targetId)).next(()=>o.jr.saveNamedQuery(a,e))})})}function Cv(n,e){return`firestore_clients_${n}_${e}`}function Sv(n,e,t){let i=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(i+=`_${e.uid}`),i}function Ah(n,e){return`firestore_targets_${n}_${e}`}var iu=class n{constructor(e,t,i,r){this.user=e,this.batchId=t,this.state=i,this.error=r}static fs(e,t,i){let r=JSON.parse(i),s,o=typeof r=="object"&&["pending","acknowledged","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return o&&r.error&&(o=typeof r.error.message=="string"&&typeof r.error.code=="string",o&&(s=new D(r.error.code,r.error.message))),o?new n(e,t,r.state,s):(Oe("SharedClientState",`Failed to parse mutation state for ID '${t}': ${i}`),null)}gs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},To=class n{constructor(e,t,i){this.targetId=e,this.state=t,this.error=i}static fs(e,t){let i=JSON.parse(t),r,s=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(r=new D(i.error.code,i.error.message))),s?new n(e,i.state,r):(Oe("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}gs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},ru=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fs(e,t){let i=JSON.parse(t),r=typeof i=="object"&&i.activeTargetIds instanceof Array,s=Ff();for(let o=0;r&&o<i.activeTargetIds.length;++o)r=Wv(i.activeTargetIds[o]),s=s.add(i.activeTargetIds[o]);return r?new n(e,s):(Oe("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},jd=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Oe("SharedClientState",`Failed to parse online state: ${e}`),null)}},qo=class{constructor(){this.activeTargetIds=Ff()}ps(e){this.activeTargetIds=this.activeTargetIds.add(e)}ys(e){this.activeTargetIds=this.activeTargetIds.delete(e)}gs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},bo=class{constructor(e,t,i,r,s){this.window=e,this.li=t,this.persistenceKey=i,this.ws=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ss=this.bs.bind(this),this.Ds=new Te(J),this.started=!1,this.vs=[];let o=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Cs=Cv(this.persistenceKey,this.ws),this.Fs=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.Ds=this.Ds.insert(this.ws,new qo),this.Ms=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.xs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Os=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Ns=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Bs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.Ss)}static p(e){return!(!e||!e.localStorage)}start(){return N(this,null,function*(){let e=yield this.syncEngine.$i();for(let i of e){if(i===this.ws)continue;let r=this.getItem(Cv(this.persistenceKey,i));if(r){let s=ru.fs(i,r);s&&(this.Ds=this.Ds.insert(s.clientId,s))}}this.Ls();let t=this.storage.getItem(this.Ns);if(t){let i=this.ks(t);i&&this.qs(i)}for(let i of this.vs)this.bs(i);this.vs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.Fs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Qs(this.Ds)}isActiveQueryTarget(e){let t=!1;return this.Ds.forEach((i,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ks(e,"pending")}updateMutationState(e,t,i){this.Ks(e,t,i),this.$s(e)}addLocalQueryTarget(e,t=!0){let i="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(Ah(this.persistenceKey,e));if(r){let s=To.fs(e,r);s&&(i=s.state)}}return t&&this.Us.ps(e),this.Ls(),i}removeLocalQueryTarget(e){this.Us.ys(e),this.Ls()}isLocalQueryTarget(e){return this.Us.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Ah(this.persistenceKey,e))}updateQueryState(e,t,i){this.Ws(e,t,i)}handleUserChange(e,t,i){t.forEach(r=>{this.$s(r)}),this.currentUser=e,i.forEach(r=>{this.addPendingMutation(r)})}setOnlineState(e){this.Gs(e)}notifyBundleLoaded(e){this.zs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Ss),this.removeItem(this.Cs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return V("SharedClientState","READ",e,t),t}setItem(e,t){V("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){V("SharedClientState","REMOVE",e),this.storage.removeItem(e)}bs(e){let t=e;if(t.storageArea===this.storage){if(V("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Cs)return void Oe("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.li.enqueueRetryable(()=>N(this,null,function*(){if(this.started){if(t.key!==null){if(this.Ms.test(t.key)){if(t.newValue==null){let i=this.js(t.key);return this.Hs(i,null)}{let i=this.Js(t.key,t.newValue);if(i)return this.Hs(i.clientId,i)}}else if(this.xs.test(t.key)){if(t.newValue!==null){let i=this.Ys(t.key,t.newValue);if(i)return this.Zs(i)}}else if(this.Os.test(t.key)){if(t.newValue!==null){let i=this.Xs(t.key,t.newValue);if(i)return this.eo(i)}}else if(t.key===this.Ns){if(t.newValue!==null){let i=this.ks(t.newValue);if(i)return this.qs(i)}}else if(t.key===this.Fs){let i=function(s){let o=xt.oe;if(s!=null)try{let a=JSON.parse(s);z(typeof a=="number"),o=a}catch(a){Oe("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);i!==xt.oe&&this.sequenceNumberHandler(i)}else if(t.key===this.Bs){let i=this.no(t.newValue);yield Promise.all(i.map(r=>this.syncEngine.ro(r)))}}}else this.vs.push(t)}))}}get Us(){return this.Ds.get(this.ws)}Ls(){this.setItem(this.Cs,this.Us.gs())}Ks(e,t,i){let r=new iu(this.currentUser,e,t,i),s=Sv(this.persistenceKey,this.currentUser,e);this.setItem(s,r.gs())}$s(e){let t=Sv(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Gs(e){let t={clientId:this.ws,onlineState:e};this.storage.setItem(this.Ns,JSON.stringify(t))}Ws(e,t,i){let r=Ah(this.persistenceKey,e),s=new To(e,t,i);this.setItem(r,s.gs())}zs(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Bs,t)}js(e){let t=this.Ms.exec(e);return t?t[1]:null}Js(e,t){let i=this.js(e);return ru.fs(i,t)}Ys(e,t){let i=this.xs.exec(e),r=Number(i[1]),s=i[2]!==void 0?i[2]:null;return iu.fs(new Ke(s),r,t)}Xs(e,t){let i=this.Os.exec(e),r=Number(i[1]);return To.fs(r,t)}ks(e){return jd.fs(e)}no(e){return JSON.parse(e)}Zs(e){return N(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.io(e.batchId,e.state,e.error);V("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}eo(e){return this.syncEngine.so(e.targetId,e.state,e.error)}Hs(e,t){let i=t?this.Ds.insert(e,t):this.Ds.remove(e),r=this.Qs(this.Ds),s=this.Qs(i),o=[],a=[];return s.forEach(u=>{r.has(u)||o.push(u)}),r.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.oo(o,a).then(()=>{this.Ds=i})}qs(e){this.Ds.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Qs(e){let t=Ff();return e.forEach((i,r)=>{t=t.unionWith(r.activeTargetIds)}),t}},su=class{constructor(){this._o=new qo,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this._o.ps(e),this.ao[e]||"not-current"}updateQueryState(e,t,i){this.ao[e]=t}removeLocalQueryTarget(e){this._o.ys(e)}isLocalQueryTarget(e){return this._o.activeTargetIds.has(e)}clearQueryState(e){delete this.ao[e]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(e){return this._o.activeTargetIds.has(e)}start(){return this._o=new qo,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Gd=class{uo(e){}shutdown(){}};var ou=class{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(e){this.To.push(e)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){V("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.To)e(0)}Po(){V("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.To)e(1)}static p(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var El=null;function xh(){return El===null?El=function(){return 268435456+Math.round(2147483648*Math.random())}():El++,"0x"+El.toString(16)}var LC={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var zd=class{constructor(e){this.Eo=e.Eo,this.Ao=e.Ao}Ro(e){this.Vo=e}mo(e){this.fo=e}po(e){this.yo=e}onMessage(e){this.wo=e}close(){this.Ao()}send(e){this.Eo(e)}So(){this.Vo()}bo(){this.fo()}Do(e){this.yo(e)}vo(e){this.wo(e)}};var ut="WebChannelConnection",Kd=class extends class{get Co(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let i=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Fo=i+"://"+t.host,this.Mo=`projects/${r}/databases/${s}`,this.xo=this.databaseId.database==="(default)"?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Oo(t,i,r,s,o){let a=xh(),u=this.No(t,i.toUriEncodedString());V("RestConnection",`Sending RPC '${t}' ${a}:`,u,r);let c={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Bo(c,s,o),this.Lo(t,u,c,r).then(d=>(V("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw zt("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",u,"request:",r),d})}ko(t,i,r,s,o,a){return this.Oo(t,i,r,s,o)}Bo(t,i,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+is}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((s,o)=>t[o]=s),r&&r.headers.forEach((s,o)=>t[o]=s)}No(t,i){let r=LC[t];return`${this.Fo}/v1/${i}:${r}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Lo(e,t,i,r){let s=xh();return new Promise((o,a)=>{let u=new wh;u.setWithCredentials(!0),u.listenOnce(Eh.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case fo.NO_ERROR:let d=u.getResponseJson();V(ut,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(d)),o(d);break;case fo.TIMEOUT:V(ut,`RPC '${e}' ${s} timed out`),a(new D(R.DEADLINE_EXCEEDED,"Request time out"));break;case fo.HTTP_ERROR:let m=u.getStatus();if(V(ut,`RPC '${e}' ${s} failed with status:`,m,"response text:",u.getResponseText()),m>0){let p=u.getResponseJson();Array.isArray(p)&&(p=p[0]);let y=p?.error;if(y&&y.status&&y.message){let C=function(k){let G=k.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(G)>=0?G:R.UNKNOWN}(y.status);a(new D(C,y.message))}else a(new D(R.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new D(R.UNAVAILABLE,"Connection failed."));break;default:j()}}finally{V(ut,`RPC '${e}' ${s} completed.`)}});let c=JSON.stringify(r);V(ut,`RPC '${e}' ${s} sending request:`,r),u.send(t,"POST",c,i,15)})}qo(e,t,i){let r=xh(),s=[this.Fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=bh(),a=Th(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Bo(u.initMessageHeaders,t,i),u.encodeInitMessageHeaders=!0;let d=s.join("");V(ut,`Creating RPC '${e}' stream ${r}: ${d}`,u);let m=o.createWebChannel(d,u),p=!1,y=!1,C=new zd({Eo:k=>{y?V(ut,`Not sending because RPC '${e}' stream ${r} is closed:`,k):(p||(V(ut,`Opening RPC '${e}' stream ${r} transport.`),m.open(),p=!0),V(ut,`RPC '${e}' stream ${r} sending:`,k),m.send(k))},Ao:()=>m.close()}),P=(k,G,K)=>{k.listen(G,O=>{try{K(O)}catch($){setTimeout(()=>{throw $},0)}})};return P(m,Sr.EventType.OPEN,()=>{y||(V(ut,`RPC '${e}' stream ${r} transport opened.`),C.So())}),P(m,Sr.EventType.CLOSE,()=>{y||(y=!0,V(ut,`RPC '${e}' stream ${r} transport closed`),C.Do())}),P(m,Sr.EventType.ERROR,k=>{y||(y=!0,zt(ut,`RPC '${e}' stream ${r} transport errored:`,k),C.Do(new D(R.UNAVAILABLE,"The operation could not be completed")))}),P(m,Sr.EventType.MESSAGE,k=>{var G;if(!y){let K=k.data[0];z(!!K);let O=K,$=O?.error||((G=O[0])===null||G===void 0?void 0:G.error);if($){V(ut,`RPC '${e}' stream ${r} received error:`,$);let Z=$.status,ee=function(w){let I=Ge[w];if(I!==void 0)return Tw(I)}(Z),E=$.message;ee===void 0&&(ee=R.INTERNAL,E="Unknown error status: "+Z+" with message "+$.message),y=!0,C.Do(new D(ee,E)),m.close()}else V(ut,`RPC '${e}' stream ${r} received:`,K),C.vo(K)}}),P(a,Ih.STAT_EVENT,k=>{k.stat===gl.PROXY?V(ut,`RPC '${e}' stream ${r} detected buffering proxy`):k.stat===gl.NOPROXY&&V(ut,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{C.bo()},0),C}};function Xw(){return typeof window<"u"?window:null}function Al(){return typeof document<"u"?document:null}function Jo(n){return new ad(n,!0)}var jo=class{constructor(e,t,i=1e3,r=1.5,s=6e4){this.li=e,this.timerId=t,this.Qo=i,this.Ko=r,this.$o=s,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(e){this.cancel();let t=Math.floor(this.Uo+this.Ho()),i=Math.max(0,Date.now()-this.Go),r=Math.max(0,t-i);r>0&&V("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Uo} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,r,()=>(this.Go=Date.now(),e())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){this.Wo!==null&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){this.Wo!==null&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}};var au=class{constructor(e,t,i,r,s,o,a,u){this.li=e,this.Yo=i,this.Zo=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new jo(e,t)}i_(){return this.state===1||this.state===5||this.s_()}s_(){return this.state===2||this.state===3}start(){this.n_=0,this.state!==4?this.auth():this.o_()}stop(){return N(this,null,function*(){this.i_()&&(yield this.close(0))})}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&this.e_===null&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,()=>this.u_()))}c_(e){this.l_(),this.stream.send(e)}u_(){return N(this,null,function*(){if(this.s_())return this.close(0)})}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}close(e,t){return N(this,null,function*(){this.l_(),this.h_(),this.r_.cancel(),this.Xo++,e!==4?this.r_.reset():t&&t.code===R.RESOURCE_EXHAUSTED?(Oe(t.toString()),Oe("Using maximum backoff delay to prevent overloading the backend."),this.r_.zo()):t&&t.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.P_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.po(t)})}P_(){}auth(){this.state=1;let e=this.T_(this.Xo),t=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.Xo===t&&this.I_(i,r)},i=>{e(()=>{let r=new D(R.UNKNOWN,"Fetching auth token failed: "+i.message);return this.d_(r)})})}I_(e,t){let i=this.T_(this.Xo);this.stream=this.E_(e,t),this.stream.Ro(()=>{i(()=>this.listener.Ro())}),this.stream.mo(()=>{i(()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,()=>(this.s_()&&(this.state=3),Promise.resolve())),this.listener.mo()))}),this.stream.po(r=>{i(()=>this.d_(r))}),this.stream.onMessage(r=>{i(()=>++this.n_==1?this.A_(r):this.onNext(r))})}o_(){this.state=5,this.r_.jo(()=>N(this,null,function*(){this.state=0,this.start()}))}d_(e){return V("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}T_(e){return t=>{this.li.enqueueAndForget(()=>this.Xo===e?t():(V("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Wd=class extends au{constructor(e,t,i,r,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}E_(e,t){return this.connection.qo("Listen",e,t)}A_(e){return this.onNext(e)}onNext(e){this.r_.reset();let t=IC(this.serializer,e),i=function(s){if(!("targetChange"in s))return W.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?W.min():o.readTime?Me(o.readTime):W.min()}(e);return this.listener.R_(t,i)}V_(e){let t={};t.database=cd(this.serializer),t.addTarget=function(s,o){let a,u=o.target;if(a=Ll(u)?{documents:kw(s,u)}:{query:Nw(s,u).ct},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Cw(s,o.resumeToken);let c=ld(s,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(W.min())>0){a.readTime=Wr(s,o.snapshotVersion.toTimestamp());let c=ld(s,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);let i=bC(this.serializer,e);i&&(t.labels=i),this.c_(t)}m_(e){let t={};t.database=cd(this.serializer),t.removeTarget=e,this.c_(t)}},$d=class extends au{constructor(e,t,i,r,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}E_(e,t){return this.connection.qo("Write",e,t)}A_(e){return z(!!e.streamToken),this.lastStreamToken=e.streamToken,z(!e.writeResults||e.writeResults.length===0),this.listener.p_()}onNext(e){z(!!e.streamToken),this.lastStreamToken=e.streamToken,this.r_.reset();let t=TC(e.writeResults,e.commitTime),i=Me(e.commitTime);return this.listener.y_(i,t)}w_(){let e={};e.database=cd(this.serializer),this.c_(e)}g_(e){let t={streamToken:this.lastStreamToken,writes:e.map(i=>Lo(this.serializer,i))};this.c_(t)}};var Qd=class extends class{}{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=r,this.S_=!1}b_(){if(this.S_)throw new D(R.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(e,t,i,r){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Oo(e,ud(t,i),r,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new D(R.UNKNOWN,s.toString())})}ko(e,t,i,r,s){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.ko(e,ud(t,i),r,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new D(R.UNKNOWN,o.toString())})}terminate(){this.S_=!0,this.connection.terminate()}},Hd=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){this.D_===0&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve())))}O_(e){this.state==="Online"?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.M_("Offline")))}set(e){this.N_(),this.D_=0,e==="Online"&&(this.C_=!1),this.M_(e)}M_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}x_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(Oe(t),this.C_=!1):V("OnlineStateTracker",t)}N_(){this.v_!==null&&(this.v_.cancel(),this.v_=null)}};var Yd=class{constructor(e,t,i,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.B_=[],this.L_=new Map,this.k_=new Set,this.q_=[],this.Q_=s,this.Q_.uo(o=>{i.enqueueAndForget(()=>N(this,null,function*(){vi(this)&&(V("RemoteStore","Restarting streams for network reachability change."),yield function(u){return N(this,null,function*(){let c=M(u);c.k_.add(4),yield ss(c),c.K_.set("Unknown"),c.k_.delete(4),yield Xo(c)})}(this))}))}),this.K_=new Hd(i,r)}};function Xo(n){return N(this,null,function*(){if(vi(n))for(let e of n.q_)yield e(!0)})}function ss(n){return N(this,null,function*(){for(let e of n.q_)yield e(!1)})}function Ru(n,e){let t=M(n);t.L_.has(e.targetId)||(t.L_.set(e.targetId,e),Gf(t)?jf(t):as(t).s_()&&qf(t,e))}function Jr(n,e){let t=M(n),i=as(t);t.L_.delete(e),i.s_()&&Zw(t,e),t.L_.size===0&&(i.s_()?i.a_():vi(t)&&t.K_.set("Unknown"))}function qf(n,e){if(n.U_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(W.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}as(n).V_(e)}function Zw(n,e){n.U_.xe(e),as(n).m_(e)}function jf(n){n.U_=new od({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>n.L_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),as(n).start(),n.K_.F_()}function Gf(n){return vi(n)&&!as(n).i_()&&n.L_.size>0}function vi(n){return M(n).k_.size===0}function eE(n){n.U_=void 0}function MC(n){return N(this,null,function*(){n.K_.set("Online")})}function UC(n){return N(this,null,function*(){n.L_.forEach((e,t)=>{qf(n,e)})})}function BC(n,e){return N(this,null,function*(){eE(n),Gf(n)?(n.K_.O_(e),jf(n)):n.K_.set("Unknown")})}function qC(n,e,t){return N(this,null,function*(){if(n.K_.set("Online"),e instanceof ql&&e.state===2&&e.cause)try{yield function(r,s){return N(this,null,function*(){let o=s.cause;for(let a of s.targetIds)r.L_.has(a)&&(yield r.remoteSyncer.rejectListen(a,o),r.L_.delete(a),r.U_.removeTarget(a))})}(n,e)}catch(i){V("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),yield lu(n,i)}else if(e instanceof Ur?n.U_.$e(e):e instanceof Bl?n.U_.Je(e):n.U_.Ge(e),!t.isEqual(W.min()))try{let i=yield $w(n.localStore);t.compareTo(i)>=0&&(yield function(s,o){let a=s.U_.it(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let d=s.L_.get(c);d&&s.L_.set(c,d.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let d=s.L_.get(u);if(!d)return;s.L_.set(u,d.withResumeToken(Ue.EMPTY_BYTE_STRING,d.snapshotVersion)),Zw(s,u);let m=new $r(d.target,u,c,d.sequenceNumber);qf(s,m)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(i){V("RemoteStore","Failed to raise snapshot:",i),yield lu(n,i)}})}function lu(n,e,t){return N(this,null,function*(){if(!_i(e))throw e;n.k_.add(1),yield ss(n),n.K_.set("Offline"),t||(t=()=>$w(n.localStore)),n.asyncQueue.enqueueRetryable(()=>N(this,null,function*(){V("RemoteStore","Retrying IndexedDB access"),yield t(),n.k_.delete(1),yield Xo(n)}))})}function tE(n,e){return e().catch(t=>lu(n,t,e))}function os(n){return N(this,null,function*(){let e=M(n),t=pi(e),i=e.B_.length>0?e.B_[e.B_.length-1].batchId:-1;for(;jC(e);)try{let r=yield VC(e.localStore,i);if(r===null){e.B_.length===0&&t.a_();break}i=r.batchId,GC(e,r)}catch(r){yield lu(e,r)}nE(e)&&iE(e)})}function jC(n){return vi(n)&&n.B_.length<10}function GC(n,e){n.B_.push(e);let t=pi(n);t.s_()&&t.f_&&t.g_(e.mutations)}function nE(n){return vi(n)&&!pi(n).i_()&&n.B_.length>0}function iE(n){pi(n).start()}function zC(n){return N(this,null,function*(){pi(n).w_()})}function KC(n){return N(this,null,function*(){let e=pi(n);for(let t of n.B_)e.g_(t.mutations)})}function WC(n,e,t){return N(this,null,function*(){let i=n.B_.shift(),r=id.from(i,e,t);yield tE(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield os(n)})}function $C(n,e){return N(this,null,function*(){e&&pi(n).f_&&(yield function(i,r){return N(this,null,function*(){if(function(o){return Iw(o)&&o!==R.ABORTED}(r.code)){let s=i.B_.shift();pi(i).__(),yield tE(i,()=>i.remoteSyncer.rejectFailedWrite(s.batchId,r)),yield os(i)}})}(n,e)),nE(n)&&iE(n)})}function Av(n,e){return N(this,null,function*(){let t=M(n);t.asyncQueue.verifyOperationInProgress(),V("RemoteStore","RemoteStore received new credentials");let i=vi(t);t.k_.add(3),yield ss(t),i&&t.K_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.k_.delete(3),yield Xo(t)})}function Jd(n,e){return N(this,null,function*(){let t=M(n);e?(t.k_.delete(2),yield Xo(t)):e||(t.k_.add(2),yield ss(t),t.K_.set("Unknown"))})}function as(n){return n.W_||(n.W_=function(t,i,r){let s=M(t);return s.b_(),new Wd(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Ro:MC.bind(null,n),mo:UC.bind(null,n),po:BC.bind(null,n),R_:qC.bind(null,n)}),n.q_.push(e=>N(this,null,function*(){e?(n.W_.__(),Gf(n)?jf(n):n.K_.set("Unknown")):(yield n.W_.stop(),eE(n))}))),n.W_}function pi(n){return n.G_||(n.G_=function(t,i,r){let s=M(t);return s.b_(),new $d(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Ro:()=>Promise.resolve(),mo:zC.bind(null,n),po:$C.bind(null,n),p_:KC.bind(null,n),y_:WC.bind(null,n)}),n.q_.push(e=>N(this,null,function*(){e?(n.G_.__(),yield os(n)):(yield n.G_.stop(),n.B_.length>0&&(V("RemoteStore",`Stopping write stream with ${n.B_.length} pending writes`),n.B_=[]))}))),n.G_}var Xd=class n{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new He,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,r,s){let o=Date.now()+i,a=new n(e,t,o,r,s);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(R.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function ls(n,e){if(Oe("AsyncQueue",`${e}: ${n}`),_i(n))return new D(R.UNAVAILABLE,`${e}: ${n}`);throw n}var uu=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,i)=>e(t,i)||U.comparator(t.key,i.key):(t,i)=>U.comparator(t.key,i.key),this.keyedMap=yo(),this.sortedSet=new Te(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let i=new n;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}};var cu=class{constructor(){this.z_=new Te(U.comparator)}track(e){let t=e.doc.key,i=this.z_.get(t);i?e.type!==0&&i.type===3?this.z_=this.z_.insert(t,e):e.type===3&&i.type!==1?this.z_=this.z_.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.z_=this.z_.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.z_=this.z_.remove(t):e.type===1&&i.type===2?this.z_=this.z_.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):j():this.z_=this.z_.insert(t,e)}j_(){let e=[];return this.z_.inorderTraversal((t,i)=>{e.push(i)}),e}},Xr=class n{constructor(e,t,i,r,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,i,r,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,uu.emptySet(t),o,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ho(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}};var Zd=class{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some(e=>e.Z_())}},ef=class{constructor(){this.queries=xv(),this.onlineState="Unknown",this.X_=new Set}terminate(){(function(t,i){let r=M(t),s=r.queries;r.queries=xv(),s.forEach((o,a)=>{for(let u of a.J_)u.onError(i)})})(this,new D(R.ABORTED,"Firestore shutting down"))}};function xv(){return new Wt(n=>lw(n),Ho)}function zf(n,e){return N(this,null,function*(){let t=M(n),i=3,r=e.query,s=t.queries.get(r);s?!s.Y_()&&e.Z_()&&(i=2):(s=new Zd,i=e.Z_()?0:1);try{switch(i){case 0:s.H_=yield t.onListen(r,!0);break;case 1:s.H_=yield t.onListen(r,!1);break;case 2:yield t.onFirstRemoteStoreListen(r)}}catch(o){let a=ls(o,`Initialization of query '${Nr(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,s),s.J_.push(e),e.ea(t.onlineState),s.H_&&e.ta(s.H_)&&Wf(t)})}function Kf(n,e){return N(this,null,function*(){let t=M(n),i=e.query,r=3,s=t.queries.get(i);if(s){let o=s.J_.indexOf(e);o>=0&&(s.J_.splice(o,1),s.J_.length===0?r=e.Z_()?0:1:!s.Y_()&&e.Z_()&&(r=2))}switch(r){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}})}function QC(n,e){let t=M(n),i=!1;for(let r of e){let s=r.query,o=t.queries.get(s);if(o){for(let a of o.J_)a.ta(r)&&(i=!0);o.H_=r}}i&&Wf(t)}function HC(n,e,t){let i=M(n),r=i.queries.get(e);if(r)for(let s of r.J_)s.onError(t);i.queries.delete(e)}function Wf(n){n.X_.forEach(e=>{e.next()})}var tf,Rv;(Rv=tf||(tf={})).na="default",Rv.Cache="cache";var Go=class{constructor(e,t,i){this.query=e,this.ra=t,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=i||{}}ta(e){if(!this.options.includeMetadataChanges){let i=[];for(let r of e.docChanges)r.type!==3&&i.push(r);e=new Xr(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ia?this.oa(e)&&(this.ra.next(e),t=!0):this._a(e,this.onlineState)&&(this.aa(e),t=!0),this.sa=e,t}onError(e){this.ra.error(e)}ea(e){this.onlineState=e;let t=!1;return this.sa&&!this.ia&&this._a(this.sa,e)&&(this.aa(this.sa),t=!0),t}_a(e,t){if(!e.fromCache||!this.Z_())return!0;let i=t!=="Offline";return(!this.options.ua||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}oa(e){if(e.docChanges.length>0)return!0;let t=this.sa&&this.sa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}aa(e){e=Xr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ia=!0,this.ra.next(e)}Z_(){return this.options.source!==tf.Cache}};var nf=class{constructor(e,t){this.ca=e,this.byteLength=t}la(){return"metadata"in this.ca}};var hu=class{constructor(e){this.serializer=e}As(e){return an(this.serializer,e)}Rs(e){return e.metadata.exists?Pw(this.serializer,e.document,!1):We.newNoDocument(this.As(e.metadata.name),this.Vs(e.metadata.readTime))}Vs(e){return Me(e)}},rf=class{constructor(e,t,i){this.ha=e,this.localStore=t,this.serializer=i,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=rE(e)}Pa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ca.namedQuery)this.queries.push(e.ca.namedQuery);else if(e.ca.documentMetadata){this.documents.push({metadata:e.ca.documentMetadata}),e.ca.documentMetadata.exists||++t;let i=he.fromString(e.ca.documentMetadata.name);this.collectionGroups.add(i.get(i.length-2))}else e.ca.document&&(this.documents[this.documents.length-1].document=e.ca.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ta(e){let t=new Map,i=new hu(this.serializer);for(let r of e)if(r.metadata.queries){let s=i.As(r.metadata.name);for(let o of r.metadata.queries){let a=(t.get(o)||ne()).add(s);t.set(o,a)}}return t}complete(){return N(this,null,function*(){let e=yield FC(this.localStore,new hu(this.serializer),this.documents,this.ha.id),t=this.Ta(this.documents);for(let i of this.queries)yield OC(this.localStore,i,t.get(i.name));return this.progress.taskState="Success",{progress:this.progress,Ia:this.collectionGroups,da:e}})}};function rE(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var du=class{constructor(e){this.key=e}},fu=class{constructor(e){this.key=e}},mu=class{constructor(e,t){this.query=e,this.Ea=t,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=ne(),this.mutatedKeys=ne(),this.Va=cw(e),this.ma=new uu(this.Va)}get fa(){return this.Ea}ga(e,t){let i=t?t.pa:new cu,r=t?t.ma:this.ma,s=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1,u=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,c=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((d,m)=>{let p=r.get(d),y=Yo(this.query,m)?m:null,C=!!p&&this.mutatedKeys.has(p.key),P=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations),k=!1;p&&y?p.data.isEqual(y.data)?C!==P&&(i.track({type:3,doc:y}),k=!0):this.ya(p,y)||(i.track({type:2,doc:y}),k=!0,(u&&this.Va(y,u)>0||c&&this.Va(y,c)<0)&&(a=!0)):!p&&y?(i.track({type:0,doc:y}),k=!0):p&&!y&&(i.track({type:1,doc:p}),k=!0,(u||c)&&(a=!0)),k&&(y?(o=o.add(y),s=P?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),i.track({type:1,doc:d})}return{ma:o,pa:i,ss:a,mutatedKeys:s}}ya(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,r){let s=this.ma;this.ma=e.ma,this.mutatedKeys=e.mutatedKeys;let o=e.pa.j_();o.sort((d,m)=>function(y,C){let P=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return j()}};return P(y)-P(C)}(d.type,m.type)||this.Va(d.doc,m.doc)),this.wa(i),r=r!=null&&r;let a=t&&!r?this.Sa():[],u=this.Ra.size===0&&this.current&&!r?1:0,c=u!==this.Aa;return this.Aa=u,o.length!==0||c?{snapshot:new Xr(this.query,e.ma,s,o,e.mutatedKeys,u===0,c,!1,!!i&&i.resumeToken.approximateByteSize()>0),ba:a}:{ba:a}}ea(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({ma:this.ma,pa:new cu,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(e){return!this.Ea.has(e)&&!!this.ma.has(e)&&!this.ma.get(e).hasLocalMutations}wa(e){e&&(e.addedDocuments.forEach(t=>this.Ea=this.Ea.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ea=this.Ea.delete(t)),this.current=e.current)}Sa(){if(!this.current)return[];let e=this.Ra;this.Ra=ne(),this.ma.forEach(i=>{this.Da(i.key)&&(this.Ra=this.Ra.add(i.key))});let t=[];return e.forEach(i=>{this.Ra.has(i)||t.push(new fu(i))}),this.Ra.forEach(i=>{e.has(i)||t.push(new du(i))}),t}va(e){this.Ea=e.Es,this.Ra=ne();let t=this.ga(e.documents);return this.applyChanges(t,!0)}Ca(){return Xr.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,this.Aa===0,this.hasCachedResults)}},sf=class{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}},of=class{constructor(e){this.key=e,this.Fa=!1}},af=class{constructor(e,t,i,r,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ma={},this.xa=new Wt(a=>lw(a),Ho),this.Oa=new Map,this.Na=new Set,this.Ba=new Te(U.comparator),this.La=new Map,this.ka=new Uo,this.qa={},this.Qa=new Map,this.Ka=Qr.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return this.$a===!0}};function YC(n,e,t=!0){return N(this,null,function*(){let i=Pu(n),r,s=i.xa.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.Ca()):r=yield sE(i,e,t,!0),r})}function JC(n,e){return N(this,null,function*(){let t=Pu(n);yield sE(t,e,!0,!1)})}function sE(n,e,t,i){return N(this,null,function*(){let r=yield Hr(n.localStore,yt(e)),s=r.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return i&&(a=yield $f(n,e,s,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&Ru(n.remoteStore,r),a})}function $f(n,e,t,i,r){return N(this,null,function*(){n.Ua=(m,p,y)=>function(P,k,G,K){return N(this,null,function*(){let O=k.view.ga(G);O.ss&&(O=yield nu(P.localStore,k.query,!1).then(({documents:E})=>k.view.ga(E,O)));let $=K&&K.targetChanges.get(k.targetId),Z=K&&K.targetMismatches.get(k.targetId)!=null,ee=k.view.applyChanges(O,P.isPrimaryClient,$,Z);return lf(P,k.targetId,ee.ba),ee.snapshot})}(n,m,p,y);let s=yield nu(n.localStore,e,!0),o=new mu(e,s.Es),a=o.ga(s.documents),u=Fo.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",r),c=o.applyChanges(a,n.isPrimaryClient,u);lf(n,t,c.ba);let d=new sf(e,t,o);return n.xa.set(e,d),n.Oa.has(t)?n.Oa.get(t).push(e):n.Oa.set(t,[e]),c.snapshot})}function XC(n,e,t){return N(this,null,function*(){let i=M(n),r=i.xa.get(e),s=i.Oa.get(r.targetId);if(s.length>1)return i.Oa.set(r.targetId,s.filter(o=>!Ho(o,e))),void i.xa.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||(yield Yr(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),t&&Jr(i.remoteStore,r.targetId),Zr(i,r.targetId)}).catch(gi))):(Zr(i,r.targetId),yield Yr(i.localStore,r.targetId,!0))})}function ZC(n,e){return N(this,null,function*(){let t=M(n),i=t.xa.get(e),r=t.Oa.get(i.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),Jr(t.remoteStore,i.targetId))})}function eS(n,e,t){return N(this,null,function*(){let i=Jf(n);try{let r=yield function(o,a){let u=M(o),c=xe.now(),d=a.reduce((y,C)=>y.add(C.key),ne()),m,p;return u.persistence.runTransaction("Locally write mutations","readwrite",y=>{let C=Ct(),P=ne();return u.hs.getEntries(y,d).next(k=>{C=k,C.forEach((G,K)=>{K.isValidDocument()||(P=P.add(G))})}).next(()=>u.localDocuments.getOverlayedDocuments(y,C)).next(k=>{m=k;let G=[];for(let K of a){let O=pC(K,m.get(K.key).overlayedDocument);O!=null&&G.push(new $t(K.key,O,tw(O.value.mapValue),Ve.exists(!0)))}return u.mutationQueue.addMutationBatch(y,c,G,a)}).next(k=>{p=k;let G=k.applyToLocalDocumentSet(m,P);return u.documentOverlayCache.saveOverlays(y,k.batchId,G)})}).then(()=>({batchId:p.batchId,changes:dw(m)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),function(o,a,u){let c=o.qa[o.currentUser.toKey()];c||(c=new Te(J)),c=c.insert(a,u),o.qa[o.currentUser.toKey()]=c}(i,r.batchId,t),yield Dn(i,r.changes),yield os(i.remoteStore)}catch(r){let s=ls(r,"Failed to persist write");t.reject(s)}})}function oE(n,e){return N(this,null,function*(){let t=M(n);try{let i=yield DC(t.localStore,e);e.targetChanges.forEach((r,s)=>{let o=t.La.get(s);o&&(z(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.Fa=!0:r.modifiedDocuments.size>0?z(o.Fa):r.removedDocuments.size>0&&(z(o.Fa),o.Fa=!1))}),yield Dn(t,i,e)}catch(i){yield gi(i)}})}function Pv(n,e,t){let i=M(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){let r=[];i.xa.forEach((s,o)=>{let a=o.view.ea(e);a.snapshot&&r.push(a.snapshot)}),function(o,a){let u=M(o);u.onlineState=a;let c=!1;u.queries.forEach((d,m)=>{for(let p of m.J_)p.ea(a)&&(c=!0)}),c&&Wf(u)}(i.eventManager,e),r.length&&i.Ma.R_(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}function tS(n,e,t){return N(this,null,function*(){let i=M(n);i.sharedClientState.updateQueryState(e,"rejected",t);let r=i.La.get(e),s=r&&r.key;if(s){let o=new Te(U.comparator);o=o.insert(s,We.newNoDocument(s,W.min()));let a=ne().add(s),u=new Vo(W.min(),new Map,new Te(J),o,a);yield oE(i,u),i.Ba=i.Ba.remove(s),i.La.delete(e),Yf(i)}else yield Yr(i.localStore,e,!1).then(()=>Zr(i,e,t)).catch(gi)})}function nS(n,e){return N(this,null,function*(){let t=M(n),i=e.batch.batchId;try{let r=yield NC(t.localStore,e);Hf(t,i,null),Qf(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),yield Dn(t,r)}catch(r){yield gi(r)}})}function iS(n,e,t){return N(this,null,function*(){let i=M(n);try{let r=yield function(o,a){let u=M(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return u.mutationQueue.lookupMutationBatch(c,a).next(m=>(z(m!==null),d=m.keys(),u.mutationQueue.removeMutationBatch(c,m))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>u.localDocuments.getDocuments(c,d))})}(i.localStore,e);Hf(i,e,t),Qf(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),yield Dn(i,r)}catch(r){yield gi(r)}})}function rS(n,e){return N(this,null,function*(){let t=M(n);vi(t.remoteStore)||V("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let i=yield function(o){let a=M(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(i===-1)return void e.resolve();let r=t.Qa.get(i)||[];r.push(e),t.Qa.set(i,r)}catch(i){let r=ls(i,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}})}function Qf(n,e){(n.Qa.get(e)||[]).forEach(t=>{t.resolve()}),n.Qa.delete(e)}function Hf(n,e,t){let i=M(n),r=i.qa[i.currentUser.toKey()];if(r){let s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.qa[i.currentUser.toKey()]=r}}function Zr(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let i of n.Oa.get(e))n.xa.delete(i),t&&n.Ma.Wa(i,t);n.Oa.delete(e),n.isPrimaryClient&&n.ka.yr(e).forEach(i=>{n.ka.containsKey(i)||aE(n,i)})}function aE(n,e){n.Na.delete(e.path.canonicalString());let t=n.Ba.get(e);t!==null&&(Jr(n.remoteStore,t),n.Ba=n.Ba.remove(e),n.La.delete(t),Yf(n))}function lf(n,e,t){for(let i of t)i instanceof du?(n.ka.addReference(i.key,e),sS(n,i)):i instanceof fu?(V("SyncEngine","Document no longer in limbo: "+i.key),n.ka.removeReference(i.key,e),n.ka.containsKey(i.key)||aE(n,i.key)):j()}function sS(n,e){let t=e.key,i=t.path.canonicalString();n.Ba.get(t)||n.Na.has(i)||(V("SyncEngine","New document in limbo: "+t),n.Na.add(i),Yf(n))}function Yf(n){for(;n.Na.size>0&&n.Ba.size<n.maxConcurrentLimboResolutions;){let e=n.Na.values().next().value;n.Na.delete(e);let t=new U(he.fromString(e)),i=n.Ka.next();n.La.set(i,new of(t)),n.Ba=n.Ba.insert(t,i),Ru(n.remoteStore,new $r(yt(rs(t.path)),i,"TargetPurposeLimboResolution",xt.oe))}}function Dn(n,e,t){return N(this,null,function*(){let i=M(n),r=[],s=[],o=[];i.xa.isEmpty()||(i.xa.forEach((a,u)=>{o.push(i.Ua(u,e,t).then(c=>{var d;if((c||t)&&i.isPrimaryClient){let m=c?!c.fromCache:(d=t?.targetChanges.get(u.targetId))===null||d===void 0?void 0:d.current;i.sharedClientState.updateQueryState(u.targetId,m?"current":"not-current")}if(c){r.push(c);let m=Ud.zi(u.targetId,c);s.push(m)}}))}),yield Promise.all(o),i.Ma.R_(r),yield function(u,c){return N(this,null,function*(){let d=M(u);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>A.forEach(c,p=>A.forEach(p.Wi,y=>d.persistence.referenceDelegate.addReference(m,p.targetId,y)).next(()=>A.forEach(p.Gi,y=>d.persistence.referenceDelegate.removeReference(m,p.targetId,y)))))}catch(m){if(!_i(m))throw m;V("LocalStore","Failed to update sequence numbers: "+m)}for(let m of c){let p=m.targetId;if(!m.fromCache){let y=d.us.get(p),C=y.snapshotVersion,P=y.withLastLimboFreeSnapshotVersion(C);d.us=d.us.insert(p,P)}}})}(i.localStore,s))})}function oS(n,e){return N(this,null,function*(){let t=M(n);if(!t.currentUser.isEqual(e)){V("SyncEngine","User change. New user:",e.toKey());let i=yield Ww(t.localStore,e);t.currentUser=e,function(s,o){s.Qa.forEach(a=>{a.forEach(u=>{u.reject(new D(R.CANCELLED,o))})}),s.Qa.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield Dn(t,i.Ts)}})}function aS(n,e){let t=M(n),i=t.La.get(e);if(i&&i.Fa)return ne().add(i.key);{let r=ne(),s=t.Oa.get(e);if(!s)return r;for(let o of s){let a=t.xa.get(o);r=r.unionWith(a.view.fa)}return r}}function lS(n,e){return N(this,null,function*(){let t=M(n),i=yield nu(t.localStore,e.query,!0),r=e.view.va(i);return t.isPrimaryClient&&lf(t,e.targetId,r.ba),r})}function uS(n,e){return N(this,null,function*(){let t=M(n);return Yw(t.localStore,e).then(i=>Dn(t,i))})}function cS(n,e,t,i){return N(this,null,function*(){let r=M(n),s=yield function(a,u){let c=M(a),d=M(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",m=>d.On(m,u).next(p=>p?c.localDocuments.getDocuments(m,p):A.resolve(null)))}(r.localStore,e);s!==null?(t==="pending"?yield os(r.remoteStore):t==="acknowledged"||t==="rejected"?(Hf(r,e,i||null),Qf(r,e),function(a,u){M(M(a).mutationQueue).Bn(u)}(r.localStore,e)):j(),yield Dn(r,s)):V("SyncEngine","Cannot apply mutation batch with id: "+e)})}function hS(n,e){return N(this,null,function*(){let t=M(n);if(Pu(t),Jf(t),e===!0&&t.$a!==!0){let i=t.sharedClientState.getAllActiveQueryTargets(),r=yield kv(t,i.toArray());t.$a=!0,yield Jd(t.remoteStore,!0);for(let s of r)Ru(t.remoteStore,s)}else if(e===!1&&t.$a!==!1){let i=[],r=Promise.resolve();t.Oa.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?i.push(o):r=r.then(()=>(Zr(t,o),Yr(t.localStore,o,!0))),Jr(t.remoteStore,o)}),yield r,yield kv(t,i),function(o){let a=M(o);a.La.forEach((u,c)=>{Jr(a.remoteStore,c)}),a.ka.wr(),a.La=new Map,a.Ba=new Te(U.comparator)}(t),t.$a=!1,yield Jd(t.remoteStore,!1)}})}function kv(n,e,t){return N(this,null,function*(){let i=M(n),r=[],s=[];for(let o of e){let a,u=i.Oa.get(o);if(u&&u.length!==0){a=yield Hr(i.localStore,yt(u[0]));for(let c of u){let d=i.xa.get(c),m=yield lS(i,d);m.snapshot&&s.push(m.snapshot)}}else{let c=yield Hw(i.localStore,o);a=yield Hr(i.localStore,c),yield $f(i,lE(c),o,!1,a.resumeToken)}r.push(a)}return i.Ma.R_(s),r})}function lE(n){return aw(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function dS(n){return function(t){return M(M(t).persistence).$i()}(M(n).localStore)}function fS(n,e,t,i){return N(this,null,function*(){let r=M(n);if(r.$a)return void V("SyncEngine","Ignoring unexpected query state notification.");let s=r.Oa.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield Yw(r.localStore,uw(s[0])),a=Vo.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ue.EMPTY_BYTE_STRING);yield Dn(r,o,a);break}case"rejected":yield Yr(r.localStore,e,!0),Zr(r,e,i);break;default:j()}})}function mS(n,e,t){return N(this,null,function*(){let i=Pu(n);if(i.$a){for(let r of e){if(i.Oa.has(r)&&i.sharedClientState.isActiveQueryTarget(r)){V("SyncEngine","Adding an already active target "+r);continue}let s=yield Hw(i.localStore,r),o=yield Hr(i.localStore,s);yield $f(i,lE(s),o.targetId,!1,o.resumeToken),Ru(i.remoteStore,o)}for(let r of t)i.Oa.has(r)&&(yield Yr(i.localStore,r,!1).then(()=>{Jr(i.remoteStore,r),Zr(i,r)}).catch(gi))}})}function Pu(n){let e=M(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=oE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=aS.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=tS.bind(null,e),e.Ma.R_=QC.bind(null,e.eventManager),e.Ma.Wa=HC.bind(null,e.eventManager),e}function Jf(n){let e=M(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=nS.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=iS.bind(null,e),e}function pS(n,e,t){let i=M(n);(function(s,o,a){return N(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(y,C){let P=M(y),k=Me(C.createTime);return P.persistence.runTransaction("hasNewerBundle","readonly",G=>P.jr.getBundleMetadata(G,C.id)).then(G=>!!G&&G.createTime.compareTo(k)>=0)}(s.localStore,u))return yield o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(rE(u));let c=new rf(u,s.localStore,o.serializer),d=yield o.Ga();for(;d;){let p=yield c.Pa(d);p&&a._updateProgress(p),d=yield o.Ga()}let m=yield c.complete();return yield Dn(s,m.da,void 0),yield function(y,C){let P=M(y);return P.persistence.runTransaction("Save bundle","readwrite",k=>P.jr.saveBundleMetadata(k,C))}(s.localStore,u),a._completeWith(m.progress),Promise.resolve(m.Ia)}catch(u){return zt("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(i,e,t).then(r=>{i.sharedClientState.notifyBundleLoaded(r)})}var Xf=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return N(this,null,function*(){this.serializer=Jo(t.databaseInfo.databaseId),this.sharedClientState=this.za(t),this.persistence=this.ja(t),yield this.persistence.start(),this.localStore=this.Ha(t),this.gcScheduler=this.Ja(t,this.localStore),this.indexBackfillerScheduler=this.Ya(t,this.localStore)})}Ja(t,i){return null}Ya(t,i){return null}Ha(t){return Kw(this.persistence,new tu,t.initialUser,this.serializer)}ja(t){return new Bo(Zl.ei,this.serializer)}za(t){return new su}terminate(){return N(this,null,function*(){var t,i;(t=this.gcScheduler)===null||t===void 0||t.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),uf=class extends Xf{constructor(e){super(),this.cacheSizeBytes=e}Ja(e,t){z(this.persistence.referenceDelegate instanceof eu);let i=this.persistence.referenceDelegate.garbageCollector;return new Yl(i,e.asyncQueue,t)}ja(e){let t=this.cacheSizeBytes!==void 0?bt.withCacheSize(this.cacheSizeBytes):bt.DEFAULT;return new Bo(i=>eu.ei(i,t),this.serializer)}},pu=class n extends Xf{constructor(e,t,i){super(),this.Za=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return N(this,null,function*(){yield oh(n.prototype,this,"initialize").call(this,e),yield this.Za.initialize(this,e),yield Jf(this.Za.syncEngine),yield os(this.Za.remoteStore),yield this.persistence.Si(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}Ha(e){return Kw(this.persistence,new tu,e.initialUser,this.serializer)}Ja(e,t){let i=this.persistence.referenceDelegate.garbageCollector;return new Yl(i,e.asyncQueue,t)}Ya(e,t){let i=new qh(t,this.persistence);return new Bh(e.asyncQueue,i)}ja(e){let t=Bf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?bt.withCacheSize(this.cacheSizeBytes):bt.DEFAULT;return new Md(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,Xw(),Al(),this.serializer,this.sharedClientState,!!this.forceOwnership)}za(e){return new su}},cf=class n extends pu{constructor(e,t){super(e,t,!1),this.Za=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return N(this,null,function*(){yield oh(n.prototype,this,"initialize").call(this,e);let t=this.Za.syncEngine;this.sharedClientState instanceof bo&&(this.sharedClientState.syncEngine={io:cS.bind(null,t),so:fS.bind(null,t),oo:mS.bind(null,t),$i:dS.bind(null,t),ro:uS.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.Si(i=>N(this,null,function*(){yield hS(this.Za.syncEngine,i),this.gcScheduler&&(i&&!this.gcScheduler.started?this.gcScheduler.start():i||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(i&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():i||this.indexBackfillerScheduler.stop())}))})}za(e){let t=Xw();if(!bo.p(t))throw new D(R.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let i=Bf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new bo(t,e.asyncQueue,i,e.clientId,e.initialUser)}},Zf=(()=>{class n{initialize(t,i){return N(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Pv(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=oS.bind(null,this.syncEngine),yield Jd(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new ef}()}createDatastore(t){let i=Jo(t.databaseInfo.databaseId),r=function(o){return new Kd(o)}(t.databaseInfo);return function(o,a,u,c){return new Qd(o,a,u,c)}(t.authCredentials,t.appCheckCredentials,r,i)}createRemoteStore(t){return function(r,s,o,a,u){return new Yd(r,s,o,a,u)}(this.localStore,this.datastore,t.asyncQueue,i=>Pv(this.syncEngine,i,0),function(){return ou.p()?new ou:new Gd}())}createSyncEngine(t,i){return function(s,o,a,u,c,d,m){let p=new af(s,o,a,u,c,d);return m&&(p.$a=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,i)}terminate(){return N(this,null,function*(){var t,i;yield function(s){return N(this,null,function*(){let o=M(s);V("RemoteStore","RemoteStore shutting down."),o.k_.add(5),yield ss(o),o.Q_.shutdown(),o.K_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()})}}return n.provider={build:()=>new n},n})();function Nv(n,e=10240){let t=0;return{read(){return N(this,null,function*(){if(t<n.byteLength){let r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})},cancel(){return N(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var es=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Xa(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Xa(this.observer.error,e):Oe("Uncaught Error in snapshot listener:",e.toString()))}eu(){this.muted=!0}Xa(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var hf=class{constructor(e,t){this.tu=e,this.serializer=t,this.metadata=new He,this.buffer=new Uint8Array,this.nu=function(){return new TextDecoder("utf-8")}(),this.ru().then(i=>{i&&i.la()?this.metadata.resolve(i.ca.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(i?.ca)}`))},i=>this.metadata.reject(i))}close(){return this.tu.cancel()}getMetadata(){return N(this,null,function*(){return this.metadata.promise})}Ga(){return N(this,null,function*(){return yield this.getMetadata(),this.ru()})}ru(){return N(this,null,function*(){let e=yield this.iu();if(e===null)return null;let t=this.nu.decode(e),i=Number(t);isNaN(i)&&this.su(`length string (${t}) is not valid number`);let r=yield this.ou(i);return new nf(JSON.parse(r),e.length+i)})}_u(){return this.buffer.findIndex(e=>e===123)}iu(){return N(this,null,function*(){for(;this._u()<0&&!(yield this.au()););if(this.buffer.length===0)return null;let e=this._u();e<0&&this.su("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}ou(e){return N(this,null,function*(){for(;this.buffer.length<e;)(yield this.au())&&this.su("Reached the end of bundle when more is expected.");let t=this.nu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}su(e){throw this.tu.cancel(),new Error(`Invalid bundle format: ${e}`)}au(){return N(this,null,function*(){let e=yield this.tu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var df=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return N(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new D(R.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(r,s){return N(this,null,function*(){let o=M(r),a={documents:s.map(m=>Oo(o.serializer,m))},u=yield o.ko("BatchGetDocuments",o.serializer.databaseId,he.emptyPath(),a,s.length),c=new Map;u.forEach(m=>{let p=EC(o.serializer,m);c.set(p.key.toString(),p)});let d=[];return s.forEach(m=>{let p=c.get(m.toString());z(!!p),d.push(p)}),d})}(this.datastore,e);return t.forEach(i=>this.recordVersion(i)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(i){this.lastTransactionError=i}this.writtenDocs.add(e.toString())}delete(e){this.write(new mi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return N(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,i)=>{let r=U.fromPath(i);this.mutations.push(new ko(r,this.precondition(r)))}),yield function(i,r){return N(this,null,function*(){let s=M(i),o={writes:r.map(a=>Lo(s.serializer,a))};yield s.Oo("Commit",s.serializer.databaseId,he.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw j();t=W.min()}let i=this.readVersions.get(e.key.toString());if(i){if(!t.isEqual(i))throw new D(R.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(W.min())?Ve.exists(!1):Ve.updateTime(t):Ve.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(W.min()))throw new D(R.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ve.updateTime(t)}return Ve.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var ff=class{constructor(e,t,i,r,s){this.asyncQueue=e,this.datastore=t,this.options=i,this.updateFunction=r,this.deferred=s,this.uu=i.maxAttempts,this.r_=new jo(this.asyncQueue,"transaction_retry")}cu(){this.uu-=1,this.lu()}lu(){this.r_.jo(()=>N(this,null,function*(){let e=new df(this.datastore),t=this.hu(e);t&&t.then(i=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(i)}).catch(r=>{this.Pu(r)}))}).catch(i=>{this.Pu(i)})}))}hu(e){try{let t=this.updateFunction(e);return!$o(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Pu(e){this.uu>0&&this.Tu(e)?(this.uu-=1,this.asyncQueue.enqueueAndForget(()=>(this.lu(),Promise.resolve()))):this.deferred.reject(e)}Tu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!Iw(t)}return!1}};var mf=class{constructor(e,t,i,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=Ke.UNAUTHENTICATED,this.clientId=Rl.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(i,o=>N(this,null,function*(){V("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(i,o=>(V("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new He;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>N(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let i=ls(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}};function Rh(n,e){return N(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),V("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(r=>N(this,null,function*(){i.isEqual(r)||(yield Ww(e.localStore,r),i=r)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Dv(n,e){return N(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield em(n);V("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(i=>Av(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,r)=>Av(e.remoteStore,r)),n._onlineComponents=e})}function em(n){return N(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Rh(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(r){return r.name==="FirebaseError"?r.code===R.FAILED_PRECONDITION||r.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;zt("Error using user provided cache. Falling back to memory cache: "+t),yield Rh(n,new Xf)}}else V("FirestoreClient","Using default OfflineComponentProvider"),yield Rh(n,new uf(void 0));return n._offlineComponents})}function ku(n){return N(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(V("FirestoreClient","Using user provided OnlineComponentProvider"),yield Dv(n,n._uninitializedComponentsProvider._online)):(V("FirestoreClient","Using default OnlineComponentProvider"),yield Dv(n,new Zf))),n._onlineComponents})}function uE(n){return em(n).then(e=>e.persistence)}function tm(n){return em(n).then(e=>e.localStore)}function cE(n){return ku(n).then(e=>e.remoteStore)}function nm(n){return ku(n).then(e=>e.syncEngine)}function gS(n){return ku(n).then(e=>e.datastore)}function ts(n){return N(this,null,function*(){let e=yield ku(n),t=e.eventManager;return t.onListen=YC.bind(null,e.syncEngine),t.onUnlisten=XC.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=JC.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=ZC.bind(null,e.syncEngine),t})}function _S(n){return n.asyncQueue.enqueue(()=>N(this,null,function*(){let e=yield uE(n),t=yield cE(n);return e.setNetworkEnabled(!0),function(r){let s=M(r);return s.k_.delete(0),Xo(s)}(t)}))}function yS(n){return n.asyncQueue.enqueue(()=>N(this,null,function*(){let e=yield uE(n),t=yield cE(n);return e.setNetworkEnabled(!1),function(r){return N(this,null,function*(){let s=M(r);s.k_.add(0),yield ss(s),s.K_.set("Offline")})}(t)}))}function vS(n,e){let t=new He;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(r,s,o){return N(this,null,function*(){try{let a=yield function(c,d){let m=M(c);return m.persistence.runTransaction("read document","readonly",p=>m.localDocuments.getDocument(p,d))}(r,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new D(R.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=ls(a,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield tm(n),e,t)})),t.promise}function hE(n,e,t={}){let i=new He;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(s,o,a,u,c){let d=new es({next:p=>{d.eu(),o.enqueueAndForget(()=>Kf(s,m));let y=p.docs.has(a);!y&&p.fromCache?c.reject(new D(R.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&p.fromCache&&u&&u.source==="server"?c.reject(new D(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(p)},error:p=>c.reject(p)}),m=new Go(rs(a.path),d,{includeMetadataChanges:!0,ua:!0});return zf(s,m)}(yield ts(n),n.asyncQueue,e,t,i)})),i.promise}function wS(n,e){let t=new He;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(r,s,o){return N(this,null,function*(){try{let a=yield nu(r,s,!0),u=new mu(s,a.Es),c=u.ga(a.documents),d=u.applyChanges(c,!1);o.resolve(d.snapshot)}catch(a){let u=ls(a,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield tm(n),e,t)})),t.promise}function dE(n,e,t={}){let i=new He;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(s,o,a,u,c){let d=new es({next:p=>{d.eu(),o.enqueueAndForget(()=>Kf(s,m)),p.fromCache&&u.source==="server"?c.reject(new D(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(p)},error:p=>c.reject(p)}),m=new Go(a,d,{includeMetadataChanges:!0,ua:!0});return zf(s,m)}(yield ts(n),n.asyncQueue,e,t,i)})),i.promise}function ES(n,e){let t=new es(e);return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(r,s){M(r).X_.add(s),s.next()}(yield ts(n),t)})),()=>{t.eu(),n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(r,s){M(r).X_.delete(s)}(yield ts(n),t)}))}}function IS(n,e,t,i){let r=function(o,a){let u;return u=typeof o=="string"?bw().encode(o):o,function(d,m){return new hf(d,m)}(function(d,m){if(d instanceof Uint8Array)return Nv(d,m);if(d instanceof ArrayBuffer)return Nv(new Uint8Array(d),m);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(t,Jo(e));n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){pS(yield nm(n),r,i)}))}function TS(n,e){return n.asyncQueue.enqueue(()=>N(this,null,function*(){return function(i,r){let s=M(i);return s.persistence.runTransaction("Get named query","readonly",o=>s.jr.getNamedQuery(o,r))}(yield tm(n),e)}))}function fE(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Vv=new Map;function im(n,e,t){if(!t)throw new D(R.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function rm(n,e,t,i){if(e===!0&&i===!0)throw new D(R.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Fv(n){if(!U.isDocumentKey(n))throw new D(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Ov(n){if(U.isDocumentKey(n))throw new D(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Nu(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(i){return i.constructor?i.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":j()}function de(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new D(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Nu(n);throw new D(R.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function mE(n,e){if(e<=0)throw new D(R.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var gu=class{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new D(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new D(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}rm("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=fE((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new D(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new D(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new D(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(i,r){return i.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Ji=class{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gu({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new D(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new D(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gu(e),e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new Ph;switch(i.type){case"firstParty":return new Vh(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new D(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return N(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let i=Vv.get(t);i&&(V("ComponentProvider","Removing Datastore"),Vv.delete(t),i.terminate())}(this),Promise.resolve()}};function pE(n,e,t,i={}){var r;let s=(n=de(n,Ji))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&zt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),i.mockUserToken){let a,u;if(typeof i.mockUserToken=="string")a=i.mockUserToken,u=Ke.MOCK_USER;else{a=ll(i.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);let c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new D(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Ke(c)}n._authCredentials=new kh(new xl(a,u))}}var it=class n{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},we=class n{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ln(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},ln=class n extends it{constructor(e,t,i){super(e,t,rs(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new we(this.firestore,null,new U(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function sm(n,e,...t){if(n=le(n),im("collection","path",e),n instanceof Ji){let i=he.fromString(e,...t);return Ov(i),new ln(n,null,i)}{if(!(n instanceof we||n instanceof ln))throw new D(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(he.fromString(e,...t));return Ov(i),new ln(n.firestore,null,i)}}function gE(n,e){if(n=de(n,Ji),im("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new D(R.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new it(n,null,function(i){return new Kt(he.emptyPath(),i)}(e))}function Zo(n,e,...t){if(n=le(n),arguments.length===1&&(e=Rl.newId()),im("doc","path",e),n instanceof Ji){let i=he.fromString(e,...t);return Fv(i),new we(n,null,new U(i))}{if(!(n instanceof we||n instanceof ln))throw new D(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(he.fromString(e,...t));return Fv(i),new we(n.firestore,n instanceof ln?n.converter:null,new U(i))}}function om(n,e){return n=le(n),e=le(e),(n instanceof we||n instanceof ln)&&(e instanceof we||e instanceof ln)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function am(n,e){return n=le(n),e=le(e),n instanceof it&&e instanceof it&&n.firestore===e.firestore&&Ho(n._query,e._query)&&n.converter===e.converter}var _u=class{constructor(e=Promise.resolve()){this.Iu=[],this.du=!1,this.Eu=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new jo(this,"async_queue_retry"),this.fu=()=>{let i=Al();i&&V("AsyncQueue","Visibility state changed to "+i.visibilityState),this.r_.Jo()},this.gu=e;let t=Al();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.du}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.pu(),this.yu(e)}enterRestrictedMode(e){if(!this.du){this.du=!0,this.Vu=e||!1;let t=Al();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.fu)}}enqueue(e){if(this.pu(),this.du)return new Promise(()=>{});let t=new He;return this.yu(()=>this.du&&this.Vu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Iu.push(e),this.wu()))}wu(){return N(this,null,function*(){if(this.Iu.length!==0){try{yield this.Iu[0](),this.Iu.shift(),this.r_.reset()}catch(e){if(!_i(e))throw e;V("AsyncQueue","Operation failed with retryable error: "+e)}this.Iu.length>0&&this.r_.jo(()=>this.wu())}})}yu(e){let t=this.gu.then(()=>(this.Ru=!0,e().catch(i=>{this.Au=i,this.Ru=!1;let r=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(i);throw Oe("INTERNAL UNHANDLED ERROR: ",r),i}).then(i=>(this.Ru=!1,i))));return this.gu=t,t}enqueueAfterDelay(e,t,i){this.pu(),this.mu.indexOf(e)>-1&&(t=0);let r=Xd.createAndSchedule(this,e,t,i,s=>this.Su(s));return this.Eu.push(r),r}pu(){this.Au&&j()}verifyOperationInProgress(){}bu(){return N(this,null,function*(){let e;do e=this.gu,yield e;while(e!==this.gu)})}Du(e){for(let t of this.Eu)if(t.timerId===e)return!0;return!1}vu(e){return this.bu().then(()=>{this.Eu.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(let t of this.Eu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.bu()})}Cu(e){this.mu.push(e)}Su(e){let t=this.Eu.indexOf(e);this.Eu.splice(t,1)}};function pf(n){return function(t,i){if(typeof t!="object"||t===null)return!1;let r=t;for(let s of i)if(s in r&&typeof r[s]=="function")return!0;return!1}(n,["next","error","complete"])}var gf=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new He,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,i){this._progressObserver={next:e,error:t,complete:i}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var _E=-1,Re=class extends Ji{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new _u,this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return N(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new _u(e),this._firestoreClient=void 0,yield e}})}};function rt(n){if(n._terminated)throw new D(R.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||yE(n),n._firestoreClient}function yE(n){var e,t,i;let r=n._freezeSettings(),s=function(a,u,c,d){return new jh(a,u,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,fE(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,r);n._componentsProvider||!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=r.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),n._firestoreClient=new mf(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(a){let u=a?._online.build();return{_offline:a?._offline.build(u),_online:u}}(n._componentsProvider))}function vE(n,e){zt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return EE(n,Zf.provider,{build:i=>new pu(i,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function wE(n){return N(this,null,function*(){zt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();EE(n,Zf.provider,{build:t=>new cf(t,e.cacheSizeBytes)})})}function EE(n,e,t){if((n=de(n,Re))._firestoreClient||n._terminated)throw new D(R.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new D(R.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},yE(n)}function IE(n){if(n._initialized&&!n._terminated)throw new D(R.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new He;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>N(this,null,function*(){try{yield function(i){return N(this,null,function*(){if(!ai.p())return Promise.resolve();let r=i+"main";yield ai.delete(r)})}(Bf(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function TE(n){return function(t){let i=new He;return t.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return rS(yield nm(t),i)})),i.promise}(rt(n=de(n,Re)))}function bE(n){return _S(rt(n=de(n,Re)))}function CE(n){return yS(rt(n=de(n,Re)))}function SE(n,e){let t=rt(n=de(n,Re)),i=new gf;return IS(t,n._databaseId,e,i),i}function AE(n,e){return TS(rt(n=de(n,Re)),e).then(t=>t?new it(n,null,t.query):null)}var hn=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ue.fromBase64String(e))}catch(t){throw new D(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ue.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Qt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new D(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Le(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var kn=class{constructor(e){this._methodName=e}};var Xi=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return J(this._lat,e._lat)||J(this._long,e._long)}};var zo=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(i,r){if(i.length!==r.length)return!1;for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}(this._values,e._values)}};var bS=/^__.*__$/,_f=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new $t(e,this.data,this.fieldMask,t,this.fieldTransforms):new fi(e,this.data,t,this.fieldTransforms)}},yu=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new $t(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function xE(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw j()}}var vu=class n{constructor(e,t,i,r,s,o){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=r,s===void 0&&this.Fu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.xu({path:i,Nu:!1});return r.Bu(e),r}Lu(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.xu({path:i,Nu:!1});return r.Fu(),r}ku(e){return this.xu({path:void 0,Nu:!0})}qu(e){return wu(e,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Fu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Bu(this.path.get(e))}Bu(e){if(e.length===0)throw this.qu("Document fields must not be empty");if(xE(this.Mu)&&bS.test(e))throw this.qu('Document fields cannot begin and end with "__"')}},yf=class{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||Jo(e)}$u(e,t,i,r=!1){return new vu({Mu:e,methodName:t,Ku:i,path:Le.emptyPath(),Nu:!1,Qu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function tr(n){let e=n._freezeSettings(),t=Jo(n._databaseId);return new yf(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Du(n,e,t,i,r,s={}){let o=n.$u(s.merge||s.mergeFields?2:0,e,t,r);cm("Data must be an object, but it was:",o,i);let a=kE(i,o),u,c;if(s.merge)u=new Rt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let d=[];for(let m of s.mergeFields){let p=Tf(e,m,t);if(!o.contains(p))throw new D(R.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);DE(d,p)||d.push(p)}u=new Rt(d),c=o.fieldTransforms.filter(m=>u.covers(m.field))}else u=null,c=o.fieldTransforms;return new _f(new ct(a),u,c)}var Ko=class n extends kn{_toFieldTransform(e){if(e.Mu!==2)throw e.Mu===1?e.qu(`${this._methodName}() can only appear at the top level of your update data`):e.qu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function RE(n,e,t){return new vu({Mu:3,Ku:e.settings.Ku,methodName:n._methodName,Nu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var vf=class n extends kn{_toFieldTransform(e){return new Qi(e.path,new hi)}isEqual(e){return e instanceof n}},wf=class n extends kn{constructor(e,t){super(e),this.Uu=t}_toFieldTransform(e){let t=RE(this,e,!0),i=this.Uu.map(s=>nr(s,t)),r=new Rn(i);return new Qi(e.path,r)}isEqual(e){return e instanceof n&&gh(this.Uu,e.Uu)}},Ef=class n extends kn{constructor(e,t){super(e),this.Uu=t}_toFieldTransform(e){let t=RE(this,e,!0),i=this.Uu.map(s=>nr(s,t)),r=new Pn(i);return new Qi(e.path,r)}isEqual(e){return e instanceof n&&gh(this.Uu,e.Uu)}},If=class n extends kn{constructor(e,t){super(e),this.Wu=t}_toFieldTransform(e){let t=new di(e.serializer,pw(e.serializer,this.Wu));return new Qi(e.path,t)}isEqual(e){return e instanceof n&&this.Wu===e.Wu}};function lm(n,e,t,i){let r=n.$u(1,e,t);cm("Data must be an object, but it was:",r,i);let s=[],o=ct.empty();yi(i,(u,c)=>{let d=hm(e,u,t);c=le(c);let m=r.Lu(d);if(c instanceof Ko)s.push(d);else{let p=nr(c,m);p!=null&&(s.push(d),o.set(d,p))}});let a=new Rt(s);return new yu(o,a,r.fieldTransforms)}function um(n,e,t,i,r,s){let o=n.$u(1,e,t),a=[Tf(e,i,t)],u=[r];if(s.length%2!=0)throw new D(R.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<s.length;p+=2)a.push(Tf(e,s[p])),u.push(s[p+1]);let c=[],d=ct.empty();for(let p=a.length-1;p>=0;--p)if(!DE(c,a[p])){let y=a[p],C=u[p];C=le(C);let P=o.Lu(y);if(C instanceof Ko)c.push(y);else{let k=nr(C,P);k!=null&&(c.push(y),d.set(y,k))}}let m=new Rt(c);return new yu(d,m,o.fieldTransforms)}function PE(n,e,t,i=!1){return nr(t,n.$u(i?4:3,e))}function nr(n,e){if(NE(n=le(n)))return cm("Unsupported field value:",e,n),kE(n,e);if(n instanceof kn)return function(i,r){if(!xE(r.Mu))throw r.qu(`${i._methodName}() can only be used with update() and set()`);if(!r.path)throw r.qu(`${i._methodName}() is not currently supported inside arrays`);let s=i._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Nu&&e.Mu!==4)throw e.qu("Nested arrays are not supported");return function(i,r){let s=[],o=0;for(let a of i){let u=nr(a,r.ku(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(i,r){if((i=le(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return pw(r.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){let s=xe.fromDate(i);return{timestampValue:Wr(r.serializer,s)}}if(i instanceof xe){let s=new xe(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:Wr(r.serializer,s)}}if(i instanceof Xi)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof hn)return{bytesValue:Cw(r.serializer,i._byteString)};if(i instanceof we){let s=r.databaseId,o=i.firestore._databaseId;if(!o.isEqual(s))throw r.qu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Lf(i.firestore._databaseId||r.databaseId,i._key.path)}}if(i instanceof zo)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.qu("VectorValues must only contain numeric values.");return Of(a.serializer,u)})}}}}}}(i,r);throw r.qu(`Unsupported field value: ${Nu(i)}`)}(n,e)}function kE(n,e){let t={};return Jv(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):yi(n,(i,r)=>{let s=nr(r,e.Ou(i));s!=null&&(t[i]=s)}),{mapValue:{fields:t}}}function NE(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof xe||n instanceof Xi||n instanceof hn||n instanceof we||n instanceof kn||n instanceof zo)}function cm(n,e,t){if(!NE(t)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(t)){let i=Nu(t);throw i==="an object"?e.qu(n+" a custom object"):e.qu(n+" "+i)}}function Tf(n,e,t){if((e=le(e))instanceof Qt)return e._internalPath;if(typeof e=="string")return hm(n,e);throw wu("Field path arguments must be of type string or ",n,!1,void 0,t)}var CS=new RegExp("[~\\*/\\[\\]]");function hm(n,e,t){if(e.search(CS)>=0)throw wu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Qt(...e.split("."))._internalPath}catch{throw wu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function wu(n,e,t,i,r){let s=i&&!i.isEmpty(),o=r!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${i}`),o&&(u+=` in document ${r}`),u+=")"),new D(R.INVALID_ARGUMENT,a+n+u)}function DE(n,e){return n.some(t=>t.isEqual(e))}var Zi=class{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new we(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new bf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Vu("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},bf=class extends Zi{data(){return super.data()}};function Vu(n,e){return typeof e=="string"?hm(n,e):e instanceof Qt?e._internalPath:e._delegate._internalPath}function VE(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new D(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Wo=class{},er=class extends Wo{};function Vn(n,e,...t){let i=[];e instanceof Wo&&i.push(e),i=i.concat(t),function(s){let o=s.filter(u=>u instanceof Cf).length,a=s.filter(u=>u instanceof Eu).length;if(o>1||o>0&&a>0)throw new D(R.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(let r of i)n=r._apply(n);return n}var Eu=class n extends er{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=this._parse(e);return zE(e._query,t),new it(e.firestore,e.converter,td(e._query,t))}_parse(e){let t=tr(e.firestore);return function(s,o,a,u,c,d,m){let p;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new D(R.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){Mv(m,d);let y=[];for(let C of m)y.push(Lv(u,s,C));p={arrayValue:{values:y}}}else p=Lv(u,s,m)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||Mv(m,d),p=PE(a,o,m,d==="in"||d==="not-in");return ue.create(c,d,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function FE(n,e,t){let i=e,r=Vu("where",n);return Eu._create(r,i,t)}var Cf=class n extends Wo{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return t.length===1?t[0]:ge.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(r,s){let o=r,a=s.getFlattenedFilters();for(let u of a)zE(o,u),o=td(o,u)}(e._query,t),new it(e.firestore,e.converter,td(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Sf=class n extends er{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(r,s,o){if(r.startAt!==null)throw new D(R.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new D(R.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Wi(s,o)}(e._query,this._field,this._direction);return new it(e.firestore,e.converter,function(r,s){let o=r.explicitOrderBy.concat([s]);return new Kt(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}};function OE(n,e="asc"){let t=e,i=Vu("orderBy",n);return Sf._create(i,t)}var Iu=class n extends er{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){return new it(e.firestore,e.converter,Ul(e._query,this._limit,this._limitType))}};function LE(n){return mE("limit",n),Iu._create("limit",n,"F")}function ME(n){return mE("limitToLast",n),Iu._create("limitToLast",n,"L")}var Tu=class n extends er{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=GE(e,this.type,this._docOrFields,this._inclusive);return new it(e.firestore,e.converter,function(r,s){return new Kt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)}(e._query,t))}};function UE(...n){return Tu._create("startAt",n,!0)}function BE(...n){return Tu._create("startAfter",n,!1)}var bu=class n extends er{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=GE(e,this.type,this._docOrFields,this._inclusive);return new it(e.firestore,e.converter,function(r,s){return new Kt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,s)}(e._query,t))}};function qE(...n){return bu._create("endBefore",n,!1)}function jE(...n){return bu._create("endAt",n,!0)}function GE(n,e,t,i){if(t[0]=le(t[0]),t[0]instanceof Zi)return function(s,o,a,u,c){if(!u)throw new D(R.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let d=[];for(let m of Mr(s))if(m.field.isKeyField())d.push(Ki(o,u.key));else{let p=u.data.field(m.field);if(Su(p))throw new D(R.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(p===null){let y=m.field.canonicalString();throw new D(R.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(p)}return new cn(d,c)}(n._query,n.firestore._databaseId,e,t[0]._document,i);{let r=tr(n.firestore);return function(o,a,u,c,d,m){let p=o.explicitOrderBy;if(d.length>p.length)throw new D(R.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let y=[];for(let C=0;C<d.length;C++){let P=d[C];if(p[C].field.isKeyField()){if(typeof P!="string")throw new D(R.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof P}`);if(!Vf(o)&&P.indexOf("/")!==-1)throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${P}' contains a slash.`);let k=o.path.child(he.fromString(P));if(!U.isDocumentKey(k))throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);let G=new U(k);y.push(Ki(a,G))}else{let k=PE(u,c,P);y.push(k)}}return new cn(y,m)}(n._query,n.firestore._databaseId,r,e,t,i)}}function Lv(n,e,t){if(typeof(t=le(t))=="string"){if(t==="")throw new D(R.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Vf(e)&&t.indexOf("/")!==-1)throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let i=e.path.child(he.fromString(t));if(!U.isDocumentKey(i))throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Ki(n,new U(i))}if(t instanceof we)return Ki(n,t._key);throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Nu(t)}.`)}function Mv(n,e){if(!Array.isArray(n)||n.length===0)throw new D(R.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function zE(n,e){let t=function(r,s){for(let o of r)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new D(R.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new D(R.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var ns=class{convertValue(e,t="none"){switch(ui(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Se(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(xn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw j()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let i={};return yi(e,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertVectorValue(e){var t,i,r;let s=(r=(i=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.map(o=>Se(o.doubleValue));return new zo(s)}convertGeoPoint(e){return new Xi(Se(e.latitude),Se(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":let i=Au(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(xo(e));default:return null}}convertTimestamp(e){let t=An(e);return new xe(t.seconds,t.nanos)}convertDocumentKey(e,t){let i=he.fromString(e);z(Ow(i));let r=new li(i.get(1),i.get(3)),s=new U(i.popFirst(5));return r.isEqual(t)||Oe(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Fu(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}var Af=class extends ns{constructor(e){super(),this.firestore=e}convertBytes(e){return new hn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new we(this.firestore,null,t)}};var Sn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Lt=class extends Zi{constructor(e,t,i,r,s,o){super(e,t,i,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new si(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let i=this._document.data.field(Vu("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}},si=class extends Lt{data(e={}){return super.data(e)}},Ht=class{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Sn(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new si(this._firestore,this._userDataWriter,i.key,i,new Sn(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(a=>{let u=new si(r._firestore,r._userDataWriter,a.doc.key,a.doc,new Sn(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new si(r._firestore,r._userDataWriter,a.doc.key,a.doc,new Sn(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter),c=-1,d=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:SS(a.type),doc:u,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function SS(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return j()}}function dm(n,e){return n instanceof Lt&&e instanceof Lt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ht&&e instanceof Ht&&n._firestore===e._firestore&&am(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function KE(n){n=de(n,we);let e=de(n.firestore,Re);return hE(rt(e),n._key).then(t=>gm(e,n,t))}var Nn=class extends ns{constructor(e){super(),this.firestore=e}convertBytes(e){return new hn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new we(this.firestore,null,t)}};function WE(n){n=de(n,we);let e=de(n.firestore,Re),t=rt(e),i=new Nn(e);return vS(t,n._key).then(r=>new Lt(e,i,n._key,r,new Sn(r!==null&&r.hasLocalMutations,!0),n.converter))}function $E(n){n=de(n,we);let e=de(n.firestore,Re);return hE(rt(e),n._key,{source:"server"}).then(t=>gm(e,n,t))}function QE(n){n=de(n,it);let e=de(n.firestore,Re),t=rt(e),i=new Nn(e);return VE(n._query),dE(t,n._query).then(r=>new Ht(e,i,n,r))}function HE(n){n=de(n,it);let e=de(n.firestore,Re),t=rt(e),i=new Nn(e);return wS(t,n._query).then(r=>new Ht(e,i,n,r))}function YE(n){n=de(n,it);let e=de(n.firestore,Re),t=rt(e),i=new Nn(e);return dE(t,n._query,{source:"server"}).then(r=>new Ht(e,i,n,r))}function fm(n,e,t){n=de(n,we);let i=de(n.firestore,Re),r=Fu(n.converter,e,t);return us(i,[Du(tr(i),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,Ve.none())])}function mm(n,e,t,...i){n=de(n,we);let r=de(n.firestore,Re),s=tr(r),o;return o=typeof(e=le(e))=="string"||e instanceof Qt?um(s,"updateDoc",n._key,e,t,i):lm(s,"updateDoc",n._key,e),us(r,[o.toMutation(n._key,Ve.exists(!0))])}function JE(n){return us(de(n.firestore,Re),[new mi(n._key,Ve.none())])}function XE(n,e){let t=de(n.firestore,Re),i=Zo(n),r=Fu(n.converter,e);return us(t,[Du(tr(n.firestore),"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,Ve.exists(!1))]).then(()=>i)}function pm(n,...e){var t,i,r;n=le(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||pf(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(pf(e[o])){let m=e[o];e[o]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[o+1]=(i=m.error)===null||i===void 0?void 0:i.bind(m),e[o+2]=(r=m.complete)===null||r===void 0?void 0:r.bind(m)}let u,c,d;if(n instanceof we)c=de(n.firestore,Re),d=rs(n._key.path),u={next:m=>{e[o]&&e[o](gm(c,n,m))},error:e[o+1],complete:e[o+2]};else{let m=de(n,it);c=de(m.firestore,Re),d=m._query;let p=new Nn(c);u={next:y=>{e[o]&&e[o](new Ht(c,p,m,y))},error:e[o+1],complete:e[o+2]},VE(n._query)}return function(p,y,C,P){let k=new es(P),G=new Go(y,k,C);return p.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return zf(yield ts(p),G)})),()=>{k.eu(),p.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return Kf(yield ts(p),G)}))}}(rt(c),d,a,u)}function ZE(n,e){return ES(rt(n=de(n,Re)),pf(e)?e:{next:e})}function us(n,e){return function(i,r){let s=new He;return i.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return eS(yield nm(i),r,s)})),s.promise}(rt(n),e)}function gm(n,e,t){let i=t.docs.get(e._key),r=new Nn(n);return new Lt(n,r,e._key,i,new Sn(t.hasPendingWrites,t.fromCache),e.converter)}var AS={maxAttempts:5};var Cu=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=tr(e)}set(e,t,i){this._verifyNotCommitted();let r=ii(e,this._firestore),s=Fu(r.converter,t,i),o=Du(this._dataReader,"WriteBatch.set",r._key,s,r.converter!==null,i);return this._mutations.push(o.toMutation(r._key,Ve.none())),this}update(e,t,i,...r){this._verifyNotCommitted();let s=ii(e,this._firestore),o;return o=typeof(t=le(t))=="string"||t instanceof Qt?um(this._dataReader,"WriteBatch.update",s._key,t,i,r):lm(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Ve.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=ii(e,this._firestore);return this._mutations=this._mutations.concat(new mi(t._key,Ve.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(R.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function ii(n,e){if((n=le(n)).firestore!==e)throw new D(R.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var xf=class extends class{constructor(t,i){this._firestore=t,this._transaction=i,this._dataReader=tr(t)}get(t){let i=ii(t,this._firestore),r=new Af(this._firestore);return this._transaction.lookup([i._key]).then(s=>{if(!s||s.length!==1)return j();let o=s[0];if(o.isFoundDocument())return new Zi(this._firestore,r,o.key,o,i.converter);if(o.isNoDocument())return new Zi(this._firestore,r,i._key,null,i.converter);throw j()})}set(t,i,r){let s=ii(t,this._firestore),o=Fu(s.converter,i,r),a=Du(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,r);return this._transaction.set(s._key,a),this}update(t,i,r,...s){let o=ii(t,this._firestore),a;return a=typeof(i=le(i))=="string"||i instanceof Qt?um(this._dataReader,"Transaction.update",o._key,i,r,s):lm(this._dataReader,"Transaction.update",o._key,i),this._transaction.update(o._key,a),this}delete(t){let i=ii(t,this._firestore);return this._transaction.delete(i._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=ii(e,this._firestore),i=new Nn(this._firestore);return super.get(e).then(r=>new Lt(this._firestore,i,t._key,r._document,new Sn(!1,!1),t.converter))}};function eI(n,e,t){n=de(n,Re);let i=Object.assign(Object.assign({},AS),t);return function(s){if(s.maxAttempts<1)throw new D(R.INVALID_ARGUMENT,"Max attempts must be at least 1")}(i),function(s,o,a){let u=new He;return s.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){let c=yield gS(s);new ff(s.asyncQueue,c,a,o,u).cu()})),u.promise}(rt(n),r=>e(new xf(n,r)),i)}function tI(){return new Ko("deleteField")}function nI(){return new vf("serverTimestamp")}function iI(...n){return new wf("arrayUnion",n)}function rI(...n){return new Ef("arrayRemove",n)}function sI(n){return new If("increment",n)}(function(e,t=!0){(function(r){is=r})(fl),dl(new nn("firestore",(i,{instanceIdentifier:r,options:s})=>{let o=i.getProvider("app").getImmediate(),a=new Re(new Nh(i.getProvider("auth-internal")),new Oh(i.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new D(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new li(c.options.projectId,d)}(o,r),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Ir(Ly,"4.7.6",e),Ir(Ly,"4.7.6","esm2017")})();var xS="@firebase/firestore-compat",RS="0.3.41";function Im(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new D("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function oI(){if(typeof Uint8Array>"u")throw new D("unimplemented","Uint8Arrays are not available in this environment.")}function aI(){if(!Xv())throw new D("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Ou=class n{constructor(e){this._delegate=e}static fromBase64String(e){return aI(),new n(hn.fromBase64String(e))}static fromUint8Array(e){return oI(),new n(hn.fromUint8Array(e))}toBase64(){return aI(),this._delegate.toBase64()}toUint8Array(){return oI(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function _m(n){return PS(n,["next","error","complete"])}function PS(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}var ym=class{enableIndexedDbPersistence(e,t){return vE(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return wE(e._delegate)}clearIndexedDbPersistence(e){return IE(e._delegate)}},Lu=class{constructor(e,t,i){this._delegate=t,this._persistenceProvider=i,this.INTERNAL={delete:()=>this.terminate()},e instanceof li||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&zt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,i={}){pE(this._delegate,e,t,i)}enableNetwork(){return bE(this._delegate)}disableNetwork(){return CE(this._delegate)}enablePersistence(e){let t=!1,i=!1;return e&&(t=!!e.synchronizeTabs,i=!!e.experimentalForceOwningTab,rm("synchronizeTabs",t,"experimentalForceOwningTab",i)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,i)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return TE(this._delegate)}onSnapshotsInSync(e){return ZE(this._delegate,e)}get app(){if(!this._appCompat)throw new D("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new ds(this,sm(this._delegate,e))}catch(t){throw vt(t,"collection()","Firestore.collection()")}}doc(e){try{return new dn(this,Zo(this._delegate,e))}catch(t){throw vt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new or(this,gE(this._delegate,e))}catch(t){throw vt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return eI(this._delegate,t=>e(new Mu(this,t)))}batch(){return rt(this._delegate),new Uu(new Cu(this._delegate,e=>us(this._delegate,e)))}loadBundle(e){return SE(this._delegate,e)}namedQuery(e){return AE(this._delegate,e).then(t=>t?new or(this,t):null)}},cs=class extends ns{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ou(new hn(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return dn.forKey(t,this.firestore,null)}};function kS(n){Uv(n)}var Mu=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new cs(e)}get(e){let t=ir(e);return this._delegate.get(t).then(i=>new rr(this._firestore,new Lt(this._firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,t.converter)))}set(e,t,i){let r=ir(e);return i?(Im("Transaction.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){let s=ir(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){let t=ir(e);return this._delegate.delete(t),this}},Uu=class{constructor(e){this._delegate=e}set(e,t,i){let r=ir(e);return i?(Im("WriteBatch.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){let s=ir(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){let t=ir(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},hs=class n{constructor(e,t,i){this._firestore=e,this._userDataWriter=t,this._delegate=i}fromFirestore(e,t){let i=new si(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new sr(this._firestore,i),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let i=n.INSTANCES,r=i.get(e);r||(r=new WeakMap,i.set(e,r));let s=r.get(t);return s||(s=new n(e,new cs(e),t),r.set(t,s)),s}};hs.INSTANCES=new WeakMap;var dn=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new cs(e)}static forPath(e,t,i){if(e.length%2!==0)throw new D("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new we(t._delegate,i,new U(e)))}static forKey(e,t,i){return new n(t,new we(t._delegate,i,e))}get id(){return this._delegate.id}get parent(){return new ds(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new ds(this.firestore,sm(this._delegate,e))}catch(t){throw vt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=le(e),e instanceof we?om(this._delegate,e):!1}set(e,t){t=Im("DocumentReference.set",t);try{return t?fm(this._delegate,e,t):fm(this._delegate,e)}catch(i){throw vt(i,"setDoc()","DocumentReference.set()")}}update(e,t,...i){try{return arguments.length===1?mm(this._delegate,e):mm(this._delegate,e,t,...i)}catch(r){throw vt(r,"updateDoc()","DocumentReference.update()")}}delete(){return JE(this._delegate)}onSnapshot(...e){let t=lI(e),i=uI(e,r=>new rr(this.firestore,new Lt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)));return pm(this._delegate,t,i)}get(e){let t;return e?.source==="cache"?t=WE(this._delegate):e?.source==="server"?t=$E(this._delegate):t=KE(this._delegate),t.then(i=>new rr(this.firestore,new Lt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(hs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function vt(n,e,t){return n.message=n.message.replace(e,t),n}function lI(n){for(let e of n)if(typeof e=="object"&&!_m(e))return e;return{}}function uI(n,e){var t,i;let r;return _m(n[0])?r=n[0]:_m(n[1])?r=n[1]:typeof n[0]=="function"?r={next:n[0],error:n[1],complete:n[2]}:r={next:n[1],error:n[2],complete:n[3]},{next:s=>{r.next&&r.next(e(s))},error:(t=r.error)===null||t===void 0?void 0:t.bind(r),complete:(i=r.complete)===null||i===void 0?void 0:i.bind(r)}}var rr=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new dn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return dm(this._delegate,e._delegate)}},sr=class extends rr{data(e){let t=this._delegate.data(e);return this._delegate._converter||Bv(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},or=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new cs(e)}where(e,t,i){try{return new n(this.firestore,Vn(this._delegate,FE(e,t,i)))}catch(r){throw vt(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,Vn(this._delegate,OE(e,t)))}catch(i){throw vt(i,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,Vn(this._delegate,LE(e)))}catch(t){throw vt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,Vn(this._delegate,ME(e)))}catch(t){throw vt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,Vn(this._delegate,UE(...e)))}catch(t){throw vt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,Vn(this._delegate,BE(...e)))}catch(t){throw vt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,Vn(this._delegate,qE(...e)))}catch(t){throw vt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,Vn(this._delegate,jE(...e)))}catch(t){throw vt(t,"endAt()","Query.endAt()")}}isEqual(e){return am(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=HE(this._delegate):e?.source==="server"?t=YE(this._delegate):t=QE(this._delegate),t.then(i=>new ea(this.firestore,new Ht(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)))}onSnapshot(...e){let t=lI(e),i=uI(e,r=>new ea(this.firestore,new Ht(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)));return pm(this._delegate,t,i)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(hs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},vm=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new sr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},ea=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new or(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new sr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new vm(this._firestore,t))}forEach(e,t){this._delegate.forEach(i=>{e.call(t,new sr(this._firestore,i))})}isEqual(e){return dm(this._delegate,e._delegate)}},ds=class n extends or{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new dn(this.firestore,e):null}doc(e){try{return e===void 0?new dn(this.firestore,Zo(this._delegate)):new dn(this.firestore,Zo(this._delegate,e))}catch(t){throw vt(t,"doc()","CollectionReference.doc()")}}add(e){return XE(this._delegate,e).then(t=>new dn(this.firestore,t))}isEqual(e){return om(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(hs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function ir(n){return de(n,we)}var wm=class n{constructor(...e){this._delegate=new Qt(...e)}static documentId(){return new n(Le.keyField().canonicalString())}isEqual(e){return e=le(e),e instanceof Qt?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Em=class n{static serverTimestamp(){let e=nI();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=tI();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=iI(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=rI(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=sI(e);return t._methodName="FieldValue.increment",new n(t)}constructor(e){this._delegate=e}isEqual(e){return this._delegate.isEqual(e._delegate)}};var NS={Firestore:Lu,GeoPoint:Xi,Timestamp:xe,Blob:Ou,Transaction:Mu,WriteBatch:Uu,DocumentReference:dn,DocumentSnapshot:rr,Query:or,QueryDocumentSnapshot:sr,QuerySnapshot:ea,CollectionReference:ds,FieldPath:wm,FieldValue:Em,setLogLevel:kS,CACHE_SIZE_UNLIMITED:_E};function DS(n,e){n.INTERNAL.registerComponent(new nn("firestore-compat",t=>{let i=t.getProvider("app-compat").getImmediate(),r=t.getProvider("firestore").getImmediate();return e(i,r)},"PUBLIC").setServiceProps(Object.assign({},NS)))}function VS(n){DS(n,(e,t)=>new Lu(e,t,new ym)),n.registerVersion(xS,RS)}VS(Qe);function FS(n,e=Ja){return new Di(t=>{let i;return e!=null?e.schedule(()=>{i=n.onSnapshot({includeMetadataChanges:!0},t)}):i=n.onSnapshot({includeMetadataChanges:!0},t),()=>{i?.()}})}function cI(n,e){return FS(n,e)}function OS(n,e){return cI(n,e).pipe(nl(void 0),tl(),Ne(t=>{let[i,r]=t;return r.exists?i?.exists?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}}))}function Cm(n,e){return cI(n,e).pipe(Ne(t=>({payload:t,type:"query"})))}var Bu=class{ref;afs;injector=At(zn);constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let i=this.ref.collection(e),{ref:r,query:s}=pI(i,t);return new ju(r,s,this.afs)}snapshotChanges(){return OS(this.ref,this.afs.schedulers.outsideAngular).pipe(Fe(this.injector))}valueChanges(e={}){return this.snapshotChanges().pipe(Ne(({payload:t})=>e.idField?jt(Je({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return qn(this.ref.get(e)).pipe(Fe(this.injector))}};function qu(n,e){return Cm(n,e).pipe(nl(void 0),tl(),Ne(t=>{let[i,r]=t,s=r.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return i&&JSON.stringify(i.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((a,u)=>{let c=s.find(m=>m.doc.ref.isEqual(a.ref)),d=i?.payload.docs.find(m=>m.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&d&&JSON.stringify(d.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function hI(n,e,t){return qu(n,t).pipe(Vi((i,r)=>LS(i,r.map(s=>s.payload),e),[]),Za(),Ne(i=>i.map(r=>({type:r.type,payload:r}))))}function LS(n,e,t){return e.forEach(i=>{t.indexOf(i.type)>-1&&(n=MS(n,i))}),n}function Tm(n,e,t,...i){let r=n.slice();return r.splice(e,t,...i),r}function MS(n,e){switch(e.type){case"added":if(!n[e.newIndex]?.doc.ref.isEqual(e.doc.ref))return Tm(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return Tm(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]?.doc.ref.isEqual(e.doc.ref))return Tm(n,e.oldIndex,1);break}return n}function dI(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var ju=class{ref;query;afs;injector=At(zn);constructor(e,t,i){this.ref=e,this.query=t,this.afs=i}stateChanges(e){let t=qu(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Ne(i=>i.filter(r=>e.indexOf(r.type)>-1)))),t.pipe(nl(void 0),tl(),Xs(([i,r])=>r.length>0||!i),Ne(([,i])=>i),Fe(this.injector))}auditTrail(e){return this.stateChanges(e).pipe(Vi((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=dI(e);return hI(this.query,t,this.afs.schedulers.outsideAngular).pipe(Fe(this.injector))}valueChanges(e={}){return Cm(this.query,this.afs.schedulers.outsideAngular).pipe(Ne(t=>t.payload.docs.map(i=>e.idField?jt(Je({},i.data()),{[e.idField]:i.id}):i.data())),Fe(this.injector))}get(e){return qn(this.query.get(e)).pipe(Fe(this.injector))}add(e){return this.ref.add(e)}doc(e){return new Bu(this.ref.doc(e),this.afs)}},bm=class{query;afs;injector=At(zn);constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?qu(this.query,this.afs.schedulers.outsideAngular).pipe(Fe(this.injector)):qu(this.query,this.afs.schedulers.outsideAngular).pipe(Ne(t=>t.filter(i=>e.indexOf(i.type)>-1)),Xs(t=>t.length>0),Fe(this.injector))}auditTrail(e){return this.stateChanges(e).pipe(Vi((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=dI(e);return hI(this.query,t,this.afs.schedulers.outsideAngular).pipe(Fe(this.injector))}valueChanges(e={}){return Cm(this.query,this.afs.schedulers.outsideAngular).pipe(Ne(i=>i.payload.docs.map(r=>e.idField?Je({[e.idField]:r.id},r.data()):r.data())),Fe(this.injector))}get(e){return qn(this.query.get(e)).pipe(Fe(this.injector))}},fI=new Xe("angularfire2.enableFirestorePersistence"),mI=new Xe("angularfire2.firestore.persistenceSettings"),US=new Xe("angularfire2.firestore.settings"),BS=new Xe("angularfire2.firestore.use-emulator");function pI(n,e=t=>t){return{query:e(n),ref:n}}var qS=(()=>{class n{schedulers;firestore;persistenceEnabled$;ngZone=At(pt);constructor(t,i,r,s,o,a,u,c,d,m,p,y,C,P,k,G,K){this.schedulers=u;let O=Oi(t,a,i),$=d;m&&co(O,a,p,C,P,k,y,G),[this.firestore,this.persistenceEnabled$]=Cr(`${O.name}.firestore`,"AngularFirestore",O.name,()=>{let Z=a.runOutsideAngular(()=>O.firestore());if(s&&Z.settings(s),$&&Z.useEmulator(...$),r&&!sl(o)){let ee=()=>{try{return qn(Z.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(E){return typeof console<"u"&&console.warn(E),Xt(!1)}};return[Z,a.runOutsideAngular(ee)]}else return[Z,Xt(!1)]},[s,$,r])}collection(t,i){let r;typeof t=="string"?r=this.firestore.collection(t):r=t;let{ref:s,query:o}=pI(r,i),a=this.ngZone.run(()=>s);return new ju(a,o,this)}collectionGroup(t,i){let r=i||(o=>o),s=this.firestore.collectionGroup(t);return new bm(r(s),this)}doc(t){let i;typeof t=="string"?i=this.firestore.doc(t):i=t;let r=this.ngZone.run(()=>i);return new Bu(r,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(i){return new(i||n)(Y(Xn),Y(Zn,8),Y(fI,8),Y(US,8),Y(Kn),Y(pt),Y(Tr),Y(mI,8),Y(BS,8),Y(ho,8),Y(ro,8),Y(so,8),Y(oo,8),Y(ao,8),Y(lo,8),Y(uo,8),Y(br,8))};static \u0275prov=jn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),gI=(()=>{class n{constructor(){Qe.registerVersion("angularfire",In.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:fI,useValue:!0},{provide:mI,useValue:t}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=$n({type:n});static \u0275inj=Gn({providers:[qS]})}return n})();var _I="@firebase/database",yI="1.0.11";var Lp="";function Mp(n){Lp=n}var Dm=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),je(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:ul(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var Vm=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Vt(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var HI=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Dm(e)}}catch{}return new Vm},lr=HI("localStorage"),Fm=HI("sessionStorage");var gs=new Er("@firebase/database"),YI=function(){let n=1;return function(){return n++}}(),JI=function(n){let e=Sy(n),t=new Cy;t.update(e);let i=t.digest();return gy.encodeByteArray(i)},ba=function(...n){let e="";for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=ba.apply(null,i):typeof i=="object"?e+=je(i):e+=i,e+=" "}return e},ur=null,vI=!0,XI=function(n,e){F(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(gs.logLevel=Ft.VERBOSE,ur=gs.log.bind(gs),e&&Fm.set("logging_enabled",!0)):typeof n=="function"?ur=n:(ur=null,Fm.remove("logging_enabled"))},Ze=function(...n){if(vI===!0&&(vI=!1,ur===null&&Fm.get("logging_enabled")===!0&&XI(!0)),ur){let e=ba.apply(null,n);ur(e)}},Ca=function(n){return function(...e){Ze(n,...e)}},Om=function(...n){let e="FIREBASE INTERNAL ERROR: "+ba(...n);gs.error(e)},pn=function(...n){let e=`FIREBASE FATAL ERROR: ${ba(...n)}`;throw gs.error(e),new Error(e)},dt=function(...n){let e="FIREBASE WARNING: "+ba(...n);gs.warn(e)},jS=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&dt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},gc=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},GS=function(n){if(tn()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Ti="[MIN_NAME]",Fn="[MAX_NAME]",hr=function(n,e){if(n===e)return 0;if(n===Ti||e===Fn)return-1;if(e===Ti||n===Fn)return 1;{let t=wI(n),i=wI(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},zS=function(n,e){return n===e?0:n<e?-1:1},ta=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+je(e))},Up=function(n){if(typeof n!="object"||n===null)return je(n);let e=[];for(let i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=je(e[i]),t+=":",t+=Up(n[e[i]]);return t+="}",t},ZI=function(n,e){let t=n.length;if(t<=e)return[n];let i=[];for(let r=0;r<t;r+=e)r+e>t?i.push(n.substring(r,t)):i.push(n.substring(r,r+e));return i};function et(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var eT=function(n){F(!gc(n),"Invalid JSON number");let e=11,t=52,i=(1<<e-1)-1,r,s,o,a,u;n===0?(s=0,o=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),s=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-i-t))));let c=[];for(u=t;u;u-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(u=e;u;u-=1)c.push(s%2?1:0),s=Math.floor(s/2);c.push(r?1:0),c.reverse();let d=c.join(""),m="";for(u=0;u<64;u+=8){let p=parseInt(d.substr(u,8),2).toString(16);p.length===1&&(p="0"+p),m=m+p}return m.toLowerCase()},KS=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},WS=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function $S(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}var QS=new RegExp("^-?(0*)\\d{1,10}$"),HS=-2147483648,YS=2147483647,wI=function(n){if(QS.test(n)){let e=Number(n);if(e>=HS&&e<=YS)return e}return null},Cs=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw dt("Exception was thrown by user callback.",t),e},Math.floor(0))}},JS=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},sa=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var Lm=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){dt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Mm=class{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Ze("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',dt(e)}},oa=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),zu="5",tT="v",nT="s",iT="r",rT="f",sT=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,oT="ls",aT="p",Um="ac",lT="websocket",uT="long_polling";var Ku=class{constructor(e,t,i,r,s=!1,o="",a=!1,u=!1){this.secure=t,this.namespace=i,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=lr.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&lr.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function XS(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function cT(n,e,t){F(typeof e=="string","typeof type must == string"),F(typeof t=="object","typeof params must == object");let i;if(e===lT)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===uT)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);XS(n)&&(t.ns=n.namespace);let r=[];return et(t,(s,o)=>{r.push(s+"="+o)}),i+r.join("&")}var Bm=class{constructor(){this.counters_={}}incrementCounter(e,t=1){Vt(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return yy(this.counters_)}};var Sm={},Am={};function Bp(n){let e=n.toString();return Sm[e]||(Sm[e]=new Bm),Sm[e]}function ZS(n,e){let t=n.toString();return Am[t]||(Am[t]=e()),Am[t]}var qm=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<i.length;++r)i[r]&&Cs(()=>{this.onMessage_(i[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var EI="start",eA="close",tA="pLPCommand",nA="pRTLPCB",hT="id",dT="pw",fT="ser",iA="cb",rA="seg",sA="ts",oA="d",aA="dframe",mT=1870,pT=30,lA=mT-pT,uA=25e3,cA=3e4,ca=class n{constructor(e,t,i,r,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ca(e),this.stats_=Bp(t),this.urlFn=u=>(this.appCheckToken&&(u[Um]=this.appCheckToken),cT(t,uT,u))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new qm(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(cA)),GS(()=>{if(this.isClosed_)return;this.scriptTagHolder=new jm((...s)=>{let[o,a,u,c,d]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===EI)this.id=a,this.password=u;else if(o===eA)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[EI]="t",i[fT]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[iA]=this.scriptTagHolder.uniqueCallbackIdentifier),i[tT]=zu,this.transportSessionId&&(i[nT]=this.transportSessionId),this.lastSessionId&&(i[oT]=this.lastSessionId),this.applicationId&&(i[aT]=this.applicationId),this.appCheckToken&&(i[Um]=this.appCheckToken),typeof location<"u"&&location.hostname&&sT.test(location.hostname)&&(i[iT]=rT);let r=this.urlFn(i);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return tn()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!KS()&&!WS()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=je(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let i=_y(t),r=ZI(i,lA);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(tn())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[aA]="t",i[hT]=e,i[dT]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=je(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},jm=class n{constructor(e,t,i,r){if(this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,tn())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=YI(),window[tA+this.uniqueCallbackIdentifier]=e,window[nA+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Ze("frame writing exception"),a.stack&&Ze(a.stack),Ze(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Ze("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[hT]=this.myID,e[dT]=this.myPW,e[fT]=this.currentSerial;let t=this.urlFn(e),i="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+pT+i.length<=mT;){let o=this.pendingSegs.shift();i=i+"&"+rA+r+"="+o.seg+"&"+sA+r+"="+o.ts+"&"+oA+r+"="+o.d,r++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(i,Math.floor(uA)),s=()=>{clearTimeout(r),i()};this.addTag(e,s)}addTag(e,t){tn()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let r=i.readyState;(!r||r==="loaded"||r==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{Ze("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var hA=16384,dA=45e3,Wu=null;typeof MozWebSocket<"u"?Wu=MozWebSocket:typeof WebSocket<"u"&&(Wu=WebSocket);var ms=(()=>{class n{constructor(t,i,r,s,o,a,u){this.connId=t,this.applicationId=r,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ca(this.connId),this.stats_=Bp(i),this.connURL=n.connectionURL_(i,a,u,s,r),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,r,s,o){let a={};return a[tT]=zu,!tn()&&typeof location<"u"&&location.hostname&&sT.test(location.hostname)&&(a[iT]=rT),i&&(a[nT]=i),r&&(a[oT]=r),s&&(a[Um]=s),o&&(a[aT]=o),cT(t,lT,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,lr.set("previous_websocket_failure",!0);try{let r;if(tn()){let s=this.nodeAdmin?"AdminNode":"Node";r={headers:{"User-Agent":`Firebase/${zu}/${Lp}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(r.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(r.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(r.proxy={origin:a})}this.mySock=new Wu(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(i);r&&r.length>1&&parseFloat(r[1])<4.4&&(t=!0)}return!t&&Wu!==null&&!n.forceDisallow_}static previouslyFailed(){return lr.isInMemoryStorage||lr.get("previous_websocket_failure")===!0}markConnectionHealthy(){lr.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let r=ul(i);this.onMessage(r)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(F(this.frames===null,"We already have a frame buffer"),t.length<=6){let i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let r=this.extractFrameCount_(i);r!==null&&this.appendFrame_(r)}}send(t){this.resetKeepAlive();let i=je(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let r=ZI(i,hA);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(dA))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),gT=(()=>{class n{static get ALL_TRANSPORTS(){return[ca,ms]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){let i=ms&&ms.isAvailable(),r=i&&!ms.previouslyFailed();if(t.webSocketOnly&&(i||dt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[ms];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),fA=6e4,mA=5e3,pA=10*1024,gA=100*1024,xm="t",II="d",_A="s",TI="r",yA="e",bI="o",CI="a",SI="n",AI="p",vA="h",Gm=class{constructor(e,t,i,r,s,o,a,u,c,d){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=u,this.onKill_=c,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ca("c:"+this.id+":"),this.transportManager_=new gT(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=sa(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>gA?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>pA?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(xm in e){let t=e[xm];t===CI?this.upgradeIfSecondaryHealthy_():t===TI?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===bI&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=ta("t",e),i=ta("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:AI,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:CI,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:SI,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=ta("t",e),i=ta("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=ta(xm,e);if(II in e){let i=e[II];if(t===vA){let r=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===SI){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===_A?this.onConnectionShutdown_(i):t===TI?this.onReset_(i):t===yA?Om("Server Error: "+i):t===bI?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Om("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,i=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),zu!==i&&dt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),sa(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(fA))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):sa(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(mA))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:AI,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(lr.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var $u=class{put(e,t,i,r){}merge(e,t,i,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}};var Qu=class{constructor(e){this.allowedEvents_=e,this.listeners_={},F(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let r=0;r<i.length;r++)i[r].callback.apply(i[r].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});let r=this.getInitialEvent(e);r&&t.apply(i,r)}off(e,t,i){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===t&&(!i||i===r[s].context)){r.splice(s,1);return}}validateEventType_(e){F(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var Hu=class n extends Qu{static getInstance(){return new n}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!mh()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return F(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var xI=32,RI=768,pe=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[i]=this.pieces_[r],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function me(){return new pe("")}function re(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function bi(n){return n.pieces_.length-n.pieceNum_}function ve(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new pe(n.pieces_,e)}function qp(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function wA(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function ha(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function _T(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new pe(e,0)}function Ae(n,e){let t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof pe)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{let i=e.split("/");for(let r=0;r<i.length;r++)i[r].length>0&&t.push(i[r])}return new pe(t,0)}function se(n){return n.pieceNum_>=n.pieces_.length}function wt(n,e){let t=re(n),i=re(e);if(t===null)return e;if(t===i)return wt(ve(n),ve(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function EA(n,e){let t=ha(n,0),i=ha(e,0);for(let r=0;r<t.length&&r<i.length;r++){let s=hr(t[r],i[r]);if(s!==0)return s}return t.length===i.length?0:t.length<i.length?-1:1}function jp(n,e){if(bi(n)!==bi(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function Mt(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(bi(n)>bi(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}var zm=class{constructor(e,t){this.errorPrefix_=t,this.parts_=ha(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=no(this.parts_[i]);yT(this)}};function IA(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=no(e),yT(n)}function TA(n){let e=n.parts_.pop();n.byteLength_-=no(e),n.parts_.length>0&&(n.byteLength_-=1)}function yT(n){if(n.byteLength_>RI)throw new Error(n.errorPrefix_+"has a key path longer than "+RI+" bytes ("+n.byteLength_+").");if(n.parts_.length>xI)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+xI+") or object contains a cycle "+ar(n))}function ar(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var Km=class n extends Qu{static getInstance(){return new n}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return F(e==="visible","Unknown event type: "+e),[this.visible_]}};var na=1e3,bA=60*5*1e3,PI=30*1e3,CA=1.3,SA=3e4,AA="server_kill",kI=3,Gp=(()=>{class n extends $u{constructor(t,i,r,s,o,a,u,c){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=u,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=Ca("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=na,this.maxReconnectDelay_=bA,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!tn())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Km.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&Hu.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,r){let s=++this.requestNumber_,o={r:s,a:t,b:i};this.log_(je(o)),F(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),r&&(this.requestCBHash_[s]=r)}get(t){this.initConnection_();let i=new _t,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let u=a.d;a.s==="ok"?i.resolve(u):i.reject(u)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),i.promise}listen(t,i,r,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),F(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),F(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let u={onComplete:s,hashFn:i,query:t,tag:r};this.listens.get(a).set(o,u),this.connected_&&this.sendListen_(u)}sendGet_(t){let i=this.outstandingGets_[t];this.sendRequest("g",i.request,r=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(r)})}sendListen_(t){let i=t.query,r=i._path.toString(),s=i._queryIdentifier;this.log_("Listen on "+r+" for "+s);let o={p:r},a="q";t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,u=>{let c=u.d,d=u.s;n.warnOnListenWarnings_(c,i),(this.listens.get(r)&&this.listens.get(r).get(s))===t&&(this.log_("listen response",u),d!=="ok"&&this.removeListen_(r,s),t.onComplete&&t.onComplete(d,c))})}static warnOnListenWarnings_(t,i){if(t&&typeof t=="object"&&Vt(t,"w")){let r=Jn(t,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){let s='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();dt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||Ty(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=PI)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,i=Iy(t)?"auth":"gauth",r={cred:t};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(i,r,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let i=t.s,r=t.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,r)})}unlisten(t,i){let r=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),F(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,t._queryObject,i)}sendUnlisten_(t,i,r,s){this.log_("Unlisten on "+t+" for "+i);let o={p:t},a="n";s&&(o.q=r,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:r})}onDisconnectMerge(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:r})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,r,s){let o={p:i,d:r};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,i,r,s){this.putInternal("p",t,i,r,s)}merge(t,i,r,s){this.putInternal("m",t,i,r,s)}putInternal(t,i,r,s,o){this.initConnection_();let a={p:i,d:r};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let u=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(u):this.log_("Buffering put: "+i)}sendPut_(t){let i=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,r,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,r=>{if(r.s!=="ok"){let o=r.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+je(t));let i=t.r,r=this.requestCBHash_[i];r&&(delete this.requestCBHash_[i],r(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),t==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):t==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):t==="c"?this.onListenRevoked_(i.p,i.q):t==="ac"?this.onAuthRevoked_(i.s,i.d):t==="apc"?this.onAppCheckRevoked_(i.s,i.d):t==="sd"?this.onSecurityDebugPacket_(i):Om("Unrecognized action received from server: "+je(t)+`
Are you using the latest client?`)}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){F(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=na,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=na,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>SA&&(this.reconnectDelay_=na),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*CA)}this.onConnectStatus_(!1)}establishConnection_(){return N(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,u=null,c=function(){u?u.close():(a=!0,r())},d=function(p){F(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(p)};this.realtime_={close:c,sendRequest:d};let m=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[p,y]=yield Promise.all([this.authTokenProvider_.getToken(m),this.appCheckTokenProvider_.getToken(m)]);a?Ze("getToken() completed but was canceled"):(Ze("getToken() completed. Creating connection."),this.authToken_=p&&p.accessToken,this.appCheckToken_=y&&y.token,u=new Gm(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,i,r,C=>{dt(C+" ("+this.repoInfo_.toString()+")"),this.interrupt(AA)},o))}catch(p){this.log_("Failed to get token: "+p),a||(this.repoInfo_.nodeAdmin&&dt(p),c())}}})}interrupt(t){Ze("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Ze("Resuming connection for reason: "+t),delete this.interruptReasons_[t],cl(this.interruptReasons_)&&(this.reconnectDelay_=na,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let i=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let r;i?r=i.map(o=>Up(o)).join("$"):r="default";let s=this.removeListen_(t,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,i){let r=new pe(t).toString(),s;if(this.listens.has(r)){let o=this.listens.get(r);s=o.get(i),o.delete(i),o.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(t,i){Ze("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=kI&&(this.reconnectDelay_=PI,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){Ze("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=kI&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},i="js";tn()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),t["sdk."+i+"."+Lp.replace(/\./g,"-")]=1,mh()?t["framework.cordova"]=1:vy()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=Hu.getInstance().currentlyOnline();return cl(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),ae=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var _s=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let i=new ae(Ti,e),r=new ae(Ti,t);return this.compare(i,r)!==0}minPost(){return ae.MIN}};var Gu,Yu=class extends _s{static get __EMPTY_NODE(){return Gu}static set __EMPTY_NODE(e){Gu=e}compare(e,t){return hr(e.name,t.name)}isDefinedOn(e){throw wr("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return ae.MIN}maxPost(){return new ae(Fn,Gu)}makePost(e,t){return F(typeof e=="string","KeyIndex indexValue must always be a string."),new ae(e,Gu)}toString(){return".key"}},mn=new Yu;var ps=class{constructor(e,t,i,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Yt=(()=>{class n{constructor(t,i,r,s,o){this.key=t,this.value=i,this.color=r??n.RED,this.left=s??Ut.EMPTY_NODE,this.right=o??Ut.EMPTY_NODE}copy(t,i,r,s,o){return new n(t??this.key,i??this.value,r??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,r){let s=this,o=r(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,i,r),null):o===0?s=s.copy(null,i,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,i,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ut.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let r,s;if(r=this,i(t,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(t,i),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),i(t,r.key)===0){if(r.right.isEmpty())return Ut.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(t,i))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),Wm=class{copy(e,t,i,r,s){return this}insert(e,t,i){return new Yt(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},Ut=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Yt.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Yt.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,r=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return r?r.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(r=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new ps(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new ps(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new ps(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new ps(this.root_,null,this.comparator_,!0,e)}};Ut.EMPTY_NODE=new Wm;function xA(n,e){return hr(n.name,e.name)}function zp(n,e){return hr(n,e)}var $m;function RA(n){$m=n}var vT=function(n){return typeof n=="number"?"number:"+eT(n):"string:"+n},wT=function(n){if(n.isLeafNode()){let e=n.val();F(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Vt(e,".sv"),"Priority must be a string or number.")}else F(n===$m||n.isEmpty(),"priority of unexpected type.");F(n===$m||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var NI,ys=(()=>{class n{static set __childrenNodeConstructor(t){NI=t}static get __childrenNodeConstructor(){return NI}constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,F(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),wT(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return se(t)?this:re(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return t===".priority"?this.updatePriority(i):i.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){let r=re(t);return r===null?i:i.isEmpty()&&r!==".priority"?this:(F(r!==".priority"||bi(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(ve(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+vT(this.priorityNode_.val())+":");let i=typeof this.value_;t+=i+":",i==="number"?t+=eT(this.value_):t+=this.value_,this.lazyHash_=JI(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(F(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let i=typeof t.value_,r=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(r);return F(s>=0,"Unknown leaf type: "+i),F(o>=0,"Unknown leaf type: "+r),s===o?r==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let i=t;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),ET,IT;function PA(n){ET=n}function kA(n){IT=n}var Qm=class extends _s{compare(e,t){let i=e.node.getPriority(),r=t.node.getPriority(),s=i.compareTo(r);return s===0?hr(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return ae.MIN}maxPost(){return new ae(Fn,new ys("[PRIORITY-POST]",IT))}makePost(e,t){let i=ET(e);return new ae(t,new ys("[PRIORITY-POST]",i))}toString(){return".priority"}},Ee=new Qm;var NA=Math.log(2),Hm=class{constructor(e){let t=s=>parseInt(Math.log(s)/NA,10),i=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let r=i(this.count);this.bits_=e+1&r}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Ju=function(n,e,t,i){n.sort(e);let r=function(u,c){let d=c-u,m,p;if(d===0)return null;if(d===1)return m=n[u],p=t?t(m):m,new Yt(p,m.node,Yt.BLACK,null,null);{let y=parseInt(d/2,10)+u,C=r(u,y),P=r(y+1,c);return m=n[y],p=t?t(m):m,new Yt(p,m.node,Yt.BLACK,C,P)}},s=function(u){let c=null,d=null,m=n.length,p=function(C,P){let k=m-C,G=m;m-=C;let K=r(k+1,G),O=n[k],$=t?t(O):O;y(new Yt($,O.node,P,null,K))},y=function(C){c?(c.left=C,c=C):(d=C,c=C)};for(let C=0;C<u.count;++C){let P=u.nextBitIsOne(),k=Math.pow(2,u.count-(C+1));P?p(k,Yt.BLACK):(p(k,Yt.BLACK),p(k,Yt.RED))}return d},o=new Hm(n.length),a=s(o);return new Ut(i||e,a)};var Rm,fs={},vs=class n{static get Default(){return F(fs&&Ee,"ChildrenNode.ts has not been loaded"),Rm=Rm||new n({".priority":fs},{".priority":Ee}),Rm}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=Jn(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Ut?t:null}hasIndex(e){return Vt(this.indexSet_,e.toString())}addIndex(e,t){F(e!==mn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(ae.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();let a;r?a=Ju(i,e.getCompare()):a=fs;let u=e.toString(),c=Object.assign({},this.indexSet_);c[u]=e;let d=Object.assign({},this.indexes_);return d[u]=a,new n(d,c)}addToIndexes(e,t){let i=to(this.indexes_,(r,s)=>{let o=Jn(this.indexSet_,s);if(F(o,"Missing index implementation for "+s),r===fs)if(o.isDefinedOn(e.node)){let a=[],u=t.getIterator(ae.Wrap),c=u.getNext();for(;c;)c.name!==e.name&&a.push(c),c=u.getNext();return a.push(e),Ju(a,o.getCompare())}else return fs;else{let a=t.get(e.name),u=r;return a&&(u=u.remove(new ae(e.name,a))),u.insert(e,e.node)}});return new n(i,this.indexSet_)}removeFromIndexes(e,t){let i=to(this.indexes_,r=>{if(r===fs)return r;{let s=t.get(e.name);return s?r.remove(new ae(e.name,s)):r}});return new n(i,this.indexSet_)}};var ia,te=(()=>{class n{static get EMPTY_NODE(){return ia||(ia=new n(new Ut(zp),null,vs.Default))}constructor(t,i,r){this.children_=t,this.priorityNode_=i,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&wT(this.priorityNode_),this.children_.isEmpty()&&F(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ia}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let i=this.children_.get(t);return i===null?ia:i}}getChild(t){let i=re(t);return i===null?this:this.getImmediateChild(i).getChild(ve(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,i){if(F(i,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(i);{let r=new ae(t,i),s,o;i.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(r,this.children_));let a=s.isEmpty()?ia:this.priorityNode_;return new n(s,a,o)}}updateChild(t,i){let r=re(t);if(r===null)return i;{F(re(t)!==".priority"||bi(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(r).updateChild(ve(t),i);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let i={},r=0,s=0,o=!0;if(this.forEachChild(Ee,(a,u)=>{i[a]=u.val(t),r++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*r){let a=[];for(let u in i)a[u]=i[u];return a}else return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+vT(this.getPriority().val())+":"),this.forEachChild(Ee,(i,r)=>{let s=r.hash();s!==""&&(t+=":"+i+":"+s)}),this.lazyHash_=t===""?"":JI(t)}return this.lazyHash_}getPredecessorChildName(t,i,r){let s=this.resolveIndex_(r);if(s){let o=s.getPredecessorKey(new ae(t,i));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(t){let i=this.getFirstChildName(t);return i?new ae(i,this.children_.get(i)):null}getLastChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(t){let i=this.getLastChildName(t);return i?new ae(i,this.children_.get(i)):null}forEachChild(t,i){let r=this.resolveIndex_(t);return r?r.inorderTraversal(s=>i(s.name,s.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,ae.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,ae.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Sa?-1:0}withIndex(t){if(t===mn||this.indexMap_.hasIndex(t))return this;{let i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===mn||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let i=t;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let r=this.getIterator(Ee),s=i.getIterator(Ee),o=r.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=r.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===mn?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),Ym=class extends te{constructor(){super(new Ut(zp),te.EMPTY_NODE,vs.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return te.EMPTY_NODE}isEmpty(){return!1}},Sa=new Ym;Object.defineProperties(ae,{MIN:{value:new ae(Ti,te.EMPTY_NODE)},MAX:{value:new ae(Fn,Sa)}});Yu.__EMPTY_NODE=te.EMPTY_NODE;ys.__childrenNodeConstructor=te;RA(Sa);kA(Sa);var DA=!0;function Pe(n,e=null){if(n===null)return te.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),F(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new ys(t,Pe(e))}if(!(n instanceof Array)&&DA){let t=[],i=!1;if(et(n,(o,a)=>{if(o.substring(0,1)!=="."){let u=Pe(a);u.isEmpty()||(i=i||!u.getPriority().isEmpty(),t.push(new ae(o,u)))}}),t.length===0)return te.EMPTY_NODE;let s=Ju(t,xA,o=>o.name,zp);if(i){let o=Ju(t,Ee.getCompare());return new te(s,Pe(e),new vs({".priority":o},{".priority":Ee}))}else return new te(s,Pe(e),vs.Default)}else{let t=te.EMPTY_NODE;return et(n,(i,r)=>{if(Vt(n,i)&&i.substring(0,1)!=="."){let s=Pe(r);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(i,s))}}),t.updatePriority(Pe(e))}}PA(Pe);var da=class extends _s{constructor(e){super(),this.indexPath_=e,F(!se(e)&&re(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let i=this.extractChild(e.node),r=this.extractChild(t.node),s=i.compareTo(r);return s===0?hr(e.name,t.name):s}makePost(e,t){let i=Pe(e),r=te.EMPTY_NODE.updateChild(this.indexPath_,i);return new ae(t,r)}maxPost(){let e=te.EMPTY_NODE.updateChild(this.indexPath_,Sa);return new ae(Fn,e)}toString(){return ha(this.indexPath_,0).join("/")}};var Jm=class extends _s{compare(e,t){let i=e.node.compareTo(t.node);return i===0?hr(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return ae.MIN}maxPost(){return ae.MAX}makePost(e,t){let i=Pe(e);return new ae(t,i)}toString(){return".value"}},Kp=new Jm;function TT(n){return{type:"value",snapshotNode:n}}function ws(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function fa(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function ma(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function VA(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var pa=class{constructor(e){this.index_=e}updateChild(e,t,i,r,s,o){F(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(r).equals(i.getChild(r))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(fa(t,a)):F(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(ws(t,i)):o.trackChildChange(ma(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(Ee,(r,s)=>{t.hasChild(r)||i.trackChildChange(fa(r,s))}),t.isLeafNode()||t.forEachChild(Ee,(r,s)=>{if(e.hasChild(r)){let o=e.getImmediateChild(r);o.equals(s)||i.trackChildChange(ma(r,s,o))}else i.trackChildChange(ws(r,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?te.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var Xu=class n{constructor(e){this.indexedFilter_=new pa(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,r,s,o){return this.matches(new ae(t,i))||(i=te.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,r,s,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=te.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(te.EMPTY_NODE);let s=this;return t.forEachChild(Ee,(o,a)=>{s.matches(new ae(o,a))||(r=r.updateImmediateChild(o,te.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var Xm=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{let i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new Xu(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,r,s,o){return this.rangedFilter_.matches(new ae(t,i))||(i=te.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,r,s,o):this.fullLimitUpdateChild_(e,t,i,s,o)}updateFullNode(e,t,i){let r;if(t.isLeafNode()||t.isEmpty())r=te.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=te.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(te.EMPTY_NODE);let s;this.reverse_?s=r.getReverseIterator(this.index_):s=r.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,te.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,r,s){let o;if(this.reverse_){let m=this.index_.getCompare();o=(p,y)=>m(y,p)}else o=this.index_.getCompare();let a=e;F(a.numChildren()===this.limit_,"");let u=new ae(t,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(u);if(a.hasChild(t)){let m=a.getImmediateChild(t),p=r.getChildAfterChild(this.index_,c,this.reverse_);for(;p!=null&&(p.name===t||a.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);let y=p==null?1:o(p,u);if(d&&!i.isEmpty()&&y>=0)return s?.trackChildChange(ma(t,i,m)),a.updateImmediateChild(t,i);{s?.trackChildChange(fa(t,m));let P=a.updateImmediateChild(t,te.EMPTY_NODE);return p!=null&&this.rangedFilter_.matches(p)?(s?.trackChildChange(ws(p.name,p.node)),P.updateImmediateChild(p.name,p.node)):P}}else return i.isEmpty()?e:d&&o(c,u)>=0?(s!=null&&(s.trackChildChange(fa(c.name,c.node)),s.trackChildChange(ws(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(c.name,te.EMPTY_NODE)):e}};var ga=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ee}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return F(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return F(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ti}hasEnd(){return this.endSet_}getIndexEndValue(){return F(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return F(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Fn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return F(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ee}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function FA(n){return n.loadsAllData()?new pa(n.getIndex()):n.hasLimit()?new Xm(n):new Xu(n)}function OA(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function LA(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function Zm(n,e,t){let i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function MA(n,e,t){let i;return n.index_===mn||t?i=Zm(n,e,t):i=Zm(n,e,Fn),i.startAfterSet_=!0,i}function ep(n,e,t){let i=n.copy();return i.endSet_=!0,e===void 0&&(e=null),i.indexEndValue_=e,t!==void 0?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function UA(n,e,t){let i;return n.index_===mn||t?i=ep(n,e,t):i=ep(n,e,Ti),i.endBeforeSet_=!0,i}function _c(n,e){let t=n.copy();return t.index_=e,t}function DI(n){let e={};if(n.isDefault())return e;let t;if(n.index_===Ee?t="$priority":n.index_===Kp?t="$value":n.index_===mn?t="$key":(F(n.index_ instanceof da,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=je(t),n.startSet_){let i=n.startAfterSet_?"startAfter":"startAt";e[i]=je(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+je(n.indexStartName_))}if(n.endSet_){let i=n.endBeforeSet_?"endBefore":"endAt";e[i]=je(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+je(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function VI(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Ee&&(e.i=n.index_.toString()),e}var tp=class n extends $u{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(F(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,i,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=r,this.log_=Ca("p:rest:"),this.listens_={}}listen(e,t,i,r){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,i),a={};this.listens_[o]=a;let u=DI(e._queryParams);this.restRequest_(s+".json",u,(c,d)=>{let m=d;if(c===404&&(m=null,c=null),c===null&&this.onDataUpdate_(s,m,!1,i),Jn(this.listens_,o)===a){let p;c?c===401?p="permission_denied":p="rest_error:"+c:p="ok",r(p,null)}})}unlisten(e,t){let i=n.getListenId_(e,t);delete this.listens_[i]}get(e){let t=DI(e._queryParams),i=e._path.toString(),r=new _t;return this.restRequest_(i+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(i,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(t.auth=r.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+by(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let u=null;if(a.status>=200&&a.status<300){try{u=ul(a.responseText)}catch{dt("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,u)}else a.status!==401&&a.status!==404&&dt("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};var np=class{constructor(){this.rootNode_=te.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Zu(){return{value:null,children:new Map}}function Ss(n,e,t){if(se(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let i=re(e);n.children.has(i)||n.children.set(i,Zu());let r=n.children.get(i);e=ve(e),Ss(r,e,t)}}function ip(n,e){if(se(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(Ee,(i,r)=>{Ss(n,new pe(i),r)}),ip(n,e)}}else if(n.children.size>0){let t=re(e);return e=ve(e),n.children.has(t)&&ip(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function rp(n,e,t){n.value!==null?t(e,n.value):BA(n,(i,r)=>{let s=new pe(e.toString()+"/"+i);rp(r,s,t)})}function BA(n,e){n.children.forEach((t,i)=>{e(i,t)})}var sp=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&et(this.last_,(i,r)=>{t[i]=t[i]-r}),this.last_=e,t}};var FI=10*1e3,qA=30*1e3,jA=5*60*1e3,op=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new sp(e);let i=FI+(qA-FI)*Math.random();sa(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),t={},i=!1;et(e,(r,s)=>{s>0&&Vt(this.statsToReport_,r)&&(t[r]=s,i=!0)}),i&&this.server_.reportStats(t),sa(this.reportStats_.bind(this),Math.floor(Math.random()*2*jA))}};var fn=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(fn||{});function Wp(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function $p(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Qp(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var ap=class n{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=fn.ACK_USER_WRITE,this.source=Wp()}operationForChild(e){if(se(this.path)){if(this.affectedTree.value!=null)return F(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new pe(e));return new n(me(),t,this.revert)}}else return F(re(this.path)===e,"operationForChild called for unrelated child."),new n(ve(this.path),this.affectedTree,this.revert)}};var ec=class n{constructor(e,t){this.source=e,this.path=t,this.type=fn.LISTEN_COMPLETE}operationForChild(e){return se(this.path)?new n(this.source,me()):new n(this.source,ve(this.path))}};var Es=class n{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=fn.OVERWRITE}operationForChild(e){return se(this.path)?new n(this.source,me(),this.snap.getImmediateChild(e)):new n(this.source,ve(this.path),this.snap)}};var _a=class n{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=fn.MERGE}operationForChild(e){if(se(this.path)){let t=this.children.subtree(new pe(e));return t.isEmpty()?null:t.value?new Es(this.source,me(),t.value):new n(this.source,me(),t)}else return F(re(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,ve(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var gn=class{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(se(e))return this.isFullyInitialized()&&!this.filtered_;let t=re(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var lp=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function GA(n,e,t,i){let r=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(VA(o.childName,o.snapshotNode))}),ra(n,r,"child_removed",e,i,t),ra(n,r,"child_added",e,i,t),ra(n,r,"child_moved",s,i,t),ra(n,r,"child_changed",e,i,t),ra(n,r,"value",e,i,t),r}function ra(n,e,t,i,r,s){let o=i.filter(a=>a.type===t);o.sort((a,u)=>KA(n,a,u)),o.forEach(a=>{let u=zA(n,a,s);r.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(u,n.query_))})})}function zA(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function KA(n,e,t){if(e.childName==null||t.childName==null)throw wr("Should only compare child_ events.");let i=new ae(e.childName,e.snapshotNode),r=new ae(t.childName,t.snapshotNode);return n.index_.compare(i,r)}function yc(n,e){return{eventCache:n,serverCache:e}}function aa(n,e,t,i){return yc(new gn(e,t,i),n.serverCache)}function bT(n,e,t,i){return yc(n.eventCache,new gn(e,t,i))}function tc(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function cr(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var Pm,WA=()=>(Pm||(Pm=new Ut(zS)),Pm),Et=class n{static fromObject(e){let t=new n(null);return et(e,(i,r)=>{t=t.set(new pe(i),r)}),t}constructor(e,t=WA()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:me(),value:this.value};if(se(e))return null;{let i=re(e),r=this.children.get(i);if(r!==null){let s=r.findRootMostMatchingPathAndValue(ve(e),t);return s!=null?{path:Ae(new pe(i),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(se(e))return this;{let t=re(e),i=this.children.get(t);return i!==null?i.subtree(ve(e)):new n(null)}}set(e,t){if(se(e))return new n(t,this.children);{let i=re(e),s=(this.children.get(i)||new n(null)).set(ve(e),t),o=this.children.insert(i,s);return new n(this.value,o)}}remove(e){if(se(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=re(e),i=this.children.get(t);if(i){let r=i.remove(ve(e)),s;return r.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,r),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(se(e))return this.value;{let t=re(e),i=this.children.get(t);return i?i.get(ve(e)):null}}setTree(e,t){if(se(e))return t;{let i=re(e),s=(this.children.get(i)||new n(null)).setTree(ve(e),t),o;return s.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,s),new n(this.value,o)}}fold(e){return this.fold_(me(),e)}fold_(e,t){let i={};return this.children.inorderTraversal((r,s)=>{i[r]=s.fold_(Ae(e,r),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,me(),t)}findOnPath_(e,t,i){let r=this.value?i(t,this.value):!1;if(r)return r;if(se(e))return null;{let s=re(e),o=this.children.get(s);return o?o.findOnPath_(ve(e),Ae(t,s),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,me(),t)}foreachOnPath_(e,t,i){if(se(e))return this;{this.value&&i(t,this.value);let r=re(e),s=this.children.get(r);return s?s.foreachOnPath_(ve(e),Ae(t,r),i):new n(null)}}foreach(e){this.foreach_(me(),e)}foreach_(e,t){this.children.inorderTraversal((i,r)=>{r.foreach_(Ae(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}};var Jt=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new Et(null))}};function la(n,e,t){if(se(e))return new Jt(new Et(t));{let i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){let r=i.path,s=i.value,o=wt(r,e);return s=s.updateChild(o,t),new Jt(n.writeTree_.set(r,s))}else{let r=new Et(t),s=n.writeTree_.setTree(e,r);return new Jt(s)}}}function up(n,e,t){let i=n;return et(t,(r,s)=>{i=la(i,Ae(e,r),s)}),i}function OI(n,e){if(se(e))return Jt.empty();{let t=n.writeTree_.setTree(e,new Et(null));return new Jt(t)}}function cp(n,e){return dr(n,e)!=null}function dr(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(wt(t.path,e)):null}function LI(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Ee,(i,r)=>{e.push(new ae(i,r))}):n.writeTree_.children.inorderTraversal((i,r)=>{r.value!=null&&e.push(new ae(i,r.value))}),e}function Ei(n,e){if(se(e))return n;{let t=dr(n,e);return t!=null?new Jt(new Et(t)):new Jt(n.writeTree_.subtree(e))}}function hp(n){return n.writeTree_.isEmpty()}function Is(n,e){return CT(me(),n.writeTree_,e)}function CT(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((r,s)=>{r===".priority"?(F(s.value!==null,"Priority writes must always be leaf nodes"),i=s.value):t=CT(Ae(n,r),s,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(Ae(n,".priority"),i)),t}}function vc(n,e){return RT(e,n)}function $A(n,e,t,i,r){F(i>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:r}),r&&(n.visibleWrites=la(n.visibleWrites,e,t)),n.lastWriteId=i}function QA(n,e,t,i){F(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=up(n.visibleWrites,e,t),n.lastWriteId=i}function HA(n,e){for(let t=0;t<n.allWrites.length;t++){let i=n.allWrites[t];if(i.writeId===e)return i}return null}function YA(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);F(t>=0,"removeWrite called with nonexistent writeId.");let i=n.allWrites[t];n.allWrites.splice(t,1);let r=i.visible,s=!1,o=n.allWrites.length-1;for(;r&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&JA(a,i.path)?r=!1:Mt(i.path,a.path)&&(s=!0)),o--}if(r){if(s)return XA(n),!0;if(i.snap)n.visibleWrites=OI(n.visibleWrites,i.path);else{let a=i.children;et(a,u=>{n.visibleWrites=OI(n.visibleWrites,Ae(i.path,u))})}return!0}else return!1}function JA(n,e){if(n.snap)return Mt(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&Mt(Ae(n.path,t),e))return!0;return!1}function XA(n){n.visibleWrites=ST(n.allWrites,ZA,me()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function ZA(n){return n.visible}function ST(n,e,t){let i=Jt.empty();for(let r=0;r<n.length;++r){let s=n[r];if(e(s)){let o=s.path,a;if(s.snap)Mt(t,o)?(a=wt(t,o),i=la(i,a,s.snap)):Mt(o,t)&&(a=wt(o,t),i=la(i,me(),s.snap.getChild(a)));else if(s.children){if(Mt(t,o))a=wt(t,o),i=up(i,a,s.children);else if(Mt(o,t))if(a=wt(o,t),se(a))i=up(i,me(),s.children);else{let u=Jn(s.children,re(a));if(u){let c=u.getChild(ve(a));i=la(i,me(),c)}}}else throw wr("WriteRecord should have .snap or .children")}}return i}function AT(n,e,t,i,r){if(!i&&!r){let s=dr(n.visibleWrites,e);if(s!=null)return s;{let o=Ei(n.visibleWrites,e);if(hp(o))return t;if(t==null&&!cp(o,me()))return null;{let a=t||te.EMPTY_NODE;return Is(o,a)}}}else{let s=Ei(n.visibleWrites,e);if(!r&&hp(s))return t;if(!r&&t==null&&!cp(s,me()))return null;{let o=function(c){return(c.visible||r)&&(!i||!~i.indexOf(c.writeId))&&(Mt(c.path,e)||Mt(e,c.path))},a=ST(n.allWrites,o,e),u=t||te.EMPTY_NODE;return Is(a,u)}}}function ex(n,e,t){let i=te.EMPTY_NODE,r=dr(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(Ee,(s,o)=>{i=i.updateImmediateChild(s,o)}),i;if(t){let s=Ei(n.visibleWrites,e);return t.forEachChild(Ee,(o,a)=>{let u=Is(Ei(s,new pe(o)),a);i=i.updateImmediateChild(o,u)}),LI(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let s=Ei(n.visibleWrites,e);return LI(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function tx(n,e,t,i,r){F(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=Ae(e,t);if(cp(n.visibleWrites,s))return null;{let o=Ei(n.visibleWrites,s);return hp(o)?r.getChild(t):Is(o,r.getChild(t))}}function nx(n,e,t,i){let r=Ae(e,t),s=dr(n.visibleWrites,r);if(s!=null)return s;if(i.isCompleteForChild(t)){let o=Ei(n.visibleWrites,r);return Is(o,i.getNode().getImmediateChild(t))}else return null}function ix(n,e){return dr(n.visibleWrites,e)}function rx(n,e,t,i,r,s,o){let a,u=Ei(n.visibleWrites,e),c=dr(u,me());if(c!=null)a=c;else if(t!=null)a=Is(u,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let d=[],m=o.getCompare(),p=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),y=p.getNext();for(;y&&d.length<r;)m(y,i)!==0&&d.push(y),y=p.getNext();return d}else return[]}function sx(){return{visibleWrites:Jt.empty(),allWrites:[],lastWriteId:-1}}function nc(n,e,t,i){return AT(n.writeTree,n.treePath,e,t,i)}function Hp(n,e){return ex(n.writeTree,n.treePath,e)}function MI(n,e,t,i){return tx(n.writeTree,n.treePath,e,t,i)}function ic(n,e){return ix(n.writeTree,Ae(n.treePath,e))}function ox(n,e,t,i,r,s){return rx(n.writeTree,n.treePath,e,t,i,r,s)}function Yp(n,e,t){return nx(n.writeTree,n.treePath,e,t)}function xT(n,e){return RT(Ae(n.treePath,e),n.writeTree)}function RT(n,e){return{treePath:n,writeTree:e}}var dp=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,i=e.childName;F(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),F(i!==".priority","Only non-priority child changes can be tracked.");let r=this.changeMap.get(i);if(r){let s=r.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(i,ma(i,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(i,fa(i,r.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(i,ws(i,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(i,ma(i,e.snapshotNode,r.oldSnap));else throw wr("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};var fp=class{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}},PT=new fp,ya=class{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new gn(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Yp(this.writes_,e,i)}}getChildAfterChild(e,t,i){let r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:cr(this.viewCache_),s=ox(this.writes_,r,t,1,i,e);return s.length===0?null:s[0]}};function ax(n){return{filter:n}}function lx(n,e){F(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),F(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function ux(n,e,t,i,r){let s=new dp,o,a;if(t.type===fn.OVERWRITE){let c=t;c.source.fromUser?o=mp(n,e,c.path,c.snap,i,r,s):(F(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!se(c.path),o=rc(n,e,c.path,c.snap,i,r,a,s))}else if(t.type===fn.MERGE){let c=t;c.source.fromUser?o=hx(n,e,c.path,c.children,i,r,s):(F(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=pp(n,e,c.path,c.children,i,r,a,s))}else if(t.type===fn.ACK_USER_WRITE){let c=t;c.revert?o=mx(n,e,c.path,i,r,s):o=dx(n,e,c.path,c.affectedTree,i,r,s)}else if(t.type===fn.LISTEN_COMPLETE)o=fx(n,e,t.path,i,s);else throw wr("Unknown operation type: "+t.type);let u=s.getChanges();return cx(e,o,u),{viewCache:o,changes:u}}function cx(n,e,t){let i=e.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=tc(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&t.push(TT(tc(e)))}}function kT(n,e,t,i,r,s){let o=e.eventCache;if(ic(i,t)!=null)return e;{let a,u;if(se(t))if(F(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=cr(e),d=c instanceof te?c:te.EMPTY_NODE,m=Hp(i,d);a=n.filter.updateFullNode(e.eventCache.getNode(),m,s)}else{let c=nc(i,cr(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,s)}else{let c=re(t);if(c===".priority"){F(bi(t)===1,"Can't have a priority with additional path components");let d=o.getNode();u=e.serverCache.getNode();let m=MI(i,t,d,u);m!=null?a=n.filter.updatePriority(d,m):a=o.getNode()}else{let d=ve(t),m;if(o.isCompleteForChild(c)){u=e.serverCache.getNode();let p=MI(i,t,o.getNode(),u);p!=null?m=o.getNode().getImmediateChild(c).updateChild(d,p):m=o.getNode().getImmediateChild(c)}else m=Yp(i,c,e.serverCache);m!=null?a=n.filter.updateChild(o.getNode(),c,m,d,r,s):a=o.getNode()}}return aa(e,a,o.isFullyInitialized()||se(t),n.filter.filtersNodes())}}function rc(n,e,t,i,r,s,o,a){let u=e.serverCache,c,d=o?n.filter:n.filter.getIndexedFilter();if(se(t))c=d.updateFullNode(u.getNode(),i,null);else if(d.filtersNodes()&&!u.isFiltered()){let y=u.getNode().updateChild(t,i);c=d.updateFullNode(u.getNode(),y,null)}else{let y=re(t);if(!u.isCompleteForPath(t)&&bi(t)>1)return e;let C=ve(t),k=u.getNode().getImmediateChild(y).updateChild(C,i);y===".priority"?c=d.updatePriority(u.getNode(),k):c=d.updateChild(u.getNode(),y,k,C,PT,null)}let m=bT(e,c,u.isFullyInitialized()||se(t),d.filtersNodes()),p=new ya(r,m,s);return kT(n,m,t,r,p,a)}function mp(n,e,t,i,r,s,o){let a=e.eventCache,u,c,d=new ya(r,e,s);if(se(t))c=n.filter.updateFullNode(e.eventCache.getNode(),i,o),u=aa(e,c,!0,n.filter.filtersNodes());else{let m=re(t);if(m===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),i),u=aa(e,c,a.isFullyInitialized(),a.isFiltered());else{let p=ve(t),y=a.getNode().getImmediateChild(m),C;if(se(p))C=i;else{let P=d.getCompleteChild(m);P!=null?qp(p)===".priority"&&P.getChild(_T(p)).isEmpty()?C=P:C=P.updateChild(p,i):C=te.EMPTY_NODE}if(y.equals(C))u=e;else{let P=n.filter.updateChild(a.getNode(),m,C,p,d,o);u=aa(e,P,a.isFullyInitialized(),n.filter.filtersNodes())}}}return u}function UI(n,e){return n.eventCache.isCompleteForChild(e)}function hx(n,e,t,i,r,s,o){let a=e;return i.foreach((u,c)=>{let d=Ae(t,u);UI(e,re(d))&&(a=mp(n,a,d,c,r,s,o))}),i.foreach((u,c)=>{let d=Ae(t,u);UI(e,re(d))||(a=mp(n,a,d,c,r,s,o))}),a}function BI(n,e,t){return t.foreach((i,r)=>{e=e.updateChild(i,r)}),e}function pp(n,e,t,i,r,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let u=e,c;se(t)?c=i:c=new Et(null).setTree(t,i);let d=e.serverCache.getNode();return c.children.inorderTraversal((m,p)=>{if(d.hasChild(m)){let y=e.serverCache.getNode().getImmediateChild(m),C=BI(n,y,p);u=rc(n,u,new pe(m),C,r,s,o,a)}}),c.children.inorderTraversal((m,p)=>{let y=!e.serverCache.isCompleteForChild(m)&&p.value===null;if(!d.hasChild(m)&&!y){let C=e.serverCache.getNode().getImmediateChild(m),P=BI(n,C,p);u=rc(n,u,new pe(m),P,r,s,o,a)}}),u}function dx(n,e,t,i,r,s,o){if(ic(r,t)!=null)return e;let a=e.serverCache.isFiltered(),u=e.serverCache;if(i.value!=null){if(se(t)&&u.isFullyInitialized()||u.isCompleteForPath(t))return rc(n,e,t,u.getNode().getChild(t),r,s,a,o);if(se(t)){let c=new Et(null);return u.getNode().forEachChild(mn,(d,m)=>{c=c.set(new pe(d),m)}),pp(n,e,t,c,r,s,a,o)}else return e}else{let c=new Et(null);return i.foreach((d,m)=>{let p=Ae(t,d);u.isCompleteForPath(p)&&(c=c.set(d,u.getNode().getChild(p)))}),pp(n,e,t,c,r,s,a,o)}}function fx(n,e,t,i,r){let s=e.serverCache,o=bT(e,s.getNode(),s.isFullyInitialized()||se(t),s.isFiltered());return kT(n,o,t,i,PT,r)}function mx(n,e,t,i,r,s){let o;if(ic(i,t)!=null)return e;{let a=new ya(i,e,r),u=e.eventCache.getNode(),c;if(se(t)||re(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=nc(i,cr(e));else{let m=e.serverCache.getNode();F(m instanceof te,"serverChildren would be complete if leaf node"),d=Hp(i,m)}d=d,c=n.filter.updateFullNode(u,d,s)}else{let d=re(t),m=Yp(i,d,e.serverCache);m==null&&e.serverCache.isCompleteForChild(d)&&(m=u.getImmediateChild(d)),m!=null?c=n.filter.updateChild(u,d,m,ve(t),a,s):e.eventCache.getNode().hasChild(d)?c=n.filter.updateChild(u,d,te.EMPTY_NODE,ve(t),a,s):c=u,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=nc(i,cr(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,s)))}return o=e.serverCache.isFullyInitialized()||ic(i,me())!=null,aa(e,c,o,n.filter.filtersNodes())}}var gp=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,r=new pa(i.getIndex()),s=FA(i);this.processor_=ax(s);let o=t.serverCache,a=t.eventCache,u=r.updateFullNode(te.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(te.EMPTY_NODE,a.getNode(),null),d=new gn(u,o.isFullyInitialized(),r.filtersNodes()),m=new gn(c,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=yc(m,d),this.eventGenerator_=new lp(this.query_)}get query(){return this.query_}};function px(n){return n.viewCache_.serverCache.getNode()}function gx(n){return tc(n.viewCache_)}function _x(n,e){let t=cr(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!se(e)&&!t.getImmediateChild(re(e)).isEmpty())?t.getChild(e):null}function qI(n){return n.eventRegistrations_.length===0}function yx(n,e){n.eventRegistrations_.push(e)}function jI(n,e,t){let i=[];if(t){F(e==null,"A cancel should cancel all event registrations.");let r=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,r);o&&i.push(o)})}if(e){let r=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=r}else n.eventRegistrations_=[];return i}function GI(n,e,t,i){e.type===fn.MERGE&&e.source.queryId!==null&&(F(cr(n.viewCache_),"We should always have a full cache before handling merges"),F(tc(n.viewCache_),"Missing event cache, even though we have a server cache"));let r=n.viewCache_,s=ux(n.processor_,r,e,t,i);return lx(n.processor_,s.viewCache),F(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,NT(n,s.changes,s.viewCache.eventCache.getNode(),null)}function vx(n,e){let t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Ee,(s,o)=>{i.push(ws(s,o))}),t.isFullyInitialized()&&i.push(TT(t.getNode())),NT(n,i,t.getNode(),e)}function NT(n,e,t,i){let r=i?[i]:n.eventRegistrations_;return GA(n.eventGenerator_,e,t,r)}var sc,oc=class{constructor(){this.views=new Map}};function wx(n){F(!sc,"__referenceConstructor has already been defined"),sc=n}function Ex(){return F(sc,"Reference.ts has not been loaded"),sc}function Ix(n){return n.views.size===0}function Jp(n,e,t,i){let r=e.source.queryId;if(r!==null){let s=n.views.get(r);return F(s!=null,"SyncTree gave us an op for an invalid query."),GI(s,e,t,i)}else{let s=[];for(let o of n.views.values())s=s.concat(GI(o,e,t,i));return s}}function DT(n,e,t,i,r){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=nc(t,r?i:null),u=!1;a?u=!0:i instanceof te?(a=Hp(t,i),u=!1):(a=te.EMPTY_NODE,u=!1);let c=yc(new gn(a,u,!1),new gn(i,r,!1));return new gp(e,c)}return o}function Tx(n,e,t,i,r,s){let o=DT(n,e,i,r,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),yx(o,t),vx(o,t)}function bx(n,e,t,i){let r=e._queryIdentifier,s=[],o=[],a=Ci(n);if(r==="default")for(let[u,c]of n.views.entries())o=o.concat(jI(c,t,i)),qI(c)&&(n.views.delete(u),c.query._queryParams.loadsAllData()||s.push(c.query));else{let u=n.views.get(r);u&&(o=o.concat(jI(u,t,i)),qI(u)&&(n.views.delete(r),u.query._queryParams.loadsAllData()||s.push(u.query)))}return a&&!Ci(n)&&s.push(new(Ex())(e._repo,e._path)),{removed:s,events:o}}function VT(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Ii(n,e){let t=null;for(let i of n.views.values())t=t||_x(i,e);return t}function FT(n,e){if(e._queryParams.loadsAllData())return wc(n);{let i=e._queryIdentifier;return n.views.get(i)}}function OT(n,e){return FT(n,e)!=null}function Ci(n){return wc(n)!=null}function wc(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var ac;function Cx(n){F(!ac,"__referenceConstructor has already been defined"),ac=n}function Sx(){return F(ac,"Reference.ts has not been loaded"),ac}var Ax=1,lc=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Et(null),this.pendingWriteTree_=sx(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Xp(n,e,t,i,r){return $A(n.pendingWriteTree_,e,t,i,r),r?As(n,new Es(Wp(),e,t)):[]}function xx(n,e,t,i){QA(n.pendingWriteTree_,e,t,i);let r=Et.fromObject(t);return As(n,new _a(Wp(),e,r))}function wi(n,e,t=!1){let i=HA(n.pendingWriteTree_,e);if(YA(n.pendingWriteTree_,e)){let s=new Et(null);return i.snap!=null?s=s.set(me(),!0):et(i.children,o=>{s=s.set(new pe(o),!0)}),As(n,new ap(i.path,s,t))}else return[]}function Aa(n,e,t){return As(n,new Es($p(),e,t))}function Rx(n,e,t){let i=Et.fromObject(t);return As(n,new _a($p(),e,i))}function Px(n,e){return As(n,new ec($p(),e))}function kx(n,e,t){let i=Zp(n,t);if(i){let r=eg(i),s=r.path,o=r.queryId,a=wt(s,e),u=new ec(Qp(o),a);return tg(n,s,u)}else return[]}function uc(n,e,t,i,r=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||OT(o,e))){let u=bx(o,e,t,i);Ix(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let c=u.removed;if(a=u.events,!r){let d=c.findIndex(p=>p._queryParams.loadsAllData())!==-1,m=n.syncPointTree_.findOnPath(s,(p,y)=>Ci(y));if(d&&!m){let p=n.syncPointTree_.subtree(s);if(!p.isEmpty()){let y=Vx(p);for(let C=0;C<y.length;++C){let P=y[C],k=P.query,G=BT(n,P);n.listenProvider_.startListening(ua(k),va(n,k),G.hashFn,G.onComplete)}}}!m&&c.length>0&&!i&&(d?n.listenProvider_.stopListening(ua(e),null):c.forEach(p=>{let y=n.queryToTagMap.get(Ic(p));n.listenProvider_.stopListening(ua(p),y)}))}Fx(n,c)}return a}function LT(n,e,t,i){let r=Zp(n,i);if(r!=null){let s=eg(r),o=s.path,a=s.queryId,u=wt(o,e),c=new Es(Qp(a),u,t);return tg(n,o,c)}else return[]}function Nx(n,e,t,i){let r=Zp(n,i);if(r){let s=eg(r),o=s.path,a=s.queryId,u=wt(o,e),c=Et.fromObject(t),d=new _a(Qp(a),u,c);return tg(n,o,d)}else return[]}function _p(n,e,t,i=!1){let r=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(r,(p,y)=>{let C=wt(p,r);s=s||Ii(y,C),o=o||Ci(y)});let a=n.syncPointTree_.get(r);a?(o=o||Ci(a),s=s||Ii(a,me())):(a=new oc,n.syncPointTree_=n.syncPointTree_.set(r,a));let u;s!=null?u=!0:(u=!1,s=te.EMPTY_NODE,n.syncPointTree_.subtree(r).foreachChild((y,C)=>{let P=Ii(C,me());P&&(s=s.updateImmediateChild(y,P))}));let c=OT(a,e);if(!c&&!e._queryParams.loadsAllData()){let p=Ic(e);F(!n.queryToTagMap.has(p),"View does not exist, but we have a tag");let y=Ox();n.queryToTagMap.set(p,y),n.tagToQueryMap.set(y,p)}let d=vc(n.pendingWriteTree_,r),m=Tx(a,e,t,d,s,u);if(!c&&!o&&!i){let p=FT(a,e);m=m.concat(Lx(n,e,p))}return m}function Ec(n,e,t){let r=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let u=wt(o,e),c=Ii(a,u);if(c)return c});return AT(r,e,s,t,!0)}function Dx(n,e){let t=e._path,i=null;n.syncPointTree_.foreachOnPath(t,(c,d)=>{let m=wt(c,t);i=i||Ii(d,m)});let r=n.syncPointTree_.get(t);r?i=i||Ii(r,me()):(r=new oc,n.syncPointTree_=n.syncPointTree_.set(t,r));let s=i!=null,o=s?new gn(i,!0,!1):null,a=vc(n.pendingWriteTree_,e._path),u=DT(r,e,a,s?o.getNode():te.EMPTY_NODE,s);return gx(u)}function As(n,e){return MT(e,n.syncPointTree_,null,vc(n.pendingWriteTree_,me()))}function MT(n,e,t,i){if(se(n.path))return UT(n,e,t,i);{let r=e.get(me());t==null&&r!=null&&(t=Ii(r,me()));let s=[],o=re(n.path),a=n.operationForChild(o),u=e.children.get(o);if(u&&a){let c=t?t.getImmediateChild(o):null,d=xT(i,o);s=s.concat(MT(a,u,c,d))}return r&&(s=s.concat(Jp(r,n,i,t))),s}}function UT(n,e,t,i){let r=e.get(me());t==null&&r!=null&&(t=Ii(r,me()));let s=[];return e.children.inorderTraversal((o,a)=>{let u=t?t.getImmediateChild(o):null,c=xT(i,o),d=n.operationForChild(o);d&&(s=s.concat(UT(d,a,u,c)))}),r&&(s=s.concat(Jp(r,n,i,t))),s}function BT(n,e){let t=e.query,i=va(n,t);return{hashFn:()=>(px(e)||te.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return i?kx(n,t._path,i):Px(n,t._path);{let s=$S(r,t);return uc(n,t,null,s)}}}}function va(n,e){let t=Ic(e);return n.queryToTagMap.get(t)}function Ic(n){return n._path.toString()+"$"+n._queryIdentifier}function Zp(n,e){return n.tagToQueryMap.get(e)}function eg(n){let e=n.indexOf("$");return F(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new pe(n.substr(0,e))}}function tg(n,e,t){let i=n.syncPointTree_.get(e);F(i,"Missing sync point for query tag that we're tracking");let r=vc(n.pendingWriteTree_,e);return Jp(i,t,r,null)}function Vx(n){return n.fold((e,t,i)=>{if(t&&Ci(t))return[wc(t)];{let r=[];return t&&(r=VT(t)),et(i,(s,o)=>{r=r.concat(o)}),r}})}function ua(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Sx())(n._repo,n._path):n}function Fx(n,e){for(let t=0;t<e.length;++t){let i=e[t];if(!i._queryParams.loadsAllData()){let r=Ic(i),s=n.queryToTagMap.get(r);n.queryToTagMap.delete(r),n.tagToQueryMap.delete(s)}}}function Ox(){return Ax++}function Lx(n,e,t){let i=e._path,r=va(n,e),s=BT(n,t),o=n.listenProvider_.startListening(ua(e),r,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(i);if(r)F(!Ci(a.value),"If we're adding a query, it shouldn't be shadowed");else{let u=a.fold((c,d,m)=>{if(!se(c)&&d&&Ci(d))return[wc(d).query];{let p=[];return d&&(p=p.concat(VT(d).map(y=>y.query))),et(m,(y,C)=>{p=p.concat(C)}),p}});for(let c=0;c<u.length;++c){let d=u[c];n.listenProvider_.stopListening(ua(d),va(n,d))}}return o}var yp=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},vp=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=Ae(this.path_,e);return new n(this.syncTree_,t)}node(){return Ec(this.syncTree_,this.path_)}},Mx=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},zI=function(n,e,t){if(!n||typeof n!="object")return n;if(F(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return Ux(n[".sv"],e,t);if(typeof n[".sv"]=="object")return Bx(n[".sv"],e);F(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},Ux=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:F(!1,"Unexpected server value: "+n)}},Bx=function(n,e,t){n.hasOwnProperty("increment")||F(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let i=n.increment;typeof i!="number"&&F(!1,"Unexpected increment value: "+i);let r=e.node();if(F(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let o=r.getValue();return typeof o!="number"?i:o+i},qT=function(n,e,t,i){return ig(e,new vp(t,n),i)},ng=function(n,e,t){return ig(n,new yp(e),t)};function ig(n,e,t){let i=n.getPriority().val(),r=zI(i,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=zI(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new ys(a,Pe(r)):n}else{let o=n;return s=o,r!==o.getPriority().val()&&(s=s.updatePriority(new ys(r))),o.forEachChild(Ee,(a,u)=>{let c=ig(u,e.getImmediateChild(a),t);c!==u&&(s=s.updateImmediateChild(a,c))}),s}}var wa=class{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}};function Tc(n,e){let t=e instanceof pe?e:new pe(e),i=n,r=re(t);for(;r!==null;){let s=Jn(i.node.children,r)||{children:{},childCount:0};i=new wa(r,i,s),t=ve(t),r=re(t)}return i}function fr(n){return n.node.value}function rg(n,e){n.node.value=e,wp(n)}function jT(n){return n.node.childCount>0}function qx(n){return fr(n)===void 0&&!jT(n)}function bc(n,e){et(n.node.children,(t,i)=>{e(new wa(t,n,i))})}function GT(n,e,t,i){t&&!i&&e(n),bc(n,r=>{GT(r,e,!0,i)}),t&&i&&e(n)}function jx(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function xa(n){return new pe(n.parent===null?n.name:xa(n.parent)+"/"+n.name)}function wp(n){n.parent!==null&&Gx(n.parent,n.name,n)}function Gx(n,e,t){let i=qx(t),r=Vt(n.node.children,e);i&&r?(delete n.node.children[e],n.node.childCount--,wp(n)):!i&&!r&&(n.node.children[e]=t.node,n.node.childCount++,wp(n))}var zx=/[\[\].#$\/\u0000-\u001F\u007F]/,Kx=/[\[\].#$\u0000-\u001F\u007F]/,km=10*1024*1024,Cc=function(n){return typeof n=="string"&&n.length!==0&&!zx.test(n)},zT=function(n){return typeof n=="string"&&n.length!==0&&!Kx.test(n)},Wx=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),zT(n)},Ea=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!gc(n)||n&&typeof n=="object"&&Vt(n,".sv")},_n=function(n,e,t,i){i&&e===void 0||Ra(Tt(n,"value"),e,t)},Ra=function(n,e,t){let i=t instanceof pe?new zm(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+ar(i));if(typeof e=="function")throw new Error(n+"contains a function "+ar(i)+" with contents = "+e.toString());if(gc(e))throw new Error(n+"contains "+e.toString()+" "+ar(i));if(typeof e=="string"&&e.length>km/3&&no(e)>km)throw new Error(n+"contains a string greater than "+km+" utf8 bytes "+ar(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,s=!1;if(et(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Cc(o)))throw new Error(n+" contains an invalid key ("+o+") "+ar(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);IA(i,o),Ra(n,a,i),TA(i)}),r&&s)throw new Error(n+' contains ".value" child '+ar(i)+" in addition to actual children.")}},$x=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];let s=ha(i);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!Cc(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(EA);let r=null;for(t=0;t<e.length;t++){if(i=e[t],r!==null&&Mt(r,i))throw new Error(n+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}},KT=function(n,e,t,i){if(i&&e===void 0)return;let r=Tt(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(r+" must be an object containing the children to replace.");let s=[];et(e,(o,a)=>{let u=new pe(o);if(Ra(r,a,Ae(t,u)),qp(u)===".priority"&&!Ea(a))throw new Error(r+"contains an invalid value for '"+u.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(u)}),$x(r,s)},sg=function(n,e,t){if(!(t&&e===void 0)){if(gc(e))throw new Error(Tt(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ea(e))throw new Error(Tt(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Pa=function(n,e,t,i){if(!(i&&t===void 0)&&!Cc(t))throw new Error(Tt(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},xs=function(n,e,t,i){if(!(i&&t===void 0)&&!zT(t))throw new Error(Tt(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Qx=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),xs(n,e,t,i)},Pt=function(n,e){if(re(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},WT=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Cc(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Wx(t))throw new Error(Tt(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Ep=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Sc(n,e){let t=null;for(let i=0;i<e.length;i++){let r=e[i],s=r.getPath();t!==null&&!jp(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(r)}t&&n.eventLists_.push(t)}function $T(n,e,t){Sc(n,t),QT(n,i=>jp(i,e))}function kt(n,e,t){Sc(n,t),QT(n,i=>Mt(i,e)||Mt(e,i))}function QT(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){let r=n.eventLists_[i];if(r){let s=r.path;e(s)?(Hx(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function Hx(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let i=t.getEventRunner();ur&&Ze("event: "+t.toString()),Cs(i)}}}var HT="repo_interrupt",Yx=25,Ip=class{constructor(e,t,i,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ep,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Zu(),this.transactionQueueTree_=new wa,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function Jx(n,e,t){if(n.stats_=Bp(n.repoInfo_),n.forceRestClient_||JS())n.server_=new tp(n.repoInfo_,(i,r,s,o)=>{KI(n,i,r,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>WI(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{je(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Gp(n.repoInfo_,e,(i,r,s,o)=>{KI(n,i,r,s,o)},i=>{WI(n,i)},i=>{Xx(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=ZS(n.repoInfo_,()=>new op(n.stats_,n.server_)),n.infoData_=new np,n.infoSyncTree_=new lc({startListening:(i,r,s,o)=>{let a=[],u=n.infoData_.getNode(i._path);return u.isEmpty()||(a=Aa(n.infoSyncTree_,i._path,u),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),og(n,"connected",!1),n.serverSyncTree_=new lc({startListening:(i,r,s,o)=>(n.server_.listen(i,s,r,(a,u)=>{let c=o(a,u);kt(n.eventQueue_,i._path,c)}),[]),stopListening:(i,r)=>{n.server_.unlisten(i,r)}})}function YT(n){let t=n.infoData_.getNode(new pe(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function ka(n){return Mx({timestamp:YT(n)})}function KI(n,e,t,i,r){n.dataUpdateCount++;let s=new pe(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(i){let u=to(t,c=>Pe(c));o=Nx(n.serverSyncTree_,s,u,r)}else{let u=Pe(t);o=LT(n.serverSyncTree_,s,u,r)}else if(i){let u=to(t,c=>Pe(c));o=Rx(n.serverSyncTree_,s,u)}else{let u=Pe(t);o=Aa(n.serverSyncTree_,s,u)}let a=s;o.length>0&&(a=Ts(n,s)),kt(n.eventQueue_,a,o)}function WI(n,e){og(n,"connected",e),e===!1&&tR(n)}function Xx(n,e){et(e,(t,i)=>{og(n,t,i)})}function og(n,e,t){let i=new pe("/.info/"+e),r=Pe(t);n.infoData_.updateSnapshot(i,r);let s=Aa(n.infoSyncTree_,i,r);kt(n.eventQueue_,i,s)}function Ac(n){return n.nextWriteId_++}function Zx(n,e,t){let i=Dx(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(r=>{let s=Pe(r).withIndex(e._queryParams.getIndex());_p(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Aa(n.serverSyncTree_,e._path,s);else{let a=va(n.serverSyncTree_,e);o=LT(n.serverSyncTree_,e._path,s,a)}return kt(n.eventQueue_,e._path,o),uc(n.serverSyncTree_,e,t,null,!0),s},r=>(Rs(n,"get for query "+je(e)+" failed: "+r),Promise.reject(new Error(r))))}function ag(n,e,t,i,r){Rs(n,"set",{path:e.toString(),value:t,priority:i});let s=ka(n),o=Pe(t,i),a=Ec(n.serverSyncTree_,e),u=ng(o,a,s),c=Ac(n),d=Xp(n.serverSyncTree_,e,u,c,!0);Sc(n.eventQueue_,d),n.server_.put(e.toString(),o.val(!0),(p,y)=>{let C=p==="ok";C||dt("set at "+e+" failed: "+p);let P=wi(n.serverSyncTree_,c,!C);kt(n.eventQueue_,e,P),Si(n,r,p,y)});let m=ug(n,e);Ts(n,m),kt(n.eventQueue_,m,[])}function eR(n,e,t,i){Rs(n,"update",{path:e.toString(),value:t});let r=!0,s=ka(n),o={};if(et(t,(a,u)=>{r=!1,o[a]=qT(Ae(e,a),Pe(u),n.serverSyncTree_,s)}),r)Ze("update() called with empty data.  Don't do anything."),Si(n,i,"ok",void 0);else{let a=Ac(n),u=xx(n.serverSyncTree_,e,o,a);Sc(n.eventQueue_,u),n.server_.merge(e.toString(),t,(c,d)=>{let m=c==="ok";m||dt("update at "+e+" failed: "+c);let p=wi(n.serverSyncTree_,a,!m),y=p.length>0?Ts(n,e):e;kt(n.eventQueue_,y,p),Si(n,i,c,d)}),et(t,c=>{let d=ug(n,Ae(e,c));Ts(n,d)}),kt(n.eventQueue_,e,[])}}function tR(n){Rs(n,"onDisconnectEvents");let e=ka(n),t=Zu();rp(n.onDisconnect_,me(),(r,s)=>{let o=qT(r,s,n.serverSyncTree_,e);Ss(t,r,o)});let i=[];rp(t,me(),(r,s)=>{i=i.concat(Aa(n.serverSyncTree_,r,s));let o=ug(n,r);Ts(n,o)}),n.onDisconnect_=Zu(),kt(n.eventQueue_,me(),i)}function nR(n,e,t){n.server_.onDisconnectCancel(e.toString(),(i,r)=>{i==="ok"&&ip(n.onDisconnect_,e),Si(n,t,i,r)})}function $I(n,e,t,i){let r=Pe(t);n.server_.onDisconnectPut(e.toString(),r.val(!0),(s,o)=>{s==="ok"&&Ss(n.onDisconnect_,e,r),Si(n,i,s,o)})}function iR(n,e,t,i,r){let s=Pe(t,i);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&Ss(n.onDisconnect_,e,s),Si(n,r,o,a)})}function rR(n,e,t,i){if(cl(t)){Ze("onDisconnect().update() called with empty data.  Don't do anything."),Si(n,i,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(r,s)=>{r==="ok"&&et(t,(o,a)=>{let u=Pe(a);Ss(n.onDisconnect_,Ae(e,o),u)}),Si(n,i,r,s)})}function sR(n,e,t){let i;re(e._path)===".info"?i=_p(n.infoSyncTree_,e,t):i=_p(n.serverSyncTree_,e,t),$T(n.eventQueue_,e._path,i)}function Tp(n,e,t){let i;re(e._path)===".info"?i=uc(n.infoSyncTree_,e,t):i=uc(n.serverSyncTree_,e,t),$T(n.eventQueue_,e._path,i)}function JT(n){n.persistentConnection_&&n.persistentConnection_.interrupt(HT)}function oR(n){n.persistentConnection_&&n.persistentConnection_.resume(HT)}function Rs(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Ze(t,...e)}function Si(n,e,t,i){e&&Cs(()=>{if(t==="ok")e(null);else{let r=(t||"error").toUpperCase(),s=r;i&&(s+=": "+i);let o=new Error(s);o.code=r,e(o)}})}function aR(n,e,t,i,r,s){Rs(n,"transaction on "+e);let o={path:e,update:t,onComplete:i,status:null,order:YI(),applyLocally:s,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=lg(n,e,void 0);o.currentInputSnapshot=a;let u=o.update(a.val());if(u===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Ra("transaction failed: Data returned ",u,o.path),o.status=0;let c=Tc(n.transactionQueueTree_,e),d=fr(c)||[];d.push(o),rg(c,d);let m;typeof u=="object"&&u!==null&&Vt(u,".priority")?(m=Jn(u,".priority"),F(Ea(m),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):m=(Ec(n.serverSyncTree_,e)||te.EMPTY_NODE).getPriority().val();let p=ka(n),y=Pe(u,m),C=ng(y,a,p);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=C,o.currentWriteId=Ac(n);let P=Xp(n.serverSyncTree_,e,C,o.currentWriteId,o.applyLocally);kt(n.eventQueue_,e,P),xc(n,n.transactionQueueTree_)}}function lg(n,e,t){return Ec(n.serverSyncTree_,e,t)||te.EMPTY_NODE}function xc(n,e=n.transactionQueueTree_){if(e||Rc(n,e),fr(e)){let t=ZT(n,e);F(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&lR(n,xa(e),t)}else jT(e)&&bc(e,t=>{xc(n,t)})}function lR(n,e,t){let i=t.map(c=>c.currentWriteId),r=lg(n,e,i),s=r,o=r.hash();for(let c=0;c<t.length;c++){let d=t[c];F(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let m=wt(e,d.path);s=s.updateChild(m,d.currentOutputSnapshotRaw)}let a=s.val(!0),u=e;n.server_.put(u.toString(),a,c=>{Rs(n,"transaction put response",{path:u.toString(),status:c});let d=[];if(c==="ok"){let m=[];for(let p=0;p<t.length;p++)t[p].status=2,d=d.concat(wi(n.serverSyncTree_,t[p].currentWriteId)),t[p].onComplete&&m.push(()=>t[p].onComplete(null,!0,t[p].currentOutputSnapshotResolved)),t[p].unwatcher();Rc(n,Tc(n.transactionQueueTree_,e)),xc(n,n.transactionQueueTree_),kt(n.eventQueue_,e,d);for(let p=0;p<m.length;p++)Cs(m[p])}else{if(c==="datastale")for(let m=0;m<t.length;m++)t[m].status===3?t[m].status=4:t[m].status=0;else{dt("transaction at "+u.toString()+" failed: "+c);for(let m=0;m<t.length;m++)t[m].status=4,t[m].abortReason=c}Ts(n,e)}},o)}function Ts(n,e){let t=XT(n,e),i=xa(t),r=ZT(n,t);return uR(n,r,i),i}function uR(n,e,t){if(e.length===0)return;let i=[],r=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let u=e[a],c=wt(t,u.path),d=!1,m;if(F(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===4)d=!0,m=u.abortReason,r=r.concat(wi(n.serverSyncTree_,u.currentWriteId,!0));else if(u.status===0)if(u.retryCount>=Yx)d=!0,m="maxretry",r=r.concat(wi(n.serverSyncTree_,u.currentWriteId,!0));else{let p=lg(n,u.path,o);u.currentInputSnapshot=p;let y=e[a].update(p.val());if(y!==void 0){Ra("transaction failed: Data returned ",y,u.path);let C=Pe(y);typeof y=="object"&&y!=null&&Vt(y,".priority")||(C=C.updatePriority(p.getPriority()));let k=u.currentWriteId,G=ka(n),K=ng(C,p,G);u.currentOutputSnapshotRaw=C,u.currentOutputSnapshotResolved=K,u.currentWriteId=Ac(n),o.splice(o.indexOf(k),1),r=r.concat(Xp(n.serverSyncTree_,u.path,K,u.currentWriteId,u.applyLocally)),r=r.concat(wi(n.serverSyncTree_,k,!0))}else d=!0,m="nodata",r=r.concat(wi(n.serverSyncTree_,u.currentWriteId,!0))}kt(n.eventQueue_,t,r),r=[],d&&(e[a].status=2,function(p){setTimeout(p,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(m==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(m),!1,null))))}Rc(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)Cs(i[a]);xc(n,n.transactionQueueTree_)}function XT(n,e){let t,i=n.transactionQueueTree_;for(t=re(e);t!==null&&fr(i)===void 0;)i=Tc(i,t),e=ve(e),t=re(e);return i}function ZT(n,e){let t=[];return e0(n,e,t),t.sort((i,r)=>i.order-r.order),t}function e0(n,e,t){let i=fr(e);if(i)for(let r=0;r<i.length;r++)t.push(i[r]);bc(e,r=>{e0(n,r,t)})}function Rc(n,e){let t=fr(e);if(t){let i=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[i]=t[r],i++);t.length=i,rg(e,t.length>0?t:void 0)}bc(e,i=>{Rc(n,i)})}function ug(n,e){let t=xa(XT(n,e)),i=Tc(n.transactionQueueTree_,e);return jx(i,r=>{Nm(n,r)}),Nm(n,i),GT(i,r=>{Nm(n,r)}),t}function Nm(n,e){let t=fr(e);if(t){let i=[],r=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(F(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(F(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(wi(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?rg(e,void 0):t.length=s+1,kt(n.eventQueue_,xa(e),r);for(let o=0;o<i.length;o++)Cs(i[o])}}function cR(n){let e="",t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let r=t[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function hR(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):dt(`Invalid query segment '${t}' in query '${n}'`)}return e}var bp=function(n,e){let t=dR(n),i=t.namespace;t.domain==="firebase.com"&&pn(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&pn("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||jS();let r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Ku(t.host,t.secure,i,r,e,"",i!==t.subdomain),path:new pe(t.pathString)}},dR=function(n){let e="",t="",i="",r="",s="",o=!0,a="https",u=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let d=n.indexOf("/");d===-1&&(d=n.length);let m=n.indexOf("?");m===-1&&(m=n.length),e=n.substring(0,Math.min(d,m)),d<m&&(r=cR(n.substring(d,m)));let p=hR(n.substring(Math.min(n.length,m)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",u=parseInt(e.substring(c+1),10)):c=e.length;let y=e.slice(0,c);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{let C=e.indexOf(".");i=e.substring(0,C).toLowerCase(),t=e.substring(C+1),s=i}"ns"in p&&(s=p.ns)}return{host:e,port:u,domain:t,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};var QI="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",fR=function(){let n=0,e=[];return function(t){let i=t===n;n=t;let r,s=new Array(8);for(r=7;r>=0;r--)s[r]=QI.charAt(t%64),t=Math.floor(t/64);F(t===0,"Cannot push at time == 0");let o=s.join("");if(i){for(r=11;r>=0&&e[r]===63;r--)e[r]=0;e[r]++}else for(r=0;r<12;r++)e[r]=Math.floor(Math.random()*64);for(r=0;r<12;r++)o+=QI.charAt(e[r]);return F(o.length===20,"nextPushId: Length should be 20."),o}}();var cc=class{constructor(e,t,i,r){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=r}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+je(this.snapshot.exportVal())}},hc=class{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Ia=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return F(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var dc=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new _t;return nR(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Pt("OnDisconnect.remove",this._path);let e=new _t;return $I(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Pt("OnDisconnect.set",this._path),_n("OnDisconnect.set",e,this._path,!1);let t=new _t;return $I(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Pt("OnDisconnect.setWithPriority",this._path),_n("OnDisconnect.setWithPriority",e,this._path,!1),sg("OnDisconnect.setWithPriority",t,!1);let i=new _t;return iR(this._repo,this._path,e,t,i.wrapCallback(()=>{})),i.promise}update(e){Pt("OnDisconnect.update",this._path),KT("OnDisconnect.update",e,this._path,!1);let t=new _t;return rR(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var It=class n{constructor(e,t,i,r){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=r}get key(){return se(this._path)?null:qp(this._path)}get ref(){return new Nt(this._repo,this._path)}get _queryIdentifier(){let e=VI(this._queryParams),t=Up(e);return t==="{}"?"default":t}get _queryObject(){return VI(this._queryParams)}isEqual(e){if(e=le(e),!(e instanceof n))return!1;let t=this._repo===e._repo,i=jp(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&i&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+wA(this._path)}};function Pc(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function xi(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===mn){let i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Ti)throw new Error(i);if(typeof e!="string")throw new Error(r)}if(n.hasEnd()){if(n.getIndexEndName()!==Fn)throw new Error(i);if(typeof t!="string")throw new Error(r)}}else if(n.getIndex()===Ee){if(e!=null&&!Ea(e)||t!=null&&!Ea(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(F(n.getIndex()instanceof da||n.getIndex()===Kp,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function kc(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var Nt=class n extends It{constructor(e,t){super(e,t,new ga,!1)}get parent(){let e=_T(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},bs=class n{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new pe(e),i=Ai(this.ref,e);return new n(this._node.getChild(t),i,Ee)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,r)=>e(new n(r,Ai(this.ref,i),Ee)))}hasChild(e){let t=new pe(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function cg(n,e){return n=le(n),n._checkNotDeleted("ref"),e!==void 0?Ai(n._root,e):n._root}function hg(n,e){n=le(n),n._checkNotDeleted("refFromURL");let t=bp(e,n._repo.repoInfo_.nodeAdmin);WT("refFromURL",t);let i=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&pn("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),cg(n,t.path.toString())}function Ai(n,e){return n=le(n),re(n._path)===null?Qx("child","path",e,!1):xs("child","path",e,!1),new Nt(n._repo,Ae(n._path,e))}function t0(n,e){n=le(n),Pt("push",n._path),_n("push",e,n._path,!0);let t=YT(n._repo),i=fR(t),r=Ai(n,i),s=Ai(n,i),o;return e!=null?o=Nc(s,e).then(()=>s):o=Promise.resolve(s),r.then=o.then.bind(o),r.catch=o.then.bind(o,void 0),r}function n0(n){return Pt("remove",n._path),Nc(n,null)}function Nc(n,e){n=le(n),Pt("set",n._path),_n("set",e,n._path,!1);let t=new _t;return ag(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function i0(n,e){n=le(n),Pt("setPriority",n._path),sg("setPriority",e,!1);let t=new _t;return ag(n._repo,Ae(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function r0(n,e,t){if(Pt("setWithPriority",n._path),_n("setWithPriority",e,n._path,!1),sg("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let i=new _t;return ag(n._repo,n._path,e,t,i.wrapCallback(()=>{})),i.promise}function s0(n,e){KT("update",e,n._path,!1);let t=new _t;return eR(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function o0(n){n=le(n);let e=new Ia(()=>{}),t=new Ta(e);return Zx(n._repo,n,t).then(i=>new bs(i,new Nt(n._repo,n._path),n._queryParams.getIndex()))}var Ta=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let i=t._queryParams.getIndex();return new cc("value",this,new bs(e.snapshotNode,new Nt(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new hc(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},fc=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new hc(this,e,t):null}createEvent(e,t){F(e.childName!=null,"Child events should have a childName.");let i=Ai(new Nt(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new cc(e.type,this,new bs(e.snapshotNode,i,r),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function Na(n,e,t,i,r){let s;if(typeof i=="object"&&(s=void 0,r=i),typeof i=="function"&&(s=i),r&&r.onlyOnce){let u=t,c=(d,m)=>{Tp(n._repo,n,a),u(d,m)};c.userCallback=t.userCallback,c.context=t.context,t=c}let o=new Ia(t,s||void 0),a=e==="value"?new Ta(o):new fc(e,o);return sR(n._repo,n,a),()=>Tp(n._repo,n,a)}function Dc(n,e,t,i){return Na(n,"value",e,t,i)}function dg(n,e,t,i){return Na(n,"child_added",e,t,i)}function fg(n,e,t,i){return Na(n,"child_changed",e,t,i)}function mg(n,e,t,i){return Na(n,"child_moved",e,t,i)}function pg(n,e,t,i){return Na(n,"child_removed",e,t,i)}function gg(n,e,t){let i=null,r=t?new Ia(t):null;e==="value"?i=new Ta(r):e&&(i=new fc(e,r)),Tp(n._repo,n,i)}var Dt=class{},mc=class extends Dt{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){_n("endAt",this._value,e._path,!0);let t=ep(e._queryParams,this._value,this._key);if(kc(t),xi(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new It(e._repo,e._path,t,e._orderByCalled)}};function a0(n,e){return Pa("endAt","key",e,!0),new mc(n,e)}var Cp=class extends Dt{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){_n("endBefore",this._value,e._path,!1);let t=UA(e._queryParams,this._value,this._key);if(kc(t),xi(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new It(e._repo,e._path,t,e._orderByCalled)}};function l0(n,e){return Pa("endBefore","key",e,!0),new Cp(n,e)}var pc=class extends Dt{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){_n("startAt",this._value,e._path,!0);let t=Zm(e._queryParams,this._value,this._key);if(kc(t),xi(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new It(e._repo,e._path,t,e._orderByCalled)}};function u0(n=null,e){return Pa("startAt","key",e,!0),new pc(n,e)}var Sp=class extends Dt{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){_n("startAfter",this._value,e._path,!1);let t=MA(e._queryParams,this._value,this._key);if(kc(t),xi(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new It(e._repo,e._path,t,e._orderByCalled)}};function c0(n,e){return Pa("startAfter","key",e,!0),new Sp(n,e)}var Ap=class extends Dt{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new It(e._repo,e._path,OA(e._queryParams,this._limit),e._orderByCalled)}};function h0(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Ap(n)}var xp=class extends Dt{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new It(e._repo,e._path,LA(e._queryParams,this._limit),e._orderByCalled)}};function d0(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new xp(n)}var Rp=class extends Dt{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Pc(e,"orderByChild");let t=new pe(this._path);if(se(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let i=new da(t),r=_c(e._queryParams,i);return xi(r),new It(e._repo,e._path,r,!0)}};function f0(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return xs("orderByChild","path",n,!1),new Rp(n)}var Pp=class extends Dt{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Pc(e,"orderByKey");let t=_c(e._queryParams,mn);return xi(t),new It(e._repo,e._path,t,!0)}};function m0(){return new Pp}var kp=class extends Dt{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Pc(e,"orderByPriority");let t=_c(e._queryParams,Ee);return xi(t),new It(e._repo,e._path,t,!0)}};function p0(){return new kp}var Np=class extends Dt{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Pc(e,"orderByValue");let t=_c(e._queryParams,Kp);return xi(t),new It(e._repo,e._path,t,!0)}};function g0(){return new Np}var Dp=class extends Dt{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(_n("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new mc(this._value,this._key)._apply(new pc(this._value,this._key)._apply(e))}};function _0(n,e){return Pa("equalTo","key",e,!0),new Dp(n,e)}function Bt(n,...e){let t=le(n);for(let i of e)t=i._apply(t);return t}wx(Nt);Cx(Nt);var mR="FIREBASE_DATABASE_EMULATOR_HOST",Vp={},pR=!1;function gR(n,e,t,i){n.repoInfo_=new Ku(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}function _g(n,e,t,i,r){let s=i||n.options.databaseURL;s===void 0&&(n.options.projectId||pn("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ze("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=bp(s,r),a=o.repoInfo,u,c;typeof process<"u"&&process.env&&(c=process.env[mR]),c?(u=!0,s=`http://${c}?ns=${a.namespace}`,o=bp(s,r),a=o.repoInfo):u=!o.repoInfo.secure;let d=r&&u?new oa(oa.OWNER):new Mm(n.name,n.options,e);WT("Invalid Firebase Database URL",o),se(o.path)||pn("Database URL must point to the root of a Firebase Database (not including a child path).");let m=yR(a,n,d,new Lm(n.name,t));return new Fp(m,n)}function _R(n,e){let t=Vp[e];(!t||t[n.key]!==n)&&pn(`Database ${e}(${n.repoInfo_}) has already been deleted.`),JT(n),delete t[n.key]}function yR(n,e,t,i){let r=Vp[e.name];r||(r={},Vp[e.name]=r);let s=r[n.toURLString()];return s&&pn("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new Ip(n,pR,t,i),r[n.toURLString()]=s,s}var Fp=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Jx(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Nt(this._repo,me())),this._rootInternal}_delete(){return this._rootInternal!==null&&(_R(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&pn("Cannot call "+e+" on a deleted database.")}};function y0(){gT.IS_TRANSPORT_INITIALIZED&&dt("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function v0(){y0(),ca.forceDisallow()}function w0(){y0(),ms.forceDisallow(),ca.forceAllow()}function E0(n,e,t,i={}){n=le(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&pn("Cannot call useEmulator() after instance has already been initialized.");let r=n._repoInternal,s;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&pn('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new oa(oa.OWNER);else if(i.mockUserToken){let o=typeof i.mockUserToken=="string"?i.mockUserToken:ll(i.mockUserToken,n.app.options.projectId);s=new oa(o)}gR(r,e,t,s)}function I0(n){n=le(n),n._checkNotDeleted("goOffline"),JT(n._repo)}function T0(n){n=le(n),n._checkNotDeleted("goOnline"),oR(n._repo)}function b0(n,e){XI(n,e)}function vR(n){Mp(fl),dl(new nn("database",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return _g(i,r,s,t)},"PUBLIC").setMultipleInstances(!0)),Ir(_I,yI,n),Ir(_I,yI,"esm2017")}var wR={".sv":"timestamp"};function C0(){return wR}function S0(n){return{".sv":{increment:n}}}var Op=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function A0(n,e,t){var i;if(n=le(n),Pt("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let r=(i=t?.applyLocally)!==null&&i!==void 0?i:!0,s=new _t,o=(u,c,d)=>{let m=null;u?s.reject(u):(m=new bs(d,new Nt(n._repo,n._path),Ee),s.resolve(new Op(c,m)))},a=Dc(n,()=>{});return aR(n._repo,n._path,e,o,a,r),s.promise}Gp.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Gp.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};vR();var ER="@firebase/database-compat",IR="2.0.2";var TR=new Er("@firebase/database-compat"),x0=function(n){let e="FIREBASE WARNING: "+n;TR.warn(e)};var bR=function(n,e,t,i){if(!(i&&t===void 0)&&typeof t!="boolean")throw new Error(Tt(n,e)+"must be a boolean.")},CR=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Tt(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var yg=class{constructor(e){this._delegate=e}cancel(e){H("OnDisconnect.cancel",0,1,arguments.length),$e("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),i=>e(i)),t}remove(e){H("OnDisconnect.remove",0,1,arguments.length),$e("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),i=>e(i)),t}set(e,t){H("OnDisconnect.set",1,2,arguments.length),$e("OnDisconnect.set","onComplete",t,!0);let i=this._delegate.set(e);return t&&i.then(()=>t(null),r=>t(r)),i}setWithPriority(e,t,i){H("OnDisconnect.setWithPriority",2,3,arguments.length),$e("OnDisconnect.setWithPriority","onComplete",i,!0);let r=this._delegate.setWithPriority(e,t);return i&&r.then(()=>i(null),s=>i(s)),r}update(e,t){if(H("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let r={};for(let s=0;s<e.length;++s)r[""+s]=e[s];e=r,x0("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}$e("OnDisconnect.update","onComplete",t,!0);let i=this._delegate.update(e);return t&&i.then(()=>t(null),r=>t(r)),i}};var vg=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return H("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var mr=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return H("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return H("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return H("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return H("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return H("DataSnapshot.child",0,1,arguments.length),e=String(e),xs("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return H("DataSnapshot.hasChild",1,1,arguments.length),xs("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return H("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return H("DataSnapshot.forEach",1,1,arguments.length),$e("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return H("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return H("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return H("DataSnapshot.ref",0,0,arguments.length),new On(this._database,this._delegate.ref)}get ref(){return this.getRef()}},Vc=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,r){var s;H("Query.on",2,4,arguments.length),$e("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",i,r),a=(c,d)=>{t.call(o.context,new mr(this.database,c),d)};a.userCallback=t,a.context=o.context;let u=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return Dc(this._delegate,a,u),t;case"child_added":return dg(this._delegate,a,u),t;case"child_removed":return pg(this._delegate,a,u),t;case"child_changed":return fg(this._delegate,a,u),t;case"child_moved":return mg(this._delegate,a,u),t;default:throw new Error(Tt("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if(H("Query.off",0,3,arguments.length),CR("Query.off",e,!0),$e("Query.off","callback",t,!0),_h("Query.off","context",i,!0),t){let r=()=>{};r.userCallback=t,r.context=i,gg(this._delegate,e,r)}else gg(this._delegate,e)}get(){return o0(this._delegate).then(e=>new mr(this.database,e))}once(e,t,i,r){H("Query.once",1,4,arguments.length),$e("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",i,r),o=new _t,a=(c,d)=>{let m=new mr(this.database,c);t&&t.call(s.context,m,d),o.resolve(m)};a.userCallback=t,a.context=s.context;let u=c=>{s.cancel&&s.cancel.call(s.context,c),o.reject(c)};switch(e){case"value":Dc(this._delegate,a,u,{onlyOnce:!0});break;case"child_added":dg(this._delegate,a,u,{onlyOnce:!0});break;case"child_removed":pg(this._delegate,a,u,{onlyOnce:!0});break;case"child_changed":fg(this._delegate,a,u,{onlyOnce:!0});break;case"child_moved":mg(this._delegate,a,u,{onlyOnce:!0});break;default:throw new Error(Tt("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return H("Query.limitToFirst",1,1,arguments.length),new n(this.database,Bt(this._delegate,h0(e)))}limitToLast(e){return H("Query.limitToLast",1,1,arguments.length),new n(this.database,Bt(this._delegate,d0(e)))}orderByChild(e){return H("Query.orderByChild",1,1,arguments.length),new n(this.database,Bt(this._delegate,f0(e)))}orderByKey(){return H("Query.orderByKey",0,0,arguments.length),new n(this.database,Bt(this._delegate,m0()))}orderByPriority(){return H("Query.orderByPriority",0,0,arguments.length),new n(this.database,Bt(this._delegate,p0()))}orderByValue(){return H("Query.orderByValue",0,0,arguments.length),new n(this.database,Bt(this._delegate,g0()))}startAt(e=null,t){return H("Query.startAt",0,2,arguments.length),new n(this.database,Bt(this._delegate,u0(e,t)))}startAfter(e=null,t){return H("Query.startAfter",0,2,arguments.length),new n(this.database,Bt(this._delegate,c0(e,t)))}endAt(e=null,t){return H("Query.endAt",0,2,arguments.length),new n(this.database,Bt(this._delegate,a0(e,t)))}endBefore(e=null,t){return H("Query.endBefore",0,2,arguments.length),new n(this.database,Bt(this._delegate,l0(e,t)))}equalTo(e,t){return H("Query.equalTo",1,2,arguments.length),new n(this.database,Bt(this._delegate,_0(e,t)))}toString(){return H("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return H("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(H("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){let r={cancel:void 0,context:void 0};if(t&&i)r.cancel=t,$e(e,"cancel",r.cancel,!0),r.context=i,_h(e,"context",r.context,!0);else if(t)if(typeof t=="object"&&t!==null)r.context=t;else if(typeof t=="function")r.cancel=t;else throw new Error(Tt(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return r}get ref(){return new On(this.database,new Nt(this._delegate._repo,this._delegate._path))}},On=class n extends Vc{constructor(e,t){super(e,new It(t._repo,t._path,new ga,!1)),this.database=e,this._delegate=t}getKey(){return H("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return H("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,Ai(this._delegate,e))}getParent(){H("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return H("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){H("Reference.set",1,2,arguments.length),$e("Reference.set","onComplete",t,!0);let i=Nc(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}update(e,t){if(H("Reference.update",1,2,arguments.length),Array.isArray(e)){let r={};for(let s=0;s<e.length;++s)r[""+s]=e[s];e=r,x0("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Pt("Reference.update",this._delegate._path),$e("Reference.update","onComplete",t,!0);let i=s0(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}setWithPriority(e,t,i){H("Reference.setWithPriority",2,3,arguments.length),$e("Reference.setWithPriority","onComplete",i,!0);let r=r0(this._delegate,e,t);return i&&r.then(()=>i(null),s=>i(s)),r}remove(e){H("Reference.remove",0,1,arguments.length),$e("Reference.remove","onComplete",e,!0);let t=n0(this._delegate);return e&&t.then(()=>e(null),i=>e(i)),t}transaction(e,t,i){H("Reference.transaction",1,3,arguments.length),$e("Reference.transaction","transactionUpdate",e,!1),$e("Reference.transaction","onComplete",t,!0),bR("Reference.transaction","applyLocally",i,!0);let r=A0(this._delegate,e,{applyLocally:i}).then(s=>new vg(s.committed,new mr(this.database,s.snapshot)));return t&&r.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),r}setPriority(e,t){H("Reference.setPriority",1,2,arguments.length),$e("Reference.setPriority","onComplete",t,!0);let i=i0(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}push(e,t){H("Reference.push",0,2,arguments.length),$e("Reference.push","onComplete",t,!0);let i=t0(this._delegate,e),r=i.then(o=>new n(this.database,o));t&&r.then(()=>t(null),o=>t(o));let s=new n(this.database,i);return s.then=r.then.bind(r),s.catch=r.catch.bind(r,void 0),s}onDisconnect(){return Pt("Reference.onDisconnect",this._delegate._path),new yg(new dc(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var pr=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:v0,forceLongPolling:w0}}useEmulator(e,t,i={}){E0(this._delegate,e,t,i)}ref(e){if(H("database.ref",0,1,arguments.length),e instanceof On){let t=hg(this._delegate,e.toString());return new On(this,t)}else{let t=cg(this._delegate,e);return new On(this,t)}}refFromURL(e){H("database.refFromURL",1,1,arguments.length);let i=hg(this._delegate,e);return new On(this,i)}goOffline(){return H("database.goOffline",0,0,arguments.length),I0(this._delegate)}goOnline(){return H("database.goOnline",0,0,arguments.length),T0(this._delegate)}};pr.ServerValue={TIMESTAMP:C0(),increment:n=>S0(n)};function SR({app:n,url:e,version:t,customAuthImpl:i,customAppCheckImpl:r,namespace:s,nodeAdmin:o=!1}){Mp(t);let a=new yh("database-standalone"),u=new hl("auth-internal",a);u.setComponent(new nn("auth-internal",()=>i,"PRIVATE"));let c;return r&&(c=new hl("app-check-internal",a),c.setComponent(new nn("app-check-internal",()=>r,"PRIVATE"))),{instance:new pr(_g(n,u,c,e,o),n),namespace:s}}var AR=Object.freeze({__proto__:null,initStandalone:SR});var xR=pr.ServerValue;function RR(n){n.INTERNAL.registerComponent(new nn("database-compat",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new pr(r,i)},"PUBLIC").setServiceProps({Reference:On,Query:Vc,Database:pr,DataSnapshot:mr,enableLogging:b0,INTERNAL:AR,ServerValue:xR}).setMultipleInstances(!0)),n.registerVersion(ER,IR)}RR(Qe);function Da(n,e,t="on",i=Ja){return new Di(r=>{let s=null;return s=n[t](e,(o,a)=>{i.schedule(()=>{r.next({snapshot:o,prevKey:a})}),t==="once"&&i.schedule(()=>r.complete())},o=>{i.schedule(()=>r.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(Ne(r=>{let{snapshot:s,prevKey:o}=r,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),I_())}function PR(n){return typeof n=="string"}function kR(n){return typeof n.exportVal=="function"}function D0(n){return n==null}function V0(n){return typeof n.set=="function"}function R0(n,e){return V0(e)?e:n.ref(e)}function F0(n,e){if(PR(n))return e.stringCase();if(V0(n))return e.firebaseCase();if(kR(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function O0(n){return(D0(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function L0(n,e,t){e=O0(e);let i=e.map(r=>Da(n,r,"on",t));return Js(...i)}function NR(n,e,t){let i=L0(n,e).pipe(Vi((r,s)=>[...r,s],[]));return VR(n,i,t)}function DR(n,e){return Da(n,"value","on",e).pipe(Ne(t=>{let i;return t.payload.forEach(r=>(i=r.key,!1)),{data:t,lastKeyToLoad:i}}))}function VR(n,e,t){return DR(n,t).pipe(b_(e),Ne(([r,s])=>{let o=r.lastKeyToLoad,a=s.map(u=>u.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),T_(r=>r.loadedKeys.indexOf(r.lastKeyToLoad)===-1),Ne(r=>r.actions))}function P0(n,e){return function(i,r){return F0(i,{stringCase:()=>n.child(i)[e](r),firebaseCase:()=>i[e](r),snapshotCase:()=>i.ref[e](r)})}}function FR(n){return function(t){return t?F0(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function OR(n,e,t){return Da(n,"value","once",t).pipe(En(i=>{let r=[Xt(i)];return e.forEach(s=>r.push(Da(n,s,"on",t))),Js(...r).pipe(Vi(MR,[]))}),Za())}function M0(n,e){let t=n.length;for(let i=0;i<t;i++)if(n[i].payload.key===e)return i;return-1}function LR(n,e){if(D0(e))return 0;{let t=M0(n,e);return t===-1?n.length:t+1}}function MR(n,e){let{payload:t,prevKey:i,key:r}=e,s=M0(n,r),o=LR(n,i);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(u=>{let c={payload:u,type:"value",prevKey:a,key:u.key};return a=u.key,n=[...n,c],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==i&&(n=n.filter(u=>u.payload.key!==t.key),n.splice(o,0,e));else{if(i==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===r?e:a);case"child_moved":if(s>-1){let a=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function k0(n,e,t){return e=O0(e),OR(n,e,t)}function UR(n,e,t){let i=e.schedulers.outsideAngular,r=At(pt).run(()=>n.ref);return{query:n,update:P0(r,"update"),set:P0(r,"set"),push:s=>r.push(s),remove:FR(r),snapshotChanges(s){return k0(n,s,i).pipe(Fe(t))},stateChanges(s){return L0(n,s,i).pipe(Fe(t))},auditTrail(s){return NR(n,s,i).pipe(Fe(t))},valueChanges(s,o){return k0(n,s,i).pipe(Ne(u=>u.map(c=>o&&o.idField?jt(Je({},c.payload.val()),{[o.idField]:c.key}):c.payload.val())),Fe(t))}}}function N0(n,e){return function(){return Da(n,"value","on",e)}}function BR(n,e,t){return{query:n,snapshotChanges(){return N0(n,e.schedulers.outsideAngular)().pipe(Fe(t))},update(i){return n.ref.update(i)},set(i){return n.ref.set(i)},remove(){return n.ref.remove()},valueChanges(){return N0(n,e.schedulers.outsideAngular)().pipe(Fe(t),Ne(r=>r.payload.exists()?r.payload.val():null))}}}var qR=new Xe("angularfire2.realtimeDatabaseURL"),jR=new Xe("angularfire2.database.use-emulator"),GR=(()=>{class n{schedulers;database;injector=At(zn);constructor(t,i,r,s,o,a,u,c,d,m,p,y,C,P,k){this.schedulers=a;let G=u,K=Oi(t,o,i);c&&co(K,o,d,p,y,C,m,P),this.database=Cr(`${K.name}.database.${r}`,"AngularFireDatabase",K.name,()=>{let O=o.runOutsideAngular(()=>K.database(r||void 0));return G&&O.useEmulator(...G),O},[G])}list(t,i){let r=At(pt).runOutsideAngular(()=>R0(this.database,t)),s=r;return i&&(s=i(r)),UR(s,this,this.injector)}object(t){let i=At(pt).runOutsideAngular(()=>R0(this.database,t));return BR(i,this,this.injector)}createPushId(){return At(pt).runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(i){return new(i||n)(Y(Xn),Y(Zn,8),Y(qR,8),Y(Kn),Y(pt),Y(Tr),Y(jR,8),Y(ho,8),Y(ro,8),Y(so,8),Y(oo,8),Y(ao,8),Y(lo,8),Y(uo,8),Y(br,8))};static \u0275prov=jn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),U0=(()=>{class n{constructor(){Qe.registerVersion("angularfire",In.full,"rtdb-compat")}static \u0275fac=function(i){return new(i||n)};static \u0275mod=$n({type:n});static \u0275inj=Gn({providers:[GR]})}return n})();var Ps=class n{constructor(){Py.initializeApp(Ay.firebase)}getFirestore(){return gI}getDatabase(){return U0}getAuth(){return Dy}static \u0275fac=function(t){return new(t||n)};static \u0275prov=jn({token:n,factory:n.\u0275fac,providedIn:"root"})};var KR=["swiperContainer1"],WR=["oneInput"],$R=["twoInput"],QR=["threeInput"],HR=["fourInput"],YR=["fiveInput"],JR=["sixInput"],B0=n=>({active:n}),j0=()=>["Facebook","Instagram","Youtube"],XR=()=>["/under-maintanace"];function ZR(n,e){n&1&&(B(0,"div",10)(1,"span",11),De(2,"i",12),q(),B(3,"p"),oe(4,"Loading, please wait..."),q()())}function eP(n,e){n&1&&(B(0,"div",61),oe(1," Username is required "),q())}function tP(n,e){if(n&1){let t=Fi();B(0,"a",62),nt("click",function(){be(t);let r=ie(4);return Ce(r.togglePassword())}),De(1,"i"),q()}if(n&2){let t=ie(4);Q(),R_("",t.toggleClass,"  align-middle")}}function nP(n,e){n&1&&(B(0,"div",61),oe(1," Password is required "),q())}function iP(n,e){n&1&&(B(0,"div",63)(1,"span",64),oe(2,"Our Social Handles"),q()())}function rP(n,e){if(n&1&&(B(0,"a",66)(1,"span",67),De(2,"i",68),q(),B(3,"span",69),oe(4),q()()),n&2){let t=ie().$implicit,i=ie(4);X("href",t.social_url,Wn),Q(2),X("ngClass",i.iconMap[t.title]||"ri-share-fill"),Q(2),Zs(t.title)}}function sP(n,e){if(n&1&&(Zt(0),Be(1,rP,5,3,"a",65),en()),n&2){let t=e.$implicit;Q(),X("ngIf",rl(1,j0).includes(t.title))}}function oP(n,e){if(n&1){let t=Fi();Zt(0),B(1,"div",38)(2,"form",39),nt("ngSubmit",function(){be(t);let r=ie(3);return Ce(r.onAdminLoginSubmit())}),B(3,"p",40),oe(4,"Sign In"),q(),B(5,"p",41),oe(6,"Welcome back"),q(),B(7,"div",42)(8,"div",43)(9,"label",44),oe(10,"User Name"),q(),B(11,"div",45),De(12,"input",46),B(13,"div",47),De(14,"i",48),q()(),Be(15,eP,2,0,"div",49),q(),B(16,"div",43)(17,"label",50),oe(18,"Password"),q(),B(19,"div",45)(20,"input",51),F_("ngModelChange",function(r){be(t);let s=ie(3);return V_(s.password,r)||(s.password=r),Ce(r)}),q(),Be(21,tP,2,3,"a",52),B(22,"div",47),De(23,"i",53),q(),Be(24,nP,2,0,"div",49),q()()(),Be(25,iP,3,0,"div",54),B(26,"div",55),Be(27,sP,2,2,"ng-container",34),q(),B(28,"div",56),De(29,"app-button",57),q(),B(30,"div",58)(31,"p",59),oe(32,"Powered By "),B(33,"a",60),oe(34,"EzeOne Technologies Private Limited"),q()()()()(),en()}if(n&2){let t=ie(3);Q(2),X("formGroup",t.loginForm),Q(13),X("ngIf",(t.loginForm.controls.username==null?null:t.loginForm.controls.username.invalid)&&(t.loginForm.controls.username==null?null:t.loginForm.controls.username.touched)),Q(5),X("type",t.showPassword?"text":"password"),D_("ngModel",t.password),Q(),X("ngIf",t.password),Q(3),X("ngIf",(t.loginForm.controls.password==null?null:t.loginForm.controls.password.invalid)&&(t.loginForm.controls.password==null?null:t.loginForm.controls.password.touched)),Q(),X("ngIf",t.authOrgData==null||t.authOrgData.social==null?null:t.authOrgData.social.length),Q(2),X("ngForOf",t.authOrgData==null?null:t.authOrgData.social),Q(2),X("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0 wp100")("disabled",t.api.disabled)("label","Login")("formType","add")("iconClass","ri-arrow-right-line")("loadingIconClass","ri-loader-2-fill")}}function aP(n,e){if(n&1){let t=Fi();Zt(0),B(1,"div",38)(2,"form",39),nt("ngSubmit",function(){be(t);let r=ie(3);return Ce(r.onOtpSend())}),B(3,"p",40),oe(4,"Sign In"),q(),B(5,"p",41),oe(6,"Select an authorized person to send the OTP."),q(),De(7,"spk-ng-select",70),B(8,"div",71)(9,"button",72),nt("click",function(){be(t);let r=ie(3);return Ce(r.goToPreviousTab("backend_team","login"))}),B(10,"i",73),oe(11,"arrow_back"),q(),oe(12,"Previous "),q(),De(13,"app-button",74),q(),B(14,"div",58)(15,"p",59),oe(16,"Powered By "),B(17,"a",75),oe(18,"EzeOne Technologies Private Limited"),q()()()()(),en()}if(n&2){let t=ie(3);Q(2),X("formGroup",t.authorizedPersonForm),Q(5),X("options",t.authOrgData==null||t.authOrgData.org==null?null:t.authOrgData.org.authorized_person),Q(6),X("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",t.api.disabled)("formType","add")("iconClass","ri-arrow-right-line")("loadingIconClass","ri-loader-2-fill")}}function lP(n,e){if(n&1&&(Zt(0),Be(1,oP,35,15,"ng-container",9)(2,aP,19,8,"ng-container",9),en()),n&2){let t=ie(2);Q(),X("ngIf",t.activeTab==="login"),Q(),X("ngIf",t.activeTab==="authorized_person")}}function uP(n,e){n&1&&(B(0,"span"),oe(1," Mobile number is required. "),q())}function cP(n,e){n&1&&(B(0,"span"),oe(1," Enter a valid 10-digit mobile number. "),q())}function hP(n,e){if(n&1&&(B(0,"div",61),Be(1,uP,2,0,"span",9)(2,cP,2,0,"span",9),q()),n&2){let t=ie(4);Q(),X("ngIf",t.individualForm.controls.mobile==null||t.individualForm.controls.mobile.errors==null?null:t.individualForm.controls.mobile.errors.required),Q(),X("ngIf",t.individualForm.controls.mobile==null||t.individualForm.controls.mobile.errors==null?null:t.individualForm.controls.mobile.errors.pattern)}}function dP(n,e){n&1&&(B(0,"div",63)(1,"span",64),oe(2,"Our Social Handles"),q()())}function fP(n,e){if(n&1&&(B(0,"a",66)(1,"span",67),De(2,"i",68),q(),B(3,"span",69),oe(4),q()()),n&2){let t=ie().$implicit,i=ie(4);X("href",t.social_url,Wn),Q(2),X("ngClass",i.iconMap[t.title]||"ri-share-fill"),Q(2),Zs(t.title)}}function mP(n,e){if(n&1&&(Zt(0),Be(1,fP,5,3,"a",65),en()),n&2){let t=e.$implicit;Q(),X("ngIf",rl(1,j0).includes(t.title))}}function pP(n,e){if(n&1){let t=Fi();Zt(0),B(1,"div",38)(2,"form",39),nt("ngSubmit",function(){be(t);let r=ie(3);return Ce(r.onOtpSend())}),B(3,"p",40),oe(4,"Sign In"),q(),B(5,"p",41),oe(6,"Welcome back"),q(),B(7,"div",42)(8,"div",43)(9,"label",44),oe(10,"Mobile"),q(),B(11,"div",45)(12,"input",76),nt("keypress",function(r){be(t);let s=ie(3);return Ce(s.formValidation.handleInputFilter(r,"mobile"))}),q(),B(13,"div",47),De(14,"i",77),q()(),Be(15,hP,3,2,"div",49),q()(),Be(16,dP,3,0,"div",54),B(17,"div",55),Be(18,mP,2,2,"ng-container",34),q(),B(19,"div",56),De(20,"app-button",57),q(),B(21,"div",58)(22,"p",59),oe(23,"Powered By "),B(24,"a",60),oe(25,"EzeOne Technologies Private Limited"),q()()()()(),en()}if(n&2){let t=ie(3);Q(2),X("formGroup",t.individualForm),Q(13),X("ngIf",(t.individualForm.controls.mobile==null?null:t.individualForm.controls.mobile.touched)&&(t.individualForm.controls.mobile==null?null:t.individualForm.controls.mobile.errors)),Q(),X("ngIf",t.authOrgData==null||t.authOrgData.social==null?null:t.authOrgData.social.length),Q(2),X("ngForOf",t.authOrgData==null?null:t.authOrgData.social),Q(2),X("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0 wp100")("disabled",t.api.disabled)("label","Login")("formType","add")("iconClass","ri-arrow-right-line")("loadingIconClass","ri-loader-2-fill")}}function gP(n,e){if(n&1&&(Zt(0),Be(1,pP,26,11,"ng-container",9),en()),n&2){let t=ie(2);Q(),X("ngIf",t.activeTab==="mobile")}}function _P(n,e){n&1&&(B(0,"div",94),oe(1," All 6 digits are required. "),q())}function yP(n,e){if(n&1){let t=Fi();Zt(0),B(1,"div",38)(2,"form",39),nt("ngSubmit",function(){be(t);let r=ie(2);return Ce(r.Submit())}),B(3,"p",78),oe(4,"Verification Code"),q(),B(5,"p",79),oe(6),q(),B(7,"div",80)(8,"div",81)(9,"div",82)(10,"div",83)(11,"input",84,1),nt("keyup",function(r){be(t);let s=Gt(15),o=ie(2);return Ce(o.onDigitInput(r,s,null))})("keydown",function(r){be(t);let s=ie(2);return Ce(s.formValidation.handleInputFilter(r,"number"))}),q()(),B(13,"div",83)(14,"input",85,2),nt("keyup",function(r){be(t);let s=Gt(12),o=Gt(18),a=ie(2);return Ce(a.onDigitInput(r,o,s))})("keydown",function(r){be(t);let s=ie(2);return Ce(s.formValidation.handleInputFilter(r,"number"))}),q()(),B(16,"div",83)(17,"input",86,3),nt("keyup",function(r){be(t);let s=Gt(15),o=Gt(21),a=ie(2);return Ce(a.onDigitInput(r,o,s))})("keydown",function(r){be(t);let s=ie(2);return Ce(s.formValidation.handleInputFilter(r,"number"))}),q()(),B(19,"div",83)(20,"input",87,4),nt("keyup",function(r){be(t);let s=Gt(18),o=Gt(24),a=ie(2);return Ce(a.onDigitInput(r,o,s))})("keydown",function(r){be(t);let s=ie(2);return Ce(s.formValidation.handleInputFilter(r,"number"))}),q()(),B(22,"div",83)(23,"input",88,5),nt("keyup",function(r){be(t);let s=Gt(21),o=Gt(27),a=ie(2);return Ce(a.onDigitInput(r,o,s))})("keydown",function(r){be(t);let s=ie(2);return Ce(s.formValidation.handleInputFilter(r,"number"))}),q()(),B(25,"div",83)(26,"input",89,6),nt("keyup",function(r){be(t);let s=Gt(24),o=ie(2);return Ce(o.onDigitInput(r,null,s))})("keydown",function(r){be(t);let s=ie(2);return Ce(s.formValidation.handleInputFilter(r,"number"))}),q()()(),Be(28,_P,2,0,"div",90),B(29,"div",91)(30,"label",92),oe(31," Didn't recieve a code ?"),B(32,"a",93),oe(33,"Resend"),q()()()(),B(34,"div",71)(35,"button",72),nt("click",function(){be(t);let r=ie(2);return Ce(r.goToPreviousTab(r.activeLoginTab,r.activeTab))}),B(36,"i",73),oe(37,"arrow_back"),q(),oe(38,"Previous "),q(),De(39,"app-button",57),q()()()(),en()}if(n&2){let t,i=ie(2);Q(2),X("formGroup",i.otpForm),Q(4),N_("Enter the 6 digit code sent to the mobile number ",i.getMaskedMobile(),"."),Q(22),X("ngIf",i.otpForm.touched&&(((t=i.otpForm.get("d1"))==null?null:t.hasError("required"))||((t=i.otpForm.get("d2"))==null?null:t.hasError("required"))||((t=i.otpForm.get("d3"))==null?null:t.hasError("required"))||((t=i.otpForm.get("d4"))==null?null:t.hasError("required"))||((t=i.otpForm.get("d5"))==null?null:t.hasError("required"))||((t=i.otpForm.get("d6"))==null?null:t.hasError("required")))),Q(4),X("routerLink",rl(11,XR)),Q(7),X("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",i.api.disabled)("label","Login")("formType","add")("iconClass","ri-arrow-right-line")("loadingIconClass","ri-loader-2-fill")}}function vP(n,e){if(n&1&&(B(0,"swiper-slide")(1,"div",95),De(2,"img",96),q()()),n&2){let t=e.$implicit,i=e.index;Q(2),P_("alt","banner ",i+1,""),X("src",t.src,Wn)}}function wP(n,e){if(n&1&&(B(0,"a",27),De(1,"img",99),q()),n&2){let t=ie(3);il("href",t.authOrgData==null||t.authOrgData.org==null?null:t.authOrgData.org.play_store_link,Wn)}}function EP(n,e){if(n&1&&(B(0,"a",27),De(1,"img",100),q()),n&2){let t=ie(3);il("href",t.authOrgData==null||t.authOrgData.org==null?null:t.authOrgData.org.app_store_link,Wn)}}function IP(n,e){if(n&1&&(B(0,"div",97),Be(1,wP,2,1,"a",98)(2,EP,2,1,"a",98),q()),n&2){let t=ie(2);Q(),X("ngIf",t.authOrgData==null||t.authOrgData.org==null?null:t.authOrgData.org.play_store_link),Q(),X("ngIf",t.authOrgData==null||t.authOrgData.org==null?null:t.authOrgData.org.app_store_link)}}function TP(n,e){if(n&1){let t=Fi();Zt(0),B(1,"div",13)(2,"div",14),De(3,"div",15),B(4,"div",16)(5,"div",17)(6,"div",18)(7,"nav",19)(8,"button",20),nt("click",function(){be(t);let r=ie();return Ce(r.switchTab("backend_team"))}),De(9,"i",21),oe(10,"Backend Team"),q(),B(11,"button",20),nt("click",function(){be(t);let r=ie();return Ce(r.switchTab("individual"))}),De(12,"i",22),oe(13,"Individual"),q()(),B(14,"div",23),Be(15,lP,3,2,"ng-container",9)(16,gP,2,1,"ng-container",9)(17,yP,40,12,"ng-container",9),q()()()(),De(18,"div",15),q()(),B(19,"div",24)(20,"div",25)(21,"div",26)(22,"a",27),De(23,"img",28),q()(),B(24,"div",29)(25,"div")(26,"div",30)(27,"div",31)(28,"div",30)(29,"div",32)(30,"swiper-container",33,0),Be(32,vP,3,3,"swiper-slide",34),q()()()(),Be(33,IP,3,2,"div",35),q(),B(34,"h6",36),oe(35),q(),B(36,"p",37),oe(37),q()()()()(),en()}if(n&2){let t=ie();Q(8),X("ngClass",uh(13,B0,t.activeLoginTab==="backend_team")),Q(3),X("ngClass",uh(15,B0,t.activeLoginTab==="individual")),Q(4),X("ngIf",t.activeLoginTab==="backend_team"),Q(),X("ngIf",t.activeLoginTab==="individual"),Q(),X("ngIf",t.activeTab==="otp"),Q(5),il("href",t.authOrgData==null||t.authOrgData.org==null?null:t.authOrgData.org.website_url,Wn),Q(),k_("src","",t.api.rootUrl,"brand-logos/",t.authOrgData==null||t.authOrgData.org==null?null:t.authOrgData.org.org_name,"/desktop-white.png",Wn),Q(9),X("ngForOf",t.webBanner),Q(),X("ngIf",(t.authOrgData==null||t.authOrgData.org==null?null:t.authOrgData.org.play_store_link)||(t.authOrgData==null||t.authOrgData.org==null?null:t.authOrgData.org.app_store_link)),Q(2),Zs((t.authOrgData==null||t.authOrgData.org==null?null:t.authOrgData.org.title)||"--"),Q(2),Zs((t.authOrgData==null||t.authOrgData.org==null?null:t.authOrgData.org.sub_title)||"--")}}var q0=class n{constructor(e,t,i,r,s,o,a,u,c,d,m,p,y,C){this.location=e;this.document=t;this.elementRef=i;this.sanitizer=r;this.authservice=s;this.router=o;this.formBuilder=a;this.renderer=u;this.firebaseService=c;this.commonapi=d;this.toastr=m;this.api=p;this.titleService=y;this.formValidation=C;t.body.classList.add("authentication-background");let P=this.renderer.selectRootElement("body",!0)}swiperContainer1;showPassword=!1;loginType="";toggleClass="ri-eye-fill";active="Angular";firestoreModule;loginContent=!1;databaseModule;authModule;username="";password="";activeLoginTab="backend_team";activeTab="login";errorMessage="";_error={name:"",message:""};disabled="";loginForm;individualForm;authorizedPersonForm;otpForm;iconMap={Facebook:"ri-facebook-fill",Instagram:"ri-instagram-fill",LinkedIn:"ri-linkedin-box-fill",Youtube:"ri-youtube-fill","X-Twitter":"ri-twitter-fill","Google Review":"ri-google-fill"};ngOnDestroy(){document.body.classList.remove("authentication-background")}ngOnInit(){this.getAuthOrg(),this.location.replaceState("auth/login"),this.loginForm=this.formBuilder.group({platform:[""],username:["",[qe.required]],password:["",qe.required]}),this.authorizedPersonForm=this.formBuilder.group({authorized_person:["",[qe.required]]}),this.individualForm=this.formBuilder.group({mobile:["",[qe.required,qe.pattern(/^[6-9][0-9]{9}$/),qe.minLength(10),qe.maxLength(10)]]}),this.otpForm=this.formBuilder.group({d1:["",[qe.required,qe.pattern("[0-9]")]],d2:["",[qe.required,qe.pattern("[0-9]")]],d3:["",[qe.required,qe.pattern("[0-9]")]],d4:["",[qe.required,qe.pattern("[0-9]")]],d5:["",[qe.required,qe.pattern("[0-9]")]],d6:["",[qe.required,qe.pattern("[0-9]")]]}),this.firestoreModule=this.firebaseService.getFirestore(),this.databaseModule=this.firebaseService.getDatabase(),this.authModule=this.firebaseService.getAuth()}authOrgData={};webBanner=[];getAuthOrg(){this.loginContent=!0,this.api.post({},"org",al.AUTH).subscribe(e=>{e.statusCode==200?(this.authOrgData=e.data,e.data&&(this.loginContent=!1,this.webBanner=this.authOrgData?.org?.web_banner?.map(t=>({src:t}))||[],this.setTitle())):(this.loginContent=!1,this.router.navigate(["/error/error404"]))})}setTitle(){let e=this.authOrgData?.org?.org_name;this.titleService.setTitle(e),this.setFavicon(this.authOrgData?.org?.favicon_url||"https://ezeonetech.com/wp-content/uploads/2025/03/favicon-1.png")}setFavicon(e){let t=document.querySelector("link[rel*='icon']")||null;t?t.href=e:(t=document.createElement("link"),t.rel="icon",t.href=e,document.getElementsByTagName("head")[0].appendChild(t))}switchTab(e){this.activeLoginTab=e,this.activeLoginTab==="backend_team"&&(this.activeTab="login"),this.activeLoginTab==="individual"&&(this.activeTab="mobile"),this.loginForm.reset(),this.individualForm.reset(),this.otpForm.reset(),this.markAllUntouched(this.loginForm),this.markAllUntouched(this.individualForm),this.markAllUntouched(this.otpForm)}markAllUntouched(e){Object.keys(e.controls).forEach(t=>{e.controls[t].markAsPristine(),e.controls[t].markAsUntouched(),e.controls[t].updateValueAndValidity()})}oneInput;twoInput;threeInput;fourInput;fiveInput;sixInput;onDigitInput(e,t,i){let r=e.target,s=e.key;s!=="Backspace"&&r.value?.length===1&&t&&t.focus(),s==="Backspace"&&r.value?.length===0&&i&&i.focus()}goToPreviousTab(e,t){e==="backend_team"&&t==="otp"&&(this.activeTab="authorized_person",this.otpForm.reset()),e==="individual"&&t==="otp"?(this.activeTab="mobile",this.otpForm.reset()):this.activeTab=t}onOtpSend(){let e=!1;if(this.activeLoginTab==="backend_team"&&(this.authorizedPersonForm.invalid&&(this.authorizedPersonForm.markAllAsTouched(),e=!0),this.loginForm.invalid&&(this.loginForm.markAllAsTouched(),e=!0)),this.activeLoginTab==="individual"&&this.individualForm.invalid&&(this.individualForm.markAllAsTouched(),e=!0),e)return;this.api.disabled=!0;let t=jt(Je(Je({},this.activeLoginTab==="backend_team"?this.loginForm.value:this.individualForm.value),this.activeLoginTab==="backend_team"&&{mobile:this.authorizedPersonForm.value.authorized_person}),{org_id:this.authOrgData?.org?.org_id,login_type:this.activeLoginTab});this.api.post(t,"send-otp",al.AUTH).subscribe(i=>{i.statusCode===200&&(this.activeTab="otp",this.api.disabled=!1)})}onAdminLoginSubmit(){if(this.loginForm.invalid){this.loginForm.markAllAsTouched();return}let e=jt(Je({},this.loginForm.value),{login_type:this.activeLoginTab});this.api.disabled=!0,this.api.post(e,"web/admin-login-validate",al.AUTH).subscribe(t=>{t.statusCode===200&&(this.api.disabled=!1,t.data.otp_flag===!0?this.activeTab="authorized_person":this.Submit())})}Submit(){if(this.validateFormsByLoginType())return;let e=[this.otpForm.value.d1,this.otpForm.value.d2,this.otpForm.value.d3,this.otpForm.value.d4,this.otpForm.value.d5,this.otpForm.value.d6].join(""),t;this.activeLoginTab==="backend_team"?t=jt(Je(jt(Je({},this.loginForm.value),{mobile:this.authorizedPersonForm.value.authorized_person}),e?{otp:Number(e)}:{}),{login_type:this.activeLoginTab}):this.activeLoginTab==="individual"&&(t=jt(Je(Je(Je({},this.activeLoginTab==="backend_team"&&Je(Je({},this.loginForm.value),this.authorizedPersonForm.value)),this.activeLoginTab==="individual"&&Je({},this.individualForm.value)),e?{otp:Number(e)}:{}),{org_id:this.authOrgData?.org?.org_id,login_type:this.activeLoginTab})),this.api.disabled=!0,this.formValidation.removeEmptyFields(t),this.authservice.login(t,"web-login").pipe(el()).subscribe({next:i=>{if(i===!0){this.api.disabled=!1,this.commonapi.fcmToken&&localStorage.setItem("fcmToken",this.commonapi.fcmToken);let r=this.authservice.getModule(),s=this.getFirstValidPath(r);s?this.router.navigate([s]):this.authservice.logout("logout")}else this.toastr.error("Login failed. Invalid credentials or user inactive.","","toast-top-right"),this.router.navigate([""])},error:i=>{this.toastr.error("Something went wrong during login. Please try again later.","","toast-top-right")}})}validateFormsByLoginType(){let e=!1;return this.activeLoginTab==="backend_team"&&(this.activeTab==="authorized_person"&&this.authorizedPersonForm.invalid&&(this.authorizedPersonForm.markAllAsTouched(),e=!0),this.activeTab==="login"&&this.loginForm.invalid&&(this.loginForm.markAllAsTouched(),e=!0)),this.activeLoginTab==="individual"&&this.activeTab==="mobile"&&this.individualForm.invalid&&(this.individualForm.markAllAsTouched(),e=!0),this.activeTab==="mobile"&&this.otpForm.invalid&&(this.otpForm.markAllAsTouched(),e=!0),e}getFirstValidPath(e){for(let t of e){if(t.path&&typeof t.path=="string"&&t.path.trim()!=="")return t.path;if(Array.isArray(t.children)&&t.children?.length>0){let i=this.getFirstValidPath(t.children);if(i)return i}}return null}getMaskedMobile(){let e="";return this.activeLoginTab==="backend_team"&&this.activeTab==="otp"?e=this.authorizedPersonForm.value?.authorized_person:this.activeLoginTab==="individual"&&this.activeTab==="otp"&&(e=this.individualForm.value?.mobile),e&&e?.length>=3?"******"+e.slice(-3):""}togglePassword(){this.showPassword=!this.showPassword,this.toggleClass=this.showPassword?"ri-eye-off-fill":"ri-eye-fill"}static \u0275fac=function(t){return new(t||n)(gt(U_),gt(M_),gt(S_),gt(K_),gt(cy),gt(W_),gt(oy),gt(A_),gt(Ps),gt(hy),gt(J_),gt(uy),gt(z_),gt(fy))};static \u0275cmp=x_({type:n,selectors:[["app-login"]],viewQuery:function(t,i){if(t&1&&(Qn(KR,5),Qn(WR,5),Qn($R,5),Qn(QR,5),Qn(HR,5),Qn(YR,5),Qn(JR,5)),t&2){let r;Hn(r=Yn())&&(i.swiperContainer1=r.first),Hn(r=Yn())&&(i.oneInput=r.first),Hn(r=Yn())&&(i.twoInput=r.first),Hn(r=Yn())&&(i.threeInput=r.first),Hn(r=Yn())&&(i.fourInput=r.first),Hn(r=Yn())&&(i.fiveInput=r.first),Hn(r=Yn())&&(i.sixInput=r.first)}},features:[O_([Ps,{provide:fh,useClass:fh}])],decls:3,vars:2,consts:[["swiperContainer1",""],["oneInput",""],["twoInput",""],["threeInput",""],["fourInput",""],["fiveInput",""],["sixInput",""],[1,"grid","grid-cols-12","authentication","authentication-cover-main","mx-0"],["class","col-span-12 gap-1 flex item-center items-center justify-center bg-white",4,"ngIf"],[4,"ngIf"],[1,"col-span-12","gap-1","flex","item-center","items-center","justify-center","bg-white"],[1,"loading"],[1,"animate-spin","ri-loader-2-fill","text-[1.5rem]"],[1,"xxl:col-span-6","xl:col-span-7","col-span-12"],[1,"grid","grid-cols-12","justify-center","items-center","h-full","bg-white"],[1,"xxl:col-span-2","xl:col-span-2","lg:col-span-3","md:col-span-3","sm:col-span-2","col-span-12"],[1,"xxl:col-span-8","xl:col-span-8","lg:col-span-6","md:col-span-6","sm:col-span-8","col-span-12","px-3"],[1,"box","my-auto","border","border-defaultborder","dark:border-defaultborder/10"],[1,"box-body","p-[3rem]","overflow-x-hidden","wp100"],["id","myTab1","role","tablist",1,"nav","nav-tabs","tab-style-8","scaleX","md:flex","block","justify-around","border","border-dashed","dark:border-defaultborder/10","border-b-0","bg-light","rounded-sm","mb-4"],["type","button",1,"nav-link","!p-4","md:w-auto","w-full","wp100",2,"padding","4px 15px !important",3,"click","ngClass"],[1,"ri-admin-line","me-2","align-middle"],[1,"ri-user-3-line","me-2","align-middle"],[1,"flex","items-center"],[1,"xxl:col-span-6","xl:col-span-5","lg:col-span-12","xl:block","hidden","px-0"],[1,"authentication-cover","overflow-hidden"],[1,"authentication-cover-logo"],["target","_blank",3,"href"],["alt","logo",1,"desktop-white",3,"src"],[1,"aunthentication-cover-content","flex","items-center","justify-center"],[1,""],[1,"mb-5","flex","justify-center"],[1,"login-swiper"],["space-between","30","slides-per-view","1","slides-per-group","1","autoplay-delay","2000","pagination","true","pagination-clickable","true","autoplay-disable-on-interaction","false",1,"swiper","mySwiper"],[4,"ngFor","ngForOf"],["class","mb-5 flex justify-center gap-3",4,"ngIf"],[1,"text-white","mb-3","font-semibold","text-[1.5rem]","text-center"],[1,"text-white","mb-1","text-[15px]","font-semibold","text-center"],[1,"wp100","animate__animated","animate__slideInRight"],[3,"ngSubmit","formGroup"],[1,"font-semibold","!mb-1","text-[1rem]","mb-4"],[1,"mb-4","text-textmuted","dark:text-textmuted/50","font-normal"],[1,"grid","grid-cols-12","gap-y-4"],[1,"xl:col-span-12","col-span-12"],["for","signup-firstname",1,"ti-form-label","text-default"],[1,"relative"],["id","signup-firstname","placeholder","User Name","autocomplete","","formControlName","username","required","",1,"ti-form-input","rounded-sm","ps-11","focus:z-10"],[1,"absolute","inset-y-0","start-0","flex","items-center","pointer-events-none","z-20","ps-4","text-[1rem]","opacity-60"],[1,"ri-user-fill"],["class","float-end font-medium text-danger text-[0.75rem]",4,"ngIf"],["for","signin-password",1,"ti-form-label","text-default","block"],["id","signin-password","placeholder","Password","autocomplete","off","formControlName","password","required","",1,"ti-form-input","rounded-sm","ps-11","focus:z-10",3,"ngModelChange","type","ngModel"],["class","show-password-button text-textmuted dark:text-textmuted/50 p-3",3,"click",4,"ngIf"],[1,"ri-lock-password-fill"],["class","text-center my-4 authentication-barrier",4,"ngIf"],[1,"flex","items-center","flex-wrap","justify-between","gap-2","mb-4"],[1,"grid","mt-4"],[3,"buttonType","buttonClass","disabled","label","formType","iconClass","loadingIconClass"],[1,"text-center"],[1,"text-textmuted","dark:text-textmuted/50","mt-4","mb-0"],["href","https://ezeonetech.com/",1,"text-primary","font-semibold"],[1,"float-end","font-medium","text-danger","text-[0.75rem]"],[1,"show-password-button","text-textmuted","dark:text-textmuted/50","p-3",3,"click"],[1,"text-center","my-4","authentication-barrier"],[1,"opacity-40","text-[0.6875rem]"],["class","ti-btn ti-btn-light !border  !border-defaultborder dark:!border-defaultborder/10 flex items-center justify-center flex-grow gap-0","target","_blank",3,"href",4,"ngIf"],["target","_blank",1,"ti-btn","ti-btn-light","!border","!border-defaultborder","dark:!border-defaultborder/10","flex","items-center","justify-center","flex-grow","gap-0",3,"href"],[1,"!text-primary","avatar","avatar-xs","bg-primary/10"],[1,"text-[0.8125rem]",3,"ngClass"],[1,"leading-none","ms-2","text-[0.8125rem]","text-default","font-medium"],["formControlName","authorized_person","label","Authorized Person",3,"options"],[1,"xl:col-span-12","col-span-12","grid","mt-6","sm:flex","items-center","justify-between"],["type","button",1,"ti-btn","ti-btn-soft-danger","m-0",3,"click"],[1,"material-icons","align-middle","inline-block"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],["href","https://ezeonetech.com/",1,"text-primary","font-semibold","underline"],["type","text","placeholder","Mobile","autocomplete","","formControlName","mobile","required","",1,"ti-form-input","rounded-sm","ps-11","focus:z-10",3,"keypress"],[1,"ri-phone-fill"],[1,"text-xl","mb-2","text-center","font-medium"],[1,"mb-4","text-textmuted","dark:text-textmuted/50","opacity-70","font-normal","text-center","text-xs"],[1,"grid","grid-cols-12","gy-3"],[1,"xl:col-span-12","col-span-12","mb-2"],[1,"grid","grid-cols-12","gap-x-2"],[1,"col-span-2"],["type","text","maxlength","1","formControlName","d1",1,"form-control","text-center",2,"padding","6px 10px !important",3,"keyup","keydown"],["type","text","maxlength","1","formControlName","d2",1,"form-control","text-center",2,"padding","6px 10px !important",3,"keyup","keydown"],["type","text","maxlength","1","formControlName","d3",1,"form-control","text-center",2,"padding","6px 10px !important",3,"keyup","keydown"],["type","text","maxlength","1","formControlName","d4",1,"form-control","text-center",2,"padding","6px 10px !important",3,"keyup","keydown"],["type","text","maxlength","1","formControlName","d5",1,"form-control","text-center",2,"padding","6px 10px !important",3,"keyup","keydown"],["type","text","maxlength","1","formControlName","d6",1,"form-control","text-center",2,"padding","6px 10px !important",3,"keyup","keydown"],["class","text-danger text-[0.75rem] mt-2 text-center font-medium",4,"ngIf"],[1,"form-check","mt-2"],["for","defaultCheck1",1,"form-check-label","text-[14px]"],[1,"text-primary","ms-2","inline-block",3,"routerLink"],[1,"text-danger","text-[0.75rem]","mt-2","text-center","font-medium"],[1,"swiper-slide"],[1,"w-full","h-auto","object-cover",3,"src","alt"],[1,"mb-5","flex","justify-center","gap-3"],["target","_blank",3,"href",4,"ngIf"],["src","./assets/images/media/media-93.svg","alt","google-play",2,"height","40px"],["src","./assets/images/media/media-94.png","alt","apple-store",2,"height","40px"]],template:function(t,i){t&1&&(B(0,"div",7),Be(1,ZR,5,0,"div",8)(2,TP,38,17,"ng-container",9),q()),t&2&&(Q(),X("ngIf",i.loginContent),Q(),X("ngIf",!i.loginContent))},dependencies:[py,B_,q_,j_,ty,X_,Z_,ey,ry,sy,ny,iy,dy,my,Q_,$_,ay,ly,G_,Y_],styles:[".firebase{width:30px;height:30px}  .rounded-lg{width:120px;justify-content:center;margin:auto;border-radius:.75rem}input[_ngcontent-%COMP%]::-ms-reveal, input[_ngcontent-%COMP%]::-ms-clear{display:none}.login-swiper[_ngcontent-%COMP%]{width:300px}"],data:{animation:[H_("slideFade",[dh(":enter",[ol({transform:"translateX(100%)",opacity:0}),hh("300ms ease-out",ol({transform:"translateX(0)",opacity:1}))]),dh(":leave",[hh("300ms ease-in",ol({transform:"translateX(-100%)",opacity:0}))])])]}})};export{q0 as LoginComponent};
