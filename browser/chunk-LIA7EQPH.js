import{a as le}from"./chunk-GXF7AAOQ.js";import{a as re}from"./chunk-PU6S26UW.js";import{a as de}from"./chunk-ZON5AR26.js";import"./chunk-LGZVJJDX.js";import{a as se}from"./chunk-54KZ5YIV.js";import"./chunk-SQZ3YN6N.js";import"./chunk-CIBZCVJQ.js";import{a as ne}from"./chunk-OTFCGVEU.js";import{a as oe}from"./chunk-HPLI5COI.js";import"./chunk-DUVWFXSE.js";import{a as X}from"./chunk-CNF4GSI7.js";import"./chunk-OEHD5D2Y.js";import{a as ae}from"./chunk-GLWQGYBC.js";import{a as Y}from"./chunk-DC4QM32I.js";import{C as ie,F as te,c as q,k as Z,v as ee}from"./chunk-VHE3PQ3O.js";import{C as P,H as z,M as H,Qa as Q,V as J,Y as $,Z as K,hb as W,l as N,w as G}from"./chunk-GYDYF5F3.js";import{K as j,M as k,f as L,g as w,n as R,t as U}from"./chunk-PD5VTTIY.js";import{Aa as v,Ba as b,Hb as M,Ob as h,Yc as x,_b as l,cc as A,ed as V,fd as O,kc as c,lc as f,mc as I,nc as B,oc as D,qc as T,rb as p,sb as d,wc as C,yc as m}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{i as E}from"./chunk-66YHNWRR.js";var ce=()=>["Branding"],fe=()=>[];function _e(a,i){a&1&&(c(0,"div",8),I(1,"app-skeleton"),f())}function ue(a,i){a&1&&(c(0,"div",4)(1,"div",5)(2,"div",6),h(3,_e,2,0,"div",7),f()()()),a&2&&(p(3),l("ngForOf",x(1,fe).constructor(10)))}function he(a,i){if(a&1){let e=T();c(0,"div")(1,"app-form-field",17,0),C("searchChanged",function(n){v(e);let t=m().$implicit,s=m(4);return b(t.search?s.onSearch(n,t):"")})("valueChange",function(n){v(e);let t=m().$implicit,s=m(4);return b(s.onFieldChange(n,t))}),f()()}if(a&2){let e=m().$implicit,o=m(4);A("mb-4 ",e.class_name,""),p(),l("field",e)("form",o.myForm)}}function ye(a,i){if(a&1&&(B(0),h(1,he,3,5,"div",16),D()),a&2){let e=i.$implicit;p(),l("ngIf",e.is_show===!0&&(e.is_parent_dependency===!1||e.is_child_show===!0))}}function Fe(a,i){if(a&1&&(c(0,"div",6),h(1,ye,2,1,"ng-container",15),f()),a&2){let e=m(3);p(),l("ngForOf",e.formFields)}}function ge(a,i){if(a&1){let e=T();c(0,"form",11),C("ngSubmit",function(){v(e);let n=m(2);return b(n.onSubmit())}),c(1,"div",4)(2,"div",5),h(3,Fe,2,1,"div",12),f(),c(4,"div",13),I(5,"app-button",14),f()()()}if(a&2){let e=m(2);l("formGroup",e.myForm),p(3),l("ngIf",e.myForm&&e.myForm.controls),p(2),l("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",e.api.disabled)("formType",e.pageType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}function ve(a,i){if(a&1&&(c(0,"div",9),h(1,ge,6,8,"form",10),f()),a&2){let e=m();p(),l("ngIf",e.formIniatialized)}}var me=class a{constructor(i,e,o,n,t,s,r,_,F,S,y,pe,u){this.CommonApiService=i;this.toastr=e;this.moduleService=o;this.api=n;this.util=t;this.formValidation=s;this.fb=r;this.uploadService=_;this.spaceRemove=F;this.logService=S;this.router=y;this.dialog=pe;this.route=u}skLoading=!1;data={};FORMID=oe;subModule;moduleFormId=0;originalFormFields=[];formFields=[];myForm;primaryForm;formIniatialized=!1;DetailId;fieldTypes=N;originalData={};pageType="add";ngOnInit(){let i=this.moduleService.getSubModuleByName("SFA","Branding"),e=this.moduleService.getFormById("SFA","Branding",this.FORMID.ID.BrandingForm);i&&(this.subModule=i),e&&(this.moduleFormId=e.form_id,this.getFormData())}getFormData(){this.skLoading=!0,this.api.post({form_id:this.moduleFormId,platform:"web"},"form-builder/read").subscribe(i=>{i.statusCode==200&&(i?.data?.form_data&&(this.originalFormFields=JSON.parse(JSON.stringify(i.data.form_data))),this.formFields=i.data.form_data,this.skLoading=!1,this.formFields.forEach(e=>{this.util.createValidation(e)}),this.initializeForm())})}initializeForm(){this.myForm=this.fb.group({}),this.formFields.forEach(i=>{i.api_path&&this.getOptions(i.name,i.api_path,i.api_payload,i.api_payload_key),i.control=this.fb.control("",this.formValidation.getValidators(i)),this.myForm.addControl(i.name,i.control)}),this.formIniatialized=!0}getOptions(i,e,o,n){return E(this,null,function*(){try{let t={dropdown_name:i,module_id:this.subModule.sub_module_id||this.subModule.module_id};o&&n&&(t[n]=o);let s=yield this.api.post(t,e).toPromise();s?.statusCode===200&&(this.formFields.forEach(r=>{r.name===i&&(r.options=s.data)}),this.originalFormFields.forEach(r=>{r.name===i&&(r.options=s.data)}))}catch(t){console.error("Error fetching options:",t)}})}lastSearchTerm="";onSearch(i,e){let o=i?.trim()||"";o!==this.lastSearchTerm&&(this.lastSearchTerm=o,this.api.post({dropdown_name:e.name,search:o},e.api_path).subscribe({next:n=>{n.statusCode===200&&(e.options=n.data)}}))}onFieldChange(i,e){if(e.type==this.fieldTypes.SINGLE_SELECT||e.type==this.fieldTypes.MULTI_SELECT||e.type==this.fieldTypes.RADIO_SELECT||e.type==this.fieldTypes.CHECKBOX_SELECT||e.type==this.fieldTypes.DATE||e.type==this.fieldTypes.TIME||e.type==this.fieldTypes.UPLOAD){if(e.key_name_required===!0){let o=e.options.findIndex(t=>t.value===i),n;o!==-1&&(n=e.options[o].label,this.formFields.forEach(t=>{t.name===e.key_name&&this.myForm.controls[t.name].setValue(n)}))}e.type==this.fieldTypes.SINGLE_SELECT&&e.key_source=="custom"||e.type==this.fieldTypes.MULTI_SELECT&&e.key_source=="custom"?(e.control.setValue(i),e.value=i.label):e.control.setValue(i)}if(e.type===this.fieldTypes.DATE_RANGE){let o={from:i.from,to:i.to};this.myForm.controls[e.name].setValue(o)}if(e.type===this.fieldTypes.UPLOAD){for(let o=0;o<this.UploadFiles.length;o++)this.UploadFiles[o].label===e.label&&this.UploadFiles.splice(o,1);this.UploadFiles.push({label:e.label,file:i})}if(e.is_child_dependency===!0){let o=e.options.findIndex(n=>n.value===i);o!==-1&&(e.type===this.fieldTypes.SINGLE_SELECT&&e.key_source==="default"?(e.value=e.options[o].value,this.getDependencyUpdate(e)):(e.value=e.options[o].label,this.getDependencyUpdate(e)))}if(e.is_child_dependency){let o=this.formFields.findIndex(n=>n.name==e.name);this.onResetDependentFields(o);for(let n=o;n<=this.formFields.length-1;n++){let s=this.formFields[n].options?.find(r=>this.spaceRemove.formatString(r.value)===this.spaceRemove.formatString(this.formFields[n].value))?.label||"";for(let r=0;r<=this.formFields[n].child_dependency.length-1;r++){let _=!1,F=this.formFields[n].child_dependency[r];if(F.visibilty==="Direct"&&(F.parent_field_value===s||F.child_field_option.length===0&&this.formFields[n].is_child_show)&&(_=!0),this.formFields[n].child_dependency[r].visibilty==="Option"){let y=this.formFields.findIndex(u=>u.name==this.formFields[n].child_dependency[r].child_field_name);if(y!==-1&&this.formFields[y].type===this.fieldTypes.SHORT_TEXT&&this.formFields[n].value&&(_=!0,this.formFields[y].is_child_show=_),this.formFields[n].child_dependency[r].child_field_option.findIndex(u=>u.parent_field_value==s&&u.parent_field_name==this.formFields[n].name)!==-1){_=!0;let u=this.formFields.findIndex(g=>g.name==this.formFields[n].child_dependency[r].child_field_name);this.formFields[u].options=this.formFields[n].child_dependency[r].child_field_option.filter(g=>g.parent_field_name==this.formFields[n].name&&g.parent_field_value==s)}}let S=this.formFields.findIndex(y=>y.name==this.formFields[n].child_dependency[r].child_field_name);S!==-1&&(this.formFields[S].is_child_show=_)}}}e.name==="customer_type_id"&&this.getCustomerByLoginType(i)}onResetDependentFields(i){this.formFields[i].child_dependency.length!=0&&this.formFields[i].child_dependency.map(e=>{let o=this.formFields.findIndex(n=>n.name===e.child_field_name);o!==-1&&(this.myForm.controls[e.child_field_name].reset(),this.formFields[o].value=""),this.onResetDependentFields(o)})}getCustomerByLoginType(i){this.api.post({customer_type_id:i},"customer/read-dropdown").subscribe(e=>{if(e.statusCode==200)for(let o=0;o<this.formFields.length;o++)this.formFields[o].name==="customer_id"&&(this.formFields[o].options=e.data)})}getDependencyUpdate(i){if(i.is_child_dependency){let e,o,n;if(i.key_source==="default"){let t=i.options.find(s=>s.value===i.value);e=t?t.label:null}i.child_dependency.forEach(t=>{let s=this.formFields.find(r=>r.name===t.child_field_name);if(s){o=s.name;let r=t.child_field_option.find(_=>_.parent_field_value===e);n=r?r.label:null}}),o&&this.api.post({child_field_name:o,parent_field_value:e},"form-builder/read-dependency").subscribe(t=>{if(t?.statusCode===200&&t?.data){let s=this.formFields.find(r=>r.name===o);s&&(s.options=t.data)}})}}pondFiles=[];UploadFiles=[];pondOptions={allowMultiple:!0,labelIdle:"Click or drag images here to upload...",acceptedFileTypes:["image/jpeg","image/png","image/jpg"],maxFileSize:"2KB",maxFiles:5};onFileAdd(i){let e=i.file.file;if(!["image/jpeg","image/png","image/jpg"].includes(e.type)){this.toastr.error("Invalid file type. Only JPG, JPEG, and PNG are allowed.","","toast-top-right");return}if(e.size>2*1e6){this.toastr.error("File size should not exceed 2MB.","","toast-top-right");return}this.pondFiles.push(e),this.UploadFiles=this.pondFiles}onSubmit(){if(this.formFields.forEach(i=>{(i.is_child_show===!1||i.is_show===!1)&&(this.myForm.get(i.name)?.clearValidators(),this.myForm.get(i.name)?.updateValueAndValidity())}),this.myForm.valid){this.api.disabled=!0;let i={primaryFields:{form_data:{}}};this.formFields.forEach(t=>{t.name&&this.myForm.value.hasOwnProperty(t.name)&&(t.read_only===!1&&t.key_source!=="custom"&&(i.primaryFields[t.name]=this.myForm.value[t.name]),t.key_source==="custom"&&(i.primaryFields.form_data[t.name]=this.myForm.value[t.name]),t.type===this.fieldTypes.UPLOAD&&delete i.primaryFields.form_data[t.name])}),i.primaryFields.form_data.files=this.myForm.value.files;let e=this.formFields.find(t=>t.name==="customer_id")?.options?.find(t=>t.value===this.myForm.value.customer_id),o=this.formFields.find(t=>t.name==="customer_type_id")?.options?.find(t=>t.value===this.myForm.value.customer_type_id),n=this.formFields.find(t=>t.name==="product_id")?.options?.find(t=>t.value===this.myForm.value.product_id);e&&(i.primaryFields.customer_name=e.label),o&&(i.primaryFields.customer_type_name=o.label),n&&(i.primaryFields.product_name=n.label),this.formValidation.removeEmptyFields(i.primaryFields),this.formValidation.removeEmptyFields(i.primaryFields.form_data),this.api.post(i.primaryFields,"brand-audit/create").subscribe(t=>{t.statusCode===200&&(this.UploadFiles.length>0?(this.api.disabled=!0,this.uploadService.uploadFile(t.data.inserted_id,"brand-audit",this.UploadFiles,"Branding Images",this.subModule,"/apps/sfa/branding")):(this.api.disabled=!1,this.router.navigate(["/apps/sfa/branding"]),this.toastr.success(t.message,"","toast-top-right")))})}else{this.toastr.error("Form Is Invalid","","toast-top-right"),this.formValidation.markFormGroupTouched(this.myForm);let i=Object.keys(this.myForm.controls).filter(e=>this.myForm.get(e)?.invalid);console.warn("Invalid fields:",i)}}openModal(){this.dialog.open(de,{data:{lastPage:"form-config",form_Fields:this.originalFormFields,moduleFormId:this.moduleFormId,moduleId:this.subModule.module_id,moduleName:this.subModule.title,moduleData:this.subModule}}).afterClosed().subscribe(e=>{this.getFormData()})}static \u0275fac=function(e){return new(e||a)(d(X),d(G),d(Y),d(K),d($),d(ee),d(J),d(re),d(se),d(ne),d(k),d(Q),d(j))};static \u0275cmp=M({type:a,selectors:[["app-branding-add"]],inputs:{formFields:"formFields"},decls:4,vars:12,consts:[["dynamicForm",""],[3,"buttonClick1","title","title1","activeitem","buttonText1","icon1","btnShow1","buttonValue1"],["class","box",4,"ngIf"],["class","xl:col-span-12 col-span-12",4,"ngIf"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","gap-x-6"],["class","xl:col-span-3 col-span-12 mb-4",4,"ngFor","ngForOf"],[1,"xl:col-span-3","col-span-12","mb-4"],[1,"xl:col-span-12","col-span-12"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"ngSubmit","formGroup"],["class","grid grid-cols-12 gap-x-6",4,"ngIf"],[1,"box-footer","border-t","border-block-start-dashed","sm:flex","justify-end"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],[4,"ngFor","ngForOf"],[3,"class",4,"ngIf"],[3,"searchChanged","valueChange","field","form"]],template:function(e,o){e&1&&(c(0,"app-page-header",1),V(1,"titlecase"),C("buttonClick1",function(){return o.openModal()}),f(),h(2,ue,4,2,"div",2)(3,ve,2,1,"div",3)),e&2&&(l("title","SFA")("title1",x(11,ce))("activeitem",O(1,9,o.pageType)+" Branding")("buttonText1","Form Config")("icon1","settings")("btnShow1",!0)("buttonValue1",""),p(2),l("ngIf",o.skLoading),p(),l("ngIf",!o.skLoading))},dependencies:[U,L,w,R,te,z,P,H,ae,le,q,ie,W,Z],encapsulation:2})};export{me as BrandingAddComponent};
