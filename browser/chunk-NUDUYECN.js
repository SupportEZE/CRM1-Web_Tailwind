import{a as De}from"./chunk-J4NDCUAB.js";import{a as Ie}from"./chunk-SQZ3YN6N.js";import{c as Ee}from"./chunk-CIBZCVJQ.js";import{a as N}from"./chunk-OTFCGVEU.js";import{a as Ve}from"./chunk-HPLI5COI.js";import{a as ye}from"./chunk-OEHD5D2Y.js";import{a as Fe}from"./chunk-GLWQGYBC.js";import{a as ce}from"./chunk-DC4QM32I.js";import{C as ke,F as B,c as se,g as Se,q as we,r as Le,s as Te,u as Ae,v as Me}from"./chunk-VHE3PQ3O.js";import{$ as le,A as $,Aa as de,B as I,C as ee,Ea as ue,G as te,Ga as _e,H as ne,M as ie,Oa as ge,P as oe,Pa as fe,Qa as be,Ra as Ce,Ta as he,Ua as ve,V as ae,W as D,X as re,Z as P,Za as xe,_ as We,hb as R,va as me,w as F,wa as pe,z as Z}from"./chunk-GYDYF5F3.js";import{M as Y,e as J,f as K,g as V,n as Q,o as X,t as E}from"./chunk-PD5VTTIY.js";import{Aa as p,Ba as d,Bc as j,Hb as A,Mc as g,Nc as C,Ob as _,Uc as x,Vc as y,Wc as S,Yc as T,Zc as G,_b as m,_c as U,ad as H,bc as M,ed as k,fc as v,fd as q,gd as z,kc as a,lc as r,mc as h,nc as w,oc as L,qc as b,rb as l,sb as f,wc as u,yc as s}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{g as Oe}from"./chunk-66YHNWRR.js";var Re=Oe(We());function Qe(n,i){if(n&1){let e=b();a(0,"div",1)(1,"app-modal-header",2),k(2,"titlecase"),u("close",function(){p(e);let t=s();return d(t.closeModal())}),r(),a(3,"form",3),u("ngSubmit",function(){p(e);let t=s();return d(t.updateStatus())}),a(4,"mat-dialog-content",4)(5,"div",5)(6,"div",6),h(7,"spk-ng-select",7),r()()(),a(8,"mat-dialog-actions",8),h(9,"app-button",9)(10,"app-button",10),r()()()}if(n&2){let e=s();l(),m("title",q(2,14,e.pageType)+" Status")("closeBtn",!0),l(2),m("formGroup",e.statusForm),l(4),m("fieldReq",!0)("options",e.statusTypeList),l(2),m("buttonType","button")("buttonClass","ti-btn ti-btn-outline-danger m-2")("label","Cancel"),l(),m("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",e.api.disabled)("formType","add")("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}var O=class n{constructor(i,e,o,t,c,Be,Ne){this.fb=i;this.formValidation=e;this.logService=o;this.modalData=t;this.dialogRef=c;this.api=Be;this.toastr=Ne}statusForm;editId;data={};originalData={};pageType="add";statusTypeList=[{label:"Published",value:"Published"},{label:"Unpublished",value:"Unpublished"}];ngOnInit(){this.statusForm=this.fb.group({status:["Published",$.required]}),this.modalData.pageType==="edit"&&(this.data=this.modalData.rowData,this.data&&(this.originalData=this.data,this.statusForm.patchValue(this.data),this.editId=this.data._id,this.pageType=this.data._id?"edit":"add"))}updateStatus(){if(this.statusForm.valid){this.editId&&(this.statusForm.value._id=this.editId);let i=this.pageType==="edit";if(i&&this.logService.logActivityOnUpdate(i,this.originalData,this.statusForm.value,this.modalData.modules.module_id,this.modalData.modules.title,"update",this.editId||null,()=>{},this.modalData.modules.module_type)){this.api.disabled=!1,this.toastr.warning("No changes detected","","toast-top-right");return}this.api.disabled=!0,this.api.patch(this.statusForm.value,"announcement/update-status").subscribe(e=>{e.statusCode==200&&(this.api.disabled=!1,this.dialogRef.close(!0),this.toastr.success(e.message,"","toast-top-right"))})}else this.formValidation.markFormGroupTouched(this.statusForm)}closeModal(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(f(ae),f(Me),f(N),f(fe),f(ge),f(P),f(F))};static \u0275cmp=A({type:n,selectors:[["app-announcement-modal"]],decls:1,vars:1,consts:[["class","mat-dialoge",4,"ngIf"],[1,"mat-dialoge"],[3,"close","title","closeBtn"],[3,"ngSubmit","formGroup"],[1,"mat-typography"],[1,"grid","grid-cols-12","gap-x-6"],[1,"xxl:col-span-12","xl:col-span-6","lg:col-span-6","md:col-span-12","col-span-12"],["formControlName","status","label","Status",3,"fieldReq","options"],["align","end"],["mat-dialog-close","",3,"buttonType","buttonClass","label"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"]],template:function(e,o){e&1&&_(0,Qe,11,16,"div",0),e&2&&m("ngIf",o.modalData.pageType==="edit")},dependencies:[B,V,ne,I,ee,ie,oe,Se,ke,Q,E,R,Ce,ve,he,D,re,Le],encapsulation:2})};var Xe=()=>["Announcement"],W=()=>[],Ye=(n,i,e,o)=>({name:n,label:i,icon:e,count:o}),Ze=n=>[n],$e=(n,i)=>({"text-success bg-success/10":n,"text-danger bg-danger/10":i});function et(n,i){n&1&&h(0,"app-skeleton"),n&2&&M("w100 h25")}function tt(n,i){n&1&&(w(0),_(1,et,1,2,"app-skeleton",10),L()),n&2&&(l(),m("ngForOf",T(1,W).constructor(2)))}function nt(n,i){if(n&1){let e=b();a(0,"app-listing-tab",12),u("tabChange",function(t){p(e);let c=s(2);return d(c.onTabChange(t.tab))}),r()}if(n&2){let e=i.$implicit,o=s(2);m("tabs",G(7,Ze,H(2,Ye,e.name,e.label,e.icon,e.count)))("activeTab",o.activeTab)}}function it(n,i){if(n&1&&(w(0),_(1,nt,1,9,"app-listing-tab",11),L()),n&2){let e=s();l(),m("ngForOf",e.mainTabs)}}function ot(n,i){if(n&1){let e=b();a(0,"button",19),u("click",function(){p(e);let t=s(2);return t.filter.title="",d(t.getList())}),a(1,"mat-icon"),g(2,"close"),r()()}}function at(n,i){if(n&1){let e=b();a(0,"button",19),u("click",function(){p(e);let t=s(2);return t.filter.login_type_name="",d(t.getList())}),a(1,"mat-icon"),g(2,"close"),r()()}}function rt(n,i){if(n&1){let e=b();a(0,"button",19),u("click",function(){p(e);let t=s(2);return t.filter.customer_type_name="",d(t.getList())}),a(1,"mat-icon"),g(2,"close"),r()()}}function lt(n,i){if(n&1){let e=b();a(0,"button",19),u("click",function(){p(e);let t=s(2);return t.filter.state="",d(t.getList())}),a(1,"mat-icon"),g(2,"close"),r()()}}function st(n,i){if(n&1){let e=b();a(0,"button",19),u("click",function(){p(e);let t=s(2);return t.filter.description="",d(t.getList())}),a(1,"mat-icon"),g(2,"close"),r()()}}function ct(n,i){if(n&1){let e=b();a(0,"button",19),u("click",function(){p(e);let t=s(2);return t.filter.status="",d(t.getList())}),a(1,"mat-icon"),g(2,"close"),r()()}}function mt(n,i){if(n&1&&(a(0,"span",31),g(1),r()),n&2){let e=i.$implicit;l(),C(e)}}function pt(n,i){if(n&1&&(a(0,"div",29),_(1,mt,2,1,"span",30),r()),n&2){let e=s().$implicit;l(),m("ngForOf",e.state)}}function dt(n,i){if(n&1){let e=b();a(0,"app-icon-button",32),u("clickEvent",function(){p(e);let t=s().$implicit,c=s(2);return d(c.openModal(t,"edit"))}),r()}n&2&&m("icon","ri-edit-line")("buttonClass","ti-btn btn-wave  ti-btn-sm ti-btn-soft-success waves-effect waves-light")}function ut(n,i){if(n&1){let e=b();a(0,"app-icon-button",33),u("clickEvent",function(){p(e);let t=s().$implicit,c=s(2);return d(c.onDeleteRow(t._id))}),r()}n&2&&m("icon","ri-delete-bin-line")("buttonClass","ti-btn btn-wave product-btn ti-btn-sm ti-btn-soft-danger waves-effect waves-light")}function _t(n,i){if(n&1){let e=b();a(0,"tr",20)(1,"td",21),g(2),r(),a(3,"td"),g(4),k(5,"date"),r(),a(6,"td"),g(7),r(),a(8,"td")(9,"a",22),u("click",function(){let t=p(e).$implicit,c=s(2);return d(c.goToDetailPage(t._id))}),g(10),r()(),a(11,"td"),g(12),r(),a(13,"td"),g(14),r(),a(15,"td"),_(16,pt,2,1,"div",23),r(),a(17,"td")(18,"span",24),g(19),r()(),a(20,"td")(21,"span",25),g(22),r()(),a(23,"td",21),_(24,dt,1,2,"app-icon-button",26),a(25,"app-icon-button",27),u("clickEvent",function(){let t=p(e).$implicit,c=s(2);return d(c.openMainLogModal(t._id))}),r(),_(26,ut,1,2,"app-icon-button",28),r()()}if(n&2){let e=i.$implicit,o=i.index,t=s(2);l(2),C((t.pagination.cur_page-1)*t.pagination.limit+o+1),l(2),C(e.created_at?z(5,15,e.created_at,"d MMM yyyy, hh:mm a"):"--"),l(3),C(e.created_name||"--"),l(3),C(e.title||"--"),l(2),C(e.login_type_name||"--"),l(2),C(e.customer_type_name||"--"),l(2),m("ngIf",e.state),l(2),j("matTooltip",e.description),l(),C(e.description||"--"),l(2),m("ngClass",U(18,$e,e.status==="Published",e.status==="Unpublished")),l(),C(e.status||"--"),l(2),m("ngIf",e.status==="Unpublished"&&(t.accessRight==null?null:t.accessRight.modifyRight)),l(),m("icon","ri-file-list-line")("buttonClass","ti-btn btn-wave  ti-btn-sm ti-btn-soft-primary waves-effect waves-light"),l(),m("ngIf",e.status==="Unpublished"&&(t.accessRight==null?null:t.accessRight.deleteRight))}}function gt(n,i){if(n&1){let e=b();w(0),a(1,"tr",13)(2,"td"),g(3,"\xA0"),r(),a(4,"td"),g(5,"\xA0"),r(),a(6,"td"),g(7,"\xA0"),r(),a(8,"td")(9,"div",14)(10,"mat-form-field",15)(11,"input",16),S("ngModelChange",function(t){p(e);let c=s();return y(c.filter.title,t)||(c.filter.title=t),d(t)}),u("keyup.enter",function(){p(e);let t=s();return d(t.getList())}),r(),_(12,ot,3,0,"button",17),r()()(),a(13,"td")(14,"div",14)(15,"mat-form-field",15)(16,"input",16),S("ngModelChange",function(t){p(e);let c=s();return y(c.filter.login_type_name,t)||(c.filter.login_type_name=t),d(t)}),u("keyup.enter",function(){p(e);let t=s();return d(t.getList())}),r(),_(17,at,3,0,"button",17),r()()(),a(18,"td")(19,"div",14)(20,"mat-form-field",15)(21,"input",16),S("ngModelChange",function(t){p(e);let c=s();return y(c.filter.customer_type_name,t)||(c.filter.customer_type_name=t),d(t)}),u("keyup.enter",function(){p(e);let t=s();return d(t.getList())}),r(),_(22,rt,3,0,"button",17),r()()(),a(23,"td")(24,"div",14)(25,"mat-form-field",15)(26,"input",16),S("ngModelChange",function(t){p(e);let c=s();return y(c.filter.state,t)||(c.filter.state=t),d(t)}),u("keyup.enter",function(){p(e);let t=s();return d(t.getList())}),r(),_(27,lt,3,0,"button",17),r()()(),a(28,"td")(29,"div",14)(30,"mat-form-field",15)(31,"input",16),S("ngModelChange",function(t){p(e);let c=s();return y(c.filter.description,t)||(c.filter.description=t),d(t)}),u("keyup.enter",function(){p(e);let t=s();return d(t.getList())}),r(),_(32,st,3,0,"button",17),r()()(),a(33,"td")(34,"div",14)(35,"mat-form-field",15)(36,"input",16),S("ngModelChange",function(t){p(e);let c=s();return y(c.filter.status,t)||(c.filter.status=t),d(t)}),u("keyup.enter",function(){p(e);let t=s();return d(t.getList())}),r(),_(37,ct,3,0,"button",17),r()()(),a(38,"td"),g(39,"\xA0"),r()(),_(40,_t,27,21,"tr",18),L()}if(n&2){let e=s();l(11),x("ngModel",e.filter.title),l(),v(e.filter.title?12:-1),l(4),x("ngModel",e.filter.login_type_name),l(),v(e.filter.login_type_name?17:-1),l(4),x("ngModel",e.filter.customer_type_name),l(),v(e.filter.customer_type_name?22:-1),l(4),x("ngModel",e.filter.state),l(),v(e.filter.state?27:-1),l(4),x("ngModel",e.filter.description),l(),v(e.filter.description?32:-1),l(4),x("ngModel",e.filter.status),l(),v(e.filter.status?37:-1),l(3),m("ngForOf",e.listing)}}function ft(n,i){n&1&&(a(0,"td"),h(1,"app-skeleton"),r()),n&2&&(l(),M("h20 bg-skeleton"))}function bt(n,i){n&1&&(a(0,"tr",13),_(1,ft,2,2,"td",35),r()),n&2&&(l(),m("ngForOf",T(1,W).constructor(10)))}function Ct(n,i){n&1&&(w(0),_(1,bt,2,2,"tr",34),L()),n&2&&(l(),m("ngForOf",T(1,W).constructor(8)))}function ht(n,i){n&1&&(w(0),h(1,"app-data-not-found"),L())}var Pe=class n{constructor(i,e,o,t,c,Be,Ne,vt){this.dialog=i;this.api=e;this.comanFuncation=o;this.moduleService=t;this.alert=c;this.router=Be;this.logService=Ne;this.toastr=vt}page=1;FORMID=Ve;skLoading=!1;activeTab="Published";pagination={};filter={};mainTabs=[];modules={};listingCount={};listing=[];accessRight={};ngOnInit(){let i=this.moduleService.getAccessMap("Announcement");i&&(this.accessRight=i);let e=this.moduleService.getModuleByName("Announcement");e&&(this.modules=e),this.getList()}onRefresh(){this.filter={},this.getList()}onTabChange(i){this.activeTab=i,this.getList()}goToAddPage(){this.router.navigate(["/apps/sfa/announcement/announcement-add"])}goToDetailPage(i){this.router.navigate(["/apps/sfa/announcement/announcement-detail",i])}changeToPage(i){this.pagination.cur_page=i,this.getList()}changeToPagination(i){i==="Next"&&this.pagination.cur_page<this.pagination.total_pages?this.pagination.cur_page++:i==="Previous"&&this.pagination.cur_page>1&&this.pagination.cur_page--,this.getList()}getList(){this.skLoading=!0,this.api.post({filters:this.filter,activeTab:this.activeTab,page:this.pagination.cur_page??1},"announcement/read").subscribe(i=>{i.statusCode==200&&(this.skLoading=!1,this.listing=i.data.result,this.listingCount=i.data.tabCount,this.pagination=i.pagination,this.mainTabs=[{name:"Published",label:"Published",icon:"ri-check-double-line",count:this.listingCount.published},{name:"Unpublished",label:"Unpublished",icon:"ri-file-forbid-line",count:this.listingCount.unpublished}])})}onDeleteRow(i){this.alert.confirm("Are you sure?").then(e=>{e.isConfirmed&&this.api.patch({_id:i,is_delete:1},"announcement/delete").subscribe(o=>{o.statusCode===200&&(this.logService.logActivityOnDelete(this.modules.module_id,this.modules.title,"delete",i,"Announcement"),Re.default.fire("Deleted!",o.message,"success"),this.getList())})})}openMainLogModal(i){this.comanFuncation.listLogsModal(this.modules.module_id,i,this.modules.module_type).subscribe(e=>{e===!0&&this.getList()})}openModal(i,e){this.dialog.open(O,{width:"400px",data:{rowData:i,pageType:e,modules:this.modules}}).afterClosed().subscribe(t=>{t===!0&&this.getList()})}PageHeaders=[{label:"Created At",field:"Created At"},{label:"Created By",field:"Created By"},{label:"Title",field:"Title"},{label:"Login Type",field:"Login Type"},{label:"Customer Category",field:"Customer Category"},{label:"State",field:"State"},{label:"Description",field:"Description"},{label:"Status",field:"Status"}];static \u0275fac=function(e){return new(e||n)(f(be),f(P),f(Ee),f(ce),f(le),f(Y),f(N),f(F))};static \u0275cmp=A({type:n,selectors:[["app-announcement-list"]],decls:14,vars:29,consts:[[3,"title","title1","activeitem"],[1,"box","py-3","px-4"],["aria-label","Tabs","role","tablist",1,"sm:flex","sm:space-x-2","sm:rtl:space-x-reverse","gap-1"],[4,"ngIf"],[1,"row"],[1,"col-xl-12"],[3,"onRefresh","logBtn","button1","pageTitle","listLength","btnShow","refreshLabel","btnShow1","logsLabel","btnShow2","addBtnLabel"],[1,"table-responsive","overflow-auto","table-bordered-default"],["tableClass","ti-custom-table ti-custom-table-head ti-custom-table-hover ti-head-primary whitespace-nowrap",3,"tableHead","showS_No","showAction","columns"],[3,"preButtonClick","nextButtonClick","pageChange","currentPage","totalPage","pageLimit","listLength","preBtn","nextBtn"],[3,"class",4,"ngFor","ngForOf"],[3,"tabs","activeTab","tabChange",4,"ngFor","ngForOf"],[3,"tabChange","tabs","activeTab"],[1,"border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"table-search-filters"],[1,"table-input"],["matInput","","type","text","placeholder","Search...",3,"ngModelChange","keyup.enter","ngModel"],["matSuffix","","mat-icon-button","","aria-label","Clear"],["class","product-list border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"click"],[1,"product-list","border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"!text-center"],[1,"text-primary","font-semibold","underline",3,"click"],["class","",4,"ngIf"],[1,"ellipsis",3,"matTooltip"],[1,"badge",3,"ngClass"],["matTooltip","Change Status",3,"icon","buttonClass","clickEvent",4,"ngIf"],["matTooltip","View Logs",3,"clickEvent","icon","buttonClass"],["matTooltip","Delete",3,"icon","buttonClass","clickEvent",4,"ngIf"],[1,""],["class","badge bg-light text-textmuted dark:text-textmuted/50 m-1 border border-defaultborder dark:border-defaultborder/10",4,"ngFor","ngForOf"],[1,"badge","bg-light","text-textmuted","dark:text-textmuted/50","m-1","border","border-defaultborder","dark:border-defaultborder/10"],["matTooltip","Change Status",3,"clickEvent","icon","buttonClass"],["matTooltip","Delete",3,"clickEvent","icon","buttonClass"],["class","border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"]],template:function(e,o){e&1&&(h(0,"app-page-header",0),a(1,"div",1)(2,"nav",2),_(3,tt,2,2,"ng-container",3)(4,it,2,1,"ng-container",3),r(),a(5,"div",4)(6,"div",5)(7,"app-page-sub-header",6),u("onRefresh",function(){return o.onRefresh()})("logBtn",function(){return o.openMainLogModal("")})("button1",function(){return o.goToAddPage()}),r(),a(8,"div",7)(9,"spk-reusable-tables",8),_(10,gt,41,13,"ng-container",3)(11,Ct,2,2,"ng-container",3),r(),_(12,ht,2,0,"ng-container",3),r(),a(13,"app-pagination-footer",9),u("preButtonClick",function(){return o.changeToPagination("Previous")})("nextButtonClick",function(){return o.changeToPagination("Next")})("pageChange",function(c){return o.changeToPage(c)}),r()()()()),e&2&&(m("title","Announcement")("title1",T(28,Xe))("activeitem","Announcement List"),l(3),m("ngIf",o.skLoading),l(),m("ngIf",!o.skLoading),l(3),M("p-0 pt-3"),m("pageTitle","Announcement List")("listLength",o.listing.length)("btnShow",!0)("refreshLabel","Refresh")("btnShow1",!0)("logsLabel","Logs")("btnShow2",o.accessRight==null?null:o.accessRight.addRight)("addBtnLabel","Add Announcement"),l(2),m("tableHead","border-b")("showS_No",!0)("showAction",!0)("columns",o.PageHeaders),l(),m("ngIf",!o.skLoading),l(),m("ngIf",o.skLoading),l(),m("ngIf",!o.listing.length&&!o.skLoading),l(),m("currentPage",o.pagination.cur_page)("totalPage",o.pagination.total_pages)("pageLimit",o.pagination.limit)("listLength",o.listing.length)("preBtn",!o.pagination.prev)("nextBtn",!o.pagination.next))},dependencies:[B,J,K,V,Z,I,te,Fe,se,Te,we,De,Ie,Ae,xe,X,E,ye,R,de,ue,_e,pe,me,D],encapsulation:2})};export{Pe as AnnouncementListComponent};
