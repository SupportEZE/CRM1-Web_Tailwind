import{a as re}from"./chunk-PU6S26UW.js";import{a as se}from"./chunk-SQZ3YN6N.js";import"./chunk-OTFCGVEU.js";import{a as U}from"./chunk-CNF4GSI7.js";import{a as W}from"./chunk-OEHD5D2Y.js";import{a as ne}from"./chunk-GLWQGYBC.js";import{a as J}from"./chunk-DC4QM32I.js";import{C as ie,F as oe,c as H,g as $,h as K,j as X,k as Z,v as ee,w as te}from"./chunk-VHE3PQ3O.js";import{A as g,B as M,C as O,H as B,M as j,P as L,V as z,X as G,Z as Y,hb as Q,o as f,w as E}from"./chunk-GYDYF5F3.js";import{K as P,M as N,Q as q,f as A,g as w,t as D}from"./chunk-PD5VTTIY.js";import{Aa as m,Ba as p,Hb as I,Mc as y,Nc as b,Ob as h,Yc as k,_b as a,f as R,kc as s,lc as l,mc as v,nc as T,oc as V,qc as C,rb as n,sb as u,wc as _,yc as d}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as S,b as x}from"./chunk-66YHNWRR.js";var le=()=>["Stock Return"],ce=()=>[];function de(c,o){c&1&&(s(0,"div",7),v(1,"app-skeleton"),l())}function me(c,o){c&1&&(s(0,"div",3)(1,"div",4)(2,"div",5),h(3,de,2,0,"div",6),l()()()),c&2&&(n(3),a("ngForOf",k(1,ce).constructor(10)))}function pe(c,o){if(c&1){let e=C();T(0),s(1,"div",11)(2,"spk-ng-select",34),_("selectedChange",function(i){m(e);let r=d(2);return r.getReceiverCustomer(i),p(r.findName(i,"receiver_customer_type_id"))}),l()(),s(3,"div",11)(4,"spk-ng-select",35),_("searchChanged",function(i){m(e);let r=d(2);return p(r.onSearch(i,"receiver_customer"))})("selectedChange",function(i){m(e);let r=d(2);return p(r.findName(i,"receiver_customer_id"))}),l()(),V()}if(c&2){let e=d(2);n(2),a("fieldReq",!0)("options",e.customerCategorySubType)("multiple",!1),n(2),a("fieldReq",!0)("search",!0)("options",e.customerData)("multiple",!1)}}function ue(c,o){if(c&1){let e=C();s(0,"tr")(1,"td",39),y(2),l(),s(3,"td"),y(4),l(),s(5,"td",40),y(6),l(),s(7,"td",41)(8,"div",42)(9,"app-icon-button",43),_("clickEvent",function(){let i=m(e).index,r=d(3);return p(r.delete(i))}),l()()()()}if(c&2){let e=o.$implicit,t=o.index;n(2),b(t+1),n(2),b(e.label?e.label:"---"),n(2),b(e.qty?e.qty:"0"),n(3),a("icon","ri-delete-bin-line")("buttonClass","ti-btn btn-wave product-btn ti-btn-sm ti-btn-soft-danger waves-effect waves-light")}}function _e(c,o){if(c&1&&(s(0,"div",23)(1,"div",36)(2,"spk-reusable-tables",37),h(3,ue,10,5,"tr",38),l()()()),c&2){let e=d(2);n(2),a("columns",e.headerColumn)("tableHead","border-b")("showCheckbox",!1),n(),a("ngForOf",e.selectedItems)}}function fe(c,o){if(c&1){let e=C();s(0,"div",8)(1,"form",9),_("ngSubmit",function(){m(e);let i=d();return p(i.onSubmit())}),s(2,"div",3)(3,"div",4)(4,"div",10)(5,"div",11)(6,"spk-ng-select",12),_("selectedChange",function(i){m(e);let r=d();return r.getSenderCustomer(i),p(r.findName(i,"sender_customer_type_id"))}),l()(),s(7,"div",11)(8,"spk-ng-select",13),_("searchChanged",function(i){m(e);let r=d();return p(r.onSearch(i,"sender_customer"))})("selectedChange",function(i){m(e);let r=d();return p(r.findName(i,"sender_customer_id"))}),l()(),h(9,pe,5,7,"ng-container",14),s(10,"div",15),v(11,"spk-flatpickr",16),l(),s(12,"div",15),v(13,"spk-input",17),l(),s(14,"div",15),v(15,"spk-input",18),l(),s(16,"div",15)(17,"label",19),y(18,"Upload Bill Copy"),s(19,"span",20),y(20,"*"),l()(),s(21,"file-pond",21),_("onremovefile",function(i){m(e);let r=d();return p(r.onFileRemove(i,"image"))})("onprocessfile",function(i){m(e);let r=d();return p(r.onFileProcessed(i,"image"))}),l()()(),s(22,"div",22)(23,"div",23)(24,"div",24)(25,"div",25)(26,"spk-ng-select",26),_("searchChanged",function(i){m(e);let r=d();return p(r.onSearch(i,"product"))}),l()(),s(27,"div",25)(28,"div",27),v(29,"spk-input",28),s(30,"button",29),_("click",function(){m(e);let i=d();return p(i.addToList())}),v(31,"i",30),l()()()()(),h(32,_e,4,4,"div",31),l(),s(33,"div",32),v(34,"app-button",33),l()()()()()}if(c&2){let e=d();n(),a("formGroup",e.stockForm),n(5),a("label",e.detailData["return-type"]==="customer"?"Sender ":"Customer Category")("fieldReq",!0)("options",e.commonApi.customerCategorySubType)("multiple",!1),n(2),a("label",e.detailData["return-type"]==="customer"?"Sender ":"Customer")("fieldReq",!0)("search",!0)("options",e.commonApi.customerData)("multiple",!1),n(),a("ngIf",e.detailData["return-type"]!="company"),n(2),a("fieldReq",!0)("max",e.today),n(2),a("fieldReq",!0),n(2),a("fieldReq",!0),n(6),a("options",e.getPondOptions("image"))("files",e.pondImages),n(5),a("search",!0)("fieldReq",e.selectedItems.length===0)("options",e.product)("multiple",!1),n(3),a("fieldReq",e.selectedItems.length===0),n(3),a("ngIf",e.selectedItems.length>0),n(2),a("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("iconClass",e.api.disabled?"ri-loader-2-fill animate-spin":"ri-save-line")("loadingIconClass","ri-loader-2-fill")("disabled",e.api.disabled)}}var ae=class c{constructor(o,e,t,i,r,F,ge,ve,he){this.toastr=o;this.api=e;this.formValidation=t;this.fb=i;this.router=r;this.route=F;this.commonApi=ge;this.uploadService=ve;this.moduleService=he}skLoading=!1;stockForm;today=new Date;pondFiles=[];submodule;pondPdf=[];pondImages=[];pondOptions=this.getPondOptions("image");pondDocumentOptions=this.getPondOptions("pdf");detailData={};product=[];selectedItems=[];ngOnInit(){let o=this.router.getCurrentNavigation();if(o?.extras?.state?.detail)this.detailData=o.extras.state.detail;else{let t=history.state;t?.detail&&(this.detailData=t.detail)}let e=this.moduleService.getSubModuleByName("IRP","Stock Transfer");e&&(this.submodule=e),this.detailData["return-type"]==="company"&&this.commonApi.getCustomerCategorySubType([f.PRIMARY,f.SUB_PRIMARY]),this.detailData["return-type"]==="customer"&&this.commonApi.getCustomerCategorySubType([f.SECONDARY,f.INFLUENCER]),this.getProduct(),this.stockForm=this.fb.group({bill_date:["",g.required],bill_amount:["",g.required],bill_number:["",g.required],sender_login_type_id:[""],sender_customer_type_id:["",g.required],sender_customer_id:["",g.required],receiver_login_type_id:[""],receiver_customer_type_id:["",g.required],receiver_customer_id:["",g.required],product_id:["",g.required],receiver_customer_name:[""],receiver_customer_type_name:[""],sender_customer_type_name:[""],sender_customer_name:[""],qty:["",g.required]})}getPondOptions(o){let e={allowFileTypeValidation:!0,allowFileSizeValidation:!0,labelIdle:"Click or drag files here to upload...",server:{process:(t,i,r,F)=>{setTimeout(()=>{F(Date.now().toString())},1e3)},revert:(t,i)=>{i()}}};return o==="image"?x(S({},e),{allowMultiple:!0,acceptedFileTypes:["image/jpeg","image/png","image/jpg","application/pdf"],maxFiles:2,allowImageValidateSize:!0,labelFileTypeNotAllowed:"Only PNG, JPEG, or PDF files are allowed",fileValidateTypeLabelExpectedTypes:"Allowed: PNG, JPEG, PDF",labelImageValidateSizeTooSmall:"Image is too small. Min: {minWidth}\xD7{minHeight}",labelImageValidateSizeTooBig:"Image is too large. Max: {maxWidth}\xD7{maxHeight}",fileValidateFunction:t=>{let i=t.type==="application/pdf",r=i?1*1024*1024:2*1024*1024;return t.size>r?Promise.reject(`Max size exceeded: ${i?"10MB for PDF":"2MB for images"}`):Promise.resolve()}}):x(S({},e),{allowMultiple:!1,maxFiles:2,acceptedFileTypes:["application/pdf"],maxFileSize:"10MB",labelFileTypeNotAllowed:"Only PDF files are allowed",fileValidateTypeLabelExpectedTypes:"Allowed: PDF"})}onFileProcessed(o,e){let t=o.file.file;Object.assign(t,{image_type:e}),e==="image"?this.pondImages=[...this.pondImages||[],t]:e==="pdf"&&(this.pondPdf=[...this.pondPdf||[],t])}onFileRemove(o,e){let t=o.file.file;if(e==="image"){let i=this.pondImages.findIndex(r=>r.name===t.name&&r.size===t.size);i>-1&&this.pondImages.splice(i,1)}else if(e==="pdf"){let i=this.pondPdf.findIndex(r=>r.name===t.name&&r.size===t.size);i>-1&&this.pondPdf.splice(i,1)}}customerLoginType=[];customerLoginType$=new R;getCustomerLoginType(o){this.api.post({login_type_ids:o},"rbac/read-login-types").subscribe(e=>{e.statusCode===200&&(this.customerLoginType=e.data,this.customerLoginType$.next(e.data))})}customerCategorySubType=[];getCustomerCategorySubType(o,e){this.api.post({login_type_id:o,search:e},"rbac/read-customer-type").subscribe(t=>{t.statusCode===200&&(this.customerCategorySubType=t.data)})}getSenderCustomer(o){let e=this.commonApi.customerCategorySubType.find(t=>t.value===o);e&&(this.stockForm.value.sender_customer_name=e.label,this.stockForm.patchValue({sender_login_type_id:e.login_type_id}),this.detailData["return-type"]==="customer"&&(this.customerCategorySubType=[],this.customerData=[],this.stockForm.get("receiver_customer_type_id")?.reset(),this.stockForm.get("receiver_customer_id")?.reset(),e.login_type_id===f.SECONDARY&&this.getCustomerCategorySubType([f.PRIMARY]),e.login_type_id===f.INFLUENCER&&this.getCustomerCategorySubType([f.PRIMARY,f.SECONDARY]))),this.commonApi.getCustomerData(this.stockForm.value.sender_customer_type_id,this.stockForm.value.sender_login_type_id)}getReceiverCustomer(o){let e=this.customerCategorySubType.find(t=>t.value===o);e&&(this.stockForm.value.sender_customer_name=e.label,this.stockForm.patchValue({receiver_login_type_id:e.login_type_id})),this.getCustomerData(this.stockForm.value.receiver_customer_type_id,this.stockForm.value.receiver_login_type_id)}customerData=[];getCustomerData(o,e,t){this.api.post({customer_type_id:o,login_type_id:e,search:t},"customer/read-dropdown").subscribe(i=>{i.statusCode===200&&(this.customerData=i.data)})}onSearch(o,e){e==="sender_customer"&&this.commonApi.getCustomerData(this.stockForm.value.sender_customer_type_id,this.stockForm.value.sender_login_type_id,o),e==="receiver_customer"&&this.getCustomerData(this.stockForm.value.receiver_customer_type_id,this.stockForm.value.receiver_login_type_id,o),e==="product"&&this.getProduct(o)}getProduct(o){this.api.post({"dropdown-name":"Product",filters:{search:o}},"product/read-dropdown").subscribe(e=>{e.statusCode==200&&(this.product=e.data)})}addToList(){let o=this.stockForm.get("product_id")?.value,e=this.stockForm.get("qty")?.value;if(this.selectedItems.length===0){if(!o){this.toastr.error("Please select a product.","","toast-top-right");return}if(e<=0){this.toastr.error("Please enter a valid quantity greater than 0.","","toast-top-right");return}}let t=this.product.find(r=>r.value===o);if(!t){this.toastr.error("Selected product not found.","","toast-top-right");return}let i=this.selectedItems.find(r=>r.value===o);i?i.qty+=e:this.selectedItems.push({label:t.label,value:t.value,product_code:t.product_code,qty:e}),this.stockForm.get("product_id")?.reset(),this.stockForm.get("qty")?.reset(),this.selectedItems.length>0&&(this.stockForm.get("product_id")?.clearValidators(),this.stockForm.get("qty")?.clearValidators(),this.stockForm.get("product_id")?.updateValueAndValidity(),this.stockForm.get("qty")?.updateValueAndValidity())}headerColumn=[{label:"S.No",table_class:"text-center"},{label:"Product Name",table_class:""},{label:"QTY",table_class:"text-center"},{label:"Action",table_class:"text-center"}];delete(o){this.selectedItems.splice(o,1),this.toastr.success("Produc removed from the list.","","toast-top-right")}findName(o,e){if(e==="sender_customer_type_id"){let t=this.commonApi.customerCategorySubType.findIndex(i=>i.value===o);t!==-1&&this.stockForm.patchValue({sender_customer_type_name:this.commonApi.customerCategorySubType[t].label})}if(e==="sender_customer_id"){let t=this.commonApi.customerData.findIndex(i=>i.value===o);t!==-1&&this.stockForm.patchValue({sender_customer_name:this.commonApi.customerData[t].label})}if(e==="receiver_customer_type_id"){let t=this.customerCategorySubType.findIndex(i=>i.value===o);t!==-1&&this.stockForm.patchValue({receiver_customer_type_name:this.customerCategorySubType[t].label})}if(e==="receiver_customer_id"){let t=this.customerData.findIndex(i=>i.value===o);t!==-1&&this.stockForm.patchValue({receiver_customer_name:this.customerData[t].label})}}onSubmit(){if(this.detailData["return-type"]=="company"&&(this.stockForm.get("receiver_customer_type_id")?.clearValidators(),this.stockForm.get("receiver_customer_id")?.clearValidators(),this.stockForm.get("receiver_customer_id")?.updateValueAndValidity()),this.stockForm.valid){if(this.stockForm.value.sender_customer_type_id===this.stockForm.value.receiver_customer_type_id){this.toastr.error("Sender and Receiver customer category both are same","","toast-top-right");return}if(this.selectedItems.length===0){this.toastr.error("Add to list at least one item","","toast-top-right");return}this.api.disabled=!0,this.stockForm.value.selectedItems=this.selectedItems,this.pondFiles=[...this.pondImages,...this.pondPdf];let o=this.detailData["return-type"]==="company"?"stock-transfer/company-return-create":"stock-transfer/customer-return-create";this.api.post(this.stockForm.value,o).subscribe(e=>{if(e.statusCode==200){let t=this.detailData["return-type"]==="company"?"/apps/loyalty/stock-transfer-list/company/company-stock-return-list":"/apps/loyalty/stock-transfer-list/company/customer-stock-return-list";this.pondFiles.length>0?(this.uploadService.uploadFile(e.data.inserted_id,"stock-transfer",this.pondFiles,"Customer Stock Return Bill",this.submodule,t),this.api.disabled=!1):(this.api.disabled=!1,this.router.navigate([t]),this.toastr.success(e.message,"","toast-top-right"))}})}else this.formValidation.markFormGroupTouched(this.stockForm)}static \u0275fac=function(e){return new(e||c)(u(E),u(Y),u(ee),u(z),u(N),u(P),u(U),u(re),u(J))};static \u0275cmp=I({type:c,selectors:[["app-stock-return-add"]],decls:3,vars:7,consts:[[3,"title","title1","activeitem","btnShow1"],["class","box",4,"ngIf"],["class","xl:col-span-12 col-span-12",4,"ngIf"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","gap-x-6"],["class","xl:col-span-3 col-span-12 ",4,"ngFor","ngForOf"],[1,"xl:col-span-3","col-span-12"],[1,"xl:col-span-12","col-span-12"],[3,"ngSubmit","formGroup"],[1,"grid","grid-cols-12","sm:gap-x-4","sm:gap-y-4"],[1,"xxl:col-span-3","xl:col-span-3","lg:col-span-3","md:col-span-4","col-span-12"],["formControlName","sender_customer_type_id",3,"selectedChange","label","fieldReq","options","multiple"],["formControlName","sender_customer_id",3,"searchChanged","selectedChange","label","fieldReq","search","options","multiple"],[4,"ngIf"],[1,"col-span-12","xl:col-span-4","xxl:col-span-3"],["placeholder","Bill Date","label","Bill Date","formControlName","bill_date",1,"form-control","custom-datepickr",3,"fieldReq","max"],["label","Bill/Slip Number","formControlName","bill_number","type","text",1,"remove-default-class",3,"fieldReq"],["label","Bill Amount","formControlName","bill_amount","type","number",1,"remove-default-class",3,"fieldReq"],[1,"form-label","mb-0"],[1,"text-red-500"],[1,"filepond","basic-filepond",3,"onremovefile","onprocessfile","options","files"],[1,"grid","grid-cols-12","sm:gap-x-6"],[1,"xl:col-span-6","col-span-12"],[1,"grid","grid-cols-12","sm:gap-x-3"],[1,"xxl:col-span-6","xl:col-span-6","lg:col-span-6","md:col-span-6","col-span-12"],["formControlName","product_id","label","Select Product",3,"searchChanged","search","fieldReq","options","multiple"],[1,"flex","gap-4","justify-center","items-end"],["label","QTY","formControlName","qty","type","number",1,"remove-default-class",3,"fieldReq"],["type","button","aria-label","button",1,"ti-btn","m-0","ti-btn-icon","ti-btn-primary","btn-wave",3,"click"],[1,"ri-add-line"],["class","xl:col-span-6 col-span-12",4,"ngIf"],[1,"flex","items-center","justify-end","mt-10","gap-2"],[3,"buttonType","buttonClass","iconClass","loadingIconClass","disabled"],["formControlName","receiver_customer_type_id","label","Receiver Customer Category",3,"selectedChange","fieldReq","options","multiple"],["formControlName","receiver_customer_id","label","Receiver Customer",3,"searchChanged","selectedChange","fieldReq","search","options","multiple"],[1,"table-responsive","mt-4","table-bordered-default"],["tableClass","ti-custom-table ti-custom-table-hover ti-head-primary",3,"columns","tableHead","showCheckbox"],[4,"ngFor","ngForOf"],[1,"w60","text-center"],[1,"text-center"],[1,"w60","relative"],[1,"flex","flex-row","items-center","!gap-2","text-[0.9375rem]"],[3,"clickEvent","icon","buttonClass"]],template:function(e,t){e&1&&(v(0,"app-page-header",0),h(1,me,4,2,"div",1)(2,fe,35,28,"div",2)),e&2&&(a("title","IRP")("title1",k(6,le))("activeitem",t.detailData["return-type"]==="company"?"Customer To Company Stock Return":"Customer To Customer Stock Return")("btnShow1",!1),n(),a("ngIf",t.skLoading),n(),a("ngIf",!t.skLoading))},dependencies:[$,oe,A,w,B,M,O,j,L,te,ne,H,ie,se,Q,D,G,q,Z,X,K,W],encapsulation:2})};export{ae as StockReturnAddComponent};
