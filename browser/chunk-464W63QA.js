import{a as ve}from"./chunk-PU6S26UW.js";import{a as xe}from"./chunk-JUPJFX3F.js";import{a as he}from"./chunk-PJTW4QXW.js";import{a as _e}from"./chunk-SQZ3YN6N.js";import"./chunk-CIBZCVJQ.js";import"./chunk-OTFCGVEU.js";import{a as J}from"./chunk-CNF4GSI7.js";import{a as le}from"./chunk-OEHD5D2Y.js";import{a as ge}from"./chunk-GLWQGYBC.js";import{a as X}from"./chunk-DC4QM32I.js";import{B as ue,C as fe,F as w,c as K,g as re,k as se,r as pe,s as me,v as de,w as ce}from"./chunk-VHE3PQ3O.js";import{$ as z,A as P,B as O,C as H,H as Q,M as U,Oa as Z,P as Y,Pa as ee,Qa as te,Ra as ie,Ta as ae,Ua as ne,V as $,X as W,Z as E,Za as oe,hb as F,w as L}from"./chunk-GYDYF5F3.js";import{K as G,e as N,f as j,g as I,n as B,o as q,t as M}from"./chunk-PD5VTTIY.js";import{$c as A,Aa as h,Ba as g,Hb as b,Mc as l,Nc as d,Ob as c,Oc as v,Yc as T,_b as r,bc as _,ed as D,fd as R,gd as V,kc as i,lc as t,mc as u,nc as C,oc as S,qc as y,rb as a,sb as m,wc as x,yc as f}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import"./chunk-66YHNWRR.js";function Me(n,o){n&1&&(C(0),i(1,"div",13),u(2,"spk-input",14),t(),i(3,"div",13),u(4,"spk-input",15),t(),S()),n&2&&(a(4),r("fieldReq",!0))}function Pe(n,o){n&1&&(i(0,"div",6),u(1,"spk-input",16),t()),n&2&&(a(),r("fieldReq",!0))}function Ee(n,o){if(n&1){let e=y();i(0,"div",1)(1,"app-modal-header",2),x("close",function(){h(e);let p=f();return g(p.closeModal())}),t(),i(2,"form",3),x("ngSubmit",function(){h(e);let p=f();return g(p.submitStatus())}),i(3,"mat-dialog-content",4)(4,"div",5)(5,"div",6),u(6,"spk-ng-select",7),t(),c(7,Me,5,1,"ng-container",8)(8,Pe,2,1,"div",9),t()(),i(9,"mat-dialog-actions",10),u(10,"app-button",11)(11,"app-button",12),t()()()}if(n&2){let e,s,p=f();a(),r("title","Update Status")("closeBtn",!0),a(),r("formGroup",p.statusForm),a(4),r("fieldReq",!0)("options",p.statusList)("multiple",!1),a(),r("ngIf",((e=p.statusForm.get("status"))==null?null:e.value)==="Approved"),a(),r("ngIf",((s=p.statusForm.get("status"))==null?null:s.value)==="Reject"),a(2),r("buttonType","button")("buttonClass","ti-btn ti-btn-outline-danger m-2")("label","Cancel"),a(),r("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",p.api.disabled)("formType","add")("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}var k=class n{constructor(o,e,s,p,Oe,He,Qe,Ue,Ye){this.toastr=o;this.alert=e;this.api=s;this.formValidation=p;this.fb=Oe;this.uploadService=He;this.commonApi=Qe;this.modalData=Ue;this.dialogRef=Ye}skLoading=!1;statusForm;today=new Date;pondPdf=[];pondImages=[];pondFiles=[];statusList=[{label:"Approved",value:"Approved"},{label:"Reject",value:"Reject"}];ngOnInit(){this.statusForm=this.fb.group({status:["",P.required],claim_point:[{value:"",disabled:!0}],approved_point:[""],_id:[""],remarks:[""]}),this.statusForm.get("status")?.valueChanges.subscribe(o=>{let e=this.statusForm.get("remarks");o==="Reject"?e?.setValidators([P.required]):e?.clearValidators(),e?.updateValueAndValidity()}),this.statusForm.get("status")?.valueChanges.subscribe(o=>{let e=this.statusForm.get("approved_point");o==="Approved"?e?.setValidators([P.required]):e?.clearValidators(),e?.updateValueAndValidity()}),this.statusForm.patchValue({claim_point:this.modalData.claim_point}),this.statusForm.patchValue({_id:this.modalData._id}),console.log(this.statusForm.value,"value")}closeModal(){this.dialogRef.close()}submitStatus(){if(this.statusForm.value.status==="Approved"&&Number(this.statusForm.value.approved_point)>Number(this.modalData.claim_point)){this.toastr.error("Maximum point transferred "+this.modalData.claim_point,"","toast-top-right");return}this.statusForm.valid?this.alert.confirm("Are you sure?","You want to transferred point","Yes it!").then(o=>{if(o.isConfirmed){this.api.disabled=!0;let e=this.statusForm.getRawValue(),s={status:e.status};s._id=e._id,e.status==="Approved"?(s.claim_point=e.claim_point,s.approved_point=e.approved_point):e.status==="Reject"&&(s.remarks=e.remarks),this.api.patch(s,"purchase/update-status").subscribe(p=>{p.statusCode==200&&(this.api.disabled=!1,this.toastr.success(p.message,"","toast-top-right"),this.dialogRef.close(!0))})}}):this.formValidation.markFormGroupTouched(this.statusForm)}static \u0275fac=function(e){return new(e||n)(m(L),m(z),m(E),m(de),m($),m(ve),m(J),m(ee),m(Z))};static \u0275cmp=b({type:n,selectors:[["app-purchase-modal"]],decls:1,vars:1,consts:[["class","mat-dialoge",4,"ngIf"],[1,"mat-dialoge"],[3,"close","title","closeBtn"],[3,"ngSubmit","formGroup"],[1,"mat-typography"],[1,"grid","grid-cols-12","sm:gap-x-6","gap-y-5"],[1,"xxl:col-span-12","xl:col-span-12","lg:col-span-12","md:col-span-12","col-span-12"],["formControlName","status","label","Status",3,"fieldReq","options","multiple"],[4,"ngIf"],["class","xxl:col-span-12 xl:col-span-12 lg:col-span-12 md:col-span-12 col-span-12",4,"ngIf"],["align","end"],["mat-dialog-close","",3,"buttonType","buttonClass","label"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],[1,"xxl:col-span-6","xl:col-span-6","lg:col-span-6","md:col-span-6","col-span-12"],["label","Claim Point","formControlName","claim_point","type","number",1,"remove-default-class","wp100"],["label","Approved Point","formControlName","approved_point","type","number",1,"remove-default-class","wp100",3,"fieldReq"],["label","Remark","formControlName","remarks","type","textarea",1,"remove-default-class",3,"fieldReq"]],template:function(e,s){e&1&&c(0,Ee,12,17,"div",0),e&2&&r("ngIf",s.modalData.pageType==="purchase_status")},dependencies:[w,I,Q,O,H,U,Y,ce,re,fe,F,ie,ne,ae,M,W,se,pe],encapsulation:2})};var Fe=()=>["Purchase"],we=(n,o,e)=>({"text-success":n,"text-warning":o,"text-danger":e}),ke=()=>[];function Te(n,o){if(n&1){let e=y();i(0,"app-icon-button",18),x("click",function(){h(e);let p=f(2);return g(p.openModal())}),t()}n&2&&r("icon","ri-pencil-line")("buttonClass","btn-wave ti-btn ti-btn-sm ti-btn-soft-primary waves-effect waves-light")}function Ve(n,o){if(n&1&&(i(0,"div",9)(1,"div")(2,"span",10),l(3),t(),i(4,"span",14),l(5,"Reject Reason"),t()()()),n&2){let e=f(2);a(3),d(e.purchaseDetail.remarks?e.purchaseDetail.remarks:"---")}}function Ae(n,o){if(n&1&&(i(0,"ul",7)(1,"li")(2,"div",8)(3,"div",9)(4,"div")(5,"span",10),l(6),D(7,"date"),t(),i(8,"span",11),l(9,"Date Created"),t()()(),i(10,"div",9)(11,"div")(12,"span",10),l(13),D(14,"titlecase"),t(),i(15,"span",11),l(16,"Created By"),t()()(),i(17,"div",9)(18,"div")(19,"span",10),l(20),t(),i(21,"span",11),l(22,"Customer Type"),t()()(),i(23,"div",9)(24,"div")(25,"span",10),l(26),t(),i(27,"span",11),l(28,"Customer Details"),t()()(),i(29,"div",9)(30,"div")(31,"span",10),l(32),t(),i(33,"span",11),l(34,"Bill Number"),t()()(),i(35,"div",9)(36,"div")(37,"span",10),l(38),D(39,"date"),t(),i(40,"span",11),l(41,"Bill Date"),t()()(),i(42,"div",9)(43,"div")(44,"span",10),l(45),t(),i(46,"span",11),l(47,"Bill Amount Without GST"),t()()(),i(48,"div",9)(49,"div")(50,"span",10),l(51),t(),i(52,"span",11),l(53,"Total Items"),t()()(),i(54,"div",9)(55,"div")(56,"span",10),l(57),t(),i(58,"span",11),l(59,"Total Qty"),t()()(),i(60,"div",12)(61,"div")(62,"span",13),l(63),t(),i(64,"span",14),l(65,"Status"),t()(),c(66,Te,1,2,"app-icon-button",15),t(),c(67,Ve,6,1,"div",16),i(68,"div",9)(69,"div")(70,"span",17),l(71),t(),i(72,"span",14),l(73,"Claim Point"),t()()(),i(74,"div",9)(75,"div")(76,"span",17),l(77),t(),i(78,"span",14),l(79,"Transfered Point"),t()()()()()()),n&2){let e=f();a(6),v(" ",e.purchaseDetail.created_at?V(7,15,e.purchaseDetail.created_at,"dd MMM yyyy"):"---",""),a(7),d(e.purchaseDetail.created_name?R(14,18,e.purchaseDetail.created_name):"---"),a(7),d(e.purchaseDetail.customer_type_name?e.purchaseDetail.customer_type_name:"---"),a(6),v("",e.purchaseDetail.customer_name?e.purchaseDetail.customer_name:"---"," "),a(6),d(e.purchaseDetail.bill_number?e.purchaseDetail.bill_number:"---"),a(6),d(e.purchaseDetail.bill_date?V(39,20,e.purchaseDetail.bill_date,"dd MMM yyyy"):"---"),a(7),v("\u20B9 ",e.purchaseDetail.bill_amount?e.purchaseDetail.bill_amount:"---"," "),a(6),d(e.purchaseDetail.total_item?e.purchaseDetail.total_item:"---"),a(6),v(" ",e.purchaseDetail.total_qty?e.purchaseDetail.total_qty:"---"," "),a(5),r("ngClass",A(23,we,e.purchaseDetail.status==="Approved",e.purchaseDetail.status==="Pending",e.purchaseDetail.status==="Reject")),a(),v(" ",e.purchaseDetail.status?e.purchaseDetail.status:"---"," "),a(3),r("ngIf",e.purchaseDetail.status==="Pending"),a(),r("ngIf",e.purchaseDetail.remarks),a(4),d(e.totalPointValue?e.totalPointValue:"---"),a(6),d(e.purchaseDetail.approved_point?e.purchaseDetail.approved_point:"---")}}function Re(n,o){n&1&&(i(0,"div",21),u(1,"app-skeleton"),t()),n&2&&(a(),_("w180"))}function Ne(n,o){n&1&&(i(0,"div")(1,"div",19),c(2,Re,2,2,"div",20),t()()),n&2&&(a(2),r("ngForOf",T(1,ke).constructor(10)))}function je(n,o){if(n&1&&(i(0,"tr",27)(1,"td",35)(2,"div",30),l(3),t()(),i(4,"td")(5,"div",30),l(6),t()(),i(7,"td",36),l(8),t(),i(9,"td",37),l(10),t()()),n&2){let e=o.$implicit,s=o.index;a(3),v(" ",s+1," "),a(3),v(" ",e.label?e.label:"---"," "),a(2),v(" ",e.qty?e.qty:"---"," "),a(2),d(e.point_value?e.point_value:"0")}}function Be(n,o){if(n&1&&(i(0,"div",40),u(1,"spk-product-card",41),t()),n&2){let e=o.$implicit;a(),r("apiPath","purchase/get-doc")("imageData",e)("editBtn",!1)("delBtn",!1)("heading",!1)("subHeading",!1)}}function qe(n,o){if(n&1&&(i(0,"div",38),c(1,Be,2,6,"div",39),t()),n&2){let e=f(2);a(),r("ngForOf",e.purchaseDetail==null?null:e.purchaseDetail.files)}}function Ge(n,o){n&1&&(C(0),u(1,"app-data-not-found"),S())}function Le(n,o){if(n&1&&(i(0,"div",1)(1,"div",22)(2,"app-showcode-card",3)(3,"div",23)(4,"spk-reusable-tables",24),c(5,je,11,4,"tr",25),t()(),i(6,"table",26)(7,"tbody")(8,"tr",27)(9,"td",28)(10,"div",29),l(11,"Total Item :"),t()(),i(12,"td",28)(13,"span",30),l(14),t()()(),i(15,"tr",27)(16,"td",28)(17,"div",29),l(18,"Total Item Qty:"),t()(),i(19,"td",28)(20,"span",30),l(21),t()()(),i(22,"tr",27)(23,"td",28)(24,"div",29),l(25,"Total Point Value"),t()(),i(26,"td",28)(27,"span",31),l(28),t()()()()()()(),i(29,"div",32)(30,"app-showcode-card",33),c(31,qe,2,1,"div",34)(32,Ge,2,0,"ng-container",5),t()()()),n&2){let e=f();a(2),_("text-primarytint1color"),r("title","Product Details")("boxHeader","pt-3")("classbody","pt-0")("titleView",!0),a(2),r("columns",e.itemColumn)("showCheckbox",!1),a(),r("ngForOf",e.purchaseDetail.selectedItem),a(9),d(e.purchaseDetail==null?null:e.purchaseDetail.selectedItem.length),a(7),d(e.totalItemQuantity),a(7),d(e.totalPointValue),a(2),_("box-title font-medium text-[15px] block text-primarytint1color"),r("title","Uploaded Bill Document")("titleView",!0)("iconClass","ti-btn btn-wave ti-btn-sm ti-btn-soft-primary waves-effect waves-light")("classbody","pt-0")("iconName","ri-add-line"),a(),r("ngIf",(e.purchaseDetail==null||e.purchaseDetail.files==null?null:e.purchaseDetail.files.length)>0),a(),r("ngIf",(e.purchaseDetail==null||e.purchaseDetail.files==null?null:e.purchaseDetail.files.length)===0)}}var be=class n{constructor(o,e,s,p){this.route=o;this.dialog=e;this.api=s;this.moduleService=p}filter={};id={};skLoading=!1;purchaseDetail={};submodule={};ngOnInit(){let o=this.moduleService.getSubSubModuleByName("IRP","Stock Transfer","Company To Customer");o&&(this.submodule=o),this.route.paramMap.subscribe(e=>{this.id=e.get("id"),this.id&&this.getPurchaseDetail()})}getPurchaseDetail(){this.skLoading=!0,this.api.post({_id:this.id},"purchase/detail").subscribe(o=>{o.statusCode===200&&(this.skLoading=!1,this.purchaseDetail=o.data,this.purchaseDetail?.selectedItem.length>0&&this.summary())})}totalItemQuantity=0;totalPointValue=0;summary(){this.totalItemQuantity=0,this.totalPointValue=0,this.purchaseDetail.selectedItem.forEach(o=>{let e=Number(o.qty)||0,s=Number(o.point_value)||0;this.totalItemQuantity+=e,this.totalPointValue+=e*s})}openModal(){this.dialog.open(k,{width:"500px",data:{pageType:"purchase_status",_id:this.id,status:this.purchaseDetail.status,claim_point:this.totalPointValue??0,submodule:this.submodule}}).afterClosed().subscribe(e=>{e===!0&&this.getPurchaseDetail()})}itemColumn=[{label:"S.No"},{label:"Product Detail"},{label:"Qty",table_class:"text-center"},{label:"Point Per Qty.",table_class:"text-right"}];static \u0275fac=function(e){return new(e||n)(m(G),m(te),m(E),m(X))};static \u0275cmp=b({type:n,selectors:[["app-purchase-detail"]],decls:9,vars:13,consts:[[3,"title","title1","activeitem"],[1,"grid","grid-cols-12","sm:gap-x-6"],[1,"xl:col-span-12","col-span-12"],[3,"title","boxHeader","classbody","titleView"],["class","ti-list-group list-group-flush border-0",4,"ngIf"],[4,"ngIf"],["class","grid grid-cols-12 sm:gap-x-6",4,"ngIf"],[1,"ti-list-group","list-group-flush","border-0"],[1,"flex","items-center","gap-5","flex-wrap","text-[12px]"],[1,"flex","items-center","me-2","flex-wrap"],[1,"block","font-medium"],[1,"text-textmuted","dark:text-textmuted/50"],[1,"flex","items-center","me-2","gap-3","flex-wrap"],[1,"font-medium",3,"ngClass"],[1,"block","text-textmuted","dark:text-textmuted/50"],["matTooltip","Change Status",3,"icon","buttonClass","click",4,"ngIf"],["class","flex items-center me-2 flex-wrap",4,"ngIf"],[1,"text-success","text-[0.9375rem]","font-bold"],["matTooltip","Change Status",3,"click","icon","buttonClass"],[1,"flex","gap-2","mb-1","flex-wrap"],["class","flex items-center",4,"ngFor","ngForOf"],[1,"flex","items-center"],[1,"xl:col-span-8","col-span-12"],[1,"table-responsive","overflow-auto","table-bordered-default"],["tableClass","ti-custom-table ti-custom-table-head",3,"columns","showCheckbox"],["class","border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[1,"ti-custom-table","text-nowrap"],[1,"border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"text-right"],[1,"font-semibold"],[1,"font-medium"],[1,"text-right","font-medium"],[1,"xl:col-span-4","col-span-12"],[3,"title","titleView","iconClass","classbody","iconName"],["class","grid grid-cols-12 gap-x-4",4,"ngIf"],[1,"w50"],[1,"product-quantity-container","text-center","w80"],[1,"w120","text-right"],[1,"grid","grid-cols-12","gap-x-4"],["class","xxl:col-span-4 lg:col-span-4 xl:col-span-4 sm:col-span-6 col-span-12",4,"ngFor","ngForOf"],[1,"xxl:col-span-4","lg:col-span-4","xl:col-span-4","sm:col-span-6","col-span-12"],[3,"apiPath","imageData","editBtn","delBtn","heading","subHeading"]],template:function(e,s){e&1&&(u(0,"app-page-header",0),i(1,"div",1)(2,"div",2)(3,"div",1)(4,"div",2)(5,"app-showcode-card",3),c(6,Ae,80,27,"ul",4)(7,Ne,3,2,"div",5),t()()(),c(8,Le,33,21,"div",6),t()()),e&2&&(r("title","IRP")("title1",T(12,Fe))("activeitem","Purchase Detail"),a(5),_("text-primarytint1color"),r("title","Purchase Detail")("boxHeader","pt-3")("classbody","pt-0")("titleView",!0),a(),r("ngIf",!s.skLoading),a(),r("ngIf",s.skLoading),a(),r("ngIf",!s.skLoading))},dependencies:[w,N,j,I,ge,K,me,_e,oe,B,q,xe,ue,M,F,le,he],encapsulation:2})};export{be as PurchaseDetailComponent};
