import{a as ue}from"./chunk-PU6S26UW.js";import{a as _e}from"./chunk-SQZ3YN6N.js";import{a as fe}from"./chunk-OTFCGVEU.js";import{a as $}from"./chunk-CNF4GSI7.js";import{a as ee}from"./chunk-OEHD5D2Y.js";import{a as ge}from"./chunk-GLWQGYBC.js";import{a as K}from"./chunk-DC4QM32I.js";import{C as pe,F as ce,g as te,h as ie,j as oe,k as re,l as ne,m as ae,n as le,p as de,v as se,w as me}from"./chunk-VHE3PQ3O.js";import{A as u,B as j,C as O,D as x,F as v,H as z,M as H,P as U,Qa as X,V as Q,W as J,X as W,Z as Y,hb as Z,o as P,w as G}from"./chunk-GYDYF5F3.js";import{K as D,M as L,f as V,g as q,n as R,t as M}from"./chunk-PD5VTTIY.js";import{Aa as g,Ba as _,Fc as B,Gc as A,Hb as T,Hc as k,Mc as f,Nc as C,Ob as h,Yc as I,_b as d,ed as E,fd as N,kc as n,lc as l,mc as c,qc as y,rb as a,sb as p,wc as b,yc as m}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as S,b as F}from"./chunk-66YHNWRR.js";var be=["filePond"],he=()=>["Leader Board"];function ye(s,o){s&1&&(n(0,"div",37),f(1," This field is required. "),l())}function Ce(s,o){if(s&1){let e=y();n(0,"div",38)(1,"label",16),f(2,"Gift Image"),n(3,"span",17),f(4,"*"),l()(),n(5,"file-pond",18),b("onremovefile",function(i){g(e);let r=m(2);return _(r.onFileRemove(i,"image"))})("onprocessfile",function(i){g(e);let r=m(2);return _(r.onFileProcessed(i,"image"))}),l()()}if(s&2){let e=m(2);a(5),d("options",e.getPondOptions("image"))("files",e.pondBannerFiles)}}function xe(s,o){if(s&1){let e=y();n(0,"tr")(1,"td",43),f(2),l(),n(3,"td"),f(4),l(),n(5,"td",44),f(6),l(),n(7,"td",45)(8,"div",46)(9,"app-icon-button",47),b("clickEvent",function(){let i=g(e).index,r=m(3);return _(r.deleteGift(i))}),l()()()()}if(s&2){let e=o.$implicit,t=o.index;a(2),C(t+1),a(2),C(e.gift_title),a(2),C(e.rank),a(3),d("icon","ri-delete-bin-line")("buttonClass","ti-btn btn-wave product-btn ti-btn-sm ti-btn-soft-danger waves-effect waves-light")}}function Se(s,o){if(s&1&&(n(0,"div",39)(1,"div",40)(2,"spk-reusable-tables",41),h(3,xe,10,5,"tr",42),l()()()),s&2){let e=m(2);a(2),d("columns",e.headerColumn)("tableHead","border-b")("showCheckbox",!1),a(),d("ngForOf",e.giftList)}}function Fe(s,o){if(s&1){let e=y();n(0,"div",2)(1,"form",3),b("ngSubmit",function(){g(e);let i=m();return _(i.onSubmit())}),n(2,"div",4)(3,"div",5)(4,"div",6)(5,"div",7),c(6,"spk-input",8),l(),n(7,"div",7)(8,"spk-flatpickr",9),b("dateChange",function(){g(e);let i=m();return _(i.onDateChange())}),l()(),n(9,"div",7),c(10,"spk-flatpickr",10),l(),n(11,"div",7)(12,"spk-ng-select",11),b("selectedChange",function(i){g(e);let r=m();return _(r.findName(i))}),l()(),n(13,"div",7)(14,"spk-ng-select",12),b("searchChanged",function(i){g(e);let r=m();return _(r.onSearch(i))}),l()(),n(15,"div",7),c(16,"spk-ng-select",13),l(),n(17,"div",7),c(18,"spk-input",14),l(),n(19,"div",15)(20,"label",16),f(21,"Attachment"),n(22,"span",17),f(23,"*"),l()(),n(24,"file-pond",18),b("onremovefile",function(i){g(e);let r=m();return _(r.onFileRemove(i,"pdf"))})("onprocessfile",function(i){g(e);let r=m();return _(r.onFileProcessed(i,"pdf"))}),l()(),n(25,"div",15)(26,"div",19)(27,"label",16),f(28,"Terms & Condition"),n(29,"span",17),f(30,"*"),l()(),c(31,"ngx-editor-menu",20)(32,"ngx-editor",21),l(),h(33,ye,2,0,"div",22),l()(),c(34,"div",23),n(35,"div",24)(36,"div",25),f(37,"Gift Detail"),l()(),n(38,"div",26)(39,"div",15)(40,"div",6)(41,"div",27),c(42,"spk-input",28),l(),n(43,"div",27)(44,"div",29),c(45,"spk-input",30),n(46,"button",31),b("click",function(){g(e);let i=m();return _(i.addToList())}),c(47,"i",32),l()()(),h(48,Ce,6,2,"div",33),l()(),h(49,Se,4,4,"div",34),l()(),n(50,"div",35),c(51,"app-button",36),l()()()()}if(s&2){let e,t=m();a(),d("formGroup",t.leaderBoardForm),a(5),d("fieldReq",!0),a(2),d("fieldReq",!0)("min",t.today),a(2),d("min",t.leaderBoardForm.value.start_date)("fieldReq",!0),a(2),d("fieldReq",!0)("options",t.CommonApiService.customerCategorySubType)("multiple",!0),a(2),d("multiple",!0)("fieldReq",!0)("options",t.CommonApiService.statList)("search",!0),a(2),d("fieldReq",!0)("options",t.pointCategoryType)("multiple",!0),a(2),d("fieldReq",!0),a(6),d("options",t.pondDocumentOptions)("files",t.pondAttachmentFiles),a(7),d("editor",t.editor)("toolbar",t.toolbar),a(),d("editor",t.editor),a(),d("ngIf",((e=t.leaderBoardForm.get("terms_condition"))==null?null:e.invalid)&&((e=t.leaderBoardForm.get("terms_condition"))==null?null:e.touched)),a(5),d("formGroup",t.giftForm),a(4),d("fieldReq",!0),a(3),d("fieldReq",!0),a(3),d("ngIf",t.giftList.length>0),a(),d("ngIf",t.giftList.length>0),a(2),d("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",t.api.disabled)("formType",t.pageType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}var ve=class s{constructor(o,e,t,i,r,w,we,Te,Be,Ae,ke){this.dialog=o;this.api=e;this.toastr=t;this.CommonApiService=i;this.fb=r;this.router=w;this.route=we;this.logService=Te;this.formValidation=Be;this.moduleService=Ae;this.uploadService=ke;this.skLoading=!0}leaderBoardForm=new x({});giftForm=new x({});giftList=[];pondFiles=[];skLoading=!1;today=new Date;pageType="add";editor;toolbar=[["bold","italic"],["underline","strike"],["code","blockquote"],["ordered_list","bullet_list"],[{heading:["h1","h2","h3","h4","h5","h6"]}],["text_color","background_color"],["align_left","align_center","align_right","align_justify"]];uploadresults=[];Detail={};originalData={};pond;submodule;ngOnInit(){let o=this.moduleService.getSubModuleByName("IRP","Leader Board");o&&(this.submodule=o),this.editor=new de,this.CommonApiService.getStates(),this.leaderBoardForm=new x({title:new v("",u.required),start_date:new v("",u.required),end_date:new v("",u.required),customer_type_name:new v("",u.required),customer_type_id:new v("",u.required),state:new v("",u.required),ledger_creation_type:new v("",u.required),min_eligiblity_points:new v("",u.required),terms_condition:new v("",u.required)}),this.giftForm=this.fb.group({gift_title:["",u.required],rank:["",u.required]}),this.skLoading=!1,this.CommonApiService.getCustomerCategorySubType([P.INFLUENCER])}onSearch(o){this.CommonApiService.getStates(o)}onDateChange(){this.leaderBoardForm.get("end_date")?.reset()}pondBannerFiles=[];pondAttachmentFiles=[];pondOptions=this.getPondOptions("image");pondDocumentOptions=this.getPondOptions("pdf");getPondOptions(o){let e={allowFileTypeValidation:!0,labelIdle:"Click or drag files here to upload...",server:{process:(t,i,r,w)=>{setTimeout(()=>{w(Date.now().toString())},1e3)},revert:(t,i)=>{i()}}};return o==="image"?F(S({},e),{allowMultiple:!0,acceptedFileTypes:["image/jpeg","image/png","image/jpg"],maxFileSize:"2MB",maxFiles:this.giftList.length,allowImageValidateSize:!0,labelFileTypeNotAllowed:"Only PNG and JPEG files are allowed",fileValidateTypeLabelExpectedTypes:"Allowed: PNG, JPEG",labelImageValidateSizeTooSmall:"Image is too small. Min: {minWidth}\xD7{minHeight}",labelImageValidateSizeTooBig:"Image is too large. Max: {maxWidth}\xD7{maxHeight}"}):F(S({},e),{allowMultiple:!1,acceptedFileTypes:["application/pdf"],maxFileSize:"10MB",labelFileTypeNotAllowed:"Only PDF files are allowed",fileValidateTypeLabelExpectedTypes:"Allowed: PDF"})}onFileProcessed(o,e){let t=o.file.file;Object.assign(t,{image_type:e}),e==="image"?this.pondBannerFiles=[...this.pondBannerFiles||[],t]:e==="pdf"&&(this.pondAttachmentFiles=[...this.pondAttachmentFiles||[],t])}onFileRemove(o,e){let t=o.file.file;if(e==="image"){let i=this.pondBannerFiles.findIndex(r=>r.name===t.name&&r.size===t.size);i>-1&&this.pondBannerFiles.splice(i,1)}else if(e==="pdf"){let i=this.pondAttachmentFiles.findIndex(r=>r.name===t.name&&r.size===t.size);i>-1&&this.pondAttachmentFiles.splice(i,1)}}addToList(){if(this.giftForm.invalid){this.toastr.error("Fill all required gift detail fields.","","toast-top-right");return}let o=this.giftForm.value,e={gift_title:o.gift_title,rank:o.rank};this.giftList.push(e),this.giftForm.reset()}deleteGift(o){this.giftList.splice(o,1),this.toastr.success("Gift removed from the list.","","toast-top-right")}onSubmit(){if(this.leaderBoardForm.valid){if(this.pondFiles=[...this.pondBannerFiles,...this.pondAttachmentFiles],this.pondFiles.length===0&&this.pageType==="add"){this.toastr.error("Please upload at least one file.","","toast-top-right");return}if(this.giftList.length===0){this.toastr.error("Please add at least one gift.","","toast-top-right");return}let o=this.fb.array(this.giftList.map(r=>this.fb.group(r)));this.api.disabled=!0,this.leaderBoardForm.setControl("gift_detail",o);let e=this.pageType==="edit";if(e&&this.logService.logActivityOnUpdate(e,this.originalData,this.leaderBoardForm.value,this.submodule.module_id,this.submodule.title,"update",this.originalData._id||null,()=>{},this.submodule.module_type)){this.api.disabled=!1,this.toastr.warning("No changes detected","","toast-top-right");return}let t=e?"patch":"post",i=e?"leader-board/update":"leader-board/create";this.leaderBoardForm.value.min_eligiblity_points=Number(this.leaderBoardForm.value.min_eligiblity_points),this.api[t](this.leaderBoardForm.value,i).subscribe(r=>{r.statusCode==200&&(this.pondFiles.length>0?(this.uploadService.uploadFile(r.data.inserted_id,"leader-board",this.pondFiles,"Leader Board Images",this.submodule,"/apps/loyalty/leader-board"),this.api.disabled=!1):(this.api.disabled=!1,this.router.navigate(["/apps/loyalty/leader-board"]),this.toastr.success(r.message,"","toast-top-right"),this.leaderBoardForm.reset()))})}else this.formValidation.markFormGroupTouched(this.leaderBoardForm)}findName(o){let e=o;if(Array.isArray(e)&&e.length>0){let t=this.CommonApiService.customerCategorySubType.filter(i=>e.includes(i.value)).map(i=>i.label);this.leaderBoardForm.patchValue({customer_type_name:t})}}headerColumn=[{label:"S.No",table_class:"text-center"},{label:"Title",table_class:""},{label:"Rank",table_class:"text-center"},{label:"Action",table_class:"text-center"}];pointCategoryType=[{label:"Purchase",value:"Purchase"},{label:"Scan",value:"Scan"},{label:"Invite",value:"Invite"}];static \u0275fac=function(e){return new(e||s)(p(X),p(Y),p(G),p($),p(Q),p(L),p(D),p(fe),p(se),p(K),p(ue))};static \u0275cmp=T({type:s,selectors:[["app-leader-board-add"]],viewQuery:function(e,t){if(e&1&&B(be,5),e&2){let i;A(i=k())&&(t.pond=i.first)}},decls:3,vars:7,consts:[[3,"title","title1","activeitem"],["class","xl:col-span-12 col-span-12",4,"ngIf"],[1,"xl:col-span-12","col-span-12"],[3,"ngSubmit","formGroup"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","sm:gap-x-6"],[1,"xl:col-span-3","col-span-12","mb-3"],["label","Title","formControlName","title","type","text",1,"remove-default-class",3,"fieldReq"],["placeholder","Start Date","label","Start Date","formControlName","start_date",1,"form-control","custom-datepickr",3,"dateChange","fieldReq","min"],["placeholder","End Date","label","End Date","formControlName","end_date",1,"form-control","custom-datepickr",3,"min","fieldReq"],["formControlName","customer_type_id","label","Customer Category",3,"selectedChange","fieldReq","options","multiple"],["formControlName","state","label","State",3,"searchChanged","multiple","fieldReq","options","search"],["formControlName","ledger_creation_type","label","Point Category Type",3,"fieldReq","options","multiple"],["label","Minimum Eligiblity Points","formControlName","min_eligiblity_points","type","number",1,"remove-default-class",3,"fieldReq"],[1,"xl:col-span-6","col-span-12","mb-3"],[1,"form-label","mb-0"],[1,"text-red-500"],[1,"filepond","basic-filepond",3,"onremovefile","onprocessfile","options","files"],["id","product-features",1,"ngx-editor-custom"],[3,"editor","toolbar"],["formControlName","terms_condition",3,"editor"],["class","error",4,"ngIf"],[1,"dropdown-divider","mb-3","mt-3"],[1,"flex","justify-between","mb-3"],[1,"box-title","flex","items-center","text-primarytint1color"],[1,"grid","grid-cols-12","sm:gap-x-6",3,"formGroup"],[1,"xl:col-span-6","col-span-6","mb-3"],["label","Title","formControlName","gift_title","type","text",1,"remove-default-class",3,"fieldReq"],[1,"flex","gap-4","justify-center","items-center"],["label","Rank","formControlName","rank","type","text",1,"remove-default-class",3,"fieldReq"],["type","button","aria-label","button",1,"ti-btn","mt-3","ti-btn-icon","ti-btn-primary","btn-wave",3,"click"],[1,"ri-add-line"],["class","xl:col-span-12 col-span-12 mb-3",4,"ngIf"],["class","xl:col-span-6 col-span-12",4,"ngIf"],[1,"box-footer","border-t","border-block-start-dashed","sm:flex","justify-end"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],[1,"error"],[1,"xl:col-span-12","col-span-12","mb-3"],[1,"xl:col-span-6","col-span-12"],[1,"table-responsive","mt-4","table-bordered-default"],["tableClass","ti-custom-table ti-custom-table-hover ti-head-primary",3,"columns","tableHead","showCheckbox"],[4,"ngFor","ngForOf"],[1,"w60","text-center"],[1,"text-center"],[1,"w60","relative"],[1,"flex","flex-row","items-center","!gap-2","text-[0.9375rem]"],[3,"clickEvent","icon","buttonClass"]],template:function(e,t){e&1&&(c(0,"app-page-header",0),E(1,"titlecase"),h(2,Fe,52,34,"div",1)),e&2&&(d("title","Loyalty")("title1",I(6,he))("activeitem",N(1,4,t.pageType)+" Leader Board"),a(2),d("ngIf",!t.skLoading))},dependencies:[J,z,j,O,M,V,q,R,ce,H,U,me,te,ge,pe,_e,Z,re,oe,le,ne,ae,W,ee,ie],encapsulation:2})};export{ve as leaderBoardAddComponent};
