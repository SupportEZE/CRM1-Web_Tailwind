import{a as pe}from"./chunk-PU6S26UW.js";import{a as ve}from"./chunk-SQZ3YN6N.js";import"./chunk-OTFCGVEU.js";import{a as A}from"./chunk-CNF4GSI7.js";import{a as le}from"./chunk-OEHD5D2Y.js";import{a as ue}from"./chunk-GLWQGYBC.js";import{a as X}from"./chunk-DC4QM32I.js";import{C as me,F as de,c as J,g as ae,v as ce,w as se}from"./chunk-VHE3PQ3O.js";import{A as b,B as O,C as G,Ga as te,H,Ha as ie,Ia as oe,J as L,Ja as re,M as Q,P as Y,V as z,W as K,X as W,Z as $,hb as ne,p as B,va as Z,w as U,wa as ee,z as j}from"./chunk-GYDYF5F3.js";import{K as R,M as D,Q as P,f as w,g as N,r as M,t as V}from"./chunk-PD5VTTIY.js";import{Aa as S,Ba as x,Hb as E,Lc as T,Mc as s,Nc as y,Ob as h,Yc as F,_b as a,ed as k,gd as q,kc as i,lc as r,mc as m,qc as C,rb as n,sb as v,wc as I,yc as _}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import"./chunk-66YHNWRR.js";var _e=()=>["Create Invoice"],be=()=>[];function ge(l,o){l&1&&(i(0,"div",8),m(1,"app-skeleton"),r())}function he(l,o){l&1&&(i(0,"div",4)(1,"div",5)(2,"div",6),h(3,ge,2,0,"div",7),r()()()),l&2&&(n(3),a("ngForOf",F(1,be).constructor(10)))}function ye(l,o){l&1&&(i(0,"div",49),s(1," This field is required. "),r())}function Se(l,o){if(l&1&&(i(0,"div",29),m(1,"spk-ng-select",50),r()),l&2){let e=_(2);n(),a("options",e.service_Status)("multiple",!1)("fieldReq",!0)}}function xe(l,o){if(l&1){let e=C();i(0,"div",29)(1,"spk-ng-select",51),I("searchChanged",function(d){S(e);let u=_(2);return x(u.onSearch(d,"product"))}),r()()}if(l&2){let e=_(2);n(),a("search",!0)("fieldReq",e.selectedItems.length===0)("options",e.product)("multiple",!1)}}function Ce(l,o){if(l&1){let e=C();i(0,"div",29)(1,"div",52),m(2,"spk-input",53),i(3,"button",54),I("click",function(){S(e);let d=_(2);return x(d.addToList())}),m(4,"i",55),r()()()}if(l&2){let e=_(2);n(2),a("fieldReq",e.selectedItems.length===0)}}function Ie(l,o){if(l&1){let e=C();i(0,"tr")(1,"td",56),s(2),r(),i(3,"td"),s(4),r(),i(5,"td",57),s(6),r(),i(7,"td",57),s(8),k(9,"number"),r(),i(10,"td",57),s(11),k(12,"number"),r(),i(13,"td",58)(14,"div",59)(15,"app-icon-button",60),I("clickEvent",function(){let d=S(e).index,u=_(2);return x(u.delete(d))}),r()()()()}if(l&2){let e=o.$implicit,c=o.index;n(2),y(c+1),n(2),y(e.label||"---"),n(2),y(e.qty||0),n(2),y(q(9,7,e.mrp,"1.2-2")),n(3),y(q(12,10,e.total_price,"1.2-2")),n(4),a("icon","ri-delete-bin-line")("buttonClass","ti-btn btn-wave product-btn ti-btn-sm ti-btn-soft-danger waves-effect waves-light")}}function Fe(l,o){l&1&&(i(0,"div",49),s(1," This field is required. "),r())}function ke(l,o){if(l&1){let e=C();i(0,"form",9),I("ngSubmit",function(){S(e);let d=_();return x(d.onSubmit())}),i(1,"div",6)(2,"div",10)(3,"div",4)(4,"div",11)(5,"div",12)(6,"div",13),m(7,"spk-input",14),r(),i(8,"div",15)(9,"label",16),s(10,"Invoice Date"),i(11,"span",17),s(12,"*"),r()(),i(13,"mat-form-field",18),m(14,"input",19)(15,"mat-datepicker-toggle",20)(16,"mat-datepicker",null,0),r()()(),i(18,"div",21)(19,"div",22)(20,"p",23),s(21,"Billing From"),r()(),i(22,"div",13),m(23,"spk-input",24),r(),i(24,"div",13),m(25,"spk-input",25),r(),i(26,"div",15)(27,"label",26),s(28,"Address"),i(29,"span",17),s(30,"*"),r()(),m(31,"textarea",27),h(32,ye,2,0,"div",28),r()(),i(33,"div",12)(34,"div",29),m(35,"spk-ng-select",30),r(),h(36,Se,2,3,"div",31)(37,xe,2,4,"div",31)(38,Ce,5,1,"div",31),i(39,"div",32)(40,"div",33)(41,"spk-reusable-tables",34),h(42,Ie,16,13,"tr",35),r()()(),i(43,"div",32)(44,"div")(45,"label",26),s(46,"Note"),i(47,"span",17),s(48,"*"),r()(),m(49,"textarea",36),h(50,Fe,2,0,"div",28),r()()()(),i(51,"div",37),m(52,"app-button",38),r()()(),i(53,"div",15)(54,"div",4)(55,"div",39)(56,"div",40),s(57," Mode Of Payment "),r()(),i(58,"div",41)(59,"div",42)(60,"div",32)(61,"div",43),m(62,"input",44),i(63,"label",45),s(64," UPI / Online "),r(),m(65,"input",46),i(66,"label",47),s(67," Cash "),r()()(),i(68,"div",32),m(69,"input",48),r()()()()()()()}if(l&2){let e,c,d,u,p,f=T(17),t=_();a("formGroup",t.stockForm),n(7),a("fieldReq",!0),n(7),a("matDatepicker",f)("min",t.today),n(),a("for",f),n(8),a("fieldReq",!0),n(2),a("fieldReq",!0),n(7),a("ngIf",((e=t.stockForm.get("note"))==null?null:e.invalid)&&((e=t.stockForm.get("note"))==null?null:e.touched)),n(3),a("options",t.Service_Type)("multiple",!1)("fieldReq",!0),n(),a("ngIf",(c=t.stockForm.get("service_type"))==null?null:c.value),n(),a("ngIf",(d=t.stockForm.get("status"))==null?null:d.value),n(),a("ngIf",(u=t.stockForm.get("product_id"))==null?null:u.value),n(3),a("columns",t.headerColumn)("tableHead","border-b")("showCheckbox",!1)("showS_No",!0)("showAction",!0),n(),a("ngForOf",t.selectedItems),n(8),a("ngIf",((p=t.stockForm.get("note"))==null?null:p.invalid)&&((p=t.stockForm.get("note"))==null?null:p.touched)),n(2),a("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",t.api.disabled)("formType",t.pageType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill"),n(10),a("value","UPI / Online"),n(3),a("value","Cash")}}var fe=class l{constructor(o,e,c,d,u,p,f,t,g,qe){this.toastr=o;this.api=e;this.formValidation=c;this.fb=d;this.router=u;this.route=p;this.commonApi=f;this.uploadService=t;this.moduleService=g;this.CommonApiService=qe}pageType="add";CUR=B;quotationList=[];selectedItems=[];submodule;product=[];stockForm;skLoading=!1;today=new Date;complaintId;serviceEngineerId;billingFromAddress;billingFromMobile;billingFromCustomer;Service_Type=[{label:"Complaint",value:"Complaint"},{label:"Installation",value:"Installation"}];service_Status=[{label:"Paid",value:"Paid"},{label:"Unpaid",value:"Unpaid"},{label:"Cancel",value:"Cancel"}];ngOnInit(){let o=this.moduleService.getSubModuleByName("WCMS","Invoice");o&&(this.submodule=o),this.stockForm=this.fb.group({customer_name:["",b.required],customer_address:["",b.required],customer_mobile:["",b.required],invoice_date:["",b.required],product_id:["",b.required],status:["",b.required],title:["",b.required],qty:["",b.required],payment_mode:["UPI / Online"],service_type:["Complaint"],transaction_number:[""],invoice_note:[""],complaint_id:[""],total_amount:[0],total_items:[0],total_qty:[0],item:[[]]}),this.route.queryParamMap.subscribe(e=>{this.complaintId=e.get("complaint_id"),this.serviceEngineerId=e.get("service_engineer_id"),this.billingFromCustomer=e.get("customer_name"),this.billingFromMobile=e.get("customer_mobile"),this.billingFromAddress=e.get("address"),this.serviceEngineerId=e.get("service_engineer_id"),this.serviceEngineerId=e.get("service_engineer_id"),console.log(e),console.log(this.billingFromCustomer,"customer console"),console.log(this.billingFromMobile,"customer mobile"),console.log(this.billingFromAddress,"customer address"),this.complaintId&&this.stockForm.patchValue({complaint_id:this.complaintId}),this.serviceEngineerId&&(this.stockForm.patchValue({service_engineer_id:this.serviceEngineerId}),this.getProduct()),console.log("Complaint ID from query:",this.serviceEngineerId),console.log("Complaint ID from query:",this.complaintId)}),this.stockForm.patchValue({complaint_id:this.complaintId||"",customer_name:this.billingFromCustomer||"",customer_mobile:this.billingFromMobile||"",customer_address:this.billingFromAddress||""}),this.getProduct()}getProduct(o){this.api.post({_id:this.serviceEngineerId,filters:{search:o}},"spare-part/read-dropdown").subscribe(e=>{e.statusCode==200&&(this.product=e.data)})}onSearch(o,e){e==="product"&&this.getProduct(o)}addToList(){let o=this.stockForm.get("product_id")?.value,e=+this.stockForm.get("qty")?.value;if(!o){this.toastr.error("Please select a product.","","toast-top-right");return}if(!e||e<=0){this.toastr.error("Please enter a valid quantity greater than 0.","","toast-top-right");return}let c=this.product.find(t=>t.value===o);if(!c){this.toastr.error("Selected product not found.","","toast-top-right");return}let d=isNaN(+c.mrp)?0:+c.mrp,u=e*d,p=this.selectedItems.find(t=>t.value===o),f=this.stockForm.get("item");if(p){p.qty+=e,p.total_price=p.qty*p.mrp;let t=this.selectedItems.findIndex(g=>g.value===o);f.at(t)&&f.at(t).patchValue({qty:p.qty})}else this.selectedItems.push({label:c.label,value:c.value,product_code:c.product_code,qty:e,mrp:d,total_price:u}),f.push(this.fb.group({product_id:[o],qty:[e]}));this.stockForm.get("product_id")?.reset(),this.stockForm.get("qty")?.reset(),this.selectedItems.length>0&&["product_id","qty"].forEach(t=>{this.stockForm.get(t)?.clearValidators(),this.stockForm.get(t)?.updateValueAndValidity()})}delete(o){this.selectedItems.splice(o,1),this.stockForm.get("item").removeAt(o)}onSubmit(){if(this.stockForm.valid){let o=this.selectedItems.map(t=>({product_id:t.value,product_name:t.label,product_code:t.product_code,qty:t.qty,mrp:t.mrp,total_price:t.total_price})),e=o.length,c=o.reduce((t,g)=>t+g.qty,0),d=o.reduce((t,g)=>t+g.total_price,0);this.stockForm.patchValue({item:o,total_items:e,total_qty:c,total_amount:d}),this.api.disabled=!0;let u=!!this.stockForm.get("_id")?.value,p=u?"patch":"post",f=u?"complaint-invoice/update-item":"complaint-invoice/create";!u&&this.stockForm.contains("_id")&&this.stockForm.removeControl("_id"),this.api[p](this.stockForm.value,f).subscribe(t=>{this.api.disabled=!1,t.statusCode===200&&(this.router.navigate(["/apps/service/service-invoice"]),this.toastr.success(t.message,"","toast-top-right"),this.stockForm.reset())})}else this.toastr.error("Form Is Invalid","","toast-top-right"),this.formValidation.markFormGroupTouched(this.stockForm)}createinvoiceColumns=[{label:"Product Name"},{label:"Description"},{label:"Qty"},{label:"Price Per Unit"},{label:"Total"},{label:"Action"}];headerColumn=[{label:"Product Name"},{label:"Qty",table_class:"text-right"},{label:"Mrp",table_class:"text-right"},{label:"Total",table_class:"text-right"}];Currency=[{label:"Select Currency",value:1},{label:"USD - (United States Dollar)",value:2},{label:"BHD - (Bahraini Dinar)",value:3},{label:"KWD - (Kuwaiti Dinar)",value:4},{label:"CHF - (Swiss Franc)",value:5}];static \u0275fac=function(e){return new(e||l)(v(U),v($),v(ce),v(z),v(D),v(R),v(A),v(pe),v(X),v(A))};static \u0275cmp=E({type:l,selectors:[["app-service-invoice-add"]],decls:3,vars:6,consts:[["picker",""],[3,"title","title1","activeitem"],["class","box",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","gap-x-6"],["class","xl:col-span-3 col-span-12 mb-4",4,"ngFor","ngForOf"],[1,"xl:col-span-3","col-span-12","mb-4"],[3,"ngSubmit","formGroup"],[1,"xl:col-span-9","col-span-12"],[1,"box-body"],[1,"grid","grid-cols-12","sm:gap-x-6"],[1,"xxl:col-span-3","xl:col-span-3","lg:col-span-3","md:col-span-4","col-span-12"],["label","Title","formControlName","title","type","text",1,"remove-default-class",3,"fieldReq"],[1,"xl:col-span-3","col-span-12"],[1,"form-label"],[1,"text-red-500"],[1,"mat-custom-field"],["matInput","","formControlName","invoice_date","placeholder","Select Invoice Date",3,"matDatepicker","min"],["matIconSuffix","",3,"for"],[1,"grid","grid-cols-12","sm:gap-x-6","gap-y-3"],[1,"col-span-12"],[1,"font-semibold","mt-4"],["label","Company Name","formControlName","customer_name","type","text",1,"remove-default-class",3,"fieldReq"],["label","Phone","formControlName","customer_mobile","type","number",1,"remove-default-class",3,"fieldReq"],[1,"form-label","mb-0"],["matInput","","placeholder","Type Here ...","formControlName","customer_address",1,"form-control","h60"],["class","error",4,"ngIf"],[1,"xxl:col-span-3","xl:col-span-6","lg:col-span-6","md:col-span-6","col-span-12"],["formControlName","service_type","label","Service Type",3,"options","multiple","fieldReq"],["class","xxl:col-span-3 xl:col-span-6 lg:col-span-6 md:col-span-6 col-span-12",4,"ngIf"],[1,"xl:col-span-12","col-span-12"],[1,"table-responsive","mt-4","table-bordered-default"],["tableClass","ti-custom-table ti-custom-table-hover ti-head-primary",3,"columns","tableHead","showCheckbox","showS_No","showAction"],[4,"ngFor","ngForOf"],["matInput","","placeholder","Type Here ...","formControlName","invoice_note",1,"form-control","form-control-light","!pt-3"],[1,"box-footer","flex","items-center","justify-end","gap-2"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],[1,"box-header"],[1,"box-title"],[1,"box-body","pt-0"],[1,"grid","grid-cols-12","gap-y-4"],["role","group","aria-label","Basic radio toggle button group",1,"btn-group","inline-flex"],["type","radio","name","payment_mode","id","strap1","formControlName","payment_mode",1,"btn-check","opacity-0","absolute",3,"value"],["for","strap1",1,"!mb-0","ti-btn","btn-wave","!m-0","!block","sm:!inline-flex","!py-2","!px-3","ti-btn-outline-primary","z-0","!rounded-e-none","!border-e-0","sm:text-[0.813rem]","text-[0.75rem]","waves-effect","waves-light"],["type","radio","name","payment_mode","id","strap3","formControlName","payment_mode",1,"btn-check","opacity-0","absolute",3,"value"],["for","strap3",1,"!mb-0","ti-btn","btn-wave","!m-0","!block","sm:!inline-flex","!py-2","text-primary","!px-3","ti-btn-outline-primary","!rounded-s-none","z-0","sm:text-[0.813rem]","text-[0.75rem]","waves-effect","waves-light"],["type","text","id","invoice-payment-cardname","placeholder","Transaction Number","formControlName","transaction_number",1,"form-control","form-control-light"],[1,"error"],["formControlName","status","label","Status",3,"options","multiple","fieldReq"],["formControlName","product_id","label","Select Product",3,"searchChanged","search","fieldReq","options","multiple"],[1,"flex","gap-4","justify-center","items-center"],["label","QTY","formControlName","qty","type","number",1,"remove-default-class",3,"fieldReq"],["type","button","aria-label","button",1,"ti-btn","mt-3","ti-btn-icon","ti-btn-primary","btn-wave",3,"click"],[1,"ri-add-line"],[1,"w60","text-center"],[1,"text-right"],[1,"w60","relative"],[1,"flex","flex-row","items-center","!gap-2","text-[0.9375rem]"],[3,"clickEvent","icon","buttonClass"]],template:function(e,c){e&1&&(m(0,"app-page-header",1),h(1,he,4,2,"div",2)(2,ke,70,29,"form",3)),e&2&&(a("title","Invoice")("title1",F(5,_e))("activeitem","Create Invoice"),n(),a("ngIf",c.skLoading),n(),a("ngIf",!c.skLoading))},dependencies:[de,w,N,H,j,L,O,G,Q,Y,se,ae,ue,J,me,ve,M,V,K,W,P,le,ne,ie,oe,re,te,ee,Z],encapsulation:2})};export{fe as ServiceInvoiceAddComponent};
