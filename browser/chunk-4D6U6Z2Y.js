import{a as se}from"./chunk-J4NDCUAB.js";import{a as re}from"./chunk-ZON5AR26.js";import"./chunk-LGZVJJDX.js";import"./chunk-54KZ5YIV.js";import{a as oe}from"./chunk-SQZ3YN6N.js";import{b as ie,c as ne}from"./chunk-CIBZCVJQ.js";import"./chunk-OTFCGVEU.js";import{a as te}from"./chunk-HPLI5COI.js";import"./chunk-DUVWFXSE.js";import{a as W}from"./chunk-CNF4GSI7.js";import{a as J}from"./chunk-OEHD5D2Y.js";import{a as ae}from"./chunk-GLWQGYBC.js";import{a as G}from"./chunk-DC4QM32I.js";import{F as ee,c as q,q as X,s as Y,u as Z}from"./chunk-VHE3PQ3O.js";import{$ as U,Qa as z,V as N,W as $,Y as K,Z as Q,l as j}from"./chunk-GYDYF5F3.js";import{M as O,f as A,g as B,o as E,t as V}from"./chunk-PD5VTTIY.js";import{Aa as m,Ba as d,Fc as F,Gc as I,Hb as y,Hc as k,Mc as C,Nc as M,Ob as _,Oc as S,Yc as v,Zc as R,_b as s,ac as x,bc as w,bd as H,ed as D,gd as P,kc as p,lc as c,mc as L,nc as h,oc as b,qc as f,rb as o,sb as g,wc as u,yc as l}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as T}from"./chunk-66YHNWRR.js";var ce=["reusableTable"],ge=()=>["Site List"],me=(n,i,t,e,a)=>({name:n,label:i,icon:t,count:e,subTab:a}),de=n=>[n],pe=()=>[];function _e(n,i){if(n&1){let t=f();p(0,"app-listing-tab",13),u("tabChange",function(a){m(t);let r=l();return d(r.onTabChange(a.tab))}),c()}if(n&2){let t=i.$implicit,e=l();s("tabs",R(8,de,H(2,me,t.name,t.label,t.icon,t.count,t.subTab)))("activeTab",e.activeTab)}}function ue(n,i){if(n&1&&(p(0,"span"),C(1),D(2,"date"),c()),n&2){let t=l().$implicit,e=l().$implicit;o(),S(" ",P(2,1,(e==null?null:e[t.name])||(e==null||e.form_data==null?null:e.form_data[t.name]),"d MMM yyyy, hh:mm a")," ")}}function he(n,i){if(n&1){let t=f();p(0,"span")(1,"a",21),u("click",function(){m(t);let a=l(2).$implicit,r=l(2);return d(r.goToDetailPage(a._id))}),C(2),c()()}if(n&2){let t=l().$implicit,e=l().$implicit;o(2),S(" ",(e==null?null:e[t.name])||(e==null||e.form_data==null?null:e.form_data[t.name])||"--"," ")}}function be(n,i){if(n&1&&(p(0,"span"),C(1),c()),n&2){let t,e=l().$implicit,a=l().$implicit;o(),S(" ",(t=(t=a[(e==null?null:e.actual_name)||(e==null?null:e.name)])!==null&&t!==void 0?t:a.form_data==null?null:a.form_data[e==null?null:e.name])!==null&&t!==void 0?t:"--"," ")}}function fe(n,i){if(n&1&&(h(0),p(1,"td"),_(2,ue,3,4,"span",20)(3,he,3,1,"span",11)(4,be,2,1,"span",11),c(),b()),n&2){let t=i.$implicit;o(2),s("ngIf",t.name.includes("date")||t.name.endsWith("_at")),o(),s("ngIf",t.name==="site_id"),o(),s("ngIf",!(t.name.includes("date")||t.name.endsWith("_at")||t.name==="site_id"))}}function Ce(n,i){if(n&1){let t=f();p(0,"tr",16)(1,"td",17),C(2),c(),_(3,fe,5,3,"ng-container",18),p(4,"td",17)(5,"app-icon-button",19),u("clickEvent",function(){let a=m(t).$implicit,r=l(2);return d(r.goToDetailPage(a._id))}),c()()()}if(n&2){let t=i.$implicit,e=i.index,a=l(2);x("bg-gray-400",a.isHighlighted(t._id)),o(2),M(e+1),o(),s("ngForOf",a.visibleHeaders),o(2),s("icon","ri-eye-line")("buttonClass","ti-btn btn-wave  ti-btn-sm ti-btn-soft-primary waves-effect waves-light")}}function Se(n,i){if(n&1){let t=f();h(0),p(1,"spk-reusable-tables",14,0),u("textSearchChange",function(a){m(t);let r=l();return d(r.updateSearchFilter(a))})("selectionChange",function(a){m(t);let r=l();return d(r.handleSelectionChange(a))})("dateChange",function(a){m(t);let r=l();return d(r.handleDateChange(a))})("dateRangeChange",function(a){m(t);let r=l();return d(r.handleDateRangeChange(a))}),_(3,Ce,6,6,"tr",15),c(),b()}if(n&2){let t=l();o(),s("tableHead","border-b")("showCheckbox",!1)("showS_No",!0)("showSorting",!1)("showFilterRow",!0)("showAction",!0)("columns",t.visibleHeaders)("subModule",t.subModule),o(2),s("ngForOf",t.listing)}}function ve(n,i){n&1&&(p(0,"td",25),L(1,"app-skeleton"),c()),n&2&&(o(),w("h20 bg-skeleton"))}function Te(n,i){n&1&&(p(0,"tr",23),_(1,ve,2,2,"td",24),c()),n&2&&(o(),s("ngForOf",v(1,pe).constructor(11)))}function Le(n,i){n&1&&(h(0),_(1,Te,2,2,"tr",22),b()),n&2&&(o(),s("ngForOf",v(1,pe).constructor(16)))}function ye(n,i){n&1&&(h(0),L(1,"app-data-not-found"),b())}var le=class n{constructor(i,t,e,a,r,xe,we,Fe,Ie,ke){this.moduleService=i;this.CommonApiService=t;this.api=e;this.dialog=a;this.fb=r;this.util=xe;this.router=we;this.alert=Fe;this.comanFuncation=Ie;this.highlightService=ke}reusableTable;filter={};FORMID=te;skLoading=!1;listing=[];listTabs={};pagination={};subModule={};moduleFormId=0;moduleTableId=0;fieldTypes=j;page=1;activeTab="Inprocess";highlightedId;pageKey="user-list";mainTabs=[];accessRight={};ngOnInit(){let i=this.highlightService.getHighlight(this.pageKey);i!=null&&(this.activeTab=i.tab,this.highlightedId=i.rowId,this.pagination.cur_page=i.pageIndex,this.filter=i.filters,this.highlightService.clearHighlight(this.pageKey));let t=this.moduleService.getAccessMap("SFA","Site-Project");t&&(this.accessRight=t);let e=this.moduleService.getSubModuleByName("SFA","Site-Project"),a=this.moduleService.getFormById("SFA","Site-Project",this.FORMID.ID.SiteForm),r=this.moduleService.getTableById("SFA","Site-Project",this.FORMID.ID.SiteTable);e&&(this.subModule=e),a&&(this.moduleFormId=a.form_id),r&&(this.moduleTableId=r.table_id),this.getHeaderConfigListing()}isHighlighted(i){return this.highlightedId===i}setHighLight(i){this.comanFuncation.setHighLight(this.pageKey,i,this.activeTab,this.filter,this.pagination.cur_page?this.pagination.cur_page:1)}onRefresh(){this.filter={},this.reusableTable.clearSearchInputs(),this.getHeaderConfigListing()}goToAddPage(){this.setHighLight("add"),this.router.navigate(["/apps/sfa/site/site-add"])}goToDetailPage(i){this.setHighLight(i),this.router.navigate(["/apps/sfa/site/site-detail",i])}onTabChange(i){this.highlightedId||(this.pagination.cur_page=1),this.activeTab=i,this.getList()}tableConfigData={};visibleHeaders=[];getHeaderConfigListing(){this.CommonApiService.getHeaderConfigListing(this.moduleTableId,this.moduleFormId).subscribe(i=>{this.tableConfigData=i.data.table_data;let t=this.tableConfigData.tableHead;this.visibleHeaders=t.filter(e=>e.list_view_checked&&e.key_name_required!==!0&&e.type!=this.fieldTypes.UPLOAD),this.getList()})}getList(){this.skLoading=!0,this.api.post({filters:this.filter,form_id:this.moduleFormId,activeTab:this.activeTab},"sites/read").subscribe(i=>{i.statusCode=="200"&&(this.skLoading=!1,this.listing=i.data.result,this.listTabs=i.data.tabCounts,this.pagination=i.pagination,this.mainTabs=[{name:"Inprocess",label:"Inprocess",icon:"ri-hourglass-fill",count:this.listTabs?.inprocces||0},{name:"Win",label:"Win",icon:"ri-trophy-fill",count:this.listTabs?.win||"0"},{name:"Lost",label:"Lost",icon:"ri-hourglass-fill",count:this.listTabs?.lost||"0"}])})}getTabCount(i){return this.listTabs&&this.listTabs[i]!==void 0?this.listTabs[i].toString():"0"}changeToPagination(i){i=="Previous"?this.pagination.prev&&this.page>1&&(this.page--,this.getList()):this.pagination.next&&(this.page++,this.getList())}changeToPage(i){this.page=i,this.pagination.cur_page=i,this.getList()}handleSelectionChange(i){let{category_name:t,selections:e}=i;this.filter[t]=e,this.getList()}updateSearchFilter(i){this.filter[i.name]=i.searchText,this.getList()}handleDateChange(i){this.filter=T(T({},this.filter),i),this.getList()}handleDateRangeChange(i){this.filter=i,this.getList()}openHeaderSettingModal(){this.getHeaderConfigListing(),this.dialog.open(re,{width:"450px",panelClass:"mat-right-modal",position:{right:"0px"},data:{lastPage:"header-config",moduleFormId:this.moduleFormId,moduleTableId:this.moduleTableId,moduleName:this.subModule.title,tableConfigData:this.tableConfigData}}).afterClosed().subscribe(t=>{t===!0&&this.getHeaderConfigListing()})}openMainLogModal(i){this.comanFuncation.listLogsModal(this.subModule.module_id,i,this.subModule.module_type).subscribe(t=>{t===!0&&this.getList()})}static \u0275fac=function(t){return new(t||n)(g(G),g(W),g(Q),g(z),g(N),g(K),g(O),g(U),g(ne),g(ie))};static \u0275cmp=y({type:n,selectors:[["app-site-list"]],viewQuery:function(t,e){if(t&1&&F(ce,5),t&2){let a;I(a=k())&&(e.reusableTable=a.first)}},decls:14,vars:25,consts:[["reusableTable",""],[3,"buttonClick1","title","title1","activeitem","icon1","btnShow1","buttonText1"],[1,"box","py-3","px-4"],["aria-label","Tabs","role","tablist",1,"sm:flex","sm:space-x-2","sm:rtl:space-x-reverse","gap-1"],[3,"tabs","activeTab","tabChange",4,"ngFor","ngForOf"],[1,"row"],[1,"col-xl-12"],[1,"box"],[3,"onRefresh","logBtn","button1","pageTitle","listLength","btnShow","refreshLabel","btnShow1","logsLabel","btnShow2","addBtnLabel"],[1,"box-body"],[1,"table-responsive","overflow-auto","table-bordered-default"],[4,"ngIf"],[3,"preButtonClick","nextButtonClick","pageChange","currentPage","totalPage","pageLimit","listLength","preBtn","nextBtn"],[3,"tabChange","tabs","activeTab"],["tableClass","ti-custom-table ti-custom-table-head ti-custom-table-hover ti-head-primary whitespace-nowrap",3,"textSearchChange","selectionChange","dateChange","dateRangeChange","tableHead","showCheckbox","showS_No","showSorting","showFilterRow","showAction","columns","subModule"],["class","product-list border-b !border-defaultborder dark:!border-defaultborder/10",3,"bg-gray-400",4,"ngFor","ngForOf"],[1,"product-list","border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"!text-center"],[4,"ngFor","ngForOf"],[3,"clickEvent","icon","buttonClass"],[4,"ngIfElseNonDate","ngIf"],[1,"text-primary","font-semibold","underline",3,"click"],["class","border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[1,"border-b","!border-defaultborder","dark:!border-defaultborder/10"],["class","w120",4,"ngFor","ngForOf"],[1,"w120"]],template:function(t,e){t&1&&(p(0,"app-page-header",1),u("buttonClick1",function(){return e.openHeaderSettingModal()}),c(),p(1,"div",2)(2,"nav",3),_(3,_e,1,10,"app-listing-tab",4),c()(),p(4,"div",5)(5,"div",6)(6,"div",7)(7,"app-page-sub-header",8),u("onRefresh",function(){return e.onRefresh()})("logBtn",function(){return e.openMainLogModal("")})("button1",function(){return e.goToAddPage()}),c(),p(8,"div",9)(9,"div",10),_(10,Se,4,9,"ng-container",11)(11,Le,2,2,"ng-container",11)(12,ye,2,0,"ng-container",11),c()(),p(13,"app-pagination-footer",12),u("preButtonClick",function(){return e.changeToPagination("Previous")})("nextButtonClick",function(){return e.changeToPagination("Next")})("pageChange",function(r){return e.changeToPage(r)}),c()()()()),t&2&&(s("title","SFA")("title1",v(24,ge))("activeitem","Site List")("icon1","settings")("btnShow1",e.accessRight==null?null:e.accessRight.modifyRight)("buttonText1","Header Config"),o(3),s("ngForOf",e.mainTabs),o(4),s("pageTitle","Site List")("listLength",e.listing.length)("btnShow",!0)("refreshLabel","Refresh")("btnShow1",!0)("logsLabel","Logs")("btnShow2",e.accessRight==null?null:e.accessRight.addRight)("addBtnLabel","Add Site"),o(3),s("ngIf",!e.skLoading),o(),s("ngIf",e.skLoading),o(),s("ngIf",!e.listing.length&&!e.skLoading),o(),s("currentPage",e.pagination.cur_page)("totalPage",e.pagination.total_pages)("pageLimit",e.pagination.limit)("listLength",e.listing.length)("preBtn",!e.pagination.prev)("nextBtn",!e.pagination.next))},dependencies:[ee,A,B,ae,q,Y,X,se,oe,Z,E,V,J,$],encapsulation:2})};export{le as SiteListComponent};
