import{a as U}from"./chunk-OTFCGVEU.js";import{C as we,F as E,j as ke,k as Se,r as Ie,t as Me}from"./chunk-VHE3PQ3O.js";import{$ as he,C as de,E as ge,H as ue,Oa as V,Pa as I,Qa as _e,Ra as ve,Sa as Ce,Ta as A,Ua as be,W as fe,Z as S,_ as Ee,eb as ye,hb as L,u as pe,w as me}from"./chunk-GYDYF5F3.js";import{M as ce,e as re,g as le,k as se,t as k}from"./chunk-PD5VTTIY.js";import{Aa as _,Ba as v,Bc as Y,Hb as h,I as J,Ka as W,Lc as ie,Mc as d,Nc as N,Ob as $,Oc as oe,Zc as ne,_b as c,_c as ae,c as z,ka as y,kc as a,lb as P,lc as l,mc as x,nc as ee,oc as te,pa as u,q as Z,qa as Q,qc as F,rb as s,sb as g,v as K,wc as p,yc as C}from"./chunk-2NSPOFEK.js";import{g as Le}from"./chunk-66YHNWRR.js";var H=class n{constructor(t,e){this.modalData=t;this.logService=e}logList=[];skLoading=!1;ngOnInit(){this.skLoading=!0,this.logService.getLogs(this.modalData.moduleId,t=>{this.logList=t,this.skLoading=!1},this.modalData.rowId?this.modalData.rowId:"",this.modalData.module_type??this.modalData.module_type)}static \u0275fac=function(e){return new(e||n)(g(I),g(U))};static \u0275cmp=h({type:n,selectors:[["app-log-modal"]],decls:1,vars:2,consts:[[3,"logList","skLoading"]],template:function(e,i){e&1&&x(0,"app-logs",0),e&2&&c("logList",i.logList)("skLoading",i.skLoading)},dependencies:[E,Me],encapsulation:2})};var j=class n{highlights=new Map;setHighlight(t,e){this.highlights.set(t,e)}getHighlight(t){return this.highlights.get(t)}clearHighlight(t){this.highlights.delete(t)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=y({token:n,factory:n.\u0275fac,providedIn:"root"})};var je=(n,t)=>["box",n,t],R=class n{quote="";author="";source="";footerText="";backgroundClass="";isDarkTheme=!1;buttonClick=new W;static \u0275fac=function(e){return new(e||n)};static \u0275cmp=h({type:n,selectors:[["spk-blockquote-card"]],inputs:{quote:"quote",author:"author",source:"source",footerText:"footerText",backgroundClass:"backgroundClass",isDarkTheme:"isDarkTheme"},outputs:{buttonClick:"buttonClick"},decls:10,vars:10,consts:[[3,"ngClass"],[1,"box-body",3,"ngClass"],[1,"blockquote","mb-0","text-center"],["aria-label","footer",1,"blockquote-footer","mt-2","text-[14px]","!ps-0",3,"ngClass"],[3,"click"],["title","Source Title"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"blockquote",2)(3,"h6",0),d(4),l(),a(5,"footer",3)(6,"a",4),p("click",function(){return i.buttonClick.emit()}),d(7),a(8,"cite",5),d(9),l()()()()()()),e&2&&(c("ngClass",ae(7,je,i.backgroundClass,i.isDarkTheme?i.backgroundClass:"")),s(),c("ngClass",i.isDarkTheme?"text-white":""),s(2),c("ngClass",i.isDarkTheme?"text-white":""),s(),N(i.quote),s(),c("ngClass",i.isDarkTheme?"!text-white opacity-70":""),s(2),oe(" ",i.author," in "),s(2),N(i.source))},dependencies:[k,re],encapsulation:2})};function Re(n,t){if(n&1){let e=F();ee(0),a(1,"div",13)(2,"file-pond",14,1),p("oninit",function(){_(e);let o=C();return v(o.pondHandleInit())})("onaddfile",function(o){_(e);let r=C();return v(r.onFileAdd(o))})("onactivatefile",function(o){_(e);let r=C();return v(r.pondHandleActivateFile(o))}),l()(),a(4,"div",15)(5,"a",16),p("click",function(){_(e);let o=C();return v(o.sampleFile())}),d(6,"Download Sample File"),l()(),te()}if(n&2){let e=C();s(2),c("options",e.pondOptions)("files",e.pondFiles)}}function Be(n,t){if(n&1){let e=F();a(0,"div",13)(1,"spk-blockquote-card",17),p("buttonClick",function(){_(e);let o=C();return v(o.downloadErrorFile())}),l()()}n&2&&(s(),c("quote","The uploaded CSV file has an incorrect format or missing/invalid data. Please review the file and upload again.")("author","Click here to download")("source","the correct template.")("isDarkTheme",!0)("backgroundClass","bg-danger"))}var B=class n{constructor(t,e,i,o){this.toastr=t;this.modalData=e;this.dialogRef=i;this.api=o;this.uploadUrl=this.api.upload}uploadUrl;formData=new FormData;data={};errorLogs=[];errorFilename;pondOptions={allowMultiple:!1,labelIdle:'Drop .csv files here or <span class="filepond--label-action">Browse</span>',acceptedFileTypes:["text/csv",".csv"],maxFileSize:"5MB"};pondFiles=[];pondHandleInit(){}pondHandleAddFile(t){}pondHandleActivateFile(t){}onFileAdd(t){let e=t.file.file;if(!["text/csv",".csv"].includes(e.type)){this.pondFiles=[],this.toastr.error("Invalid file type. Only .csv are allowed.","","toast-top-right");return}if(e.size>2*1e6){this.toastr.error("File size should not exceed 2MB.","","toast-top-right");return}this.pondFiles.push(e)}sampleFile(){this.api.post({form_id:this.modalData.formId},"csv/generate-sample-csv").subscribe(t=>{t.statusCode===200&&(window.open(this.uploadUrl+t.data.filename,"_blank"),this.dialogRef.close(!0))})}downloadErrorFile(){window.open(this.uploadUrl+this.errorFilename,"_blank"),this.dialogRef.close(!0)}onSubmit(t){if(this.errorLogs.length>0){this.toastr.error(".Csv file not correct","","toast-top-right");return}if(!this.pondFiles){this.toastr.error("Upload a file.","","toast-top-right");return}this.formData.append("file",this.pondFiles[0]),this.formData.append("form_id",this.modalData.formId),this.api.disabled=!0,this.api.uploadFile(this.formData,"csv/analyze-csv-data").subscribe(e=>{e.statusCode===200&&(this.errorLogs=e.data.errors?e.data.errors:[],this.errorLogs.length>0&&(this.errorFilename=e.data.filename),this.errorLogs===0&&this.productImport(e.data.data),this.api.disabled=!1)})}productImport(t=[]){this.api.disabled=!0,this.api.post({form_id:this.modalData.formId,csv_data:t},"product/import").subscribe(e=>{e.statusCode===200&&(this.api.disabled=!1)})}static \u0275fac=function(e){return new(e||n)(g(me),g(I),g(V),g(S))};static \u0275cmp=h({type:n,selectors:[["app-upload-file-modal"]],decls:13,vars:11,consts:[["uploadForm","ngForm"],["myPond",""],[1,"mat-dialoge"],[1,"flex","items-center","justify-between"],["mat-dialog-title",""],[3,"ngSubmit"],[1,"mat-typography"],[1,"grid","grid-cols-12","gap-x-12"],[4,"ngIf"],["class","col-span-12 md:col-span-12 xxl:!col-span-12",4,"ngIf"],["align","end"],["mat-dialog-close","",3,"buttonType","buttonClass","label"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],[1,"col-span-12","md:col-span-12","xxl:!col-span-12"],[1,"filepond","filepond--root","basic-filepond",3,"oninit","onaddfile","onactivatefile","options","files"],[1,"col-span-12","md:col-span-12","xxl:!col-span-12","text-right"],[1,"font-medium","text-primary",3,"click"],[3,"buttonClick","quote","author","source","isDarkTheme","backgroundClass"]],template:function(e,i){if(e&1){let o=F();a(0,"div",2)(1,"div",3)(2,"h2",4),d(3,"Upload File"),l()(),a(4,"form",5,0),p("ngSubmit",function(){_(o);let b=ie(5);return v(i.onSubmit(b))}),a(6,"mat-dialog-content",6)(7,"div",7),$(8,Re,7,2,"ng-container",8)(9,Be,2,5,"div",9),l()(),a(10,"mat-dialog-actions",10),x(11,"app-button",11)(12,"app-button",12),l()()()}e&2&&(s(8),c("ngIf",i.errorLogs.length===0),s(),c("ngIf",i.errorLogs.length>0),s(2),c("buttonType","button")("buttonClass","ti-btn ti-btn-outline-danger m-2")("label","Cancel"),s(),c("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",i.api.disabled)("formType","add")("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill"))},dependencies:[k,le,E,ue,de,ge,we,fe,L,ve,Ce,be,A,Se,ke,R],encapsulation:2})};var T=Le(Ee());var Oe=n=>({transform:n}),O=class n{constructor(t,e,i){this.imageData=t;this.api=e;this.dialogRef=i}imageUrl;flipH=!1;flipV=!1;scale=.5;cale=.5;rotation=0;lastX=0;lastY=0;posX=0;posY=0;isDragging=!1;minScale=.5;maxScale=2;ngOnInit(){this.getUrl()}zoomIn(){this.scale<this.maxScale&&(this.scale=Math.min(this.scale+.1,this.maxScale))}zoomOut(){this.scale>this.minScale&&(this.scale=Math.max(this.scale-.1,this.minScale))}rotate(){this.rotation+=90}flipHorizontal(){this.flipH=!this.flipH}flipVertical(){this.flipV=!this.flipV}getUrl(){this.api.post({_id:this.imageData._id},this.imageData.apiPath).subscribe(t=>{t.statusCode===200&&(this.imageUrl=t.data.signed_url)})}startDragging(t){this.isDragging=!0;let e=this.getClientX(t),i=this.getClientY(t);this.lastX=e,this.lastY=i}stopDragging(){this.isDragging=!1}onDrag(t){if(!this.isDragging)return;let e=this.getClientX(t),i=this.getClientY(t);this.posX+=e-this.lastX,this.posY+=i-this.lastY,this.lastX=e,this.lastY=i}getClientX(t){return t instanceof MouseEvent?t.clientX:t.touches[0].clientX}getClientY(t){return t instanceof MouseEvent?t.clientY:t.touches[0].clientY}closeModal(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(g(I),g(S),g(V))};static \u0275cmp=h({type:n,selectors:[["app-image-view-modal"]],decls:23,vars:6,consts:[[1,"mat-dialoge"],[3,"close","closeBtn"],[1,"mat-typography"],[3,"mousedown","mousemove","mouseup","mouseleave","touchstart","touchmove","touchend","src","ngStyle"],[1,"action-footer"],["target","_blank","matTooltip","Open In Tab",3,"href"],[1,"material-icons"],["matTooltip","Zoom In",3,"click"],["matTooltip","Zoom Out",3,"click"],["matTooltip","Rotate",3,"click"],["matTooltip","Flip Horizontal",3,"click"],["matTooltip","Flip Vertical",3,"click"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"app-modal-header",1),p("close",function(){return i.closeModal()}),l(),a(2,"mat-dialog-content",2)(3,"img",3),p("mousedown",function(r){return i.startDragging(r)})("mousemove",function(r){return i.onDrag(r)})("mouseup",function(){return i.stopDragging()})("mouseleave",function(){return i.stopDragging()})("touchstart",function(r){return i.startDragging(r)})("touchmove",function(r){return i.onDrag(r)})("touchend",function(){return i.stopDragging()}),l()(),a(4,"div",4)(5,"a",5)(6,"i",6),d(7,"open_in_new"),l()(),a(8,"a",7),p("click",function(){return i.zoomIn()}),a(9,"i",6),d(10,"zoom_in"),l()(),a(11,"a",8),p("click",function(){return i.zoomOut()}),a(12,"i",6),d(13,"zoom_out"),l()(),a(14,"a",9),p("click",function(){return i.rotate()}),a(15,"i",6),d(16,"rotate_right"),l()(),a(17,"a",10),p("click",function(){return i.flipHorizontal()}),a(18,"i",6),d(19,"flip"),l()(),a(20,"a",11),p("click",function(){return i.flipVertical()}),a(21,"i",6),d(22,"flip_camera_android"),l()()()()),e&2&&(s(),c("closeBtn",!0),s(2),Y("src",i.imageUrl,P),c("ngStyle",ne(4,Oe,"translate("+i.posX+"px, "+i.posY+"px) rotate("+i.rotation+"deg) scale("+(i.flipH?-i.scale:i.scale)+", "+(i.flipV?-i.scale:i.scale)+")")),s(2),Y("href",i.imageUrl,P))},dependencies:[k,se,L,A,Ie],encapsulation:2})};var q=class n{_snackBar=Q(ye);durationInSeconds=5;constructor(){}errorSnackBar(t,e){this._snackBar.open("\u274C"+t,e,{horizontalPosition:"right",verticalPosition:"top",duration:this.durationInSeconds*1e3,panelClass:["error-snackbar"]})}warningSnackbar(t,e){this._snackBar.open("\u26A0\uFE0F"+t,e,{horizontalPosition:"right",verticalPosition:"top",duration:this.durationInSeconds*1e3,panelClass:["warning-snackbar"]})}successSnackbar(t,e){this._snackBar.open("\u2705"+t,e,{horizontalPosition:"right",verticalPosition:"top",duration:this.durationInSeconds*1e3,panelClass:["success-snackbar"]})}defaultSnackbar(){this._snackBar.open("Copied to clipboard","",{horizontalPosition:"right",verticalPosition:"bottom",duration:this.durationInSeconds*1e3})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=y({token:n,factory:n.\u0275fac,providedIn:"root"})};var Fe=class n{constructor(t,e,i,o,r,b,f,w){this.dialog=t;this.api=e;this.toastr=i;this.snackbar=o;this.alert=r;this.logService=b;this.highlightService=f;this.router=w}originalData={};success(t,e,i){this.toastr.success(t,e,{timeOut:3e3,positionClass:i})}statusChange(t,e,i,o,r,b,f,w){return new z(m=>{this.alert.confirm("Are you sure?","You want to change status","Yes it!").then(Ve=>{if(Ve.isConfirmed){let Ae={status:r==="toggle"?t?"Active":"Inactive":t};this.originalData.status=i;let G=!0;if(G&&this.logService.logActivityOnUpdate(G,this.originalData,Ae,o.sub_module_id?o.sub_module_id:o.module_id,o.title?o.title:o.module_name,"update",e||null,()=>{},o.module_type)){this.api.disabled=!1,this.toastr.warning("No changes detected","",{positionClass:"toast-top-right"});return}this.api.patch({_id:e,status:r==="toggle"?t?"Active":"Inactive":t,reason:w||f},b).pipe(K(D=>{D.statusCode===200?(this.toastr.success(D.message,"",{positionClass:"toast-top-right"}),m.next(!0),m.complete()):(m.next(!1),m.complete())}),J(D=>(m.next(!1),m.complete(),Z(!1)))).subscribe()}else m.next(!1),m.complete()})})}listLogsModal(t,e,i){return this.dialog.open(H,{width:"350px",panelClass:"mat-right-modal",position:{right:"0px"},data:{moduleId:t,rowId:e,module_type:i}}).afterClosed()}importModal(t,e){return this.dialog.open(B,{width:"600px",data:{moduleId:t,formId:e}}).afterClosed()}delete(t,e,i,o,r,b){return new z(f=>{T.default.fire({title:"Are you sure?",text:"Once deleted, you will not be able to recover this item!",icon:"warning",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonText:"Yes, delete it!"}).then(w=>{w.isConfirmed?this.api.patch({_id:t,is_delete:1},o).subscribe(m=>{m.statusCode===200&&(T.default.fire("Deleted!",m.message,"success"),r==="single_action"?this.logService.logActivityOnDelete(e.sub_module_id?e.sub_module_id:e.module_id,e.sub_module_name?e.sub_module_name:e.module_name,"delete",b,i,e.module_type):(this.logService.directMainLog(e.sub_module_id?e.sub_module_id:e.module_id,e.form_id,e.sub_module_name?e.sub_module_name:e.module_name,i,"deleted",e.module_type),T.default.fire("Deleted!",m.message,"success")),f.next(!0),f.complete())},m=>{T.default.fire("Error!","Something went wrong.","error"),f.error(m)}):(f.next({status:"cancelled"}),f.complete())})})}getSocialStyles(t){return{Youtube:{bg:"danger",icon:"youtube",textcolor:""},"X-Twitter":{bg:"dark",icon:"twitter-x",textcolor:"dark"},Facebook:{bg:"info",icon:"facebook",textcolor:""},Instagram:{bg:"secondary",icon:"instagram",textcolor:""},LinkedIn:{bg:"secondary",icon:"linkedin-box",textcolor:""},"Google Review":{bg:"secondary",icon:"instagram",textcolor:""}}[t]||{bg:"gray",icon:"question",textcolor:""}}removeBlankKeys(t){for(let e in t)if(t.hasOwnProperty(e)){let i=t[e];(i===""||i===null||i===void 0||Array.isArray(i)&&i.length===0)&&delete t[e]}return t}zoom(t,e){this.dialog.open(O,{panelClass:"view-image",data:{_id:t,apiPath:e}}).afterClosed().subscribe(o=>{})}setHighLight(t,e,i,o,r){this.highlightService.setHighlight(t,{rowId:e,tab:i,filters:o,pageIndex:r||1})}copy(t){navigator.clipboard.writeText(t).then(()=>{this.snackbar.defaultSnackbar()}).catch(e=>{console.error("Error copying text: ",e)})}static \u0275fac=function(e){return new(e||n)(u(_e),u(S),u(pe),u(q),u(he),u(U),u(j),u(ce))};static \u0275prov=y({token:n,factory:n.\u0275fac,providedIn:"root"})};export{H as a,j as b,Fe as c};
