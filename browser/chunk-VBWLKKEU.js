import{a as te}from"./chunk-HPLI5COI.js";import{b as oe}from"./chunk-DUVWFXSE.js";import{a as z}from"./chunk-CNF4GSI7.js";import{a as ne}from"./chunk-GLWQGYBC.js";import{a as K}from"./chunk-DC4QM32I.js";import{C as ee,F as ie,c as J,g as X,v as Z,w as $}from"./chunk-VHE3PQ3O.js";import{A as u,B as q,C as O,D as j,F as h,H as B,M as G,P,V as L,W as H,X as U,Z as Y,hb as Q,o as E,w as V}from"./chunk-GYDYF5F3.js";import{K as T,M as R,Q as k,f as A,g as D,n as M,t as w}from"./chunk-PD5VTTIY.js";import{Aa as _,Ba as g,Hb as I,Ka as F,Ob as v,Yc as S,_b as a,ed as x,fd as W,kc as r,lc as l,mc as c,qc as N,rb as s,sb as p,wc as b,yc as f}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as C}from"./chunk-66YHNWRR.js";var se=()=>["Spin & Win Add"],re=()=>[];function pe(o,i){o&1&&(r(0,"div",7),c(1,"app-skeleton"),l())}function le(o,i){o&1&&(r(0,"div",3)(1,"div",4)(2,"div",5),v(3,pe,2,0,"div",6),l()()()),o&2&&(s(3),a("ngForOf",S(1,re).constructor(10)))}function me(o,i){if(o&1&&(r(0,"div",17),c(1,"spk-input",18),l()),o&2){let e=i.index;s(),a("label","Slab Point "+(e+1))("fieldReq",!0)("formControlName","slab_point_"+e)}}function de(o,i){if(o&1){let e=N();r(0,"div",8)(1,"form",9),b("ngSubmit",function(){_(e);let n=f();return g(n.onSubmit())}),r(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",10)(6,"spk-ng-select",11),b("selectedChange",function(n){_(e);let m=f();return m.onSingleSelectChange(n),m.onSelectionChange(n),g(m.findName(n))}),l()(),r(7,"div",10)(8,"spk-ng-select",12),b("selectedChange",function(n){_(e);let m=f();return m.onSingleSelectChange(n),g(m.findName(n))}),l()(),r(9,"div",10),c(10,"spk-input",13),l()(),r(11,"div",5),v(12,me,2,3,"div",14),l(),r(13,"div",15),c(14,"app-button",16),l()()()()()}if(o&2){let e=f();s(),a("formGroup",e.spinForm),s(5),a("fieldReq",!0)("options",e.commonApi.dropDownData.point_section),s(2),a("multiple",!0)("fieldReq",!0)("options",e.commonApi.customerCategorySubType),s(2),a("fieldReq",!0),s(2),a("ngForOf",e.inputFields),s(2),a("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("iconClass",e.api.disabled?"ri-loader-2-fill animate-spin":"ri-save-line")("loadingIconClass","ri-loader-2-fill")}}var ae=class o{constructor(i,e,t,n,m,y,d,ce){this.toastr=i;this.api=e;this.commonApi=t;this.fb=n;this.router=m;this.formValidation=y;this.route=d;this.moduleService=ce}FORMID=te;skLoading=!1;spinForm=new j({});data={};moduleData;subModule;inputFields=[];spinWinId;pageType="add";spinWinDetails;valueChange=new F;ngOnInit(){let i=this.moduleService.getSubModuleByName("IRP","Bonus"),e=this.moduleService.getSubSubModuleByName("IRP","Bonus","Spin & Win");e&&(this.subModule=e),this.route.paramMap.subscribe(t=>{if(t){this.spinWinId=t.get("id");let n=t.get("edit");this.pageType=n||"add",this.spinWinId&&this.getSpinWinDetail()}}),this.spinForm=this.fb.group({eligible_days:["",u.required],customer_type_id:["",u.required],customer_type_name:[""],point_section:["",u.required]}),this.commonApi.getDropDownData(this.subModule.sub_module_id,"point_section"),this.commonApi.getCustomerCategorySubType([E.INFLUENCER])}onSingleSelectChange(i,e){this.valueChange.emit(i)}findName(i){let e=i;if(Array.isArray(e)&&e.length>0){let t=this.commonApi.customerCategorySubType.filter(n=>e.includes(n.value)).map(n=>n.label);this.spinForm.patchValue({customer_type_name:t})}}onSubmit(){if(this.spinForm.valid){this.api.disabled=!0;let i=C({},this.spinForm.value),e=Number(i.point_section),t=Object.keys(i).filter(d=>d.startsWith("slab_point_")).map(d=>({slab_point:Number(i[d])})),n={customer_type_name:i.customer_type_name||[],customer_type_id:i.customer_type_id||[],point_section:isNaN(e)?0:e,eligible_days:Number(i.eligible_days)||0,slab_data:t},y=this.pageType==="edit"?"spin-win/update":"spin-win/create";this.spinWinId&&(n._id=this.spinWinId),this.api.post(n,y).subscribe({next:d=>{this.api.disabled=!1,d.statusCode===200&&(this.toastr.success(d.message,"","toast-top-right"),this.router.navigate(["/apps/loyalty/spin-win-list"]))}})}else this.toastr.error("Form Is Invalid","","toast-top-right"),this.formValidation.markFormGroupTouched(this.spinForm)}onSelectionChange(i){let e=Number(i);if(!isNaN(e)){this.inputFields=Array(e).fill(0),Object.keys(this.spinForm.controls).forEach(t=>{t.startsWith("slab_point_")&&this.spinForm.removeControl(t)});for(let t=0;t<e;t++)this.spinForm.addControl(`slab_point_${t}`,new h("",u.required))}}getSpinWinDetail(){this.skLoading=!0,this.api.post({_id:this.spinWinId},"spin-win/detail").subscribe(i=>{i.statusCode===200&&(this.skLoading=!1,this.spinWinDetails=i.data,this.spinWinDetails.point_section=this.spinWinDetails.point_section?.toString(),this.spinForm.patchValue(this.spinWinDetails),this.spinWinDetails.slab_data&&this.spinWinDetails.slab_data.length&&(this.inputFields=this.spinWinDetails.slab_data,this.spinWinDetails.slab_data.forEach((e,t)=>{this.spinForm.addControl(`slab_point_${t}`,new h(e.slab_point,u.required))})))})}static \u0275fac=function(e){return new(e||o)(p(V),p(Y),p(z),p(L),p(R),p(Z),p(T),p(K))};static \u0275cmp=I({type:o,selectors:[["app-spin-win-add"]],inputs:{moduleData:"moduleData"},outputs:{valueChange:"valueChange"},decls:4,vars:9,consts:[[3,"title","title1","activeitem","btnShow1"],["class","box",4,"ngIf"],["class","xl:col-span-12 col-span-12",4,"ngIf"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","gap-x-6"],["class","xl:col-span-3 col-span-12 mb-4",4,"ngFor","ngForOf"],[1,"xl:col-span-3","col-span-12","mb-4"],[1,"xl:col-span-12","col-span-12"],[3,"ngSubmit","formGroup"],[1,"xxl:col-span-4","xl:col-span-4","lg:col-span-4","md:col-span-12","col-span-12"],["formControlName","point_section","label","Point Section",3,"selectedChange","fieldReq","options"],["formControlName","customer_type_id","label","Customer Category",3,"selectedChange","multiple","fieldReq","options"],["label","Eligibilty Days Interval","formControlName","eligible_days","type","number",1,"remove-default-class",3,"fieldReq"],["class","xxl:col-span-3 xl:col-span-3 lg:col-span-4 md:col-span-12 col-span-12",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-end","mt-10","gap-2"],[3,"buttonType","buttonClass","iconClass","loadingIconClass"],[1,"xxl:col-span-3","xl:col-span-3","lg:col-span-4","md:col-span-12","col-span-12"],["type","number",1,"remove-default-class",3,"label","fieldReq","formControlName"]],template:function(e,t){e&1&&(c(0,"app-page-header",0),x(1,"titlecase"),v(2,le,4,2,"div",1)(3,de,15,12,"div",2)),e&2&&(a("title","Spin & Win")("title1",S(8,se))("activeitem",W(1,6,t.pageType)+" Spin & Win")("btnShow1",!1),s(2),a("ngIf",t.skLoading),s(),a("ngIf",!t.skLoading))},dependencies:[ie,A,D,B,q,O,G,P,$,X,ne,J,ee,M,Q,w,H,oe,k,U],encapsulation:2})};export{ae as SpinWinAddComponent};
