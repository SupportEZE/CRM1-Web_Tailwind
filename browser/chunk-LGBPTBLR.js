import{a as Lt}from"./chunk-5QFGLOXN.js";import{a as Tt}from"./chunk-J4NDCUAB.js";import{a as Mt}from"./chunk-SQZ3YN6N.js";import{a as st}from"./chunk-CNF4GSI7.js";import{a as H}from"./chunk-OEHD5D2Y.js";import{a as At}from"./chunk-GLWQGYBC.js";import{a as dt}from"./chunk-DC4QM32I.js";import{C as wt,F as U,c as ct,g as St,q as bt,r as vt,s as kt,v as xt,w as yt}from"./chunk-VHE3PQ3O.js";import{A as b,Aa as O,B as D,C as it,D as Q,Ea as W,G as P,Ga as j,H as nt,Ha as mt,Ia as pt,Ja as ut,M as ot,Oa as _t,P as rt,Pa as ft,Qa as gt,Ta as Ct,Ua as ht,V as at,W as R,X as lt,Z as N,hb as G,o as E,va as B,w as et,wa as q,z as F}from"./chunk-GYDYF5F3.js";import{f as L,g as V,o as tt,t as I}from"./chunk-PD5VTTIY.js";import{Aa as m,Ba as p,Hb as w,Lc as X,Mc as u,Nc as f,Ob as g,Uc as v,Vc as k,Wc as x,Yc as T,_b as d,bc as K,ed as Z,fc as y,gd as $,kc as a,lc as o,mc as S,nc as A,oc as M,qc as h,rb as r,sb as C,wc as _,yc as s}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as z,b as J}from"./chunk-66YHNWRR.js";function jt(l,n){if(l&1){let t=h();a(0,"tr")(1,"td",27),u(2),o(),a(3,"td"),u(4),o(),a(5,"td",28),u(6),o(),a(7,"td",28),u(8),o(),a(9,"td",29)(10,"div",30)(11,"app-icon-button",31),_("clickEvent",function(){let e=m(t).index,c=s(3);return p(c.deleteRow(e))}),o()()()()}if(l&2){let t=n.$implicit,i=n.index;r(2),f(i+1),r(2),f(t.product_name),r(2),f(t.stock),r(2),f(t.uom),r(3),d("icon","ri-delete-bin-line")("buttonClass","ti-btn btn-wave product-btn ti-btn-sm ti-btn-soft-danger waves-effect waves-light")}}function Gt(l,n){if(l&1&&(a(0,"div",23)(1,"div",24)(2,"spk-reusable-tables",25),g(3,jt,12,6,"tr",26),o()()()),l&2){let t=s(2);r(2),d("columns",t.headerColumn)("tableHead","border-b")("showCheckbox",!1)("showS_No",!0)("showAction",!0),r(),d("ngForOf",t.productData)}}function Ht(l,n){if(l&1){let t=h();a(0,"div",1)(1,"app-modal-header",2),_("close",function(){m(t);let e=s();return p(e.close())}),o(),a(2,"form",3),_("ngSubmit",function(){m(t);let e=s();return p(e.onSubmit())}),a(3,"mat-dialog-content",4)(4,"div",5)(5,"div",6)(6,"spk-ng-select",7),_("selectedChange",function(e){m(t);let c=s();return p(c.onCustomerCategoryChange(e))}),o()(),a(7,"div",8)(8,"spk-ng-select",9),_("searchChanged",function(e){m(t);let c=s();return p(c.onSearch(e,"customer"))})("selectedChange",function(e){m(t);let c=s();return p(c.onCustomerChange(e))}),o()()(),a(9,"div",10)(10,"div",8)(11,"spk-ng-select",11),_("searchChanged",function(e){m(t);let c=s();return p(c.onSearch(e,"product"))})("selectedChange",function(e){m(t);let c=s();return p(c.onProductChange(e))}),o()(),a(12,"div",12),S(13,"spk-input",13),o(),a(14,"div",14),S(15,"spk-ng-select",15),o(),a(16,"div",16)(17,"button",17),_("click",function(){m(t);let e=s();return p(e.addToList())}),S(18,"i",18),o()(),g(19,Gt,4,6,"div",19),o()(),a(20,"mat-dialog-actions",20)(21,"div",21),S(22,"app-button",22),o()()()()}if(l&2){let t=s();r(),d("title","Add Stock Audit")("closeBtn",!0),r(),d("formGroup",t.stockAuditForm),r(4),d("fieldReq",!0)("options",t.CommonApiService.customerCategorySubType),r(2),d("fieldReq",!0)("options",t.CommonApiService.customerData)("search",!0),r(),d("formGroup",t.productForm),r(2),d("fieldReq",!1)("options",t.CommonApiService.productList)("search",!0),r(2),d("fieldReq",!1),r(2),d("fieldReq",!1)("options",t.uomList),r(4),d("ngIf",t.productData.length>0),r(3),d("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",t.api.disabled)("iconClass",t.api.disabled?"ri-loader-2-fill animate-spin":"ri-save-line")("loadingIconClass","ri-loader-2-fill")}}function Ut(l,n){if(l&1){let t=h();a(0,"button",39),_("click",function(){m(t);let e=s(2);return e.filter.product_name="",p(e.onStaticSearch())}),a(1,"mat-icon"),u(2,"close"),o()()}}function Yt(l,n){if(l&1&&(a(0,"tr")(1,"td",27),u(2),o(),a(3,"td"),u(4),o(),a(5,"td",28),u(6),o(),a(7,"td",28),u(8),o()()),l&2){let t=n.$implicit,i=n.index;r(2),f(i+1),r(2),f(t.product_name||"---"),r(2),f(t.uom||"--"),r(2),f(t.stock||"--")}}function Qt(l,n){if(l&1){let t=h();a(0,"div",1)(1,"app-modal-header",2),_("close",function(){m(t);let e=s();return p(e.close())}),o(),a(2,"mat-dialog-content",32)(3,"div",24)(4,"spk-reusable-tables",33)(5,"tr",34)(6,"td"),u(7,"\xA0"),o(),a(8,"td")(9,"div",35)(10,"mat-form-field",36)(11,"input",37),x("ngModelChange",function(e){m(t);let c=s();return k(c.filter.product_name,e)||(c.filter.product_name=e),p(e)}),_("keyup.enter",function(){m(t);let e=s();return p(e.onStaticSearch())}),o(),g(12,Ut,3,0,"button",38),o()()(),a(13,"td"),u(14,"\xA0"),o(),a(15,"td"),u(16,"\xA0"),o()(),g(17,Yt,9,4,"tr",26),o()()()()}if(l&2){let t=s();r(),d("title","Product Detail")("closeBtn",!0),r(3),d("columns",t.headerColumn)("tableHead","border-b")("showS_No",!0),r(7),v("ngModel",t.filter.product_name),r(),y(t.filter.product_name?12:-1),r(5),d("ngForOf",t.filteredData)}}var Y=class l{constructor(n,t,i,e,c,re,ae,le){this.modalData=n;this.dialogRef=t;this.nameUtils=i;this.CommonApiService=e;this.api=c;this.fb=re;this.toastr=ae;this.formValidation=le}stockAuditForm=new Q({});productForm=new Q({});skLoading=!1;productData=[];filter={};filteredData=[];ngOnInit(){this.modalData.formType==="add"?(this.CommonApiService.getCustomerCategorySubType([E.PRIMARY,E.SUB_PRIMARY,E.SECONDARY]),this.CommonApiService.getProduct()):this.filteredData=[...this.modalData.formData],this.stockAuditForm=this.fb.group({customer_type_id:["",b.required],customer_type_name:["",b.required],customer_id:["",b.required],customer_name:["",b.required]}),this.productForm=this.fb.group({product_id:["",b.required],product_name:["",b.required],stock:["",b.required],uom:["",b.required]})}onCustomerCategoryChange(n){let t=this.CommonApiService.customerCategorySubType.find(i=>i.value===n);t&&this.stockAuditForm.patchValue({customer_type_name:t.label}),this.CommonApiService.getCustomerData(this.stockAuditForm.value.customer_type_id)}onCustomerChange(n){let t=this.CommonApiService.customerData.find(i=>i.value===n);t&&this.stockAuditForm.patchValue({customer_name:t.label})}onProductChange(n){let t=this.CommonApiService.productList.find(i=>i.value===n);t&&this.productForm.patchValue({product_name:t.label})}lastSearchTerm="";onSearch(n,t){let i=n?.trim()||"";i!==this.lastSearchTerm&&(this.lastSearchTerm=i,t==="customer"&&this.CommonApiService.getCustomerData(this.stockAuditForm.value.customer_type_id,"",n),t==="product"&&this.CommonApiService.getProduct(n))}addToList(){if(this.productForm.invalid){this.productForm.markAllAsTouched();return}let n=this.productForm.value;if(n.stock=Number(n.stock),this.productData.some(i=>i.product_id===n.product_id&&i.uom===n.uom)){this.toastr.error("This product is already added","","toast-top-right");return}this.productData.push(this.productForm.value),this.productForm.reset()}deleteRow(n){this.productData.splice(n,1)}onSubmit(){if(this.stockAuditForm.invalid){this.stockAuditForm.markAllAsTouched();return}if(this.productData.length===0){this.toastr.error("Please add at least one product.","","toast-top-right");return}if(this.stockAuditForm.valid){let n=J(z({},this.stockAuditForm.value),{audit_report:this.productData});this.api.disabled=!0,this.api.post(n,"stock/create-stock-audit").subscribe(t=>{t.statusCode===200&&(this.api.disabled=!1,this.toastr.success(t.message,"","toast-top-right"),this.dialogRef.close(!0))})}else this.toastr.error("Form Is Invalid","","toast-top-right"),this.formValidation.markFormGroupTouched(this.stockAuditForm)}close(){this.dialogRef.close()}onStaticSearch(){let n=this.filter.product_name?.toLowerCase()||"";this.filteredData=this.modalData.formData.filter(t=>t.product_name?.toLowerCase().includes(n))}headerColumn=[{label:"Product",table_class:""},{label:"Stock",table_class:"text-center"},{label:"UOM",table_class:"text-center"}];uomList=[{label:"Box",value:"Box"},{label:"Pcs",value:"Pcs"}];static \u0275fac=function(t){return new(t||l)(C(ft),C(_t),C(Lt),C(st),C(N),C(at),C(et),C(xt))};static \u0275cmp=w({type:l,selectors:[["app-stock-audit-modal"]],decls:2,vars:2,consts:[["class","mat-dialoge",4,"ngIf"],[1,"mat-dialoge"],[3,"close","title","closeBtn"],[3,"ngSubmit","formGroup"],[1,"mat-typography","py-1"],[1,"grid","grid-cols-12","sm:gap-x-6"],[1,"xl:col-span-4","col-span-12","mb-3"],["formControlName","customer_type_id","label","Customer Category",3,"selectedChange","fieldReq","options"],[1,"xl:col-span-6","col-span-12","mb-3"],["formControlName","customer_id","label","Customer Category",3,"searchChanged","selectedChange","fieldReq","options","search"],[1,"grid","grid-cols-12","sm:gap-x-6",3,"formGroup"],["formControlName","product_id","label","Product",3,"searchChanged","selectedChange","fieldReq","options","search"],[1,"xl:col-span-3","col-span-12","mb-3"],["label","Stock","formControlName","stock","type","number",1,"remove-default-class",3,"fieldReq"],[1,"xl:col-span-2","col-span-12","mb-3"],["formControlName","uom","label","UOM",3,"fieldReq","options"],[1,"flex","justify-start","mt-6"],["type","button","aria-label","button",1,"ti-btn","ti-btn-icon","ti-btn-primary","btn-wave",3,"click"],[1,"ri-add-line"],["class","xl:col-span-12 col-span-12",4,"ngIf"],["align","end"],[1,"flex","items-center","gap-2"],[3,"buttonType","buttonClass","disabled","iconClass","loadingIconClass"],[1,"xl:col-span-12","col-span-12"],[1,"table-responsive","mt-4","table-bordered-default"],["tableClass","ti-custom-table ti-custom-table-hover ti-head-primary",3,"columns","tableHead","showCheckbox","showS_No","showAction"],[4,"ngFor","ngForOf"],[1,"w60","text-center"],[1,"text-center"],[1,"w60","relative"],[1,"flex","flex-row","items-center","!gap-2","text-[0.9375rem]"],[3,"clickEvent","icon","buttonClass"],[1,"mat-typography"],["tableClass","ti-custom-table ti-custom-table-hover ti-head-primary",3,"columns","tableHead","showS_No"],[1,"border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"table-search-filters"],[1,"table-input"],["matInput","","type","text","placeholder","Search...",3,"ngModelChange","keyup.enter","ngModel"],["matSuffix","","mat-icon-button","","aria-label","Clear"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"click"]],template:function(t,i){t&1&&g(0,Ht,23,21,"div",0)(1,Qt,18,8,"div",0),t&2&&(d("ngIf",i.modalData.formType==="add"),r(),d("ngIf",i.modalData.formType==="view"))},dependencies:[I,L,V,U,nt,F,D,it,P,ot,rt,yt,St,wt,Mt,vt,G,O,ht,Ct,W,j,q,B,R,lt,H],encapsulation:2})};var zt=()=>["Stock Audit"],It=()=>[];function Jt(l,n){if(l&1){let t=h();a(0,"button",19),_("click",function(){m(t);let e=s(2);return e.filter.created_name="",p(e.getList())}),a(1,"mat-icon"),u(2,"close"),o()()}}function Kt(l,n){if(l&1){let t=h();a(0,"button",19),_("click",function(){m(t);let e=s(2);return e.filter.customer_type_name="",p(e.getList())}),a(1,"mat-icon"),u(2,"close"),o()()}}function Xt(l,n){if(l&1){let t=h();a(0,"button",19),_("click",function(){m(t);let e=s(2);return e.filter.audit_no="",p(e.getList())}),a(1,"mat-icon"),u(2,"close"),o()()}}function Zt(l,n){if(l&1){let t=h();a(0,"button",19),_("click",function(){m(t);let e=s(2);return e.filter.customer_name="",p(e.getList())}),a(1,"mat-icon"),u(2,"close"),o()()}}function $t(l,n){if(l&1){let t=h();a(0,"tr",20)(1,"td",21),u(2),o(),a(3,"td"),u(4),Z(5,"date"),o(),a(6,"td"),u(7),o(),a(8,"td"),u(9),o(),a(10,"td")(11,"a",22),_("click",function(){let e=m(t).$implicit,c=s(2);return p(c.openModal("view",e.audit_report))}),u(12),o()(),a(13,"td"),u(14),o(),a(15,"td",21),u(16),o(),a(17,"td",21),u(18),o()()}if(l&2){let t=n.$implicit,i=n.index,e=s(2);r(2),f((e.listPagination.cur_page-1)*e.listPagination.limit+i+1),r(2),f(t.created_at?$(5,8,t.created_at,"d MMM yyyy, hh:mm a"):"--"),r(3),f(t.created_name||"--"),r(2),f(t.customer_type_name||"--"),r(3),f(t.audit_no||"--"),r(2),f(t.customer_name||"--"),r(2),f(t.total_product_audit||"--"),r(2),f(t.total_product_qty||"--")}}function te(l,n){if(l&1){let t=h();A(0),a(1,"tr",11)(2,"td"),u(3,"\xA0"),o(),a(4,"td")(5,"div",12)(6,"mat-form-field",13)(7,"input",14),x("ngModelChange",function(e){m(t);let c=s();return k(c.filter.created_at,e)||(c.filter.created_at=e),p(e)}),_("ngModelChange",function(){m(t);let e=s();return p(e.getList())}),o(),S(8,"mat-datepicker-toggle",15)(9,"mat-datepicker",null,0),o()()(),a(11,"td")(12,"div",12)(13,"mat-form-field",13)(14,"input",16),x("ngModelChange",function(e){m(t);let c=s();return k(c.filter.created_name,e)||(c.filter.created_name=e),p(e)}),_("keyup.enter",function(){m(t);let e=s();return p(e.getList())}),o(),g(15,Jt,3,0,"button",17),o()()(),a(16,"td")(17,"div",12)(18,"mat-form-field",13)(19,"input",16),x("ngModelChange",function(e){m(t);let c=s();return k(c.filter.customer_type_name,e)||(c.filter.customer_type_name=e),p(e)}),_("keyup.enter",function(){m(t);let e=s();return p(e.getList())}),o(),g(20,Kt,3,0,"button",17),o()()(),a(21,"td")(22,"div",12)(23,"mat-form-field",13)(24,"input",16),x("ngModelChange",function(e){m(t);let c=s();return k(c.filter.audit_no,e)||(c.filter.audit_no=e),p(e)}),_("keyup.enter",function(){m(t);let e=s();return p(e.getList())}),o(),g(25,Xt,3,0,"button",17),o()()(),a(26,"td")(27,"div",12)(28,"mat-form-field",13)(29,"input",16),x("ngModelChange",function(e){m(t);let c=s();return k(c.filter.customer_name,e)||(c.filter.customer_name=e),p(e)}),_("keyup.enter",function(){m(t);let e=s();return p(e.getList())}),o(),g(30,Zt,3,0,"button",17),o()()(),a(31,"td"),u(32,"\xA0"),o(),a(33,"td"),u(34,"\xA0"),o()(),g(35,$t,19,11,"tr",18),M()}if(l&2){let t=X(10),i=s();r(7),d("matDatepicker",t),v("ngModel",i.filter.created_at),r(),d("for",t),r(6),v("ngModel",i.filter.created_name),r(),y(i.filter.created_name?15:-1),r(4),v("ngModel",i.filter.customer_type_name),r(),y(i.filter.customer_type_name?20:-1),r(4),v("ngModel",i.filter.audit_no),r(),y(i.filter.audit_no?25:-1),r(4),v("ngModel",i.filter.customer_name),r(),y(i.filter.customer_name?30:-1),r(5),d("ngForOf",i.listing)}}function ee(l,n){l&1&&(a(0,"td"),S(1,"app-skeleton"),o()),l&2&&(r(),K("h20 bg-skeleton"))}function ie(l,n){l&1&&(a(0,"tr",11),g(1,ee,2,2,"td",24),o()),l&2&&(r(),d("ngForOf",T(1,It).constructor(8)))}function ne(l,n){l&1&&(A(0),g(1,ie,2,2,"tr",23),M()),l&2&&(r(),d("ngForOf",T(1,It).constructor(8)))}function oe(l,n){l&1&&(A(0),S(1,"app-data-not-found"),M())}var Vt=class l{constructor(n,t,i){this.dialog=n;this.api=t;this.moduleService=i}skLoading=!1;listPagination={};filter={};listing=[];accessRight={};ngOnInit(){let n=this.moduleService.getAccessMap("SFA","Stock","Stock Audit");n&&(this.accessRight=n),this.getList()}onRefresh(){this.filter={},this.getList()}changeToPage(n){this.listPagination.cur_page=n,this.getList()}changeToPagination(n){n==="Next"&&this.listPagination.cur_page<this.listPagination.total_pages?this.listPagination.cur_page++:n==="Previous"&&this.listPagination.cur_page>1&&this.listPagination.cur_page--,this.getList()}getList(){this.skLoading=!0,this.api.post({filters:this.filter},"stock/read-stock-audit").subscribe(n=>{n.statusCode==200&&(this.skLoading=!1,this.listing=n.data,this.listPagination=n.pagination)})}openModal(n,t){this.dialog.open(Y,{width:n==="view"?"700px":"800px",data:{formType:n,formData:t}}).afterClosed().subscribe(e=>{e===!0&&this.getList()})}PageHeaders=[{label:"Created At"},{label:"Created By"},{label:"Customer Category"},{label:"Audit No."},{label:"Customer Detail"},{label:"Total Item",table_class:"text-center"},{label:"Total Qty",table_class:"text-center"}];static \u0275fac=function(t){return new(t||l)(C(gt),C(N),C(dt))};static \u0275cmp=w({type:l,selectors:[["app-stock-audit-list"]],decls:12,vars:23,consts:[["picker",""],[3,"title","title1","activeitem"],[1,"row"],[1,"col-xl-12"],[1,"box"],[3,"onRefresh","button1","pageTitle","listLength","btnShow","refreshLabel","btnShow2","addBtnLabel"],[1,"box-body"],[1,"table-responsive","overflow-auto","table-bordered-default"],["tableClass","ti-custom-table ti-custom-table-head ti-custom-table-hover ti-head-primary whitespace-nowrap",3,"tableHead","showS_No","showAction","columns"],[4,"ngIf"],[3,"preButtonClick","nextButtonClick","pageChange","currentPage","totalPage","pageLimit","listLength","preBtn","nextBtn"],[1,"border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"table-search-filters"],[1,"table-input"],["matInput","","name","createdAt","placeholder","Date Created",3,"ngModelChange","matDatepicker","ngModel"],["matIconSuffix","",3,"for"],["matInput","","type","text","placeholder","Search...",3,"ngModelChange","keyup.enter","ngModel"],["matSuffix","","mat-icon-button","","aria-label","Clear"],["class","product-list border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"click"],[1,"product-list","border-b","!border-defaultborder","dark:!border-defaultborder/10"],[1,"text-center"],[1,"text-primary","font-semibold","underline",3,"click"],["class","border-b !border-defaultborder dark:!border-defaultborder/10",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"]],template:function(t,i){t&1&&(S(0,"app-page-header",1),a(1,"div",2)(2,"div",3)(3,"div",4)(4,"app-page-sub-header",5),_("onRefresh",function(){return i.onRefresh()})("button1",function(){return i.openModal("add","")}),o(),a(5,"div",6)(6,"div",7)(7,"spk-reusable-tables",8),g(8,te,36,12,"ng-container",9)(9,ne,2,2,"ng-container",9),o(),g(10,oe,2,0,"ng-container",9),o()(),a(11,"app-pagination-footer",10),_("preButtonClick",function(){return i.changeToPagination("Previous")})("nextButtonClick",function(){return i.changeToPagination("Next")})("pageChange",function(c){return i.changeToPage(c)}),o()()()()),t&2&&(d("title","Stock Audit")("title1",T(22,zt))("activeitem","Stock Audit List"),r(4),d("pageTitle","Stock Audit List")("listLength",i.listing.length)("btnShow",!0)("refreshLabel","Refresh")("btnShow2",i.accessRight==null?null:i.accessRight.addRight)("addBtnLabel","Add Stock Audit"),r(3),d("tableHead","border-b")("showS_No",!0)("showAction",!1)("columns",i.PageHeaders),r(),d("ngIf",!i.skLoading),r(),d("ngIf",i.skLoading),r(),d("ngIf",!i.listing.length&&!i.skLoading),r(),d("currentPage",i.listPagination.cur_page)("totalPage",i.listPagination.total_pages)("pageLimit",i.listPagination.limit)("listLength",i.listing.length)("preBtn",!i.listPagination.prev)("nextBtn",!i.listPagination.next))},dependencies:[U,L,V,F,D,P,At,ct,kt,bt,Tt,tt,I,H,G,O,mt,pt,ut,W,j,q,B,R],encapsulation:2})};export{Vt as StockAuditListComponent};
