import{a as re}from"./chunk-5QFGLOXN.js";import{a as ne}from"./chunk-PU6S26UW.js";import{a as ae}from"./chunk-OTFCGVEU.js";import{a as B}from"./chunk-CNF4GSI7.js";import{a as U}from"./chunk-DC4QM32I.js";import{C as ie,F as oe,g as X,j as Y,k as Z,r as ee,w as te}from"./chunk-VHE3PQ3O.js";import{A as _,B as w,C as N,D as b,H as M,M as q,Oa as J,P as R,Pa as H,Ta as W,Ua as Q,V as E,X as O,Ya as $,Z as j,hb as K,oa as L,w as G,wa as z}from"./chunk-GYDYF5F3.js";import{f as V,g as P,n as D,t as I}from"./chunk-PD5VTTIY.js";import{Aa as m,Ba as c,Hb as x,Mc as v,Ob as h,Pc as T,_b as n,ed as k,fd as A,kc as s,lc as l,mc as g,qc as y,rb as r,sb as f,wc as u,yc as p}from"./chunk-2NSPOFEK.js";import{a as C,b as S}from"./chunk-66YHNWRR.js";function le(a,i){if(a&1){let e=y();s(0,"div",6)(1,"label",12),v(2,"Product Images"),s(3,"span",13),v(4,"*"),l()(),s(5,"file-pond",14),u("onremovefile",function(o){m(e);let d=p(2);return c(d.onFileRemove(o,"image"))})("onprocessfile",function(o){m(e);let d=p(2);return c(d.onFileProcessed(o,"image"))}),l()()}if(a&2){let e=p(2);r(5),n("options",e.pondOptions)("files",e.pondFiles)}}function de(a,i){if(a&1){let e=y();s(0,"div",1)(1,"app-modal-header",2),k(2,"titlecase"),u("close",function(){m(e);let o=p();return c(o.close())}),l(),s(3,"form",3),u("ngSubmit",function(){m(e);let o=p();return c(o.onSubmitPopGift())}),s(4,"mat-dialog-content",4)(5,"div",5)(6,"div",6),g(7,"spk-input",7),l(),s(8,"div",6),g(9,"spk-input",8),l(),h(10,le,6,2,"div",9),l()(),s(11,"mat-dialog-actions",10),g(12,"app-button",11),l()()()}if(a&2){let e=p();r(),n("title",A(2,14,e.pageType)+" Pop & Gift")("closeBtn",!0),r(2),n("formGroup",e.addForm),r(4),n("label","Product Name")("fieldReq",!0),r(2),n("label","Description")("fieldReq",!0),r(),n("ngIf",e.modalData.formType==="add"),r(2),n("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",e.api.disabled)("formType",e.modalData.formType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}function pe(a,i){if(a&1){let e=y();s(0,"div",15)(1,"spk-ng-select",25),u("selectedChange",function(o){m(e);let d=p(2);return c(d.findName(o,"assign_to_type"))}),l()()}if(a&2){let e=p(2);r(),n("fieldReq",!0)("options",e.assign_to_type)}}function me(a,i){if(a&1){let e=y();s(0,"div",15)(1,"spk-ng-select",26),u("searchChanged",function(o){m(e);let d=p(2);return c(d.onSearch(o,d.stockForm.value.assign_to_type))})("selectedChange",function(o){m(e);let d=p(2);return c(d.findName(o,"customer_name"))}),l()()}if(a&2){let e=p(2);r(),n("label",e.stockForm.value.assign_to_type)("fieldReq",!0)("options",e.stockForm.value.assign_to_type==="Team"?e.CommonApiService.userData:e.CommonApiService.customerData)("search",!0)}}function ce(a,i){a&1&&(s(0,"div",15),g(1,"spk-input",27),l()),a&2&&(r(),n("label","Vendor")("fieldReq",!0))}function _e(a,i){if(a&1&&(s(0,"mat-option",28),v(1),l()),a&2){let e=i.$implicit;n("value",e._id),r(),T("",e.product_name," (",e.product_code,")")}}function fe(a,i){a&1&&(s(0,"div",29),v(1," Product is required. "),l())}function ue(a,i){if(a&1){let e=y();s(0,"div",1)(1,"app-modal-header",2),u("close",function(){m(e);let o=p();return c(o.close())}),l(),s(2,"form",3),u("ngSubmit",function(){m(e);let o=p();return c(o.onSubmitManageStock())}),s(3,"mat-dialog-content",4)(4,"div",5)(5,"div",15)(6,"spk-ng-select",16),u("selectedChange",function(){m(e);let o=p();return c(o.getAssignToTypeOptions())}),l()(),h(7,pe,2,2,"div",17)(8,me,2,4,"div",17)(9,ce,2,2,"div",17),s(10,"div",18)(11,"label",12),v(12,"Product"),s(13,"span",13),v(14,"*"),l()(),s(15,"mat-form-field",19)(16,"mat-select",20),u("ngModelChange",function(o){m(e);let d=p();return c(d.findName(o,"product_name"))}),h(17,_e,2,3,"mat-option",21),l()(),h(18,fe,2,0,"div",22),l(),s(19,"div",15),g(20,"spk-input",23),l(),s(21,"div",15),g(22,"spk-input",24),l()()(),s(23,"mat-dialog-actions",10),g(24,"app-button",11),l()()()}if(a&2){let e,t=p();r(),n("title","Manage Transaction")("closeBtn",!0),r(),n("formGroup",t.stockForm),r(4),n("fieldReq",!0)("options",t.transaction_type),r(),n("ngIf",t.stockForm.value.transaction_type),r(),n("ngIf",t.stockForm.value.assign_to_type&&t.stockForm.value.assign_to_type!=="Vendor"),r(),n("ngIf",t.stockForm.value.assign_to_type==="Vendor"),r(8),n("ngForOf",t.listing),r(),n("ngIf",((e=t.stockForm.get("product_id"))==null?null:e.invalid)&&((e=t.stockForm.get("product_id"))==null?null:e.touched)),r(2),n("label","Qty")("fieldReq",!0)("type","number"),r(2),n("label","Description")("fieldReq",!0),r(2),n("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",t.api.disabled)("formType",t.modalData.formType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}var se=class a{constructor(i,e,t,o,d,F,ge,ve,he,ye){this.modalData=i;this.dialogRef=e;this.nameUtils=t;this.CommonApiService=o;this.toastr=d;this.api=F;this.fb=ge;this.uploadService=ve;this.logService=he;this.moduleService=ye}data={};addForm=new b({});stockForm=new b({});submodule;listing=[];assign_to_type=[];pageType="add";originalData={};ngOnInit(){let i=this.moduleService.getSubModuleByName("SFA","Pop Gift");i&&(this.submodule=i),this.modalData.formType==="manage-transaction"&&this.getList(),this.addForm=this.fb.group({product_name:["",_.required],description:["",_.required],_id:[""]}),this.stockForm=this.fb.group({transaction_type:["",_.required],assign_to_type:[""],assigned_to_id:[""],assigned_to_login_id:[""],assigned_to_name:["",_.required],product_id:["",_.required],product_name:["",_.required],transaction_qty:["",_.required],delivery_note:["",_.required]}),this.stockForm.get("transaction_type")?.valueChanges.subscribe(e=>{e==="Fresh Purchase"?(this.stockForm.get("assign_to_type")?.clearValidators(),this.stockForm.get("assigned_to_id")?.clearValidators(),this.stockForm.get("assigned_to_login_id")?.clearValidators()):(this.stockForm.get("assign_to_type")?.setValidators([_.required]),this.stockForm.get("assigned_to_id")?.setValidators([_.required]),this.stockForm.get("assigned_to_login_id")?.setValidators([_.required]))}),this.modalData.formType==="edit"&&(this.pageType=this.modalData.formType,this.addForm.patchValue(S(C({},this.modalData.formData),{_id:this.modalData.formData._id})),this.originalData=JSON.parse(JSON.stringify(this.modalData.formData)))}pondFiles=[];pondOptions=this.getPondOptions("image");getPondOptions(i){let e={allowFileTypeValidation:!0,labelIdle:"Click or drag files here to upload...",maxFiles:5,server:{process:(t,o,d,F)=>{setTimeout(()=>{F(Date.now().toString())},1e3)},revert:(t,o)=>{o()}}};if(i==="image")return S(C({},e),{allowMultiple:!1,acceptedFileTypes:["image/jpeg","image/png","image/jpg"],maxFileSize:"2MB",allowImageValidateSize:!0,labelFileTypeNotAllowed:"Only PNG and JPEG files are allowed",fileValidateTypeLabelExpectedTypes:"Allowed: PNG, JPEG",labelImageValidateSizeTooSmall:"Image is too small. Min: {minWidth}\xD7{minHeight}",labelImageValidateSizeTooBig:"Image is too large. Max: {maxWidth}\xD7{maxHeight}"})}onFileProcessed(i,e){let t=i.file.file;Object.assign(t,{image_type:e}),e==="image"&&(this.pondFiles=[...this.pondFiles||[],t])}onFileRemove(i,e){let t=i.file.file;if(e==="image"){let o=this.pondFiles.findIndex(d=>d.name===t.name&&d.size===t.size);o>-1&&this.pondFiles.splice(o,1)}}getList(){this.api.post({page:1},"pop-gift/read-pop-gift").subscribe(i=>{i.statusCode==200&&(this.listing=i.data.result)})}lastSearchTerm="";onSearch(i,e){let t=i?.trim()||"";t!==this.lastSearchTerm&&(this.lastSearchTerm=t,e==="Team"&&this.CommonApiService.getUserData(i),e==="Customer"&&this.CommonApiService.getCustomerData("","",i))}findName(i,e){if(e==="assign_to_type"&&(this.stockForm.value.assign_to_type==="Team"&&this.CommonApiService.getUserData(),this.stockForm.value.assign_to_type==="Customer"&&this.CommonApiService.getCustomerData()),e==="customer_name"){if(this.stockForm.value.assign_to_type==="Team"){let t=this.CommonApiService.userData.find(o=>o.value===i);t&&(this.stockForm.patchValue({assigned_to_name:t.label}),this.stockForm.patchValue({assigned_to_login_id:t.login_type_id}))}if(this.stockForm.value.assign_to_type==="Customer"){let t=this.CommonApiService.customerData.find(o=>o.value===i);t&&(this.stockForm.patchValue({assigned_to_name:t.label}),this.stockForm.patchValue({assigned_to_login_id:t.login_type_id}))}}if(e==="product_name"){let t=this.listing.find(o=>o._id===i);t&&this.stockForm.patchValue({product_name:t.product_name})}}onSubmitPopGift(){if(this.addForm.invalid){this.addForm.markAllAsTouched();return}if(this.pondFiles.length===0&&this.modalData.formType==="add"){this.toastr.error("Please upload at least one file.","","toast-top-right");return}this.api.disabled=!0;let i=this.pageType==="edit";if(i&&this.logService.logActivityOnUpdate(i,this.originalData,this.addForm.value,this.submodule.module_id,this.submodule.title,"update",this.originalData._id||null,()=>{},this.submodule.module_type)&&this.pondFiles.length===0){this.api.disabled=!1,this.toastr.warning("No changes detected","","toast-top-right");return}let e=i?"patch":"post",t=i?"pop-gift/update-pop-gift":"pop-gift/create-pop-gift";this.api[e](this.addForm.value,t).subscribe(o=>{o.statusCode===200&&(this.pondFiles.length>0?(this.api.disabled=!0,this.uploadService.uploadFile(o.data.inserted_id,"pop-gift",this.pondFiles,"Pop And Gift Images",this.submodule,void 0,()=>this.dialogRef.close(!0))):(this.api.disabled=!1,this.toastr.success(o.message,"","toast-top-right"),this.dialogRef.close(!0)))})}onSubmitManageStock(){if(this.stockForm.invalid){this.stockForm.markAllAsTouched();return}this.stockForm.value.transaction_type==="Fresh Purchase"&&(delete this.stockForm.value.assigned_to_id,delete this.stockForm.value.assigned_to_login_id),this.api.disabled=!0,this.api.post(this.stockForm.value,"pop-gift/create-manage-stock").subscribe(i=>{i.statusCode===200&&(this.api.disabled=!1,this.toastr.success(i.message,"","toast-top-right"),this.dialogRef.close(!0))})}close(){this.dialogRef.close()}transaction_type=[{label:"Fresh Purchase",value:"Fresh Purchase"},{label:"Assign",value:"Assign"},{label:"Return",value:"Return"}];getAssignToTypeOptions(){return this.assign_to_type=[],this.stockForm.value.transaction_type==="Fresh Purchase"?this.assign_to_type.push({label:"Vendor",value:"Vendor"}):this.assign_to_type.push({label:"Team",value:"Team"},{label:"Customer",value:"Customer"}),this.assign_to_type}static \u0275fac=function(e){return new(e||a)(f(H),f(J),f(re),f(B),f(G),f(j),f(E),f(ne),f(ae),f(U))};static \u0275cmp=x({type:a,selectors:[["app-pop-gift-add"]],decls:2,vars:2,consts:[["class","mat-dialoge",4,"ngIf"],[1,"mat-dialoge"],[3,"close","title","closeBtn"],[3,"ngSubmit","formGroup"],[1,"mat-typography","py-1"],[1,"grid","grid-cols-12","sm:gap-x-6"],[1,"xl:col-span-12","col-span-12"],["formControlName","product_name",1,"remove-default-class",3,"label","fieldReq"],["formControlName","description","type","textarea",1,"remove-default-class",3,"label","fieldReq"],["class","xl:col-span-12 col-span-12",4,"ngIf"],["align","end",1,"gap-2"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],[1,"form-label","mb-0"],[1,"text-red-500"],[1,"filepond","basic-filepond",3,"onremovefile","onprocessfile","options","files"],[1,"xl:col-span-4","col-span-12"],["formControlName","transaction_type","label","Transaction Type",3,"selectedChange","fieldReq","options"],["class","xl:col-span-4 col-span-12",4,"ngIf"],[1,"xl:col-span-4","col-span-12","mb-3"],[1,"mat-custom-field"],["placeholder","Select an option","formControlName","product_id",3,"ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["class","error",4,"ngIf"],["formControlName","transaction_qty",1,"remove-default-class",3,"label","fieldReq","type"],["formControlName","delivery_note","type","textarea",1,"remove-default-class",3,"label","fieldReq"],["formControlName","assign_to_type","label","User Type",3,"selectedChange","fieldReq","options"],["formControlName","assigned_to_id",3,"searchChanged","selectedChange","label","fieldReq","options","search"],["formControlName","assigned_to_name",1,"remove-default-class",3,"label","fieldReq"],[3,"value"],[1,"error"]],template:function(e,t){e&1&&h(0,de,13,16,"div",0)(1,ue,25,21,"div",0),e&2&&(n("ngIf",t.modalData.formType==="add"||t.modalData.formType==="edit"),r(),n("ngIf",t.modalData.formType==="manage-transaction"))},dependencies:[I,V,P,D,oe,M,w,N,q,R,te,X,ie,ee,K,L,Q,W,z,$,Z,Y,O],encapsulation:2})};export{se as a};
