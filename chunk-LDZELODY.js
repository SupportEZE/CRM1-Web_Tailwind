import{a as fe}from"./chunk-GXF7AAOQ.js";import{a as pe}from"./chunk-ZON5AR26.js";import"./chunk-LGZVJJDX.js";import{a as ce}from"./chunk-54KZ5YIV.js";import"./chunk-SQZ3YN6N.js";import"./chunk-CIBZCVJQ.js";import{a as le}from"./chunk-OTFCGVEU.js";import{a as de}from"./chunk-HPLI5COI.js";import"./chunk-DUVWFXSE.js";import"./chunk-OEHD5D2Y.js";import{a as me}from"./chunk-GLWQGYBC.js";import{a as ee}from"./chunk-DC4QM32I.js";import{C as ae,F as se,c as Z,f as oe,n as re,v as ne}from"./chunk-VHE3PQ3O.js";import{C as B,H as z,M as $,Qa as ie,V as J,W as X,X as K,Y as W,Z as Y,hb as te,l as q,w as U}from"./chunk-GYDYF5F3.js";import{K as j,M as H,f as N,g as Q,t as G}from"./chunk-PD5VTTIY.js";import{Aa as C,Ba as I,Hb as L,Ob as y,Yc as D,_b as m,cc as V,kc as h,lc as _,mc as x,nc as A,oc as O,qc as E,qd as k,rb as u,sb as d,wc as S,yc as f}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{i as P}from"./chunk-66YHNWRR.js";var _e=()=>["QR Code"],ye=()=>[];function ge(n,i){n&1&&(h(0,"div",8),x(1,"app-skeleton"),_())}function Fe(n,i){n&1&&(h(0,"div",4)(1,"div",5)(2,"div",6),y(3,ge,2,0,"div",7),_()()()),n&2&&(u(3),m("ngForOf",D(1,ye).constructor(10)))}function ve(n,i){if(n&1){let e=E();h(0,"div")(1,"app-form-field",17,0),S("valueChange",function(r){C(e);let o=f().$implicit,l=f(4);return I(l.onFieldChange(r,o))})("searchChanged",function(r){C(e);let o=f().$implicit,l=f(4);return I(o.search?l.onSearch(r,o):"")}),_()()}if(n&2){let e=f().$implicit,t=f(4);V("mb-4 ",e.class_name,""),u(),m("field",e)("form",t.myForm)}}function be(n,i){if(n&1&&(A(0),y(1,ve,3,5,"div",16),O()),n&2){let e=i.$implicit;u(),m("ngIf",e.is_show===!0&&(e.is_parent_dependency===!1||e.is_child_show===!0))}}function Ce(n,i){if(n&1&&(h(0,"div",6),y(1,be,2,1,"ng-container",15),_()),n&2){let e=f(3);u(),m("ngForOf",e.formFields)}}function Ie(n,i){if(n&1){let e=E();h(0,"form",11),S("ngSubmit",function(){C(e);let r=f(2);return I(r.onSubmit())}),h(1,"div",4)(2,"div",5),y(3,Ce,2,1,"div",12),_(),h(4,"div",13),x(5,"app-button",14),_()()()}if(n&2){let e=f(2);m("formGroup",e.myForm),u(3),m("ngIf",e.myForm&&e.myForm.controls),u(2),m("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",e.api.disabled)("formType",e.pageType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}function Se(n,i){if(n&1&&(h(0,"div",9),y(1,Ie,6,8,"form",10),_()),n&2){let e=f();u(),m("ngIf",e.formIniatialized)}}var ue=class n{constructor(i,e,t,r,o,l,s,a,g,M,c,v){this.dialog=i;this.spaceRemove=e;this.cdr=t;this.fb=r;this.util=o;this.toastr=l;this.api=s;this.route=a;this.router=g;this.logService=M;this.moduleService=c;this.formValidation=v}filter={};pageType="add";productId;formFields=[];myForm;primaryForm;FORMID=de;moduleFormId=0;moduleId=0;submoduleId=0;moduleName="";originalFormFields=[];skLoading=!1;formIniatialized=!1;fieldTypes=q;originalData={};tableIdId=0;submodule;ngOnInit(){let i=this.moduleService.getSubModuleByName("IRP","Qr Code"),e=this.moduleService.getFormById("IRP","Qr Code",this.FORMID.ID.QRCodeformId);i&&(this.submodule=i),e&&(this.submodule.form_id=e.form_id,this.moduleFormId=e.form_id,this.getFormData())}onRefresh(){this.filter={},this.getListingModuleData()}listPageData={};productPageTableData={};allProductPageHeaders=[];productPageHeaders=[];productPageDropdowns={};getListingModuleData(){this.api.post({platform:"web",table_id:this.tableIdId,form_id:this.moduleFormId},"table-builder/read").subscribe(i=>{i.statusCode=="200"&&(this.listPageData=i.data,this.productPageTableData=this.listPageData.table_data,this.allProductPageHeaders=this.productPageTableData.tableHead,this.productPageHeaders=this.productPageTableData.tableHead,this.productPageDropdowns=this.productPageHeaders.filter(e=>e.type==="SINGLE_SELECT"||e.type==="MULTI_SELECT"),this.productPageDropdowns=this.productPageDropdowns.map(e=>e.name),this.productPageHeaders=this.productPageHeaders.filter(e=>e.list_view_checked))})}initializeForm(){this.myForm=this.fb.group({}),this.formFields.forEach(i=>{i.api_path&&!i.is_parent_dependency&&this.getOptions(i.name,i.api_path),i.control=this.fb.control("",this.formValidation.getValidators(i)),this.myForm.addControl(i.name,i.control)}),this.formIniatialized=!0}onClick(i){}getFormData(){this.skLoading=!0,this.api.post({form_id:this.moduleFormId,platform:"web"},"form-builder/read").subscribe(i=>{i.statusCode==200&&(i?.data?.form_data&&(this.originalFormFields=JSON.parse(JSON.stringify(i.data.form_data))),this.formFields=i.data.form_data,this.skLoading=!1,this.formFields.forEach(e=>{this.util.createValidation(e)}),this.initializeForm())})}openModal(i){this.dialog.open(pe,{data:{lastPage:"product",form_Fields:this.originalFormFields,moduleFormId:this.moduleFormId,moduleId:this.submodule.sub_module_id?this.submodule.sub_module_id:this.submodule.module_id,moduleName:this.submodule.title,moduleData:this.submodule}}).afterClosed().subscribe(t=>{t===!0&&this.getFormData()})}onResetDependentFields(i){this.formFields[i].child_dependency.length!=0&&this.formFields[i].child_dependency.map(e=>{let t=this.formFields.findIndex(r=>r.name===e.child_field_name);t!==-1&&(this.myForm.controls[e.child_field_name].reset(),this.formFields[t].value=""),this.onResetDependentFields(t)})}onFieldChange(i,e){let t=null;if(e.type==this.fieldTypes.SINGLE_SELECT||e.type==this.fieldTypes.MULTI_SELECT||e.type==this.fieldTypes.RADIO_SELECT||e.type==this.fieldTypes.CHECKBOX_SELECT||e.type==this.fieldTypes.DATE||e.type==this.fieldTypes.TIME||e.type==this.fieldTypes.UPLOAD)if(e.type==this.fieldTypes.SINGLE_SELECT){e.control.setValue(i),e.value=i.label;let s=e.options.findIndex(g=>g.value===i),a;s!==-1&&(a=e.options[s].label,t=e.options[s].second_value,this.formFields.forEach(g=>{g.name===e.key_name&&this.myForm.controls[g.name].setValue(a)}))}else e.control.setValue(i);if(e.type===this.fieldTypes.DATE_RANGE){let s={from:i.from,to:i.to};this.myForm.controls[e.name].setValue(s)}if(e.is_child_dependency===!0){let s=e.options.findIndex(a=>a.value===i);s!==-1&&(e.type===this.fieldTypes.SINGLE_SELECT&&e.key_source==="default"?(e.value=e.options[s].value,this.getDependencyUpdate(e)):(e.value=e.options[s].label,this.getDependencyUpdate(e)))}let r=this.formFields.findIndex(s=>s.name==e.name),o=this.formFields[r].child_dependency?.filter(s=>s.parent_field_value!=e.value),l=0;if(e.is_child_dependency){console.log(e.is_child_dependency,"is_child_dependency");let s=this.formFields.findIndex(a=>a.name==e.name);for(let a=s;a<=this.formFields.length-1;a++){let M=this.formFields[a].options?.find(c=>this.spaceRemove.formatString(c.value)===this.spaceRemove.formatString(this.formFields[a].value))?.label||"";for(let c=0;c<=this.formFields[a].child_dependency.length-1;c++){let v=!1,T=this.formFields[a].child_dependency[c];if(T.visibilty==="Direct"&&(T.parent_field_value===M||T.child_field_option.length===0&&this.formFields[a].is_child_show)&&(v=!0),this.formFields[a].child_dependency[c].visibilty==="Option"){console.log(c,"childIndex"),console.log(this.formFields[a].child_dependency[c].child_field_name,"child_name");let p=this.formFields.findIndex(R=>R.name==this.formFields[a].child_dependency[c].child_field_name);if(console.log(p,"parentChildIndex"),p!==-1&&this.formFields[p].type===this.fieldTypes.SHORT_TEXT&&this.formFields[a].value&&(v=!0,this.formFields[p].is_child_show=v),p!==-1&&this.formFields[p].type===(this.fieldTypes.SINGLE_SELECT||this.fieldTypes.MULTI_SELECT))if(e.key_source==="default"){if(e.options.findIndex(b=>b.value===i)!==-1){let b=(t||e.value)===this.formFields[a].child_dependency[c].child_field_name;b?(this.formFields[p].is_child_show=b,this.getOptions(this.formFields[p].name,this.formFields[p].api_path,e.value)):o.map(he=>{let F=this.formFields.findIndex(w=>w.name==he.child_field_name);if(l!=F&&F!==-1&&this.formFields[F]){let w=this.formFields[F];this.formFields[F].is_child_show=!1}l=F})}}else this.getOptions(this.formFields[p].name,this.formFields[p].api_path,e.value)}}}}}lastSearchTerm="";onSearch(i,e){let t=i?.trim()||"";t!==this.lastSearchTerm&&(this.lastSearchTerm=t,this.api.post({module_id:this.submodule.sub_module_id||this.submodule.module_id,page:1,dropdown_name:e.name,filters:{search:t}},e.api_path).subscribe({next:r=>{r.statusCode===200&&(e.options=r.data)}}))}getOptions(i,e,t){return P(this,null,function*(){try{let r=yield this.api.post({dropdown_name:i,module_id:this.submodule.sub_module_id||this.submodule.module_id,dropdown_option:t},e).toPromise();r?.statusCode===200&&(this.formFields.forEach(o=>{o.name===i&&(o.options=r.data,t&&r.data.length>0&&(o.is_child_show=!0))}),this.originalFormFields.forEach(o=>{o.name===i&&(o.options=r.data)}))}catch{}})}getQrType(){let i=this.formFields.find(r=>r.name==="qrcode_type"),e=i?i.value:null;if(!e)return;let t={qrcode_type:e};this.api.post(t,"qr-code/read-item").subscribe(r=>{if(r.statusCode===200)for(let o=0;o<this.formFields.length;o++)this.formFields[o].name==="user_name"&&(this.formFields[o].options=r.data)})}getDependencyUpdate(i){if(i.is_child_dependency){let e,t,r;if(i.key_source==="default"){let o=i.options.find(l=>l.value===i.value);e=o?o.label:null}i.child_dependency.forEach(o=>{let l=this.formFields.find(s=>s.name===o.child_field_name);if(l){t=l.name;let s=o.child_field_option.find(a=>a.parent_field_value===e);r=s?s.label:null}})}}onSubmit(){if(this.formFields.forEach(i=>{(i.is_child_show===!1||i.is_show===!1)&&(this.myForm.get(i.name)?.clearValidators(),this.myForm.get(i.name)?.updateValueAndValidity())}),this.myForm.valid){this.formValidation.removeEmptyControls(this.myForm),this.api.disabled=!0;let i={primaryFields:{form_data:{}}};this.formFields.forEach(e=>{e.name&&this.myForm.value.hasOwnProperty(e.name)&&(e.read_only===!1&&e.key_source!=="custom"&&(i.primaryFields[e.name]=this.myForm.value[e.name]),e.key_source==="custom"&&(i.primaryFields.form_data[e.name]=this.myForm.value[e.name]),e.type===this.fieldTypes.UPLOAD&&delete i.primaryFields.form_data[e.name])}),this.api.post(i.primaryFields,"qr-code/create").subscribe(e=>{e.statusCode===200&&(this.api.disabled=!1,this.router.navigate(["/apps/loyalty/qr-list/qr-details/"+e.data.history_id]),this.toastr.success(e.message,"","toast-top-right"))})}else this.toastr.error("Form Is Invalid","","toast-top-right"),this.formValidation.markFormGroupTouched(this.myForm)}checkDuplicate(i,e){this.api.post({product_code:e},i).subscribe(t=>{t===!1?this.api.isDuplicate=!0:this.api.isDuplicate=!1})}static \u0275fac=function(e){return new(e||n)(d(ie),d(ce),d(k),d(J),d(W),d(U),d(Y),d(j),d(H),d(le),d(ee),d(ne))};static \u0275cmp=L({type:n,selectors:[["app-qr-add"]],inputs:{formFields:"formFields"},decls:3,vars:14,consts:[["dynamicForm",""],[3,"buttonClick","buttonClick1","title","title1","activeitem","buttonText","icon","btnShow","buttonValue","buttonText1","icon1","btnShow1","buttonValue1"],["class","box",4,"ngIf"],["class","xl:col-span-12 col-span-12",4,"ngIf"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","gap-x-6"],["class","xl:col-span-3 col-span-12 mb-4",4,"ngFor","ngForOf"],[1,"xl:col-span-3","col-span-12","mb-4"],[1,"xl:col-span-12","col-span-12"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"ngSubmit","formGroup"],["class","grid grid-cols-12 gap-x-6",4,"ngIf"],[1,"box-footer","border-t","border-block-start-dashed","sm:flex","justify-end"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],[4,"ngFor","ngForOf"],[3,"class",4,"ngIf"],[3,"valueChange","searchChanged","field","form"]],template:function(e,t){e&1&&(h(0,"app-page-header",1),S("buttonClick",function(o){return t.onClick(o)})("buttonClick1",function(o){return t.openModal(o)}),_(),y(1,Fe,4,2,"div",2)(2,Se,2,1,"div",3)),e&2&&(m("title","IRP")("title1",D(13,_e))("activeitem","QR Code Generate")("buttonText","Filter")("icon","filter_list")("btnShow",!1)("buttonValue","filter_data")("buttonText1","Form Config")("icon1","settings")("btnShow1",!0)("buttonValue1",""),u(),m("ngIf",t.skLoading),u(),m("ngIf",!t.skLoading))},dependencies:[se,N,Q,z,B,$,me,fe,Z,ae,oe,X,re,K,te,G],encapsulation:2})};export{ue as QrAddComponent};
