import{Z as p}from"./chunk-GYDYF5F3.js";import{d as u}from"./chunk-PD5VTTIY.js";import{ka as l,pa as m}from"./chunk-2NSPOFEK.js";var g=class y{constructor(i){this.api=i}getChanges(i,o){if(!i||!o)return{};let a=(r,e)=>{if(Array.isArray(r)&&Array.isArray(e))return r.length!==e.length?!1:r.every((n,t)=>a(n,e[t]));if(r&&e&&typeof r=="object"&&typeof e=="object"){let n=Object.keys(r),t=Object.keys(e);return n.length!==t.length?!1:n.every(s=>a(r[s],e[s]))}return r===e};return Object.keys(o).reduce((r,e)=>{let n=i[e],t=o[e];return t===""||t===null||t===void 0||Array.isArray(n)&&Array.isArray(t)&&n.length===0&&t.length===0||a(n,t)||(r[e]={old:n,new:t}),r},{})}directMainLog(i,o,a,r,e,n){this.api.post({module_name:a,message:r+" field has been "+e,action:e,module_id:i,form_id:o,module_type:n},"log/form-action").subscribe(t=>{t.statusCode})}logActivityOnUpdate(i,o,a,r,e,n,t,s){if(!i)return!1;if(!o||Object.keys(o).length===0)return t&&t(),!0;let c={module_id:a,module_name:r,action:e,row_id:n,changes:o,module_type:s};return n||delete c.row_id,this.api.post(c,"log/transaction-action").subscribe(d=>{d.statusCode}),!1}logActivityOnDelete(i,o,a,r,e,n){let t={module_id:i,module_name:o,action:a,row_id:r,message:`${e} Record with ID - ${r} `,module_type:n};this.api.post(t,"log/transaction-action").subscribe(s=>{s.statusCode})}logActivityOnImage(i,o,a,r,e){let n={module_id:i,module_name:o,action:a,row_id:r,message:`${e} record with ID - ${r} `};this.api.post(n,"log/transaction-action").subscribe(t=>{t.statusCode})}getLogs(i,o,a,r){let e={module_id:i};a&&(e.module_id=i,e.row_id=a),r&&(e.module_type=r),this.api.post(e,"log/read").subscribe(n=>{if(n.statusCode===200){let t=n.data.map(s=>({createdName:s.created_name,createdAt:new Date(s.created_at),changes:this.formatChanges(s.changes?s.changes:s.message)}));o(t)}})}formatChanges(i){if(typeof i=="string")return i;let o=e=>e&&typeof e=="object"&&"old"in e&&"new"in e,a=e=>{if(e==null||e==="")return"-";if(typeof e=="string"&&e.includes("T")&&e.includes("Z"))try{let n=new Date(e);return u(n,"d MMM yyyy","en-US")}catch{return e}return Array.isArray(e)?e.map(n=>n.name||n.product_name||JSON.stringify(n)).join(", "):typeof e=="object"?e.name||e.product_name||JSON.stringify(e):String(e)},r=(e,n)=>{let t=`<span class="font-medium">${e}:</span><br>`;if(n.removed?.length){let s=n.removed.map(c=>a(c)).join(", ");t+=`<span class="font-medium">Removed:</span> <span class="text-danger">${s}</span><br><br>`}return n.added?.length&&(t+='<span class="font-medium">Added:</span><br>',n.added.forEach(s=>{let c=s.name||s.product_name||"Item",d=JSON.stringify(s,null,2);t+=`<strong>${c}</strong><br><pre>${d}</pre>`})),n.modified?.length&&n.modified.forEach((s,c)=>{let d=a(s.old.name||s.old.product_name||`Item ${c+1}`);t+=`<span class="font-medium">Modified</span> <span class="font-medium">${d}</span>:<br>`,Object.keys(s.old).forEach(f=>{s.old[f]!==s.new[f]&&(t+=`- ${f}: <span class="text-danger">${a(s.old[f])}</span> \u2192 <span class="text-success">${a(s.new[f])}</span><br>`)})}),t};return Object.entries(i).map(([e,n])=>{let t=e.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase());return e==="additional_target"&&typeof n=="object"&&("added"in n||"removed"in n||"modified"in n)?r(t,n):Array.isArray(n?.old)&&Array.isArray(n?.new)?`<span class="font-medium">${t}:</span><br>${r(t,{added:n.new,removed:n.old,modified:[]})}`:o(n)?`<span class="font-medium">${t}:</span> changed from <span class="text-danger">${a(n.old)}</span> to <span class="text-success">${a(n.new)}</span>`:`<span class="font-medium">${t}:</span> changed from <span class="text-danger">-</span> to <span class="text-success">${a(n)}</span>`}).join("<br>")}logActivityOnUpdateArray(i,o,a,r,e,n,t,s,c){if(!i)return!1;let d=this.getChangesArray(o,a);if(Object.keys(d).length===0)return s&&s(),!0;let f={module_id:r,module_name:e,action:n,row_id:t,changes:d,module_type:c};return t===""&&delete f.row_id,this.api.post(f,"log/transaction-action").subscribe(b=>{b.statusCode}),!1}getChangesArray(i,o){if(Array.isArray(i)&&Array.isArray(o))return this.getArrayDifferences(i,o);let a={};for(let r in i)i[r]!==o[r]&&(a[r]={old:i[r],new:o[r]});return a}getArrayDifferences(i,o){let a={},r=Math.max(i.length,o.length);for(let e=0;e<r;e++){let n=i[e],t=o[e];if(n&&!t)a[`deleted_${e}`]={old:n,new:null};else if(!n&&t)a[`added_${e}`]={old:null,new:t};else{let s={};for(let c in n)n[c]!==t?.[c]&&(s[c]={old:n[c],new:t[c]});Object.keys(s).length>0&&(a[`updated_${e}`]={old:n,new:t})}}return a}static \u0275fac=function(o){return new(o||y)(m(p))};static \u0275prov=l({token:y,factory:y.\u0275fac,providedIn:"root"})};export{g as a};
