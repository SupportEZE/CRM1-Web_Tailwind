import{a as ae}from"./chunk-GXF7AAOQ.js";import{a as oe}from"./chunk-OTFCGVEU.js";import{a as ie}from"./chunk-HPLI5COI.js";import{a as K}from"./chunk-DC4QM32I.js";import{C as ee,F as te,c as q,r as Y,v as Z}from"./chunk-VHE3PQ3O.js";import{C as R,F as k,H as P,M as B,Oa as J,Pa as Q,V as U,X as z,Y as $,Z as H,hb as W,jb as I,l as A,na as X,w as G}from"./chunk-GYDYF5F3.js";import{f as w,g as O,n as N,t as j}from"./chunk-PD5VTTIY.js";import{Aa as v,Ba as u,Hb as S,Ob as _,Xc as L,Yc as M,_b as n,cc as x,ed as E,fd as V,kc as l,lc as c,mc as y,nc as T,oc as D,qc as g,rb as p,sb as m,wc as F,yc as s}from"./chunk-2NSPOFEK.js";import{a as C,i as b}from"./chunk-66YHNWRR.js";var ne=()=>[];function se(a,t){a&1&&(l(0,"div",12),y(1,"app-skeleton"),c())}function me(a,t){a&1&&(l(0,"div",8)(1,"div",9)(2,"div",10),_(3,se,2,0,"div",11),c()()()),a&2&&(p(3),n("ngForOf",M(1,ne).constructor(10)))}function le(a,t){if(a&1){let e=g();l(0,"app-form-field",24,0),F("searchChanged",function(r){v(e);let i=s(2).$implicit,d=s(5);return u(i.search?d.onSearch(r,i):"")})("valueChange",function(r){v(e);let i=s(2).$implicit,d=s(5);return u(d.onFieldChange(r,i))}),c()}if(a&2){let e=s(2).$implicit,o=s(5);n("field",e)("form",o.myForm)}}function de(a,t){if(a&1&&(l(0,"div"),_(1,le,2,2,"app-form-field",23),c()),a&2){let e=s().$implicit;x("mb-4 ",e.class_name,""),p(),n("ngIf",e.is_show==!0)}}function pe(a,t){if(a&1&&(T(0),_(1,de,2,4,"div",22),D()),a&2){let e=t.$implicit;p(),n("ngIf",e.is_show==!0)}}function ce(a,t){if(a&1&&(l(0,"div",20),_(1,pe,2,1,"ng-container",21),c()),a&2){let e=s(4);p(),n("ngForOf",e.formFields)}}function _e(a,t){if(a&1){let e=g();l(0,"form",15),F("ngSubmit",function(){v(e);let r=s(3);return u(r.onSubmit())}),l(1,"div",16)(2,"div",9),_(3,ce,2,1,"div",17),c(),l(4,"div",18),y(5,"app-button",19),c()()()}if(a&2){let e=s(3);n("formGroup",e.myForm),p(3),n("ngIf",e.myForm&&e.myForm.controls),p(2),n("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",e.api.disabled)("formType","add")("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}function fe(a,t){if(a&1&&(l(0,"div",13),_(1,_e,6,8,"form",14),c()),a&2){let e=s(2);p(),n("ngIf",e.formIniatialized)}}function ve(a,t){if(a&1){let e=g();l(0,"div",2)(1,"app-modal-header",3),E(2,"titlecase"),F("close",function(){v(e);let r=s();return u(r.close())}),c(),y(3,"div",4),l(4,"div",5),_(5,me,4,2,"div",6)(6,fe,2,1,"div",7),c()()}if(a&2){let e=s();p(),n("title",V(2,4,e.modalData.formType)+" Leave Policy")("closeBtn",!0),p(4),n("ngIf",e.skLoading),p(),n("ngIf",!e.skLoading)}}var re=class a{constructor(t,e,o,r,i,d,h,f,ue,he,ye){this.modalData=t;this.fb=e;this.toastr=o;this.api=r;this.dialogRef=i;this.moduleService=d;this.dateService=h;this.formValidation=f;this.util=ue;this.logService=he;this.date=ye}states=[];today=new Date;formIniatialized=!1;skLoading=!1;myForm;formFields=[];moduleFormId=0;moduleId;primaryForm;FORMID=ie;fieldTypes=A;formDropdown=[];formDropdownOption=[];userList=[];originalData={};tableId;originalFormFields=[];ngOnInit(){let t=this.moduleService.getSubModuleByName("Masters","Leave Policy"),e=this.moduleService.getFormById("Masters","Leave Policy",this.FORMID.ID.LeaveMasterForm),o=this.moduleService.getTableById("Masters","Leave Policy",this.FORMID.ID.LeaveMasterTable);t&&(this.moduleId=t),e&&(this.moduleFormId=e.form_id),o&&(this.tableId=o.table_id),this.getFormData()}initializeForm(){if(this.myForm=this.fb.group({}),this.formFields.forEach(t=>{t.api_path&&this.getOptions(t.label,t.name,t.api_path,t.api_payload,t.api_payload_key),t.min_date===!0&&t.min_period==="today"&&(t.min_period=new Date),t.control=this.fb.control("",this.formValidation.getValidators(t)),this.myForm.addControl(t.name,t.control)}),this.formIniatialized=!0,this.modalData.formType==="edit"){let t;t=this.modalData.formData,this.originalData=C(C({},t),t.form_data),delete this.originalData.form_data,Object.keys(this.originalData).forEach(o=>{this.myForm.contains(o)||this.myForm.addControl(o,new k(this.originalData[o]))}),this.myForm.patchValue(this.originalData),this.formFields.filter(o=>Object.keys(this.originalData).includes(o.name)&&(o.type===this.fieldTypes.SINGLE_SELECT||o.type===this.fieldTypes.MULTI_SELECT)).forEach(o=>{let r=o.name;this.myForm.get(r)&&this.myForm.get(r)?.setValue(this.originalData[r])})}}getOptions(t,e,o,r,i){return b(this,null,function*(){try{let d={dropdown_name:t,module_id:this.moduleId.sub_module_id||this.moduleId.module_id};r&&i&&(d[i]=r);let h=yield this.api.post(d,o).toPromise();h?.statusCode===200&&(this.formFields.forEach(f=>{f.name===e&&(f.options=h.data)}),this.originalFormFields.forEach(f=>{f.name===e&&(f.options=h.data)}))}catch(d){console.error("Error fetching options:",d)}})}lastSearchTerm="";onSearch(t,e){let o=t?.trim()||"";o!==this.lastSearchTerm&&(this.lastSearchTerm=o,this.api.post({dropdown_name:e.name,search:o},e.api_path).subscribe({next:r=>{r.statusCode===200&&(e.options=r.data)}}))}onFieldChange(t,e){if(e.type==this.fieldTypes.SINGLE_SELECT||e.type==this.fieldTypes.MULTI_SELECT||e.type==this.fieldTypes.RADIO_SELECT||e.type==this.fieldTypes.CHECKBOX_SELECT||e.type==this.fieldTypes.DATE||e.type==this.fieldTypes.TIME||e.type==this.fieldTypes.UPLOAD)if(e.type==this.fieldTypes.SINGLE_SELECT){if(e.control.setValue(t),e.value=t.label,e.key_name_required===!0){let o=e.options.findIndex(i=>i.value===t),r;o!==-1&&(r=e.options[o].label,this.formFields.forEach(i=>{i.name===e.key_name&&this.myForm.controls[i.name].setValue(r)}))}}else e.control.setValue(t);if(e.type===this.fieldTypes.DATE_RANGE){let o={from:t.from,to:t.to};this.myForm.controls[e.name].setValue(o)}if(e.type===this.fieldTypes.DATE&&this.myForm.controls[e.name].setValue(e.control.value),e?.actual_name){let o=e.options.findIndex(r=>r.value===t);o!==-1&&e.type===this.fieldTypes.SINGLE_SELECT&&e.key_source==="default"&&(e[e.actual_name]=e.options[o].label)}}getFormData(){this.skLoading=!0,this.api.post({form_id:this.moduleFormId,platform:"web"},"form-builder/read").subscribe(t=>{t.statusCode==200&&(this.formFields=t.data.form_data,this.skLoading=!1,this.formFields.forEach(e=>{this.util.createValidation(e)}),this.initializeForm())})}onSubmit(){this.formFields.forEach(i=>{(i.is_child_show===!1||i.is_show===!1)&&(this.myForm.get(i.name)?.clearValidators(),this.myForm.get(i.name)?.updateValueAndValidity())});let t=this.modalData.formType==="edit";if(!t&&!this.myForm.valid){this.toastr.error("Form is Invalid","","toast-top-right"),this.formValidation.markFormGroupTouched(this.myForm);let i=Object.keys(this.myForm.controls).filter(d=>this.myForm.get(d)?.invalid);console.warn("Invalid fields:",i);return}let e={primaryFields:{form_data:{}}};if(this.formFields.forEach(i=>{i.name&&this.myForm.value.hasOwnProperty(i.name)&&(i.read_only===!1&&i.key_source!=="custom"&&(e.primaryFields[i.name]=this.myForm.value[i.name]),i.key_source==="custom"&&(e.primaryFields.form_data[i.name]=this.myForm.value[i.name]),i?.actual_name&&(e.primaryFields[i.actual_name]=i[i.actual_name]))}),this.api.disabled=!0,e.primaryFields._id=this.originalData._id,t&&(e.primaryFields.user_name=this.originalData.user_name,this.logService.logActivityOnUpdate(t,this.originalData,this.myForm.value,this.moduleId.sub_module_id,this.moduleId.title,"update",this.originalData._id||null,()=>{},this.moduleId.module_type))){this.api.disabled=!1,this.toastr.warning("No changes detected","","toast-top-right");return}let o=t?"patch":"post",r=t?"leave/update":"leave/create";this.api[o](e.primaryFields,r).subscribe(i=>{i.statusCode==200&&(this.api.disabled=!1,this.dialogRef.close(!0),this.toastr.success(i.message,"","toast-top-right"))})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||a)(m(Q),m(U),m(G),m(H),m(J),m(K),m(I),m(Z),m($),m(oe),m(I))};static \u0275cmp=S({type:a,selectors:[["app-leave-modal"]],inputs:{formFields:"formFields"},features:[L([X()])],decls:1,vars:1,consts:[["dynamicForm",""],["class","mat-dialoge",4,"ngIf"],[1,"mat-dialoge"],[3,"close","title","closeBtn"],[1,"dropdown-divider"],[1,"xxl:col-span-8","xl:col-span-12","lg:col-span-12","md:col-span-6","col-span-12"],["class","box",4,"ngIf"],["class","xl:col-span-12 col-span-12",4,"ngIf"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","gap-x-6"],["class","xl:col-span-3 col-span-12 mb-4",4,"ngFor","ngForOf"],[1,"xl:col-span-3","col-span-12","mb-4"],[1,"xl:col-span-12","col-span-12"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"box","m-0","shadow-none"],["class","grid grid-cols-12 gap-x-4",4,"ngIf"],[1,"box-footer","border-t","border-block-start-dashed","sm:flex","justify-end"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],[1,"grid","grid-cols-12","gap-x-4"],[4,"ngFor","ngForOf"],[3,"class",4,"ngIf"],[3,"field","form","searchChanged","valueChange",4,"ngIf"],[3,"searchChanged","valueChange","field","form"]],template:function(e,o){e&1&&_(0,ve,7,6,"div",1),e&2&&n("ngIf",o.modalData.lastPage==="leave-add")},dependencies:[j,w,O,N,te,P,R,B,ae,q,ee,z,W,Y],encapsulation:2})};export{re as a};
