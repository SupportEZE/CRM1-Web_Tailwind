import{a as de}from"./chunk-OTFCGVEU.js";import{a as se}from"./chunk-HPLI5COI.js";import{a as le}from"./chunk-GLWQGYBC.js";import{a as X}from"./chunk-DC4QM32I.js";import{B as ne,C as ae,F as re,c as Q,f as ie,n as oe}from"./chunk-VHE3PQ3O.js";import{B as j,C as k,E as B,G as q,Ga as $,H as W,I as G,Qa as ee,R as z,V as H,W as U,X as J,Z as K,hb as te,ua as Y,w as O,wa as Z,z as R}from"./chunk-GYDYF5F3.js";import{K as w,M as L,f as E,g as N,t as V}from"./chunk-PD5VTTIY.js";import{Aa as _,Ba as f,Cc as A,Hb as T,Lc as c,Mc as g,Ob as m,Oc as D,Uc as b,Vc as S,Wc as x,Yc as P,_b as r,kc as s,lc as d,mc as y,nc as v,oc as h,qc as C,rb as a,sb as p,wc as F,yc as u}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as M,b as I}from"./chunk-66YHNWRR.js";var me=()=>[];function ce(o,t){o&1&&(s(0,"div",10),y(1,"app-skeleton"),d())}function ue(o,t){o&1&&(s(0,"div",6)(1,"div",7)(2,"div",8),m(3,ce,2,0,"div",9),d()()()),o&2&&(a(3),r("ngForOf",P(1,me).constructor(10)))}function ge(o,t){o&1&&(v(0),g(1,"This field is required"),h())}function _e(o,t){if(o&1&&(s(0,"mat-hint",23),m(1,ge,2,0,"ng-container",24),d()),o&2){u();let e=c(12);a(),r("ngIf",e.errors==null?null:e.errors.required)}}function fe(o,t){o&1&&(v(0),g(1,"This field is required"),h())}function ye(o,t){if(o&1&&(s(0,"mat-hint",23),m(1,fe,2,0,"ng-container",24),d()),o&2){u();let e=c(7);a(),r("ngIf",e.errors==null?null:e.errors.required)}}function ve(o,t){if(o&1){let e=C();s(0,"div",14)(1,"label",15),g(2),s(3,"span",16),g(4,"*"),d()(),s(5,"mat-form-field",17)(6,"input",25,2),x("ngModelChange",function(i){let l=_(e).$implicit;return S(l.point_value,i)||(l.point_value=i),f(i)}),d(),m(8,ye,2,1,"mat-hint",19),d()()}if(o&2){let e=t.$implicit,n=t.index,i=c(7);u();let l=c(3);a(2),D("",e.customer_type_name," Point"),a(4),A("placeholder","",e.label," Point"),r("name","point_value"+n),b("ngModel",e.point_value),a(2),r("ngIf",i.touched||l.submitted)}}function he(o,t){if(o&1){let e=C();s(0,"div",11)(1,"app-showcode-card",12)(2,"form",13,0),F("ngSubmit",function(){_(e);let i=c(3),l=u();return f(i.valid&&l.submit())}),s(4,"div",8)(5,"div",14)(6,"label",15),g(7,"Title"),s(8,"span",16),g(9,"*"),d()(),s(10,"mat-form-field",17)(11,"input",18,1),x("ngModelChange",function(i){_(e);let l=u();return S(l.data.point_category_name,i)||(l.data.point_category_name=i),f(i)}),d(),m(13,_e,2,1,"mat-hint",19),d()(),m(14,ve,9,6,"div",20),d(),s(15,"div",21),y(16,"app-button",22),d()()()()}if(o&2){let e=c(3),n=c(12),i=u();a(),r("title","Basic Detail"),a(10),b("ngModel",i.data.point_category_name),a(2),r("ngIf",n.touched||e.submitted),a(),r("ngForOf",i.userSubTypes),a(2),r("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("iconClass","ri-save-line")("disabled",i.api.disabled)("loadingIconClass","ri-loader-2-fill")}}var pe=class o{constructor(t,e,n,i,l,Ce,be,Se){this.toastr=t;this.api=e;this.dialog=n;this.route=i;this.router=l;this.logService=Ce;this.moduleService=be;this.fb=Se}submodule;moduleFormId=0;id;formFields=[];myForm;skLoading=!1;pageType="add";originalData={};FORMID=se;pointCategoryForm;formIniatialized=!1;userSubTypes=[];formInitialized=!1;data={};ngOnInit(){let t=this.moduleService.getSubModuleByName("Masters","Point Category");t&&(this.submodule=t),this.route.paramMap.subscribe(e=>{if(e){this.id=e.get("id");let n=e.get("edit");this.pageType=n||"add",this.id&&this.getCustomerDetail()}else this.getSubType()})}pointDetail={};getCustomerDetail(){this.skLoading=!0,this.api.post({_id:this.id},"point-category/detail").subscribe(t=>{if(t.statusCode===200){this.skLoading=!1,this.pointDetail=t.data,this.data.point_category_name=t.data.point_category_name;let e=this.transformData(t.data.point);this.originalData.point_category_name=t.data.point_category_name,this.getSubType(),this.originalData._id=this.id,this.originalData.point=e}})}submit(){this.userSubTypes.forEach(i=>{i.point_value=Number(i.point_value)}),this.data.point=this.userSubTypes;let t=this.pageType==="edit";if(t&&this.logService.logActivityOnUpdate(t,this.originalData,this.data,this.submodule.sub_module_id,this.submodule.title,"update",this.id||null,()=>{},this.submodule.module_type)){this.api.disabled=!1,this.toastr.warning("No changes detected","","toast-top-right");return}let e=t?"patch":"post",n=t?"point-category/update":"point-category/create";this.api.disabled=!0,this.data._id=this.id,this.api[e](this.data,n).subscribe(i=>{i.statusCode==200&&(this.api.disabled=!1,this.router.navigate(["/apps/master/points-category-list"]),this.toastr.success(i.message,"","toast-top-right"))})}transformData(t){return t.map(e=>({customer_type_name:e.label?e.label:e.customer_type_name,customer_type_id:e.value?e.value:e.customer_type_id,point_value:e.point_value?Number(e.point_value):"0"}))}getSubType(){this.api.post({is_loyalty:!0},"customer-type/read-dropdown").subscribe(t=>{t.statusCode==200&&(this.id?(this.userSubTypes=t.data.map(e=>{let n=this.pointDetail.point.find(i=>i.customer_type_id===e.value);return I(M({},e),{point_value:n?n.point_value.toString():0})}),this.userSubTypes=this.transformData(this.userSubTypes)):t.data&&(this.userSubTypes=this.transformData(t.data)))})}static \u0275fac=function(e){return new(e||o)(p(O),p(K),p(ee),p(w),p(L),p(de),p(X),p(H))};static \u0275cmp=T({type:o,selectors:[["app-point-category-add"]],inputs:{formFields:"formFields"},decls:3,vars:5,consts:[["f","ngForm"],["point_category_name","ngModel"],["point_value","ngModel"],[3,"title","title1","activeitem"],["class","box",4,"ngIf"],["class","xl:col-span-12 col-span-12",4,"ngIf"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","gap-x-6"],["class","xl:col-span-3 col-span-12 mb-4",4,"ngFor","ngForOf"],[1,"xl:col-span-3","col-span-12","mb-4"],[1,"xl:col-span-12","col-span-12"],[3,"title"],[3,"ngSubmit"],[1,"col-span-12","mb-4","xl:col-span-4","xxl:col-span-3"],[1,"form-label","mb-0"],[1,"text-red-500"],[1,"mat-custom-field"],["matInput","","placeholder","Enter Title","name","point_category_name","required","",3,"ngModelChange","ngModel"],["align","end",4,"ngIf"],["class","col-span-12 mb-4 xl:col-span-4 xxl:col-span-3",4,"ngFor","ngForOf"],[1,"box-footer","border-t","border-block-start-dashed","sm:flex","justify-end"],[3,"buttonType","buttonClass","iconClass","disabled","loadingIconClass"],["align","end"],[4,"ngIf"],["type","text","matInput","","onkeypress","return (event.charCode >= 48 && event.charCode <= 57) || event.charCode == 46","type","number","required","",3,"ngModelChange","placeholder","name","ngModel"]],template:function(e,n){e&1&&(y(0,"app-page-header",3),m(1,ue,4,2,"div",4)(2,he,17,9,"div",5)),e&2&&(r("title","Master Modules")("title1","Point Category")("activeitem",(n.id?"Edit ":"Add ")+" Point Category"),a(),r("ngIf",n.skLoading),a(),r("ngIf",!n.skLoading))},dependencies:[re,E,N,W,R,G,j,k,z,q,B,le,Q,ae,ie,ne,U,oe,J,V,te,$,Z,Y],encapsulation:2})};export{pe as PointCategoryAddComponent};
