import{a as ne}from"./chunk-PU6S26UW.js";import"./chunk-OTFCGVEU.js";import{a as oe}from"./chunk-HPLI5COI.js";import{b as re}from"./chunk-DUVWFXSE.js";import{a as U}from"./chunk-CNF4GSI7.js";import{a as ae}from"./chunk-GLWQGYBC.js";import{a as W}from"./chunk-DC4QM32I.js";import{C as ie,F as te,c as H,g as Y,h as K,j as Q,k as Z,v as $,w as ee}from"./chunk-VHE3PQ3O.js";import{A as g,B as w,C as E,D,H as q,M as P,P as G,V as j,W as O,X as z,Z as L,hb as J,jb as X,o as S,w as k}from"./chunk-GYDYF5F3.js";import{K as V,M as B,Q as M,f as N,g as A,t as R}from"./chunk-PD5VTTIY.js";import{Aa as u,Ba as f,Hb as x,Mc as y,Ob as b,Yc as _,_b as n,_c as T,kc as a,lc as s,mc as p,qc as I,rb as l,sb as d,wc as v,yc as c}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as h,b as F}from"./chunk-66YHNWRR.js";var se=()=>["Bonus"],de=()=>[],me=()=>({label:"Fixed Point",value:"Fixed Point"}),pe=()=>({label:"Gift",value:"Gift"}),ce=(r,i)=>[r,i];function ue(r,i){r&1&&(a(0,"div",7),p(1,"app-skeleton"),s())}function fe(r,i){r&1&&(a(0,"div",3)(1,"div",4)(2,"div",5),b(3,ue,2,0,"div",6),s()()()),r&2&&(l(3),n("ngForOf",_(1,de).constructor(10)))}function ge(r,i){if(r&1&&(a(0,"div",10),p(1,"spk-input",25),s()),r&2){let e=c(2);l(),n("label",e.badgeForm.value.incentive_type)("fieldReq",!0)("type","text")}}function ve(r,i){if(r&1){let e=I();a(0,"div",8)(1,"form",9),v("ngSubmit",function(){u(e);let t=c();return f(t.onSubmit())}),a(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",10)(6,"spk-ng-select",11),v("searchChanged",function(t){u(e);let m=c();return f(m.onSearch(t))})("selectedChange",function(t){u(e);let m=c();return f(m.findName(t))}),s()(),a(7,"div",10),p(8,"spk-input",12),s(),a(9,"div",10)(10,"spk-flatpickr",13),v("dateChange",function(){u(e);let t=c();return f(t.onDateChange())}),s()(),a(11,"div",10),p(12,"spk-flatpickr",14),s(),a(13,"div",10),p(14,"spk-input",15),s(),a(15,"div",10),p(16,"spk-ng-select",16),s(),b(17,ge,2,3,"div",17),a(18,"div",18)(19,"label",19),y(20,"Upload Image"),a(21,"span",20),y(22,"*"),s()(),a(23,"file-pond",21),v("onprocessfile",function(t){u(e);let m=c();return f(m.onFileProcessed(t))})("onremovefile",function(t){u(e);let m=c();return f(m.onFileRemove(t))}),s(),a(24,"p",22),y(25,"Image dimensions must be exactly 300X300 px and file size must not exceed 2 MB."),s()()(),a(26,"div",23),p(27,"app-button",24),s()()()()()}if(r&2){let e=c();l(),n("formGroup",e.badgeForm),l(5),n("search",!0)("multiple",!0)("fieldReq",!0)("options",e.commonApi.customerCategorySubType),l(2),n("fieldReq",!0),l(2),n("fieldReq",!0)("min",e.today),l(2),n("min",e.badgeForm.value.start_date)("fieldReq",!0),l(2),n("fieldReq",!0),l(2),n("fieldReq",!0)("options",T(23,ce,_(21,me),_(22,pe))),l(),n("ngIf",e.badgeForm.value.incentive_type),l(6),n("options",e.pondOptions)("files",e.pondFiles),l(4),n("buttonType","submit")("disabled",e.api.disabled)("buttonClass","ti-btn ti-btn-primary m-0")("iconClass",e.api.disabled?"ri-loader-2-fill animate-spin":"ri-save-line")("loadingIconClass","ri-loader-2-fill")}}var le=class r{constructor(i,e,o,t,m,C,_e,be,ye,Se){this.toastr=i;this.api=e;this.formValidation=o;this.fb=t;this.dateService=m;this.router=C;this.route=_e;this.moduleService=be;this.commonApi=ye;this.uploadService=Se}skLoading=!1;badgeForm=new D({});today=new Date;formIniatialized=!1;formFields=[];documentData={};slabTypes=[];badgeTypes=[];incentiveTypes=[];uploadresults=[];incentiveDropdown=[];FORMID=oe;submodule={};ngOnInit(){let i=this.moduleService.getSubModuleByName("IRP","Bonus"),e=this.moduleService.getSubSubModuleByName("IRP","Bonus","Badges");e&&(this.submodule=e),this.badgeForm=this.fb.group({title:["",g.required],start_date:[""],end_date:[""],eligible_points:["",g.required],incentive_type:["",g.required],incentive_value:["",g.required],customer_type_id:[[],g.required],customer_type_name:[""]}),this.commonApi.getLoginType([S.INFLUENCER]),this.commonApi.getDropDownData(this.submodule.sub_module_id,"Incentive Type"),this.commonApi.getCustomerCategorySubType([S.INFLUENCER])}findName(i){let e=i;if(Array.isArray(e)&&e.length>0){let o=this.commonApi.customerCategorySubType.filter(t=>e.includes(t.value)).map(t=>t.label);this.badgeForm.patchValue({customer_type_name:o})}}onSearch(i){this.commonApi.getCustomerCategorySubType([S.INFLUENCER],i)}onDateChange(){this.badgeForm.get("end_date")?.reset()}pondFiles=[];pondOptions=this.getPondOptions("image");getPondOptions(i){let e={allowMultiple:!1,allowFileTypeValidation:!0,labelIdle:"Click or drag files here to upload...",maxFiles:5,server:{process:(o,t,m,C)=>{setTimeout(()=>{C(Date.now().toString())},1e3)},revert:(o,t)=>{t()}}};if(i==="image")return F(h({},e),{acceptedFileTypes:["image/jpeg","image/png","image/jpg"],maxFileSize:"2MB",allowImageValidateSize:!0,imageValidateSizeMinWidth:300,imageValidateSizeMinHeight:300,imageValidateSizeMaxWidth:300,imageValidateSizeMaxHeight:300,labelFileTypeNotAllowed:"Only PNG and JPEG files are allowed",fileValidateTypeLabelExpectedTypes:"Allowed: PNG, JPEG",labelImageValidateSizeTooSmall:"Image is too small. Min: {minWidth}\xD7{minHeight}",labelImageValidateSizeTooBig:"Image is too large. Max: {maxWidth}\xD7{maxHeight}"})}onFileProcessed(i){let e=i.file.file;this.pondFiles=[...this.pondFiles||[],e]}onFileRemove(i){let e=i.file.file,o=this.pondFiles.findIndex(t=>t.name===e.name&&t.size===e.size);o>-1&&this.pondFiles.splice(o,1)}onSubmit(){if(this.badgeForm.valid)if(this.pondFiles.length===0){this.toastr.error("Banner image is required","","toast-top-right");return}else this.api.disabled=!0,this.api.post(this.badgeForm.value,"badges/create").subscribe({next:i=>{this.api.disabled=!1,i.statusCode===200&&(this.pondFiles.length>0?this.uploadService.uploadFile(i.data.inserted_id,"badges",this.pondFiles,"Badged Images",this.submodule,"/apps/loyalty/badges-list"):(this.api.disabled=!1,this.toastr.success(i.message,"","toast-top-right"),this.router.navigate(["/apps/loyalty/badges-list"])))}});else this.toastr.error("Form Is Invalid","","toast-top-right"),this.formValidation.markFormGroupTouched(this.badgeForm)}static \u0275fac=function(e){return new(e||r)(d(k),d(L),d($),d(j),d(X),d(B),d(V),d(W),d(U),d(ne))};static \u0275cmp=x({type:r,selectors:[["app-badges-add"]],inputs:{formFields:"formFields"},decls:3,vars:7,consts:[[3,"title","title1","activeitem","btnShow1"],["class","box",4,"ngIf"],["class","xl:col-span-12 col-span-12",4,"ngIf"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","gap-x-6"],["class","xl:col-span-3 col-span-12 mb-4",4,"ngFor","ngForOf"],[1,"xl:col-span-3","col-span-12","mb-4"],[1,"xl:col-span-12","col-span-12"],[3,"ngSubmit","formGroup"],[1,"col-span-12","mb-4","xl:col-span-4","xxl:col-span-3"],["formControlName","customer_type_id","label","Customer Category",3,"searchChanged","selectedChange","search","multiple","fieldReq","options"],["label","Title","formControlName","title","type","text",1,"remove-default-class",3,"fieldReq"],["placeholder","Start Date","label","Start Date","formControlName","start_date",1,"form-control","custom-datepickr",3,"dateChange","fieldReq","min"],["placeholder","End Date","label","End Date","formControlName","end_date",1,"form-control","custom-datepickr",3,"min","fieldReq"],["label","Eligible Points","formControlName","eligible_points","type","number",1,"remove-default-class",3,"fieldReq"],["formControlName","incentive_type","label","Incentive Type",3,"fieldReq","options"],["class","col-span-12 mb-4 xl:col-span-4 xxl:col-span-3",4,"ngIf"],[1,"col-span-12","mb-4","xl:col-span-6","xxl:col-span-6"],[1,"form-label"],[1,"text-red-500"],[1,"filepond","basic-filepond",3,"onprocessfile","onremovefile","options","files"],[1,"text-[.625rem]","font-semibold","text-right","text-red-500"],[1,"flex","items-center","justify-end","mt-10","gap-2"],[3,"buttonType","disabled","buttonClass","iconClass","loadingIconClass"],["formControlName","incentive_value",1,"remove-default-class",3,"label","fieldReq","type"]],template:function(e,o){e&1&&(p(0,"app-page-header",0),b(1,fe,4,2,"div",1)(2,ve,28,26,"div",2)),e&2&&(n("title","Loyalty")("title1",_(6,se))("activeitem","Add Badges")("btnShow1",!1),l(),n("ngIf",o.skLoading),l(),n("ngIf",!o.skLoading))},dependencies:[te,N,A,q,w,E,P,G,ee,Y,ae,H,ie,J,R,O,re,M,z,Z,Q,K],encapsulation:2})};export{le as BadgesAddComponent};
