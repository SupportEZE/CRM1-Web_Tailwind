import{a as de}from"./chunk-GXF7AAOQ.js";import{a as le}from"./chunk-ZON5AR26.js";import"./chunk-LGZVJJDX.js";import{a as se}from"./chunk-54KZ5YIV.js";import"./chunk-SQZ3YN6N.js";import"./chunk-CIBZCVJQ.js";import{a as ae}from"./chunk-OTFCGVEU.js";import{a as ne}from"./chunk-HPLI5COI.js";import"./chunk-DUVWFXSE.js";import"./chunk-OEHD5D2Y.js";import{a as re}from"./chunk-GLWQGYBC.js";import{a as K}from"./chunk-DC4QM32I.js";import{C as te,F as oe,c as X,f as Z,n as ee,v as ie}from"./chunk-VHE3PQ3O.js";import{C as G,H as P,M as B,Qa as Y,V as z,W as q,X as H,Y as $,Z as J,hb as Q,jb as W,l as w,o as U,w as j}from"./chunk-GYDYF5F3.js";import{K as k,M as N,f as V,g as R,t as O}from"./chunk-PD5VTTIY.js";import{Aa as I,Ba as S,Hb as D,Ob as _,Yc as T,_b as d,cc as L,kc as p,lc as c,mc as C,nc as E,oc as A,qc as x,qd as M,rb as m,sb as l,wc as g,yc as f}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import"./chunk-66YHNWRR.js";var ce=()=>["Leave Add"],fe=()=>[];function ue(a,t){a&1&&(p(0,"div",8),C(1,"app-skeleton"),c())}function he(a,t){a&1&&(p(0,"div",4)(1,"div",5)(2,"div",6),_(3,ue,2,0,"div",7),c()()()),a&2&&(m(3),d("ngForOf",T(1,fe).constructor(10)))}function _e(a,t){if(a&1){let e=x();p(0,"div")(1,"app-form-field",17,0),g("valueChange",function(o){I(e);let n=f().$implicit,s=f(4);return S(s.onFieldChange(o,n))}),c()()}if(a&2){let e=f().$implicit,i=f(4);L("mb-4 ",e.class_name,""),m(),d("field",e)("form",i.myForm)}}function ye(a,t){if(a&1&&(E(0),_(1,_e,3,5,"div",16),A()),a&2){let e=t.$implicit;m(),d("ngIf",e.is_show===!0&&(e.is_parent_dependency===!1||e.is_child_show===!0))}}function Fe(a,t){if(a&1&&(p(0,"div",6),_(1,ye,2,1,"ng-container",15),c()),a&2){let e=f(3);m(),d("ngForOf",e.formFields)}}function ve(a,t){if(a&1){let e=x();p(0,"form",11),g("ngSubmit",function(){I(e);let o=f(2);return S(o.onSubmit())}),p(1,"div",4)(2,"div",5),_(3,Fe,2,1,"div",12),c(),p(4,"div",13),C(5,"app-button",14),c()()()}if(a&2){let e=f(2);d("formGroup",e.myForm),m(3),d("ngIf",e.myForm&&e.myForm.controls),m(2),d("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",e.api.disabled)("formType",e.pageType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}function ge(a,t){if(a&1&&(p(0,"div",9),_(1,ve,6,8,"form",10),c()),a&2){let e=f();m(),d("ngIf",e.formIniatialized)}}var me=class a{constructor(t,e,i,o,n,s,r,u,F,b,y,pe,h){this.api=t;this.date=e;this.spaceRemove=i;this.cdr=o;this.fb=n;this.util=s;this.toastr=r;this.route=u;this.router=F;this.logService=b;this.moduleService=y;this.formValidation=pe;this.dialog=h}filter={};pageType="add";productId;formFields=[];myForm;primaryForm;FORMID=ne;moduleFormId=0;subModule={};originalFormFields=[];skLoading=!1;formIniatialized=!1;fieldTypes=w;originalData={};tableIdId=0;UploadFIles=[];onClick(t){}ngOnInit(){let t=this.moduleService.getSubModuleByName("SFA","Leave"),e=this.moduleService.getFormById("SFA","Leave",this.FORMID.ID.LeaveFormData),i=this.moduleService.getTableById("SFA","Expense",this.FORMID.ID.LeaveTableData);t&&(this.subModule=t),e&&(this.moduleFormId=e.form_id,this.getFormData()),i&&(this.tableIdId=i.table_id)}getFormData(){this.skLoading=!0,this.api.post({form_id:this.moduleFormId,platform:"web"},"form-builder/read").subscribe(t=>{t.statusCode==200&&(t?.data?.form_data&&(this.originalFormFields=JSON.parse(JSON.stringify(t.data.form_data))),this.formFields=t.data.form_data,this.skLoading=!1,this.formFields.forEach(e=>{this.util.createValidation(e)}),this.initializeForm())})}initializeForm(){this.getLoginType(),this.myForm=this.fb.group({}),this.formFields.forEach(t=>{t.control=this.fb.control("",this.formValidation.getValidators(t)),this.myForm.addControl(t.name,t.control)}),this.formIniatialized=!0,this.productId}getOptions(t){this.api.post({user_id:t},"leave/leave-config").subscribe(e=>{if(e.statusCode===200){for(let i=0;i<this.formFields.length;i++)this.formFields[i].name==="leave_type"&&(this.formFields[i].options=e.data);for(let i=0;i<this.originalFormFields.length;i++)this.originalFormFields[i].name==="leave_type"&&(this.originalFormFields[i].options=e.data)}})}getLoginType(){let t=[U.FIELD_USER];this.api.post({form_id:this.moduleFormId,login_type_ids:t},"user/read-dropdown").subscribe(e=>{if(e.statusCode==200)for(let i=0;i<this.formFields.length;i++)this.formFields[i].name==="user_name"&&(this.formFields[i].options=e.data)})}getDependencyUpdate(t){if(t.is_child_dependency){let e,i,o;if(t.key_source==="default"){let n=t.options.find(s=>s.value===t.value);e=n?n.label:null}t.child_dependency.forEach(n=>{let s=this.formFields.find(r=>r.name===n.child_field_name);if(s){i=s.name;let r=n.child_field_option.find(u=>u.parent_field_value===e);o=r?r.label:null}}),i&&this.api.post({child_field_name:i,parent_field_value:e},"form-builder/read-dependency").subscribe(n=>{if(n?.statusCode===200&&n?.data){let s=this.formFields.find(r=>r.name===i);s&&(s.options=n.data)}})}}onSubmit(){this.formFields.forEach(t=>{(t.is_child_show===!1||t.is_show===!1)&&(this.myForm.get(t.name)?.clearValidators(),this.myForm.get(t.name)?.updateValueAndValidity())}),this.myForm.valid?(this.api.disabled=!0,this.UploadFIles.length>0?this.UploadFIles.forEach(t=>{let e=t.file.map(i=>{let o=new FormData;return o.append("file",i,i.name),o.append("label",t.label),this.api.uploadFile(o,"s3/uploadsingle").toPromise()});e.length&&Promise.all(e).then(i=>console.log("All files uploaded successfully:",i)).catch(i=>console.error("Error uploading files:",i)),Promise.all(e).then(i=>{let o=[];for(let n=0;n<i.length;n++)o.push({file:i[n].fullPath,label:i[n].label,id:n+1});this.handleSuccess(o)}).catch(i=>{})}):this.handleSuccess([])):this.formValidation.markFormGroupTouched(this.myForm)}handleSuccess(t){this.myForm.addControl("files",this.fb.control(t));let e={primaryFields:{form_data:{}}};this.formFields.forEach(i=>{i.name&&this.myForm.value.hasOwnProperty(i.name)&&(i.read_only===!1&&i.key_source!=="custom"&&(e.primaryFields[i.name]=this.myForm.value[i.name]),i.key_source==="custom"&&(e.primaryFields.form_data[i.name]=this.myForm.value[i.name]),i.type===this.fieldTypes.UPLOAD&&delete e.primaryFields.form_data[i.name])}),e.primaryFields=this.date.formatDatesInObject(e.primaryFields),e.primaryFields.form_data.files=this.myForm.value.files,this.api.post(e.primaryFields,"leave/leave-create").subscribe(i=>{i.statusCode===200&&(this.api.disabled=!1,this.router.navigate(["/apps/sfa/leave-list"]),this.toastr.success(i.message,"","toast-top-right"))},i=>{this.api.disabled=!1,this.toastr.error("Error creating leave request","","toast-top-right"),console.error("Error:",i)})}onResetDependentFields(t){this.formFields[t].child_dependency.length!=0&&this.formFields[t].child_dependency.map(e=>{let i=this.formFields.findIndex(o=>o.name===e.child_field_name);i!==-1&&(this.myForm.controls[e.child_field_name].reset(),this.formFields[i].value=""),this.onResetDependentFields(i)})}onFieldChange(t,e){if(e.type==this.fieldTypes.SINGLE_SELECT||e.type==this.fieldTypes.MULTI_SELECT||e.type==this.fieldTypes.RADIO_SELECT||e.type==this.fieldTypes.CHECKBOX_SELECT||e.type==this.fieldTypes.DATE||e.type==this.fieldTypes.TIME||e.type==this.fieldTypes.UPLOAD)if(e.type==this.fieldTypes.SINGLE_SELECT){if(e.control.setValue(t),e.value=t.label,e.key_name_required===!0){let i=e.options.findIndex(n=>n.value===t),o;i!==-1&&(o=e.options[i].label,this.formFields.forEach(n=>{n.name===n.key_name&&this.myForm.controls[n.name].setValue(o)}))}}else e.control.setValue(t);if(e.type===this.fieldTypes.DATE_RANGE){let i={from:t.from,to:t.to};this.myForm.controls[e.name].setValue(i)}if(e.name==="product_code"&&t.length>=3&&this.checkDuplicate(e.api_path,t),e.name==="user_name"){this.getOptions(t);let i=e.options.findIndex(o=>o.value===t);if(i!==-1){let o=e.options[i].label,n=e.options[i].value;this.myForm.controls.user_name.setValue(o),this.myForm.controls.user_id.setValue(n)}}if(e.type===this.fieldTypes.UPLOAD){for(let i=0;i<this.UploadFIles.length;i++)this.UploadFIles[i].label===e.label&&this.UploadFIles.splice(i,1);this.UploadFIles.push({label:e.label,file:t})}if(e.is_child_dependency===!0){let i=e.options.findIndex(o=>o.value===t);i!==-1&&(e.type===this.fieldTypes.SINGLE_SELECT&&e.key_source==="default"?(e.value=e.options[i].value,this.getDependencyUpdate(e)):(e.value=e.options[i].label,this.getDependencyUpdate(e)))}if(e.is_child_dependency){let i=this.formFields.findIndex(o=>o.name==e.name);this.onResetDependentFields(i);for(let o=i;o<=this.formFields.length-1;o++){let s=this.formFields[o].options?.find(r=>this.spaceRemove.formatString(r.value)===this.spaceRemove.formatString(this.formFields[o].value))?.label||"";for(let r=0;r<=this.formFields[o].child_dependency.length-1;r++){let u=!1,F=this.formFields[o].child_dependency[r];if(F.visibilty==="Direct"&&(F.parent_field_value===s||F.child_field_option.length===0&&this.formFields[o].is_child_show)&&(u=!0),this.formFields[o].child_dependency[r].visibilty==="Option"){let y=this.formFields.findIndex(h=>h.name==this.formFields[o].child_dependency[r].child_field_name);if(y!==-1&&this.formFields[y].type===this.fieldTypes.SHORT_TEXT&&this.formFields[o].value&&(u=!0,this.formFields[y].is_child_show=u),this.formFields[o].child_dependency[r].child_field_option.findIndex(h=>h.parent_field_value==s&&h.parent_field_name==this.formFields[o].name)!==-1){u=!0;let h=this.formFields.findIndex(v=>v.name==this.formFields[o].child_dependency[r].child_field_name);this.formFields[h].options=this.formFields[o].child_dependency[r].child_field_option.filter(v=>v.parent_field_name==this.formFields[o].name&&v.parent_field_value==s)}}let b=this.formFields.findIndex(y=>y.name==this.formFields[o].child_dependency[r].child_field_name);b!==-1&&(this.formFields[b].is_child_show=u)}}}}openModal(t){this.dialog.open(le,{data:{lastPage:"product",form_Fields:this.originalFormFields,moduleFormId:this.moduleFormId,moduleId:this.subModule.sub_module_id,moduleName:this.subModule.title,module_type:this.subModule.module_type}}).afterClosed().subscribe(i=>{i===!0&&this.getFormData()})}checkDuplicate(t,e){this.api.post({product_code:e},t).subscribe(i=>{i===!1?this.api.isDuplicate=!0:this.api.isDuplicate=!1})}static \u0275fac=function(e){return new(e||a)(l(J),l(W),l(se),l(M),l(z),l($),l(j),l(k),l(N),l(ae),l(K),l(ie),l(Y))};static \u0275cmp=D({type:a,selectors:[["app-leave-add"]],inputs:{formFields:"formFields"},decls:3,vars:14,consts:[["dynamicForm",""],[3,"buttonClick","buttonClick1","title","title1","activeitem","buttonText","icon","btnShow","buttonValue","buttonText1","icon1","btnShow1","buttonValue1"],["class","box",4,"ngIf"],["class","xl:col-span-12 col-span-12",4,"ngIf"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","gap-x-6"],["class","xl:col-span-3 col-span-12 mb-4",4,"ngFor","ngForOf"],[1,"xl:col-span-3","col-span-12","mb-4"],[1,"xl:col-span-12","col-span-12"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"ngSubmit","formGroup"],["class","grid grid-cols-12 gap-x-6",4,"ngIf"],[1,"box-footer","border-t","border-block-start-dashed","sm:flex","justify-end"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],[4,"ngFor","ngForOf"],[3,"class",4,"ngIf"],[3,"valueChange","field","form"]],template:function(e,i){e&1&&(p(0,"app-page-header",1),g("buttonClick",function(n){return i.onClick(n)})("buttonClick1",function(n){return i.openModal(n)}),c(),_(1,he,4,2,"div",2)(2,ge,2,1,"div",3)),e&2&&(d("title","SFA Modules")("title1",T(13,ce))("activeitem","Leave Add")("buttonText","Filter")("icon","filter_list")("btnShow",!0)("buttonValue","filter_data")("buttonText1","Form Config")("icon1","settings")("btnShow1",!0)("buttonValue1",""),m(),d("ngIf",i.skLoading),m(),d("ngIf",!i.skLoading))},dependencies:[oe,V,R,P,G,B,re,de,X,te,Z,q,ee,H,Q,O],encapsulation:2})};export{me as LeaveAddComponent};
