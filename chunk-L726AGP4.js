import{a as oe}from"./chunk-PU6S26UW.js";import"./chunk-OTFCGVEU.js";import{a as H}from"./chunk-CNF4GSI7.js";import{a as re}from"./chunk-GLWQGYBC.js";import{a as J}from"./chunk-DC4QM32I.js";import{C as ie,F as ne,g as X,j as Z,k as $,v as ee,w as te}from"./chunk-VHE3PQ3O.js";import{A as u,B as q,C as k,D as A,F as f,H as B,M as O,P as j,Qa as W,V as L,W as G,X as U,Z as z,aa as Y,hb as K,jb as Q,o as h,w as D}from"./chunk-GYDYF5F3.js";import{K as P,M as E,g as R,n as N,t as M}from"./chunk-PD5VTTIY.js";import{Aa as d,Ba as c,Hb as T,Mc as C,Ob as b,Yc as w,_b as r,ed as I,fd as V,kc as a,lc as m,mc as _,qc as F,rb as l,sb as s,wc as g,yc as p}from"./chunk-2NSPOFEK.js";import"./chunk-EU2KAMEK.js";import{a as S,b as y}from"./chunk-66YHNWRR.js";var le=()=>["Announcement"];function se(v,n){if(v&1){let t=F();a(0,"div",7)(1,"spk-ng-select",20),g("selectedChange",function(i){d(t);let o=p(2);return c(o.onCustomerCategoryChange(i))}),m()()}if(v&2){let t=p(2);l(),r("fieldReq",!0)("options",t.CommonApiService.customerCategorySubType)("multiple",!1)}}function me(v,n){if(v&1){let t=F();a(0,"div",2)(1,"form",3),g("ngSubmit",function(){d(t);let i=p();return c(i.onSubmit())}),a(2,"div",4)(3,"div",5)(4,"div",6)(5,"div",7),_(6,"spk-input",8),m(),a(7,"div",7)(8,"spk-ng-select",9),g("selectedChange",function(i){d(t);let o=p();return c(o.onLoginTypeChange(i))}),m()(),b(9,se,2,3,"div",10),a(10,"div",7)(11,"spk-ng-select",11),g("searchChanged",function(i){d(t);let o=p();return c(o.onSearch(i))}),m()(),a(12,"div",7),_(13,"spk-ng-select",12),m(),a(14,"div",13),_(15,"spk-input",14),m()(),a(16,"div",6)(17,"div",13)(18,"label",15),C(19,"Banner"),a(20,"span",16),C(21,"*"),m()(),a(22,"file-pond",17),g("onremovefile",function(i){d(t);let o=p();return c(o.onFileRemove(i,"image"))})("onprocessfile",function(i){d(t);let o=p();return c(o.onFileProcessed(i,"image"))}),m()(),a(23,"div",13)(24,"label",15),C(25,"Attachment"),m(),a(26,"file-pond",17),g("onremovefile",function(i){d(t);let o=p();return c(o.onFileRemove(i,"document"))})("onprocessfile",function(i){d(t);let o=p();return c(o.onFileProcessed(i,"pdf"))}),m()()()(),a(27,"div",18),_(28,"app-button",19),m()()()()}if(v&2){let t,e=p();l(),r("formGroup",e.announcementForm),l(5),r("fieldReq",!0),l(2),r("fieldReq",!0)("options",e.CommonApiService.loginType)("multiple",!1),l(),r("ngIf",(t=e.announcementForm.get("login_type_id"))==null?null:t.value),l(2),r("fieldReq",!0)("options",e.CommonApiService.statList)("multiple",!0)("search",!0),l(2),r("fieldReq",!0)("options",e.statusType)("multiple",!1),l(2),r("fieldReq",!0),l(7),r("options",e.pondOptions)("files",e.pondBannerFiles),l(4),r("options",e.pondDocumentOptions)("files",e.pondAttachmentFiles),l(2),r("buttonType","submit")("buttonClass","ti-btn ti-btn-primary m-0")("disabled",e.api.disabled)("formType",e.pageType)("iconClass","ri-save-line")("loadingIconClass","ri-loader-2-fill")}}var ae=class v{constructor(n,t,e,i,o,x,pe,de,ce,ue,fe,ve){this.dialog=n;this.api=t;this.toastr=e;this.CommonApiService=i;this.dateService=o;this.fb=x;this.router=pe;this.route=de;this.formValidation=ce;this.authService=ue;this.moduleService=fe;this.uploadService=ve;this.orgData=this.authService.getUser()}announcementForm=new A({});pageType="add";skLoading=!1;modules={};pondFiles=[];pondBannerFiles=[];pondAttachmentFiles=[];orgData={};ngOnInit(){let n=this.moduleService.getModuleByName("Announcement");n&&(this.modules=n),this.announcementForm=new A({title:new f("",u.required),login_type_name:new f("",u.required),login_type_id:new f("",u.required),customer_type_name:new f("",u.required),customer_type_id:new f("",u.required),state:new f("",u.required),status:new f("Published",u.required),description:new f("",u.required)}),this.CommonApiService.getStates();let t=[],e=[],i=[];(this.orgData?.org?.sfa||this.orgData?.org?.dms)&&(t=[h.PRIMARY,h.SUB_PRIMARY],e=[h.SECONDARY]),this.orgData?.org?.irp&&(i=[h.INFLUENCER]);let o=[...t||[],...e||[],...i||[]];this.CommonApiService.getLoginType(o)}onLoginTypeChange(n){let t=this.CommonApiService.loginType.find(e=>e.value===n);t&&(this.announcementForm.patchValue({login_type_name:t.label}),this.CommonApiService.getCustomerCategorySubType(this.announcementForm.value.login_type_id))}onCustomerCategoryChange(n){let t=this.CommonApiService.customerCategorySubType.find(e=>e.value===n);t&&this.announcementForm.patchValue({customer_type_name:t.label})}pondOptions=this.getPondOptions("image");pondDocumentOptions=this.getPondOptions("pdf");getPondOptions(n){let t={allowFileTypeValidation:!0,labelIdle:"Click or drag files here to upload...",maxFiles:1,server:{process:(e,i,o,x)=>{setTimeout(()=>{x(Date.now().toString())},1e3)},revert:(e,i)=>{i()}}};return n==="image"?y(S({},t),{allowMultiple:!1,acceptedFileTypes:["image/jpeg","image/png","image/jpg"],maxFileSize:"2MB",allowImageValidateSize:!0,labelFileTypeNotAllowed:"Only PNG and JPEG files are allowed",fileValidateTypeLabelExpectedTypes:"Allowed: PNG, JPEG",labelImageValidateSizeTooSmall:"Image is too small. Min: {minWidth}\xD7{minHeight}",labelImageValidateSizeTooBig:"Image is too large. Max: {maxWidth}\xD7{maxHeight}"}):y(S({},t),{allowMultiple:!0,acceptedFileTypes:["application/pdf"],maxFileSize:"10MB",labelFileTypeNotAllowed:"Only PDF files are allowed",fileValidateTypeLabelExpectedTypes:"Allowed: PDF"})}onFileProcessed(n,t){let e=n.file.file;Object.assign(e,{image_type:t}),t==="image"?this.pondBannerFiles=[...this.pondBannerFiles||[],e]:t==="pdf"&&(this.pondAttachmentFiles=[...this.pondAttachmentFiles||[],e])}onFileRemove(n,t){let e=n.file.file;if(t==="image"){let i=this.pondBannerFiles.findIndex(o=>o.name===e.name&&o.size===e.size);i>-1&&this.pondBannerFiles.splice(i,1)}else if(t==="document"){let i=this.pondAttachmentFiles.findIndex(o=>o.name===e.name&&o.size===e.size);i>-1&&this.pondAttachmentFiles.splice(i,1)}}onSearch(n){this.CommonApiService.getStates(n)}onSubmit(){if(this.announcementForm.valid)if(this.pondFiles=[...this.pondBannerFiles,...this.pondAttachmentFiles],this.pondFiles.length===0&&this.pageType==="add"){this.toastr.error("Please upload at least one file.","","toast-top-right");return}else this.api.disabled=!0,this.api.post(this.announcementForm.value,"announcement/create").subscribe(n=>{n.statusCode==200&&(this.pondFiles.length>0?this.uploadService.uploadFile(n.data.inserted_id,"announcement",this.pondFiles,"Announcement Images",this.modules,"/apps/sfa/announcement"):(this.api.disabled=!1,this.router.navigate(["/apps/sfa/announcement"]),this.toastr.success(n.message,"","toast-top-right"),this.announcementForm.reset()))});else this.formValidation.markFormGroupTouched(this.announcementForm)}statusType=[{label:"Published",value:"Published"},{label:"Unpublished",value:"Unpublished"}];static \u0275fac=function(t){return new(t||v)(s(W),s(z),s(D),s(H),s(Q),s(L),s(E),s(P),s(ee),s(Y),s(J),s(oe))};static \u0275cmp=T({type:v,selectors:[["app-announcement-add"]],decls:3,vars:7,consts:[[3,"title","title1","activeitem"],["class","xl:col-span-12 col-span-12",4,"ngIf"],[1,"xl:col-span-12","col-span-12"],[3,"ngSubmit","formGroup"],[1,"box"],[1,"p-4"],[1,"grid","grid-cols-12","sm:gap-x-6"],[1,"xl:col-span-3","col-span-12","mb-3"],["label","Title","formControlName","title","type","text",1,"remove-default-class",3,"fieldReq"],["formControlName","login_type_id","label","Login Type",3,"selectedChange","fieldReq","options","multiple"],["class","xl:col-span-3 col-span-12 mb-3",4,"ngIf"],["formControlName","state","label","State",3,"searchChanged","fieldReq","options","multiple","search"],["formControlName","status","label","Status",3,"fieldReq","options","multiple"],[1,"xl:col-span-6","col-span-12","mb-3"],["label","Description","formControlName","description","type","textarea",1,"remove-default-class",3,"fieldReq"],[1,"form-label","mb-0"],[1,"text-red-500"],[1,"filepond","basic-filepond",3,"onremovefile","onprocessfile","options","files"],[1,"box-footer","border-t","border-block-start-dashed","sm:flex","justify-end"],[3,"buttonType","buttonClass","disabled","formType","iconClass","loadingIconClass"],["formControlName","customer_type_id","label","Customer Category",3,"selectedChange","fieldReq","options","multiple"]],template:function(t,e){t&1&&(_(0,"app-page-header",0),I(1,"titlecase"),b(2,me,29,24,"div",1)),t&2&&(r("title","Announcement")("title1",w(6,le))("activeitem",V(1,4,e.pageType)+" Announcement"),l(2),r("ngIf",!e.skLoading))},dependencies:[G,B,q,k,M,R,N,ne,O,j,te,X,re,ie,K,$,Z,U],encapsulation:2})};export{ae as AnnouncementAddComponent};
