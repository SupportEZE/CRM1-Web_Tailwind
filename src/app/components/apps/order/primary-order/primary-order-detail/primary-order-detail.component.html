<app-page-header [title]="'Primary Order'" [title1]="['Primary Order Detail']" [activeitem]="'Primary Order Detail'"></app-page-header>


<div class="grid grid-cols-12 sm:gap-x-6" *ngIf="!skLoading">
    <div class="xl:col-span-8 col-span-12">
        <div class="box">
            <div class="box-header">
                <div class="box-title text-primarytint1color wp100 flex justify-between">
                    Customer  Detail
                    <div class="">
                        <app-icon-button [icon]="'bi bi-file-earmark-pdf'" [buttonClass]="'ti-btn ti-btn-icon bg-primary/10 text-primary !border hover:bg-primary hover:text-white !rounded-full btn-wave'" (click)="exportOrderPdf()" matTooltip="Export Order PDF"> </app-icon-button>
                    </div>
                </div>
            </div>
            <div class="box-body pt-0">
                <ul class="ti-list-group list-group-flush border-0">
                    <li>
                        <div class="flex items-center gap-5 flex-wrap text-[12px]">
                            <div class="flex items-center  flex-wrap">
                                <div>
                                    <span class="block font-medium text-primay">{{customerDetail?.customer_type_name || '--'}}</span>
                                    <span class="text-textmuted dark:text-textmuted/50">Customer Catgeory</span>
                                </div>
                            </div>
                            <div class="flex items-center  flex-wrap">
                                <div>
                                    <span class="block font-medium text-primay">{{customerDetail?.company_name || 'N/A' }}</span>
                                    <span class="text-textmuted dark:text-textmuted/50">Company Name</span>
                                </div>
                            </div>
                            
                            <div class="flex items-center  flex-wrap">
                                <div>
                                    <span class="block font-medium text-primay">{{contactPersonDetail[0]?.contact_person_name || '--'}}</span>
                                    <span class="text-textmuted dark:text-textmuted/50">Contact Person</span>
                                </div>
                            </div>
                            <div class="flex items-center  flex-wrap">
                                <div>
                                    <span class="block font-medium text-primay">{{customerDetail?.mobile || '--'}}</span>
                                    <span class="text-textmuted dark:text-textmuted/50">Contact Details</span>
                                </div>
                            </div>
                            <div class="flex items-center  flex-wrap">
                                <div>
                                    <span class="block font-medium text-primay">{{customerDetail?.customer_code || '--'}}</span>
                                    <span class="text-textmuted dark:text-textmuted/50">Account Code</span>
                                </div>
                            </div>
                            <div class="flex items-center  flex-wrap">
                                <div>
                                    <span class="block font-medium text-primay">{{customerDetail?.full_address || '--'}}
                                    </span>
                                    <span class="text-textmuted dark:text-textmuted/50">Address</span>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        
        <app-showcode-card [title]="'Order Detail'" [class]="'text-primarytint1color'" [boxHeader]="'pt-3'" [classbody]="'pt-0'"  [titleView]="true">
            <ul class="ti-list-group list-group-flush border-0">
                <li>
                    <div class="flex items-center gap-5 flex-wrap text-[12px]">
                        <div class="flex items-center  flex-wrap">
                            <div>
                                <span class="block font-medium text-primay">{{orderDetail?.created_at ? (orderDetail?.created_at | date:'d MMM yyyy, hh:mm a') : '--'}}</span>
                                <span class="text-textmuted dark:text-textmuted/50">Date Created</span>
                            </div>
                        </div>
                        <div class="flex items-center  flex-wrap">
                            <div>
                                <span class="block font-medium text-primay">{{orderDetail?.created_name || '--'}}</span>
                                <span class="text-textmuted dark:text-textmuted/50">Created By</span>
                            </div>
                        </div>
                        <div class="flex items-center  flex-wrap">
                            <div>
                                <span class="block font-medium text-primay">{{orderDetail?.order_no || '--'}}</span>
                                <span class="text-textmuted dark:text-textmuted/50">Order No.</span>
                            </div>
                        </div>
                        <div class="flex items-center  flex-wrap">
                            <div>
                                <span class="block font-medium text-primay">{{orderDetail?.total_item_count || 0}}</span>
                                <span class="text-textmuted dark:text-textmuted/50">Total Items</span>
                            </div>
                        </div>
                        <div class="flex items-center  flex-wrap">
                            <div>
                                <span class="block font-medium text-primay">{{orderDetail?.total_item_quantity || 0}}</span>
                                <span class="text-textmuted dark:text-textmuted/50">Total Items Qty</span>
                            </div>
                        </div>
                        <div class="flex items-center  flex-wrap">
                            <div>
                                <span class="block font-medium text-primay text-right">
                                    {{ CURRENCY_SYMBOLS.RUPEE }}   {{orderDetail?.net_amount_with_tax || 0 | number:'1.2-2' }}
                                </span>
                                <span class="text-textmuted dark:text-textmuted/50 text-right">Total Order Amount</span>
                            </div>
                        </div>
                        <div class="flex items-center  flex-wrap">
                            <div>
                                <span class="block font-medium text-primay">{{orderDetail?.status || '--'}}</span>
                                <span class="text-textmuted dark:text-textmuted/50">Order Status</span>
                            </div>
                        </div>
                        <div class="flex items-center  flex-wrap">
                            <div>
                                <span class="block font-medium text-primay">{{orderDetail?.order_create_remark || '--'}}</span>
                                <span class="text-textmuted dark:text-textmuted/50">Order Remark</span>
                            </div>
                        </div>
                        <div class="flex items-center  flex-wrap">
                            <div>
                                <span class="block font-medium text-primay">{{orderDetail?.shipping_address || '--'}}</span>
                                <span class="text-textmuted dark:text-textmuted/50">Shipping Address</span>
                            </div>
                        </div>

                        <div class="flex items-center  flex-wrap" *ngIf="orderDetail.billing_company">
                            <div>
                                <span class="block font-medium text-primay">{{orderDetail?.billing_company || '--'}}</span>
                                <span class="text-textmuted dark:text-textmuted/50">Billing Company</span>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </app-showcode-card>
        
        <app-showcode-card [title]="'Product Details'" [class]="'text-primarytint1color'" [boxHeader]="'pt-3'" [classbody]="'pt-0'" [titleView]="true" [btn1]="orderDetail.status === 'Pending' ? true: false" (btnClick)="addNewItem('add-new-item')" [iconName]="'ri-add-line'" [iconClass]="'ti-btn btn-wave ti-btn-sm ti-btn-soft-primary waves-effect waves-light'" [buttonName]="'Add New Item'">
            <div class="table-responsive overflow-auto table-bordered-default">
                <spk-reusable-tables [columns]="cartColumn" tableClass="ti-custom-table ti-custom-table-head ti-custom-table-hover ti-head-primary whitespace-nowrap" [showAction]="orderDetail.status === 'Pending' ? true : false">
                    <tr class="product-list border-b !border-defaultborder dark:!border-defaultborder/10" *ngFor="let row of orderDetail.item; let i = index;">
                        <td class="text-center">{{ i + 1 }}</td>
                        <td class="cart-items01">
                            <div class="flex items-center">
                                <div class="flex-auto">
                                    <div class="text-[12px] font-semibold">{{row?.category_name || '--'}}</div>
                                    <div class="flex-wrap items-center">
                                        <div>
                                            <span>Product Name : </span><span
                                            class="font-normal text-textmuted dark:text-textmuted/50">{{row?.product_name || '--'}}</span>
                                        </div>
                                        <div>
                                            <span>Code : </span><span
                                            class="font-normal text-textmuted dark:text-textmuted/50">{{row?.product_code || '--'}}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="text-right">{{CURRENCY_SYMBOLS.RUPEE}} {{row?.mrp || 0  | number:'1.2-2' }}</td>
                        <td>
                            <div>
                                {{ row.discount_percent || 0}} ({{CURRENCY_SYMBOLS.RUPEE}}{{row.discount_amount  || 0  | number:'1.2-2' }})
                            </div>
                        </td>
                        <td>
                            <div class="text-right">
                                {{CURRENCY_SYMBOLS.RUPEE}} {{row.unit_price  || 0 | number:'1.2-2' }}
                            </div>
                        </td>
                        <td class="text-center">{{row?.total_quantity || 0}}</td>
                        <td>{{row?.uom || '--'}}</td>
                        <td>
                            <div class="text-right">
                                {{CURRENCY_SYMBOLS.RUPEE}} {{row.gross_amount  || 0  | number:'1.2-2' }}
                            </div>
                        </td>
                        <td class="text-right">{{CURRENCY_SYMBOLS.RUPEE}} {{row?.gst_amount || 0 | number:'1.2-2' }}</td>
                        <td class="text-right font-medium">{{CURRENCY_SYMBOLS.RUPEE}} {{row?.net_amount_with_tax || 0 | number:'1.2-2'}}</td>
                        <td class="!text-center" *ngIf="orderDetail.status === 'Pending'">
                            <app-icon-button [icon]="'ri-delete-bin-line'" [buttonClass]="'ti-btn btn-wave product-btn ti-btn-sm ti-btn-soft-danger waves-effect waves-light'"
                            (clickEvent)="onDeleteRow(row._id)" matTooltip="Delete" *ngIf="accessRight?.deleteRight"> </app-icon-button>
                        </td>
                    </tr>
                </spk-reusable-tables>
                <ng-container *ngIf="!orderDetail.item.length">
                    <app-data-not-found></app-data-not-found>
                </ng-container>
                <div class="grid grid-cols-12 sm:gap-x-6">
                    <div class="xl:col-span-7 col-span-12">
                    </div>
                    <div class="xl:col-span-5 col-span-12" *ngIf="orderDetail.item.length > 0">
                        <table class="ti-custom-table text-nowrap" >
                            <tbody>
                                <tr class="border-b !border-defaultborder dark:!border-defaultborder/10">
                                    <td>
                                        <div class="font-semibold">Total Item :</div>
                                    </td>
                                    <td><span class="font-medium">{{orderDetail?.total_item_count || 0}}</span></td>
                                </tr>
                                <tr class="border-b !border-defaultborder dark:!border-defaultborder/10">
                                    <td>
                                        <div class="font-semibold">Total Item Qty:</div>
                                    </td>
                                    <td><span class="font-medium">{{orderDetail?.total_item_quantity || 0}}</span></td>
                                </tr>
                                <tr class="border-b !border-defaultborder dark:!border-defaultborder/10">
                                    <td>
                                        <div class="font-semibold">Total Order Value</div>
                                    </td>
                                    <td><span class="text-right font-medium">{{ CURRENCY_SYMBOLS.RUPEE }} {{ orderDetail?.net_amount_before_tax | number:'1.2-2' }}</span></td>
                                </tr>
                                <tr class="border-b !border-defaultborder dark:!border-defaultborder/10">
                                    <td>
                                        <div class="font-semibold">Total Discount Amount :</div>
                                    </td>
                                    <td><span class="text-right font-medium">{{ CURRENCY_SYMBOLS.RUPEE }} {{ orderDetail?.discount_amount | number:'1.2-2' }}</span></td>
                                </tr>
                                <tr class="border-b !border-defaultborder dark:!border-defaultborder/10">
                                    <td>
                                        <div class="font-semibold">Sub Total :</div>
                                    </td>
                                    <td><span class="text-right font-medium">{{ CURRENCY_SYMBOLS.RUPEE }} {{ orderDetail?.gross_amount | number:'1.2-2' }}</span></td>
                                </tr>
                                <tr class="border-b !border-defaultborder dark:!border-defaultborder/10">
                                    <td>
                                        <div class="font-semibold">Total GST Amount :</div>
                                    </td>
                                    <td><span class="text-right font-medium">{{ CURRENCY_SYMBOLS.RUPEE }} {{ orderDetail?.gst_amount | number:'1.2-2' }}</span></td>
                                </tr>
                                <tr class="border-b !border-defaultborder dark:!border-defaultborder/10">
                                    <td>
                                        <div class="font-semibold">Total Grand Amount :</div>
                                    </td>
                                    <td><span class="text-right font-medium">{{ CURRENCY_SYMBOLS.RUPEE }} {{ orderDetail?.net_amount_with_tax | number:'1.2-2' }}</span></td>
                                </tr>
                                
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </app-showcode-card>
    </div>
    
    <div class="xxl:col-span-4 xl:col-span-4 lg:col-span-4 md:col-span-5 col-span-12">
        <app-showcode-card [title]="'Order Status Tracking'" [iconClass]="'ti-btn btn-wave ti-btn-sm ti-btn-soft-primary waves-effect waves-light'" [boxHeader]="'pt-3'" [classbody]="'pt-0'" [titleView]="true" [iconName]="'ri-draft-line'" (btnClick)="orderDetail.status === 'Pending' || orderDetail.status === 'Hold' ? updateOrderStatus('update-order-status') : dispatchPlan() " [btn1]="accessRight?.modifyRight" [buttonName]="
            orderDetail.status === 'Pending' || orderDetail.status === 'Hold' ? 'Change Order Status' : 'Dispatch Planning'">
            <p class="mb-4">
                <span class="font-medium  text-[14px]">Status :</span>
                <span class="bg-info/10 text-info text-[11px] badge">{{orderDetail.status}}</span>
            </p>
            <div class="order-track mt-1">
                <div class="scroll-y-225 overflow-y-auto pe-2">
                    <div class="hs-accordion-group" data-hs-accordion-always-open>
                        <div *ngFor="let status of orderStatusList; let i = index" class="hs-accordion accordion active" [id]="'order-heading-' + i">
                            <a href="javascript:void(0);" class="hs-accordion-toggle group items-center gap-x-3 w-full font-semibold text-start transition"
                            [attr.aria-controls]="'order-collapse-' + i">
                            <div class="flex mb-2">
                                <div>
                                    <span class="avatar avatar-sm avatar-rounded track-order-icon backdrop-blur" [ngClass]="
                                    status.label === 'Order Placed' ? 'border border-primary/10 bg-primary/10' :
                                    status.label === 'Pending' ? 'border border-warning/10 bg-warning/10' :
                                    status.label === 'Approved' ? 'border border-success/10 bg-success/10' :
                                    status.label === 'Reject' ? 'border border-danger/10 bg-danger/10' :
                                    status.label === 'Hold' ? 'border border-info/10 bg-info/10':
                                   'border border-primary/10 bg-primary/10'">
                                    <i [ngClass]="
                                    status.label === 'Order Placed' ? 'ri-shopping-cart-2-fill text-primary' :
                                    status.label === 'Pending' ? 'ri-time-fill text-warning' :
                                    status.label === 'Approved' ? 'ri-checkbox-circle-fill text-success' :
                                    status.label === 'Reject' ? 'ri-close-circle-fill text-danger' :
                                    status.label === 'Hold' ? 'ri-pause-circle-fill text-info':
                                   'ri-truck-line text-primary'">
                                </i>
                            </span>
                        </div>
                        <div class="flex-grow flex items-center justify-between">
                            <p class="font-medium mb-0 text-[0.875rem]">{{ status.label }}</p>
                            <span class="font-normal text-textmuted">{{status.status_update_date ? (status.status_update_date | date: 'dd MMM y, h:mm a')
                                : 'N/A'}}</span>
                            </div>
                        </div>
                    </a>
                    
                    <div [id]="'order-collapse-' + i" class="space-y-3 hs-accordion-content w-full overflow-hidden transition-[height] duration-300" [attr.aria-labelledby]="'order-heading-' + i">
                        <div class="accordion-body !pt-0 !ps-[3rem]">
                            <p class="mb-0" [innerHTML]="formatMessage(status.message)"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <ng-container *ngIf="!orderStatusList.length">
        <app-data-not-found></app-data-not-found>
    </ng-container>
</app-showcode-card>

<div>
    <app-logs [logList]="logList" [scrollHeight]="'305'" [closeBtn]="false"></app-logs>
</div>
</div>
</div>

<!-- Sk Loading Start -->
<div class="grid grid-cols-12 sm:gap-x-6" *ngIf="skLoading">
    <div class="xl:col-span-9 col-span-12">
        <div class="grid grid-cols-12 sm:gap-x-6">
            <div class="xl:col-span-12 col-span-12">
                <app-showcode-card [titleView]="false"  [view]="false">
                    <div >
                        <div class="flex gap-2 mb-1 flex-wrap">
                            <div class="flex items-center" *ngFor="let card of [].constructor(10)">
                                <app-skeleton [class]="'w180'"></app-skeleton>
                            </div>
                        </div>
                    </div>
                </app-showcode-card>
            </div>
            <div class="xl:col-span-12 col-span-12">
                <app-showcode-card [titleView]="false"  [view]="false">
                    <div >
                        <div class="flex gap-2 mb-1 flex-wrap">
                            <div class="flex items-center" *ngFor="let card of [].constructor(10)">
                                <app-skeleton [class]="'w180'"></app-skeleton>
                            </div>
                        </div>
                    </div>
                </app-showcode-card>
            </div>
        </div>
    </div>
    <div class="xl:col-span-3 col-span-12">
        <app-showcode-card [titleView]="false"  [view]="false">
            <app-skeleton [class]="'wp100 h35 mb-3'" *ngFor="let card of [].constructor(5)"></app-skeleton>
        </app-showcode-card>
        
        <app-showcode-card [titleView]="false"  [view]="false">
            <app-skeleton [class]="'wp100 h35 mb-3'" *ngFor="let card of [].constructor(5)"></app-skeleton>
        </app-showcode-card>
    </div>
</div>
<!-- Sk Loading End -->
