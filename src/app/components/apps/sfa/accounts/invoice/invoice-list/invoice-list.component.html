<app-page-header [title]="'Invoice'" [title1]="['Invoice list']" [activeitem]="'Invoice list'" *ngIf="pageHeader"></app-page-header>

<!-- Start::row-1 -->
<div class="grid grid-cols-12 gap-x-6">
    <div class="xxl:col-span-8 col-span-12">
        <div class="box">
            <div class="box-body " [ngClass]="topCountLoading ? 'p-4' : 'p-0'">
                <div id="invoice-list-stats">
                    <!-- *ngIf="!chartOptions1" -->
                    <spk-apexcharts  [chartOptions]="chartOptions1" ></spk-apexcharts>  
                    
                    <app-skeleton [class]="'h195 wp100 bg-skeleton'" *ngIf="topCountLoading"></app-skeleton>
                </div>
            </div>
        </div>
    </div>
    
    <div class="xxl:col-span-4 col-span-12">
        <div class="grid grid-cols-12 gap-x-6">
            <div class="xxl:col-span-6 col-span-12">
                <div class="box overflow-hidden main-content-card">
                    <div class="box-body p-2">
                        <div class="flex items-start gap-1">
                            <div class="flex-auto">
                                <h5 class="mb-2 text-xs">Total</h5> 
                                <div class="pb-0 mt-0"> 
                                    <div> 
                                        <h4 class="font-medium mb-1">₹
                                            <span class="count-up" data-count="126" *ngIf="!topCountLoading">
                                                {{transform(topCount.total_invoice) || '0' }}
                                            </span>
                                            <app-skeleton [class]="'h12 w80 bg-skeleton'" *ngIf="topCountLoading"></app-skeleton>
                                        </h4>  
                                        <span class="badge bg-primary" *ngIf="!topCountLoading">{{topCount.total_invoice_count || 0}}</span>
                                        <app-skeleton [class]="'h6 w60 bg-skeleton'" *ngIf="topCountLoading"></app-skeleton>
                                    </div> 
                                </div> 
                            </div>
                            <div class="main-card-icon primary border-[3px] border-primary/50 !rounded-full">
                                <div class="avatar avatar-md bg-primary border border-primary/10 avatar-rounded">
                                    <div class="avatar avatar-sm">
                                        <svg  class="!fill-white !stroke-primary" xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="rgba(var(--primary-rgb))" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <path d="M5 21v-16a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v16l-3 -2l-2 2l-2 -2l-2 2l-2 -2l-3 2m4 -14h6m-6 4h6m-2 4h2" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="xxl:col-span-6 col-span-12">
                <div class="box overflow-hidden main-content-card">
                    <div class="box-body p-2">
                        <div class="flex items-start gap-1">
                            <div class="flex-auto">
                                <h5 class="mb-2 text-xs">Paid</h5> 
                                <div> 
                                    <h4 class="font-medium mb-1">₹
                                        <span class="count-up" data-count="126" *ngIf="!topCountLoading">
                                            {{transform(topCount.total_payment) || '0' }}
                                        </span>
                                        <app-skeleton [class]="'h12 w80 bg-skeleton'" *ngIf="topCountLoading"></app-skeleton>
                                    </h4> 
                                    <span class="badge bg-primarytint1color" *ngIf="!topCountLoading">{{topCount.total_payment_count || 0}}
                                    </span>
                                    <app-skeleton [class]="'h6 w60 bg-skeleton'" *ngIf="topCountLoading"></app-skeleton>
                                </div> 
                            </div>
                            <div class="main-card-icon primary1 border-[3px] border-primarytint1color/50 !rounded-full">
                                <div class="avatar avatar-md bg-primarytint1color border border-primarytint1color/10 avatar-rounded">
                                    <div class="avatar avatar-sm">
                                        <svg class="!fill-white !stroke-primarytint1color icon icon-tabler icon-tabler-discount-check" xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="var(--primary-tint1-color)" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <path d="M5 7.2a2.2 2.2 0 0 1 2.2 -2.2h1a2.2 2.2 0 0 0 1.55 -.64l.7 -.7a2.2 2.2 0 0 1 3.12 0l.7 .7c.412 .41 .97 .64 1.55 .64h1a2.2 2.2 0 0 1 2.2 2.2v1c0 .58 .23 1.138 .64 1.55l.7 .7a2.2 2.2 0 0 1 0 3.12l-.7 .7a2.2 2.2 0 0 0 -.64 1.55v1a2.2 2.2 0 0 1 -2.2 2.2h-1a2.2 2.2 0 0 0 -1.55 .64l-.7 .7a2.2 2.2 0 0 1 -3.12 0l-.7 -.7a2.2 2.2 0 0 0 -1.55 -.64h-1a2.2 2.2 0 0 1 -2.2 -2.2v-1a2.2 2.2 0 0 0 -.64 -1.55l-.7 -.7a2.2 2.2 0 0 1 0 -3.12l.7 -.7a2.2 2.2 0 0 0 .64 -1.55v-1" />
                                            <path d="M9 12l2 2l4 -4" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>    
                    </div>
                </div>
            </div>
            
            <div class="xxl:col-span-6 col-span-12">
                <div class="box overflow-hidden main-content-card">
                    <div class="box-body p-2">
                        <div class="flex items-start gap-1">
                            <div class="flex-auto">
                                <h5 class="mb-2 text-xs">Outstanding</h5> 
                                <div> 
                                    <h4 class="font-medium mb-1">₹
                                        <span class="count-up" data-count="126" *ngIf="!bottomLoading">
                                            {{transform(bottomCount.outstanding) || '0' }}
                                        </span>
                                        <app-skeleton [class]="'h12 w80 bg-skeleton'" *ngIf="bottomLoading"></app-skeleton>

                                    </h4> 
                                    <span class="badge bg-primarytint2color" *ngIf="!bottomLoading">
                                        {{bottomCount.total_outstanding_count || '0' }}
                                    </span>
                                    <app-skeleton [class]="'h8 w60 bg-skeleton'" *ngIf="bottomLoading"></app-skeleton>

                                </div> 
                            </div>
                            <div class="main-card-icon primary1 border-[3px] border-primarytint2color/50 !rounded-full">
                                <div class="avatar avatar-md bg-primarytint2color border border-primarytint2color/10 avatar-rounded">
                                    <div class="avatar avatar-sm">
                                        <svg class="!fill-white !stroke-primarytint2color icon icon-tabler icon-tabler-discount-check" xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="var(--primary-tint1-color)" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <path d="M5 7.2a2.2 2.2 0 0 1 2.2 -2.2h1a2.2 2.2 0 0 0 1.55 -.64l.7 -.7a2.2 2.2 0 0 1 3.12 0l.7 .7c.412 .41 .97 .64 1.55 .64h1a2.2 2.2 0 0 1 2.2 2.2v1c0 .58 .23 1.138 .64 1.55l.7 .7a2.2 2.2 0 0 1 0 3.12l-.7 .7a2.2 2.2 0 0 0 -.64 1.55v1a2.2 2.2 0 0 1 -2.2 2.2h-1a2.2 2.2 0 0 0 -1.55 .64l-.7 .7a2.2 2.2 0 0 1 -3.12 0l-.7 -.7a2.2 2.2 0 0 0 -1.55 -.64h-1a2.2 2.2 0 0 1 -2.2 -2.2v-1a2.2 2.2 0 0 0 -.64 -1.55l-.7 -.7a2.2 2.2 0 0 1 0 -3.12l.7 -.7a2.2 2.2 0 0 0 .64 -1.55v-1" />
                                            <path d="M9 12l2 2l4 -4" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>    
                    </div>
                </div>
            </div>
            
            <div class="xxl:col-span-6 col-span-12">
                <div class="box overflow-hidden main-content-card">
                    <div class="box-body p-2">
                        <div class="flex items-start gap-1">
                            <div class="flex-auto">
                                <h5 class="mb-2 text-xs">Overdue (30 Day's)</h5> 
                                <div> 
                                    <h4 class="font-medium mb-1">₹
                                        <span class="count-up" data-count="126" *ngIf="!bottomLoading">
                                            {{transform(bottomCount.overdue) || '0' }}
                                        </span>
                                        <app-skeleton [class]="'h12 w80 bg-skeleton'" *ngIf="bottomLoading"></app-skeleton>
                                    </h4> 
                                    <span class="badge bg-primarytint3color" *ngIf="!bottomLoading">
                                        {{bottomCount.total_overdue_count || '0' }}
                                    </span>
                                    <app-skeleton [class]="'h8 w60 bg-skeleton'" *ngIf="bottomLoading"></app-skeleton>
                                </div> 
                            </div>
                            <div class="main-card-icon primary1 border-[3px] border-primarytint3color/50 !rounded-full">
                                <div class="avatar avatar-md bg-primarytint3color border border-primarytint3color/10 avatar-rounded">
                                    <div class="avatar avatar-sm">
                                        <svg class="!fill-white !stroke-primarytint3color icon icon-tabler icon-tabler-discount-check" xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="var(--primary-tint1-color)" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <path d="M5 7.2a2.2 2.2 0 0 1 2.2 -2.2h1a2.2 2.2 0 0 0 1.55 -.64l.7 -.7a2.2 2.2 0 0 1 3.12 0l.7 .7c.412 .41 .97 .64 1.55 .64h1a2.2 2.2 0 0 1 2.2 2.2v1c0 .58 .23 1.138 .64 1.55l.7 .7a2.2 2.2 0 0 1 0 3.12l-.7 .7a2.2 2.2 0 0 0 -.64 1.55v1a2.2 2.2 0 0 1 -2.2 2.2h-1a2.2 2.2 0 0 0 -1.55 .64l-.7 .7a2.2 2.2 0 0 1 -3.12 0l-.7 -.7a2.2 2.2 0 0 0 -1.55 -.64h-1a2.2 2.2 0 0 1 -2.2 -2.2v-1a2.2 2.2 0 0 0 -.64 -1.55l-.7 -.7a2.2 2.2 0 0 1 0 -3.12l.7 -.7a2.2 2.2 0 0 0 .64 -1.55v-1" />
                                            <path d="M9 12l2 2l4 -4" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>    
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xl-12">
        <div class="box py-4 px-4">
            <nav class="sm:flex sm:space-x-2 sm:rtl:space-x-reverse gap-1" aria-label="Tabs" role="tablist">
                <app-listing-tab *ngFor="let tab of mainTabs" [tabs]="[{ name: tab.name, label: tab.label, icon: tab.icon}]"
                [activeTab]="activeTab" [countShow]="false" (tabChange)="onTabChange($event.tab)">
            </app-listing-tab>
        </nav>
        <app-page-sub-header [pageTitle]="'Invoice List'" [listLength]="listing.length" [btnShow]="true" [refreshLabel]="'Refresh'" (onRefresh)="onRefresh()" [class]="'p-0 pt-0'"></app-page-sub-header>
        
        <div class="table-responsive overflow-auto table-bordered-default">
            <spk-reusable-tables tableClass="ti-custom-table ti-custom-table-head ti-custom-table-hover ti-head-primary whitespace-nowrap" [tableHead]="'border-b'" [showS_No]="true" [columns]="getColumn()"> 
                <ng-container *ngIf="!skLoading">
                    <tr
                    class="border-b !border-defaultborder dark:!border-defaultborder/10">
                    <td class="!text-center">&nbsp;</td>
                    <td>
                        <div class="table-search-filters">
                            <mat-form-field class="table-input">
                                <input matInput  [matDatepicker]="picker" [(ngModel)]="filter.billing_date" name="billing_date" placeholder="Date Created" (ngModelChange)="activeTab === 'All' ? getList() : getUnpaidList()">
                                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                                <mat-datepicker #picker></mat-datepicker>
                            </mat-form-field>  
                        </div>
                    </td>
                    <td class="!text-center">
                        <div class="table-search-filters">
                            <mat-form-field class="table-input">
                                <input matInput type="text"
                                [(ngModel)]="filter.created_name"
                                placeholder="Search..."
                                (keyup.enter)="activeTab === 'All' ? getList() : getUnpaidList()">
                                @if (filter.created_name) {
                                    <button matSuffix mat-icon-button
                                    aria-label="Clear"
                                    (click)="filter.created_name='';activeTab === 'All' ? getList() : getUnpaidList()">
                                    <mat-icon>close</mat-icon>
                                </button>
                            }
                        </mat-form-field>
                    </div>
                </td>
                <td class="!text-center">
                    <div class="table-search-filters">
                        <mat-form-field class="table-input">
                            <input matInput type="text"
                            [(ngModel)]="filter.invoice_number"
                            placeholder="Search..."
                            (keyup.enter)="activeTab === 'All' ? getList() : getUnpaidList()">
                            @if (filter.invoice_number) {
                                <button matSuffix mat-icon-button
                                aria-label="Clear"
                                (click)="filter.invoice_number='';activeTab === 'All' ? getList() : getUnpaidList()">
                                <mat-icon>close</mat-icon>
                            </button>
                        }
                    </mat-form-field>
                </div>
            </td>
            <td class="!text-center">
                <div class="table-search-filters">
                    <mat-form-field class="table-input">
                        <input matInput type="text"
                        [(ngModel)]="filter.customer_type_name"
                        placeholder="Search..."
                        (keyup.enter)="activeTab === 'All' ? getList() : getUnpaidList()">
                        @if (filter.customer_type_name) {
                            <button matSuffix mat-icon-button
                            aria-label="Clear"
                            (click)="filter.customer_type_name='';activeTab === 'All' ? getList() : getUnpaidList()">
                            <mat-icon>close</mat-icon>
                        </button>
                    }
                </mat-form-field>
            </div>
        </td>
        <td class="!text-center">
            <div class="table-search-filters">
                <mat-form-field class="table-input">
                    <input matInput type="text"
                    [(ngModel)]="filter.customer_name"
                    placeholder="Search..."
                    (keyup.enter)="activeTab === 'All' ? getList() : getUnpaidList()">
                    @if (filter.customer_name) {
                        <button matSuffix mat-icon-button
                        aria-label="Clear"
                        (click)="filter.customer_name='';activeTab === 'All' ? getList() : getUnpaidList()">
                        <mat-icon>close</mat-icon>
                    </button>
                }
            </mat-form-field>
        </div>
    </td>
    <td class="!text-center">
        <div class="table-search-filters">
            <mat-form-field class="table-input">
                <input matInput type="text"
                [(ngModel)]="filter.customer_code"
                placeholder="Search..."
                (keyup.enter)="activeTab === 'All' ? getList() : getUnpaidList()">
                @if (filter.customer_code) {
                    <button matSuffix mat-icon-button
                    aria-label="Clear"
                    (click)="filter.customer_code='';activeTab === 'All' ? getList() : getUnpaidList()">
                    <mat-icon>close</mat-icon>
                </button>
            }
        </mat-form-field>
    </div>
</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr *ngFor="let row of listing; let i = index;" class="invoice-list border-b !border-defaultborder dark:!border-defaultborder/10" [class.bg-gray-400]="isHighlighted(row._id)">
    <td>{{(pagination.cur_page - 1) * pagination.limit + i + 1 }}</td>
    <td>{{row.billing_date ? (row.billing_date | date : 'dd MMM yyyy hh:mm a') : '' }}</td>
    <td>{{row.created_name ? (row.created_name | titlecase) : '---'}}</td>
    <td>
        <a (click)="goToDetail(row._id)" class="font-medium text-primary underline">
            {{row.invoice_number ? row.invoice_number : '---'}}
        </a>
    </td>
    <td>{{row.customer_type_name ? row.customer_type_name : '---'}}</td>
    <td>{{row.customer_name ? (row.customer_name | titlecase) : '---'}}</td>
    <td>{{row.customer_code ? row.customer_code : '---'}}</td>
    <ng-container *ngIf="activeTab === 'All'">
        <td class="text-right">{{row.total_item_count ? row.total_item_count : '---'}}</td>
        <td class="text-right">{{row.total_item_quantity ? row.total_item_quantity : '---'}}</td>
        <td class="text-right">₹ {{row.net_amount_with_tax ? (row.net_amount_with_tax) : '0'}}</td>
    </ng-container>
    <ng-container *ngIf="activeTab === 'Unpaid'">
        <td class="text-right">₹ {{row.net_amount ? row.net_amount : '0'}}</td>
        <td class="text-right">₹ {{row.received_amount ? row.received_amount : '0'}}</td>
        <td class="text-right">₹ {{ (row.net_amount || 0) - (row.received_amount || 0) }}</td>
    </ng-container>
    
</tr>
</ng-container>


<!-- //--skeleton--// -->
<ng-container *ngIf="skLoading">
    <tr
    class="border-b !border-defaultborder dark:!border-defaultborder/10"
    *ngFor="let row of [].constructor(5)">
    <td *ngFor="let row of [].constructor(10)">
        <app-skeleton
        [class]="'h20 bg-skeleton'"></app-skeleton>
    </td>
</tr>
</ng-container>
<!-- //--skeleton--// -->

</spk-reusable-tables>


<ng-container *ngIf="(listing.length === 0 && !skLoading && activeTab === 'Unpaid') || (listing.length === 0 && !skLoading && activeTab === 'All')">
    <app-data-not-found></app-data-not-found>
</ng-container>


<app-pagination-footer
[currentPage]="pagination.cur_page"
[totalPage]="pagination.total_pages"
[pageLimit]="pagination.limit"
[listLength]="listing.length"
[preBtn]="!pagination.prev"
[nextBtn]="!pagination.next"
(preButtonClick)="changeToPagination('Previous')"
(nextButtonClick)="changeToPagination('Next')"
(pageChange)="changeToPage($event)"></app-pagination-footer>
</div>
</div>
</div>
</div>
<!--End::row-1 -->
